<!DOCTYPE html>
<html dir="ltr" lang="zh-CN">
<head><meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/><meta content="å‰è¨€ updï¼šç¬”è€…å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™æ°´å¹³ä¸è¶³ï¼Œåœ¨çœé€‰åå¯èƒ½ä¼šè€ƒè™‘é‡æ„ï¼Œå¹¶å°†ç”Ÿæˆå‡½æ•°è®¡æ•°å’Œå½¢å¼å¹‚çº§æ•°ç§‘æŠ€åˆ†å¼€ã€‚
å¤šé¡¹å¼å…¨å®¶æ¡¶çš„æ€»ç»“ç¬”è®°ã€‚ç¯‡å¹…æé•¿ï¼Œå–„ç”¨ TOC è¿›è¡Œè·³è½¬ã€‚
å¦‚æœ‰é”™æ¼ä¹‹å¤„çƒ¦è¯·æŒ‡å‡ºã€‚
å¼€å§‹å…¨å®¶æ¡¶ä¹‹å‰ å½¢å¼åŒ–å®šä¹‰ çº¦å®šï¼š\(f_i\)ï¼ˆæˆ–è€… \([x^i]f(x)\)ï¼‰è¡¨ç¤º \(f(x)\) åœ¨ \(x^i\) å¤„çš„ç³»æ•°ï¼Œå³ä¸€ä¸ªå¤šé¡¹å¼å¯ä»¥è¡¨ç¤ºä¸º \(\displaystyle\sum_{i = 0} f_ix^i\) çš„å½¢å¼ã€‚
ä¸¤ä¸ªå¤šé¡¹å¼çš„åŠ å‡æ³•å®šä¹‰ä¸º
\[ f(x) \pm g(x) = \sum_{i = 0}(f_i \pm g_i)x^i \]
å¤æ‚åº¦ \(O(n)\)
ä¸¤ä¸ªå¤šé¡¹å¼çš„ä¹˜æ³•ï¼ˆåŠ æ³•å·ç§¯ï¼‰å®šä¹‰ä¸ºï¼š
\[ f(x)*g(x) = \sum_{i = 0}x^i\sum_{j = 0}f_jg_{i - j} \]
ä¸éš¾å‘ç°å…¶æ­£ç¡®æ€§ã€‚å¯ä»¥æ‰‹åŠ¨æ¨¡æ‹Ÿä¸€ä¸‹å¤šé¡¹å¼çš„ä¹˜æ³•çœ‹çœ‹æ˜¯ä¸æ˜¯è¿™æ ·å­çš„ã€‚å…¶æœ¬è´¨ä¹Ÿå°±æ˜¯å·å®Œä¹‹ååˆå¹¶åŒç±»é¡¹ã€‚æœ´ç´ çš„åšçš„è¯å¤æ‚åº¦æ˜¯ \(O(n^2)\) çš„ï¼Œä¸‹é¢è¦è®²çš„ FFT/NTT å¯ä»¥åŠ é€Ÿåˆ° \(O(n\log n)\)
ç•Œ æœ‰äº›æ—¶å€™ï¼Œé¢˜ç›®åªå¯¹å¤šé¡¹å¼çš„å‰è‹¥å¹²é¡¹æ„Ÿå…´è¶£ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»™è¿ç®—è®¾å®šä¸€ä¸ªä¸Šç•Œï¼Œå³ \(\pmod{x^n}\)ã€‚æ„æ€å°±æ˜¯åªè€ƒè™‘è¿™ä¸ªå¤šé¡¹å¼çš„å‰ \(n\) é¡¹ï¼Œä» \(x^n\) å¼€å§‹ä»¥åçš„å…¨éƒ¨èˆæ‰ã€‚
ä¸éš¾å‘ç°ç”±åŠ æ³•å’Œä¹˜æ³•æ˜¯ä»ä½ä½åˆ°é«˜ä½è´¡çŒ®çš„ï¼Œæ‰€ä»¥
\[ \begin{aligned} (f(x) \bmod{x^n} \pm g(x)\bmod{x^n})\bmod{x^n} &amp;amp;= (f(x) \pm g(x))\bmod{x^n}\\ (f(x) \bmod{x^n}) * (g(x)\bmod{x^n})\bmod{x^n} &amp;amp;= (f(x) * g(x))\bmod{x^n}\\ \end{aligned} \]" name="description"/><title>å¤šé¡¹å¼å…¨å®¶æ¡¶ç¬”è®°</title>
<link href="https://oi.imyangty.com/note-poly/" rel="canonical"/>
<link href="/scss/style.min.a5821f3d3ab84ce5a0ac21477e347a2e0ca00292e398d16c5e8e36ded6e35a23.css" rel="stylesheet"/><meta content="å¤šé¡¹å¼å…¨å®¶æ¡¶ç¬”è®°" property="og:title"/>
<meta content="å‰è¨€ updï¼šç¬”è€…å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™æ°´å¹³ä¸è¶³ï¼Œåœ¨çœé€‰åå¯èƒ½ä¼šè€ƒè™‘é‡æ„ï¼Œå¹¶å°†ç”Ÿæˆå‡½æ•°è®¡æ•°å’Œå½¢å¼å¹‚çº§æ•°ç§‘æŠ€åˆ†å¼€ã€‚
å¤šé¡¹å¼å…¨å®¶æ¡¶çš„æ€»ç»“ç¬”è®°ã€‚ç¯‡å¹…æé•¿ï¼Œå–„ç”¨ TOC è¿›è¡Œè·³è½¬ã€‚
å¦‚æœ‰é”™æ¼ä¹‹å¤„çƒ¦è¯·æŒ‡å‡ºã€‚
å¼€å§‹å…¨å®¶æ¡¶ä¹‹å‰ å½¢å¼åŒ–å®šä¹‰ çº¦å®šï¼š\(f_i\)ï¼ˆæˆ–è€… \([x^i]f(x)\)ï¼‰è¡¨ç¤º \(f(x)\) åœ¨ \(x^i\) å¤„çš„ç³»æ•°ï¼Œå³ä¸€ä¸ªå¤šé¡¹å¼å¯ä»¥è¡¨ç¤ºä¸º \(\displaystyle\sum_{i = 0} f_ix^i\) çš„å½¢å¼ã€‚
ä¸¤ä¸ªå¤šé¡¹å¼çš„åŠ å‡æ³•å®šä¹‰ä¸º
\[ f(x) \pm g(x) = \sum_{i = 0}(f_i \pm g_i)x^i \]
å¤æ‚åº¦ \(O(n)\)
ä¸¤ä¸ªå¤šé¡¹å¼çš„ä¹˜æ³•ï¼ˆåŠ æ³•å·ç§¯ï¼‰å®šä¹‰ä¸ºï¼š
\[ f(x)*g(x) = \sum_{i = 0}x^i\sum_{j = 0}f_jg_{i - j} \]
ä¸éš¾å‘ç°å…¶æ­£ç¡®æ€§ã€‚å¯ä»¥æ‰‹åŠ¨æ¨¡æ‹Ÿä¸€ä¸‹å¤šé¡¹å¼çš„ä¹˜æ³•çœ‹çœ‹æ˜¯ä¸æ˜¯è¿™æ ·å­çš„ã€‚å…¶æœ¬è´¨ä¹Ÿå°±æ˜¯å·å®Œä¹‹ååˆå¹¶åŒç±»é¡¹ã€‚æœ´ç´ çš„åšçš„è¯å¤æ‚åº¦æ˜¯ \(O(n^2)\) çš„ï¼Œä¸‹é¢è¦è®²çš„ FFT/NTT å¯ä»¥åŠ é€Ÿåˆ° \(O(n\log n)\)
ç•Œ æœ‰äº›æ—¶å€™ï¼Œé¢˜ç›®åªå¯¹å¤šé¡¹å¼çš„å‰è‹¥å¹²é¡¹æ„Ÿå…´è¶£ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»™è¿ç®—è®¾å®šä¸€ä¸ªä¸Šç•Œï¼Œå³ \(\pmod{x^n}\)ã€‚æ„æ€å°±æ˜¯åªè€ƒè™‘è¿™ä¸ªå¤šé¡¹å¼çš„å‰ \(n\) é¡¹ï¼Œä» \(x^n\) å¼€å§‹ä»¥åçš„å…¨éƒ¨èˆæ‰ã€‚
ä¸éš¾å‘ç°ç”±åŠ æ³•å’Œä¹˜æ³•æ˜¯ä»ä½ä½åˆ°é«˜ä½è´¡çŒ®çš„ï¼Œæ‰€ä»¥
\[ \begin{aligned} (f(x) \bmod{x^n} \pm g(x)\bmod{x^n})\bmod{x^n} &amp;amp;= (f(x) \pm g(x))\bmod{x^n}\\ (f(x) \bmod{x^n}) * (g(x)\bmod{x^n})\bmod{x^n} &amp;amp;= (f(x) * g(x))\bmod{x^n}\\ \end{aligned} \]" property="og:description"/>
<meta content="https://oi.imyangty.com/note-poly/" property="og:url"/>
<meta content="æ¸…çƒ›çš„åšå®¢" property="og:site_name"/>
<meta content="article" property="og:type"/><meta content="Post" property="article:section"/><meta content="OI" property="article:tag"/><meta content="ç¬”è®°" property="article:tag"/><meta content="FFT" property="article:tag"/><meta content="NTT" property="article:tag"/><meta content="ç”Ÿæˆå‡½æ•°" property="article:tag"/><meta content="å®¹æ–¥åŸç†" property="article:tag"/><meta content="æ‹‰æ ¼æœ—æ—¥æ’å€¼" property="article:tag"/><meta content="2021-03-13T12:41:09+08:00" property="article:published_time"/><meta content="2021-03-13T12:41:09+08:00" property="article:modified_time"/><meta content="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg23.webp" property="og:image"/>
<meta content="å¤šé¡¹å¼å…¨å®¶æ¡¶ç¬”è®°" name="twitter:title"/>
<meta content="å‰è¨€ updï¼šç¬”è€…å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™æ°´å¹³ä¸è¶³ï¼Œåœ¨çœé€‰åå¯èƒ½ä¼šè€ƒè™‘é‡æ„ï¼Œå¹¶å°†ç”Ÿæˆå‡½æ•°è®¡æ•°å’Œå½¢å¼å¹‚çº§æ•°ç§‘æŠ€åˆ†å¼€ã€‚
å¤šé¡¹å¼å…¨å®¶æ¡¶çš„æ€»ç»“ç¬”è®°ã€‚ç¯‡å¹…æé•¿ï¼Œå–„ç”¨ TOC è¿›è¡Œè·³è½¬ã€‚
å¦‚æœ‰é”™æ¼ä¹‹å¤„çƒ¦è¯·æŒ‡å‡ºã€‚
å¼€å§‹å…¨å®¶æ¡¶ä¹‹å‰ å½¢å¼åŒ–å®šä¹‰ çº¦å®šï¼š\(f_i\)ï¼ˆæˆ–è€… \([x^i]f(x)\)ï¼‰è¡¨ç¤º \(f(x)\) åœ¨ \(x^i\) å¤„çš„ç³»æ•°ï¼Œå³ä¸€ä¸ªå¤šé¡¹å¼å¯ä»¥è¡¨ç¤ºä¸º \(\displaystyle\sum_{i = 0} f_ix^i\) çš„å½¢å¼ã€‚
ä¸¤ä¸ªå¤šé¡¹å¼çš„åŠ å‡æ³•å®šä¹‰ä¸º
\[ f(x) \pm g(x) = \sum_{i = 0}(f_i \pm g_i)x^i \]
å¤æ‚åº¦ \(O(n)\)
ä¸¤ä¸ªå¤šé¡¹å¼çš„ä¹˜æ³•ï¼ˆåŠ æ³•å·ç§¯ï¼‰å®šä¹‰ä¸ºï¼š
\[ f(x)*g(x) = \sum_{i = 0}x^i\sum_{j = 0}f_jg_{i - j} \]
ä¸éš¾å‘ç°å…¶æ­£ç¡®æ€§ã€‚å¯ä»¥æ‰‹åŠ¨æ¨¡æ‹Ÿä¸€ä¸‹å¤šé¡¹å¼çš„ä¹˜æ³•çœ‹çœ‹æ˜¯ä¸æ˜¯è¿™æ ·å­çš„ã€‚å…¶æœ¬è´¨ä¹Ÿå°±æ˜¯å·å®Œä¹‹ååˆå¹¶åŒç±»é¡¹ã€‚æœ´ç´ çš„åšçš„è¯å¤æ‚åº¦æ˜¯ \(O(n^2)\) çš„ï¼Œä¸‹é¢è¦è®²çš„ FFT/NTT å¯ä»¥åŠ é€Ÿåˆ° \(O(n\log n)\)
ç•Œ æœ‰äº›æ—¶å€™ï¼Œé¢˜ç›®åªå¯¹å¤šé¡¹å¼çš„å‰è‹¥å¹²é¡¹æ„Ÿå…´è¶£ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»™è¿ç®—è®¾å®šä¸€ä¸ªä¸Šç•Œï¼Œå³ \(\pmod{x^n}\)ã€‚æ„æ€å°±æ˜¯åªè€ƒè™‘è¿™ä¸ªå¤šé¡¹å¼çš„å‰ \(n\) é¡¹ï¼Œä» \(x^n\) å¼€å§‹ä»¥åçš„å…¨éƒ¨èˆæ‰ã€‚
ä¸éš¾å‘ç°ç”±åŠ æ³•å’Œä¹˜æ³•æ˜¯ä»ä½ä½åˆ°é«˜ä½è´¡çŒ®çš„ï¼Œæ‰€ä»¥
\[ \begin{aligned} (f(x) \bmod{x^n} \pm g(x)\bmod{x^n})\bmod{x^n} &amp;amp;= (f(x) \pm g(x))\bmod{x^n}\\ (f(x) \bmod{x^n}) * (g(x)\bmod{x^n})\bmod{x^n} &amp;amp;= (f(x) * g(x))\bmod{x^n}\\ \end{aligned} \]" name="twitter:description"/><meta content="summary_large_image" name="twitter:card"/>
<meta content="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg23.webp" name="twitter:image"/>
<link href="https://q1.qlogo.cn/g?b=qq&amp;nk=375836877&amp;s=5" rel="shortcut icon"/>
<link href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/styles/github-dark-dimmed.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</head>
<body class="article-page">
<script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky">
<button aria-label="åˆ‡æ¢èœå•" class="hamburger hamburger--spin" id="toggle-menu" type="button">
<span class="hamburger-box">
<span class="hamburger-inner"></span>
</span>
</button>
<header>
<figure class="site-avatar">
<a href="/">
<img alt="Avatar" class="site-logo" height="300" loading="lazy" src="/img/avatar_huea3ce2119467b51fdd2a81393644a76d_51594_300x0_resize_q75_box.jpg" width="300"/>
</a>
<span class="emoji">ğŸ˜…</span>
</figure>
<div class="site-meta">
<h1 class="site-name"><a href="/">æ¸…çƒ›çš„åšå®¢</a></h1>
<h2 class="site-description">çƒŸç«å·²è°¢ï¼Œç¬™æ­Œæœªåœ</h2>
</div>
</header><ol class="social-menu">
<li>
<a href="mailto:i@imyangty.com" target="_blank" title="email">
<svg class="icon icon-tabler icon-tabler-mail" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
<rect height="14" rx="2" width="18" x="3" y="5"></rect>
<polyline points="3 7 12 13 21 7"></polyline>
</svg>
</a>
</li>
<li>
<a href="https://github.com/Cgfyufsygsm" target="_blank" title="GitHub">
<svg class="icon icon-tabler icon-tabler-brand-github" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
<path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path>
</svg>
</a>
</li>
<li>
<a href="https://t.me/Cgfyufsygsm" target="_blank" title="Telegram">
<svg class="icon icon-tabler icon-tabler-brand-telegram" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
<path d="M15 10l-4 4l6 6l4 -16l-18 7l4 2l2 6l3 -4"></path>
</svg>
</a>
</li>
<li>
<a href="https://twitter.com/Cgfyufsygsm" target="_blank" title="Twitter">
<svg class="icon icon-tabler icon-tabler-brand-twitter" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
<path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z"></path>
</svg>
</a>
</li>
</ol><ol class="menu" id="main-menu">
<li>
<a href="/">
<svg class="icon icon-tabler icon-tabler-home" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<polyline points="5 12 3 12 12 3 21 12 19 12"></polyline>
<path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7"></path>
<path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6"></path>
</svg>
<span>ä¸»é¡µ</span>
</a>
</li>
<li>
<a href="/about/">
<svg class="icon icon-tabler icon-tabler-user" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<circle cx="12" cy="7" r="4"></circle>
<path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2"></path>
</svg>
<span>å…³äº</span>
</a>
</li>
<li>
<a href="/idx/">
<svg class="icon icon-tabler icon-tabler-hash" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<line x1="5" x2="19" y1="9" y2="9"></line>
<line x1="5" x2="19" y1="15" y2="15"></line>
<line x1="11" x2="7" y1="4" y2="20"></line>
<line x1="17" x2="13" y1="4" y2="20"></line>
</svg>
<span>å¯¼èˆª</span>
</a>
</li>
<li>
<a href="/archives/">
<svg class="icon icon-tabler icon-tabler-archive" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<rect height="4" rx="2" width="18" x="3" y="4"></rect>
<path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10"></path>
<line x1="10" x2="14" y1="12" y2="12"></line>
</svg>
<span>å½’æ¡£</span>
</a>
</li>
<li>
<a href="/search/">
<svg class="icon icon-tabler icon-tabler-search" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<circle cx="10" cy="10" r="7"></circle>
<line x1="21" x2="15" y1="21" y2="15"></line>
</svg>
<span>æœç´¢</span>
</a>
</li>
<li>
<a href="/friends/">
<svg class="icon icon-tabler icon-tabler-link" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5"></path>
<path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"></path>
</svg>
<span>å‹é“¾</span>
</a>
</li>
<li>
<a href="https://blog.imyangty.com" target="_blank">
<svg class="icon icon-tabler icon-tabler-home" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<polyline points="5 12 3 12 12 3 21 12 19 12"></polyline>
<path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7"></path>
<path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6"></path>
</svg>
<span>ä¸»åšå®¢</span>
</a>
</li>
<div class="menu-bottom-section">
<li id="dark-mode-toggle">
<svg class="icon icon-tabler icon-tabler-toggle-left" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<circle cx="8" cy="12" r="2"></circle>
<rect height="12" rx="6" width="20" x="2" y="6"></rect>
</svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<circle cx="16" cy="12" r="2"></circle>
<rect height="12" rx="6" width="20" x="2" y="6"></rect>
</svg>
<span>æš—è‰²æ¨¡å¼</span>
</li>
</div>
</ol>
</aside>
<main class="main full-width">
<article class="has-image main-article">
<header class="article-header">
<div class="article-image">
<a href="/note-poly/">
<img alt="Featured image of post å¤šé¡¹å¼å…¨å®¶æ¡¶ç¬”è®°" loading="lazy" src="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg23.webp"/>
</a>
</div>
<div class="article-details">
<header class="article-category">
<a href="/categories/oi/">
                OI
            </a>
<a href="/categories/note/">
                ç¬”è®°
            </a>
</header>
<div class="article-title-wrapper">
<h2 class="article-title">
<a href="/note-poly/">å¤šé¡¹å¼å…¨å®¶æ¡¶ç¬”è®°</a>
</h2>
</div>
<footer class="article-time">
<div>
<svg class="icon icon-tabler icon-tabler-calendar-time" fill="none" height="56" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="56" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4"></path>
<circle cx="18" cy="18" r="4"></circle>
<path d="M15 3v4"></path>
<path d="M7 3v4"></path>
<path d="M3 11h16"></path>
<path d="M18 16.496v1.504l1 1"></path>
</svg>
<time class="article-time--published">Mar 13, 2021</time>
</div>
<div>
<svg class="icon icon-tabler icon-tabler-clock" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<circle cx="12" cy="12" r="9"></circle>
<polyline points="12 7 12 12 15 15"></polyline>
</svg>
<time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 48 åˆ†é’Ÿ
                </time>
</div>
</footer>
</div>
</header>
<section class="article-content">
<h2 id="å‰è¨€">å‰è¨€</h2>
<p>updï¼šç¬”è€…å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™æ°´å¹³ä¸è¶³ï¼Œåœ¨çœé€‰åå¯èƒ½ä¼šè€ƒè™‘é‡æ„ï¼Œå¹¶å°†ç”Ÿæˆå‡½æ•°è®¡æ•°å’Œå½¢å¼å¹‚çº§æ•°ç§‘æŠ€åˆ†å¼€ã€‚</p>
<p>å¤šé¡¹å¼å…¨å®¶æ¡¶çš„æ€»ç»“ç¬”è®°ã€‚ç¯‡å¹…æé•¿ï¼Œå–„ç”¨ TOC è¿›è¡Œè·³è½¬ã€‚</p>
<p>å¦‚æœ‰é”™æ¼ä¹‹å¤„çƒ¦è¯·æŒ‡å‡ºã€‚</p>
<h2 id="å¼€å§‹å…¨å®¶æ¡¶ä¹‹å‰">å¼€å§‹å…¨å®¶æ¡¶ä¹‹å‰</h2>
<h3 id="å½¢å¼åŒ–å®šä¹‰">å½¢å¼åŒ–å®šä¹‰</h3>
<p>çº¦å®šï¼š<span class="math inline">\(f_i\)</span>ï¼ˆæˆ–è€… <span class="math inline">\([x^i]f(x)\)</span>ï¼‰è¡¨ç¤º <span class="math inline">\(f(x)\)</span> åœ¨ <span class="math inline">\(x^i\)</span> å¤„çš„ç³»æ•°ï¼Œå³ä¸€ä¸ªå¤šé¡¹å¼å¯ä»¥è¡¨ç¤ºä¸º <span class="math inline">\(\displaystyle\sum_{i = 0} f_ix^i\)</span> çš„å½¢å¼ã€‚</p>
<p>ä¸¤ä¸ªå¤šé¡¹å¼çš„åŠ å‡æ³•å®šä¹‰ä¸º</p>
<p><span class="math display">\[
f(x) \pm g(x) = \sum_{i = 0}(f_i \pm g_i)x^i
\]</span></p>
<p>å¤æ‚åº¦ <span class="math inline">\(O(n)\)</span></p>
<p>ä¸¤ä¸ªå¤šé¡¹å¼çš„ä¹˜æ³•ï¼ˆåŠ æ³•å·ç§¯ï¼‰å®šä¹‰ä¸ºï¼š</p>
<p><span class="math display">\[
f(x)*g(x) = \sum_{i = 0}x^i\sum_{j = 0}f_jg_{i - j}
\]</span></p>
<p>ä¸éš¾å‘ç°å…¶æ­£ç¡®æ€§ã€‚å¯ä»¥æ‰‹åŠ¨æ¨¡æ‹Ÿä¸€ä¸‹å¤šé¡¹å¼çš„ä¹˜æ³•çœ‹çœ‹æ˜¯ä¸æ˜¯è¿™æ ·å­çš„ã€‚å…¶æœ¬è´¨ä¹Ÿå°±æ˜¯å·å®Œä¹‹ååˆå¹¶åŒç±»é¡¹ã€‚æœ´ç´ çš„åšçš„è¯å¤æ‚åº¦æ˜¯ <span class="math inline">\(O(n^2)\)</span> çš„ï¼Œä¸‹é¢è¦è®²çš„ FFT/NTT å¯ä»¥åŠ é€Ÿåˆ° <span class="math inline">\(O(n\log n)\)</span></p>
<h3 id="ç•Œ">ç•Œ</h3>
<p>æœ‰äº›æ—¶å€™ï¼Œé¢˜ç›®åªå¯¹å¤šé¡¹å¼çš„å‰è‹¥å¹²é¡¹æ„Ÿå…´è¶£ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»™è¿ç®—è®¾å®šä¸€ä¸ªä¸Šç•Œï¼Œå³ <span class="math inline">\(\pmod{x^n}\)</span>ã€‚æ„æ€å°±æ˜¯<strong>åªè€ƒè™‘è¿™ä¸ªå¤šé¡¹å¼çš„å‰ <span class="math inline">\(n\)</span> é¡¹</strong>ï¼Œä» <span class="math inline">\(x^n\)</span> å¼€å§‹ä»¥åçš„å…¨éƒ¨èˆæ‰ã€‚</p>
<p>ä¸éš¾å‘ç°ç”±åŠ æ³•å’Œä¹˜æ³•æ˜¯ä»ä½ä½åˆ°é«˜ä½è´¡çŒ®çš„ï¼Œæ‰€ä»¥</p>
<p><span class="math display">\[
\begin{aligned}
(f(x) \bmod{x^n} \pm g(x)\bmod{x^n})\bmod{x^n} &amp;= (f(x) \pm g(x))\bmod{x^n}\\
(f(x) \bmod{x^n}) * (g(x)\bmod{x^n})\bmod{x^n} &amp;= (f(x) * g(x))\bmod{x^n}\\
\end{aligned}
\]</span></p>
<p>ä¸‹é¢æˆ‘ä»¬å°±å¼€å§‹å­¦ä¹ å¤šé¡¹å¼çš„å„ç§æ“ä½œå§</p>
<h2 id="å¿«é€Ÿå‚…é‡Œå¶å˜æ¢fft">å¿«é€Ÿå‚…é‡Œå¶å˜æ¢ï¼ˆFFT)</h2>
<p>FFT å¯ä»¥åŠ é€Ÿå·ç§¯ï¼Œè®©æ—¶é—´å¤æ‚åº¦ä» <span class="math inline">\(O(n^2)\)</span> é™åˆ° <span class="math inline">\(O(n\log n)\)</span>ï¼Œå­¦ä¹  FFT çš„åŸºç¡€æ“ä½œå‰ï¼Œéœ€è¦å…ˆäº†è§£å¤æ•°ï¼Œå› ä¸º FFT å°±æ˜¯åŸºäºå•ä½å¤æ•°æ ¹çš„è‰¯å¥½æ€§è´¨å®ç°çš„ã€‚</p>
<h3 id="å¤æ•°åŸºç¡€">å¤æ•°åŸºç¡€</h3>
<p>ï¼ˆæ•°å­¦æ—§äººæ•™é€‰ä¿® 2-2 å†…å®¹ï¼‰</p>
<p>å®šä¹‰è™šæ•°å•ä½ <span class="math inline">\(\mathrm i = \sqrt{-1}\)</span>ï¼ŒæŠŠå½¢å¦‚ <span class="math inline">\(a + b\mathrm i\:(a,b\in\mathbb R)\)</span> çš„æ•°ç§°ä¸ºå¤æ•°ï¼Œæ‰€æœ‰å¤æ•°çš„é›†åˆç§°ä¸ºå¤æ•°é›† <span class="math inline">\(\mathbb C\)</span>ã€‚</p>
<p>å¤æ•°ä¸€èˆ¬ä½¿ç”¨ <span class="math inline">\(z\)</span> è¡¨ç¤ºï¼Œè¡¨ç¤ºä¸º <span class="math inline">\(z = a + b\mathrm i\)</span>ï¼Œè¿™ç§å½¢å¼ç§°ä¸ºå¤æ•°çš„ä»£æ•°å½¢å¼ã€‚<span class="math inline">\(a\)</span> è¢«ç§°ä¸ºå¤æ•°çš„å®éƒ¨ï¼Œ<span class="math inline">\(b\)</span> ç§°ä¸ºå¤æ•°çš„è™šéƒ¨ï¼ŒæœªåŠ è¯´æ˜çš„æƒ…å†µä¸‹ä¸€èˆ¬è®¤ä¸º <span class="math inline">\(a,b\in\mathbb R\)</span>ã€‚å¾ˆæ˜æ˜¾åœ°ï¼Œå½“ <span class="math inline">\(a = 0\land b\not=0\)</span> æ—¶ï¼Œè¿™ä¸ªå¤æ•°ä¸ºçº¯è™šæ•°ï¼Œå½“ <span class="math inline">\(b=0\)</span> æ—¶ï¼Œè¿™ä¸ªå¤æ•°ä¸ºå®æ•°ã€‚</p>
<p>æ¯ä¸ªå¤æ•° <span class="math inline">\(a + b\mathrm i\)</span> éƒ½èƒ½å¯¹åº”å¹³é¢ç›´è§’åæ ‡ç³»é‡Œé¢çš„ä¸€ä¸ªç‚¹ <span class="math inline">\((a,b)\)</span>ï¼ŒåŒæ ·çš„ä¹Ÿå¯ä»¥å¯¹åº”ä¸€ä¸ªå‘é‡ <span class="math inline">\((a,b)\)</span>ã€‚æ•…å®šä¹‰å¤æ•°çš„æ¨¡ä¸º <span class="math inline">\(\sqrt{a^2 + b^2}\)</span>ã€‚</p>
<p>å®šä¹‰å¤æ•°çš„åŠ æ³•ä¸ä¹˜æ³•ï¼š <span class="math display">\[
\begin{aligned}
&amp;(a + b\mathrm i) + (c + d\mathrm i)\\
=&amp;(a + c) + (b + d)\mathrm i
\end{aligned}
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
&amp;(a+b\mathrm i)(c + d\mathrm i)\\
=&amp;ac + ad\mathrm i + cb\mathrm i + bd\mathrm i^2\\
=&amp;(ac - bd) + (ad + bc)\mathrm i
\end{aligned}
\]</span></p>
<p>è¿™éƒ½æ˜¯æ¯”è¾ƒæ˜¾ç„¶çš„ã€‚</p>
<p>å®¹æ˜“çœ‹å‡ºå¤æ•°æ»¡è¶³å¾ˆå¤šå®æ•°çš„è¿ç®—å¾‹ã€‚</p>
<p>å®šä¹‰å¤æ•° <span class="math inline">\(z=a+b\mathrm i\)</span> çš„å…±è½­å¤æ•°ä¸º <span class="math inline">\(\overline{z} = a - b\mathrm i\)</span>ï¼Œä¸éš¾å‘ç° <span class="math inline">\(z\)</span> ä¸ <span class="math inline">\(\overline{z}\)</span> å…³äºå®è½´å¯¹ç§°ã€‚ <span class="math display">\[
z\overline z=(a+b\mathrm i)(a-b\mathrm i) = a^2 + b^2=|z|^2
\]</span> å¤æ•°æ—¢ç„¶å¯ä»¥å¯¹åº”å¹³é¢ç›´è§’åæ ‡ç³»ä¸­çš„å‘é‡ï¼Œä¸éš¾å‘ç°å…¶å¯ä»¥ä½¿ç”¨å…¶æ¨¡é•¿ä¸è¾è§’æ¥è¡¨ç¤ºï¼š <span class="math display">\[
z=a+b\mathrm i\iff z = r(\cos\theta+\mathrm i\sin\theta)
\]</span> å…¶ä¸­ <span class="math inline">\(r\)</span> ä¸º <span class="math inline">\(z\)</span> çš„æ¨¡é•¿ï¼Œ<span class="math inline">\(\theta\)</span> ä¸ºå…¶è¾è§’ã€‚å³æˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªå¤æ•°è¡¨ç¤ºæˆäºŒå…ƒç»„ <span class="math inline">\((r,\theta)\)</span> çš„å½¢å¼ã€‚</p>
<p>ç°åœ¨è€ƒè™‘ä¸¤ä¸ªå¤æ•° <span class="math inline">\((r_1,\theta_1)\)</span> ä¸ <span class="math inline">\((r_2,\theta_2)\)</span> ç›¸ä¹˜å¾—åˆ°çš„ç»“æœï¼š <span class="math display">\[
\begin{aligned}
(r_1,\theta_1)\times(r_2,\theta_2) &amp;= r_1(\cos\theta_1 + \mathrm i\sin\theta_1)r_2(\cos\theta_2 + \mathrm i\sin\theta_2)\\
&amp;=r_1r_2(\cos\theta_1\cos\theta_2 - \sin\theta_1\sin\theta_2 + \mathrm i\sin\theta_1\cos\theta_2 + \mathrm i\sin\theta_2\cos\theta_1)\\
&amp;=r_1r_2\left(\cos(\theta_1 + \theta_2) + \mathrm i\sin(\theta_1 + \theta_2)\right)\\
&amp;=(r_1r_2,\theta_1 + \theta_2)
\end{aligned}
\]</span> äºæ˜¯æˆ‘ä»¬å¯ä»¥æ¦‚æ‹¬å¤æ•°ä¹˜æ³•çš„æ³•åˆ™ï¼šæ¨¡é•¿ç›¸ä¹˜ï¼Œè¾è§’ç›¸åŠ ã€‚ï¼ˆä¸Šè¿°æ¨å¯¼éœ€è¦æŒæ¡åŸºæœ¬çš„ä¸‰è§’æ’ç­‰å˜æ¢ï¼‰</p>
<h3 id="ä»æ¬§æ‹‰å…¬å¼åˆ°å•ä½åœ†">ä»æ¬§æ‹‰å…¬å¼åˆ°å•ä½åœ†</h3>
<p>ç»™å‡ºå¤æ•°æŒ‡æ•°å¹‚çš„å®šä¹‰ï¼š <span class="math display">\[
\mathrm e^{x +y\mathrm i} = e^x(\cos y + \mathrm i\sin y)
\]</span> è¿™ä¸ªå…¬å¼æ˜¯åŸºäºå¦‚ä¸‹äº‹å®ï¼ˆå¯ä»¥ç†è§£ä¸ºè¿™å‡ ä¸ªå‡½æ•°åœ¨ <span class="math inline">\(x = 0\)</span> å¤„çš„æ³°å‹’å±•å¼€ï¼‰ï¼š <span class="math display">\[
\begin{aligned}
\sin(x) &amp;= x - \frac{x^3}{3!}+\frac{x^5}{5!} - \frac{x^7}{7!} + \frac{x^9}{9!} + \cdots = \sum_{k = 1}^\infty\frac{(-1)^{k - 1}x^{2k - 1}}{(2k-1)!}\\
\cos(x) &amp;= 1 - \frac{x^2}{2!} + \frac{x^4}{4!} - \frac{x^6}{6!} + \frac{x^8}{8!} + \cdots = \sum_{k = 0}^\infty\frac{(-1)^{k} x^{2k}}{(2k)!}\\
\mathrm e^x &amp;= 1 + x + \frac{x^2}{2!} + \frac{x^3}{3!} + \frac{x^4}{4!} + \cdots = \sum_{k = 0}^\infty\frac{x^k}{k!}
\end{aligned}
\]</span> å°† <span class="math inline">\(x + y\mathrm i\)</span> ä»£å…¥è¿›å»å³å¯æ¨å¯¼ã€‚</p>
<p>å¦‚æœ <span class="math inline">\(x = 0\)</span>ï¼Œæˆ‘ä»¬å°±å¾—åˆ°å¤§åé¼é¼çš„æ¬§æ‹‰å…¬å¼ï¼š <span class="math display">\[
\mathrm e^{x\mathrm i} = \cos x + \mathrm i\sin x
\]</span> æ›´ç‰¹æ®Šåœ°ï¼Œå¦‚æœ <span class="math inline">\(x = \pi\)</span>ï¼Œå¾—åˆ°çš„å°±æ˜¯ä¸‹é¢è¿™ä¸ªç¥å¥‡çš„å¼å­ï¼š <span class="math display">\[
\mathrm e^{\pi\mathrm i} = -1
\]</span> å¤å¹³é¢ä¸Šæˆ‘ä»¬å¯ä»¥å®šä¹‰ç±»ä¼¼äºå¹³é¢ç›´è§’åæ ‡ç³»ä¸Šçš„å•ä½åœ†ï¼Œå•ä½åœ†ä¸Šçš„æ‰€æœ‰å¤æ•°æ„æˆé›†åˆ <span class="math inline">\(\{z: |z| = 1\}\)</span>ã€‚è¿™äº›å¤æ•°éƒ½å¯ä»¥è¡¨ç¤ºä¸º <span class="math inline">\(\cos\theta + \mathrm i\sin\theta\)</span> æˆ– <span class="math inline">\(e^{\theta \mathrm i}\)</span> çš„å½¢å¼ã€‚</p>
<h3 id="å¤šé¡¹å¼çš„è¡¨ç¤ºæ³•">å¤šé¡¹å¼çš„è¡¨ç¤ºæ³•</h3>
<p>ç³»æ•°è¡¨ç¤ºæ³•ï¼šé¡¾åæ€ä¹‰ <span class="math display">\[
f(x) = a_0 + a_1x + a_2x^2 + \cdots + a_nx^n\iff f(x) = \{a_0,a_1,a_2,\cdots,a_n\} = 
\begin{bmatrix}
x^0 &amp; x^1 &amp; x^2 &amp;\cdots &amp; x^n
\end{bmatrix}
\begin{bmatrix}
a_0\\a_1\\a_2\\\vdots\\a_n
\end{bmatrix}
\]</span> ç‚¹å€¼è¡¨ç¤ºæ³•ï¼š</p>
<p>æˆ‘ä»¬çŸ¥é“ç”±ä¸€ä¸ªå¤šé¡¹å¼åœ¨ <span class="math inline">\(n + 1\)</span> ä¸ªç‚¹ä¸Šçš„å–å€¼æ˜¯å¯ä»¥å”¯ä¸€ç¡®å®šä¸€ä¸ªå¤šé¡¹å¼çš„ï¼Œå…¶æœ¬è´¨ä¹Ÿå°±æ˜¯çº¿æ€§æ–¹ç¨‹ç»„çš„è§£ã€‚æ‰€ä»¥ä¸€ä¸ª <span class="math inline">\(n\)</span> æ¬¡å¤šé¡¹å¼å¯ä»¥ç”¨ <span class="math inline">\(n + 1\)</span> ä¸ªç‚¹è¡¨ç¤ºï¼š</p>
<p><span class="math display">\[
f(x) = \{(x_0,y_0),(x_1,y_1),\cdots,(x_n,y_n)\}
\]</span></p>
<p>æˆ–è€…ï¼š</p>
<p><span class="math display">\[
\begin{bmatrix}
x_0^0 &amp; x_0^1 &amp; x_0^2 &amp;\cdots &amp;x_0^n\\
x_1^0 &amp; x_1^1 &amp; x_1^2 &amp;\cdots &amp; x_1^n\\
\vdots &amp; \vdots &amp; \vdots &amp; &amp;\vdots\\
x_n^0 &amp; x_n^1 &amp; x_n^2 &amp; \cdots &amp; x_n^n
\end{bmatrix}\begin{bmatrix}
a_0\\a_1\\ \vdots \\ a_n
\end{bmatrix}
=\begin{bmatrix}
y_0\\y_1\\ \vdots\\ y_n
\end{bmatrix}
\]</span></p>
<p>é€šè¿‡ä¸‹é¢çš„è¿™ä¸ªå½¢å¼æˆ‘ä»¬çœ‹å¾—å‡ºæ¥å…¶å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„çº¿æ€§æ–¹ç¨‹ç»„çš„å½¢å¼ï¼Œä¸éš¾è¯æ˜å…¶è§£çš„å”¯ä¸€æ€§ã€‚</p>
<p>å¹¶ä¸”æˆ‘ä»¬å‘ç°ç‚¹å€¼è¡¨ç¤ºæ³•æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„ä¼˜åŠ¿ï¼šå¯ä»¥åœ¨ <span class="math inline">\(O(n)\)</span> çš„æ—¶é—´å†…å°†ä¸¤ä¸ªå¤šé¡¹å¼ä¹˜èµ·æ¥ï¼Œåªéœ€æŠŠå¯¹åº”ç‚¹çš„ <span class="math inline">\(y\)</span> ä¹˜èµ·æ¥å³å¯ã€‚</p>
<p>é€šä¿—çš„æ¥è¯´ï¼ŒFFT å®ç°çš„å°±æ˜¯å¿«é€Ÿæ±‚å¤šé¡¹å¼ä¹˜æ³•çš„è¿‡ç¨‹ï¼šå…ˆæŠŠç³»æ•°è¡¨ç¤ºæ³•è½¬æˆç‚¹å€¼è¡¨ç¤ºæ³•ï¼ˆDFTï¼Œç¦»æ•£å‚…é‡Œå¶å˜æ¢ï¼‰ï¼Œä¹˜å®Œä¹‹åå†æŠŠç‚¹å€¼è¿˜åŸä¸ºæ’å€¼ï¼ˆIDFTï¼Œç¦»æ•£å‚…é‡Œå¶é€†å˜æ¢ï¼‰ã€‚å¯æ˜¯æœ´ç´ çš„ DFT éœ€è¦çš„æ—¶é—´å¤æ‚åº¦ä¸º <span class="math inline">\(O(n^2)\)</span>ï¼ŒIDFT è¿˜å›å…¶ç³»æ•°éœ€è¦é«˜æ–¯æ¶ˆå…ƒæ˜¯ <span class="math inline">\(O(n^3)\)</span> çš„ã€‚è€Œ FFT åˆ©ç”¨äº†ä¸€äº›å¾ˆç‰¹æ®Šå¾ˆç‰¹æ®Šçš„å€¼åŠ é€Ÿäº† DFT å’Œ IDFT çš„è¿‡ç¨‹ï¼Œä½¿å¾—æ€»æ—¶é—´å¤æ‚åº¦é™ä½åˆ°äº† <span class="math inline">\(O(n\log n)\)</span>ã€‚</p>
<h3 id="å•ä½å¤æ•°æ ¹">å•ä½å¤æ•°æ ¹</h3>
<p>è§£è¿™ä¸ªæ–¹ç¨‹ï¼š <span class="math display">\[
x^n = 1
\]</span> æˆ‘ä»¬ä¼šå‘ç°è¿™ä¸ªæ–¹ç¨‹åœ¨å®æ•°èŒƒå›´å†…åªæœ‰ <span class="math inline">\(1\)</span> æˆ–è€… <span class="math inline">\(2\)</span> ä¸ªè§£ã€‚ç„¶è€Œä»£æ•°åŸºæœ¬å®šç†å‘Šè¯‰æˆ‘ä»¬è¿™æ ·çš„æ–¹ç¨‹æœ‰ <span class="math inline">\(n\)</span> ä¸ªå¤æ•°åŸŸä¸Šçš„è§£ã€‚ç”±æ¨¡é•¿ç›¸ä¹˜è¾è§’ç›¸åŠ æˆ‘ä»¬çŸ¥é“å› ä¸ºæœ€ç»ˆ <span class="math inline">\(x^n = 1\)</span>ï¼Œæ‰€ä»¥è¿™äº›æ»¡è¶³æ¡ä»¶çš„ <span class="math inline">\(x\)</span> çš„æ¨¡é•¿å¿…å®šä¹Ÿæ˜¯ <span class="math inline">\(1\)</span>ã€‚ç„¶åéœ€è¦æ»¡è¶³ä»–ä»¬çš„è¾è§’çš„ <span class="math inline">\(n\)</span> å€èƒ½è¢« <span class="math inline">\(2\pi\)</span> æ•´é™¤ã€‚</p>
<p>ä¸éš¾å‘ç°å…¶å°±æ˜¯ <span class="math inline">\(n\)</span> ç­‰åˆ†å•ä½åœ†ï¼š</p>
<figure>
<img alt="" src="https://oi-wiki.org/math/poly/images/fft2.jpg"/><figcaption>img</figcaption>
</figure>
<p>æˆ‘ä»¬è®° <span class="math inline">\(n\)</span> æ¬¡å•ä½æ ¹çš„ç¬¬ <span class="math inline">\(k\)</span> ä¸ªè®°ä¸º <span class="math inline">\(\omega_n^k\)</span>ï¼Œä¸éš¾å‘ç° <span class="math inline">\(\omega_k^n = \mathrm e^{\frac{2k\pi i}{n}}\)</span>ã€‚ç”±æ­¤å¯è§ï¼Œå•ä½å¤æ•°æ ¹å…·æœ‰ä¸€äº›éå¸¸å¥½çš„æ€§è´¨æ¯”å¦‚ï¼š <span class="math display">\[
\begin{aligned}
\omega_n^0 = \omega_n^n &amp;= 1\\
\omega_n^k &amp;= \omega_{2n}^{2k}\\
\omega_{2n}^{k + n} &amp;= -\omega_{2n}^k\\
\left(\omega_{2n}^{k + n}\right)^2 &amp;=\omega_n^k 
\end{aligned}
\]</span> åˆ©ç”¨è¿™äº›æ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥åŠ é€Ÿ DFT çš„è¿‡ç¨‹ã€‚FFT å°±æ˜¯åˆ©ç”¨åˆ†æ²»æ€æƒ³åŠ é€Ÿæ±‚æ¯ä¸ª <span class="math inline">\(f(\omega_n^k)\)</span> çš„å€¼</p>
<h3 id="dft">DFT</h3>
<p>æ­¤æ—¶ DFT çš„åˆ†æ²»æ€æƒ³å°±æ˜¯åˆ†å¼€è€ƒè™‘å¥‡æ¬¡é¡¹å’Œå¶æ¬¡é¡¹ï¼š</p>
<p>è€ƒè™‘ <span class="math display">\[
f(x) = a_0x^0 + a_1x^1 + a_2x^2 + \cdots
\]</span> å°†å…¶åˆ†ä¸ºä¸¤ä¸ªå¤šé¡¹å¼ <span class="math display">\[
\begin{aligned}
f(x) &amp;= a_0x^0 + a_2x^2 + a_4x^4 + a_6x^6 + a_8x^8 + \cdots +a_1x^1 + a_3x^3 + a_5x^5 + a_7x^7 + a_9x^9 + \cdots\\
&amp;= a_0x^0 + a_2x^2 + a_4x^4 + a_6x^6 + a_8x^8+\cdots +x(a_1x^0 + a_3x^2 + a_5x^4 + a_7x^6 + \cdots)
\end{aligned}
\]</span> è€ƒè™‘ä¸¤ä¸ªæ–°å¤šé¡¹å¼ï¼š <span class="math display">\[
\begin{aligned}
f_0(x) &amp;= a_0x^0 + a_2x^1 + a_4x^2 + a_6x^3 + \cdots\\
f_1(x) &amp;= a_1x^0 + a_3x^1 + a_5x^2 + a_7x^3 + \cdots
\end{aligned}
\]</span> ä¸éš¾å‘ç° <span class="math display">\[
f(x) = f_0(x^2) + xf_1(x^2)
\]</span> åˆ©ç”¨å•ä½å¤æ•°æ ¹çš„æ€§è´¨ï¼š <span class="math display">\[
\begin{aligned}
\mathrm{DFT}(f(\omega_n^k)) &amp;= \mathrm{DFT}(f_0(\omega_n^{2k})) + \omega_n^k\mathrm{DFT}(f_1(\omega_n^{2k}))\\
&amp;=\mathrm{DFT}(f_0(\omega_{\frac n2^k})) + \omega_n^k\mathrm{DFT}(f_1(\omega_{\frac n2^k}))
\end{aligned}
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
\mathrm{DFT}(f(\omega_n^{k + \frac n2})) &amp;= \mathrm{DFT}(f_0(\omega_n^{2k + n})) + \omega_{n}^{k + \frac n2}\mathrm{DFT}(f_1(\omega_n^{2k + n}))\\
&amp;=\mathrm{DFT}(f_0(\omega_n^n\omega_n^{2k})) - \omega_n^k\mathrm{DFT}(f_1(\omega_n^n\omega_n^{2k}))\\
&amp;=\mathrm{DFT}(f_0(\omega_{\frac n2^k})) - \omega_n^k\mathrm{DFT}(f_1(\omega_{\frac n2^k}))
\end{aligned}
\]</span></p>
<p>å…¶ä¸­ <span class="math inline">\(k &lt; \displaystyle\frac n2\)</span>ã€‚ä¸éš¾å‘ç°åªè¦æˆ‘ä»¬æ±‚å¾—å‡º <span class="math inline">\(\mathrm{DFT}(f_0(\omega_{\frac n2^k}))\)</span> ä¸ <span class="math inline">\(\mathrm{DFT}(f_1(\omega_{\frac n2^k}))\)</span> çš„è¯ï¼Œå°±å¯ä»¥åŒæ—¶æ±‚å‡º <span class="math inline">\(\mathrm{DFT}(f(\omega_n^k))\)</span> å’Œ <span class="math inline">\(\mathrm{DFT}(f(\omega_n^{k + \frac n2}))\)</span>ã€‚æ¥ä¸‹æ¥å†å¯¹ <span class="math inline">\(f_0\)</span> ä¸ <span class="math inline">\(f_1\)</span> é€’å½’ DFT å³å¯ã€‚å…¶æ—¶é—´å¤æ‚åº¦å‡½æ•°æ˜¯å½¢å¦‚ä¸‹é¢è¿™æ ·çš„ï¼š <span class="math display">\[
T(n) = T(n/2) + O(n)
\]</span> æ‰€ä»¥æ€»å¤æ‚åº¦ä¸º <span class="math inline">\(\Theta(n\log n)\)</span></p>
<p>å®é™…å®ç°çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„ä¼ è¿›å»çš„ç³»æ•°ä¸€å®šè¦æ˜¯ <span class="math inline">\(2^m\)</span> ä¸ªçš„ï¼Œä¸ç„¶åˆ†æ²»çš„è¿‡ç¨‹ä¸­å·¦å³ä¸ä¸€æ ·ä¼šå‡ºé—®é¢˜ã€‚ç¬¬ä¸€æ¬¡ä¼ è¿›å»çš„æ—¶å€™å°±é«˜ä½è¡¥ <span class="math inline">\(0\)</span>ï¼Œè¡¥æˆæœ€é«˜é¡¹æ¬¡æ•°ä¸º <span class="math inline">\(2^{m - 1}\)</span> çš„å¤šé¡¹å¼ã€‚</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a aria-hidden="true" href="#cb1-1"></a><span class="dt">void</span> dft(<span class="dt">int</span> lim, complex *a)</span>
<span id="cb1-2"><a aria-hidden="true" href="#cb1-2"></a>{</span>
<span id="cb1-3"><a aria-hidden="true" href="#cb1-3"></a>    <span class="cf">if</span> (lim == <span class="dv">1</span>) <span class="cf">return</span>;<span class="co">//å¸¸æ•°é¡¹ç›´æ¥è¿”å›</span></span>
<span id="cb1-4"><a aria-hidden="true" href="#cb1-4"></a>    complex a1[lim &gt;&gt; <span class="dv">1</span>], a2[lim &gt;&gt; <span class="dv">1</span>];</span>
<span id="cb1-5"><a aria-hidden="true" href="#cb1-5"></a>    <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; lim; i += <span class="dv">2</span>)</span>
<span id="cb1-6"><a aria-hidden="true" href="#cb1-6"></a>        a1[i &gt;&gt; <span class="dv">1</span>] = a[i], a2[i &gt;&gt; <span class="dv">1</span>] = a[i + <span class="dv">1</span>];<span class="co">//æŠŠç³»æ•°æŒ‰ç…§å¥‡å¶åˆ†å¼€</span></span>
<span id="cb1-7"><a aria-hidden="true" href="#cb1-7"></a>    dft(lim &gt;&gt; <span class="dv">1</span>, a1, type);<span class="co">//æ±‚ DFT(f_0())</span></span>
<span id="cb1-8"><a aria-hidden="true" href="#cb1-8"></a>    dft(lim &gt;&gt; <span class="dv">1</span>, a2, type);<span class="co">//æ±‚ DFT(f_1())</span></span>
<span id="cb1-9"><a aria-hidden="true" href="#cb1-9"></a>    complex Wn = complex(cos(<span class="fl">2.0</span> * pi / lim), sin(<span class="fl">2.0</span> * pi / lim)), w = complex(<span class="dv">1</span>, <span class="dv">0</span>);</span>
<span id="cb1-10"><a aria-hidden="true" href="#cb1-10"></a>    <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; (lim &gt;&gt; <span class="dv">1</span>); ++i, w = w * Wn)</span>
<span id="cb1-11"><a aria-hidden="true" href="#cb1-11"></a>    {</span>
<span id="cb1-12"><a aria-hidden="true" href="#cb1-12"></a>        a[i] = a1[i] + w * a2[i];<span class="co">//æ±‚ DFT(f(\omega_n^k))</span></span>
<span id="cb1-13"><a aria-hidden="true" href="#cb1-13"></a>        a[i + (lim &gt;&gt; <span class="dv">1</span>)] = a1[i] - w * a2[i];<span class="co">//æ±‚ DFT(f(\omega_n^{k+\fracn2}))</span></span>
<span id="cb1-14"><a aria-hidden="true" href="#cb1-14"></a>    }</span>
<span id="cb1-15"><a aria-hidden="true" href="#cb1-15"></a>    <span class="cf">return</span>;</span>
<span id="cb1-16"><a aria-hidden="true" href="#cb1-16"></a>}</span></code></pre></div>
<h3 id="idft">IDFT</h3>
<p>å¥½äº†ç°åœ¨å‡è£…æˆ‘ä»¬å·²ç»æ±‚å‡ºäº†ä¸¤ä¸ªå¤šé¡¹å¼çš„ç‚¹å€¼è¡¨è¾¾å¹¶å·²ç»å°†ä»–ä»¬ä¹˜èµ·æ¥ï¼Œä½†æ˜¯æˆ‘ä»¬æœ€ç»ˆè¿˜æ˜¯è¦æŠŠä»–è¿˜åŸå›å»åˆ°ç³»æ•°è¡¨ç¤ºçš„ã€‚è¿™ä¸ªè¿‡ç¨‹å°±å«åš IDFTã€‚</p>
<p>å…¶å®å°±æ˜¯æˆ‘ä»¬éœ€è¦æ±‚è§£ä¸‹é¢å…³äº <span class="math inline">\(a\)</span> çš„çº¿æ€§æ–¹ç¨‹ç»„ï¼š</p>
<p><span class="math display">\[
\begin{bmatrix}
(\omega_n^0)^0 &amp; (\omega_n^0)^1 &amp; (\omega_n^0)^2 &amp;\cdots &amp;(\omega_n^0)^n\\
(\omega_n^1)^0 &amp; (\omega_n^1)^1 &amp; (\omega_n^1)^2 &amp;\cdots &amp; (\omega_n^1)^n\\
\vdots &amp; \vdots &amp; \vdots &amp; &amp;\vdots\\
(\omega_n^{n})^0 &amp; (\omega_n^{n})^1 &amp; (\omega_n^{n})^2 &amp; \cdots &amp; (\omega_n^n)^n
\end{bmatrix}
\begin{bmatrix}
a_0\\a_1\\ \vdots \\ a_n
\end{bmatrix}=\begin{bmatrix}
y_0\\y_1\\ \vdots\\ y_n
\end{bmatrix}
\]</span></p>
<p>æˆ‘ä»¬å°†å…¶ä¹˜ä¸Šå·¦è¾¹çŸ©é˜µçš„é€†ï¼š</p>
<p><span class="math display">\[
\begin{bmatrix}
a_0\\a_1\\ \vdots \\ a_n
\end{bmatrix}=\begin{bmatrix}
(\omega_n^0)^0 &amp; (\omega_n^0)^1 &amp; (\omega_n^0)^2 &amp;\cdots &amp;(\omega_n^0)^n\\
(\omega_n^1)^0 &amp; (\omega_n^1)^1 &amp; (\omega_n^1)^2 &amp;\cdots &amp; (\omega_n^1)^n\\
\vdots &amp; \vdots &amp; \vdots &amp; &amp;\vdots\\
(\omega_n^{n})^0 &amp; (\omega_n^{n})^1 &amp; (\omega_n^{n})^2 &amp; \cdots &amp; (\omega_n^n)^n
\end{bmatrix}^{-1}
\begin{bmatrix}
y_0\\y_1\\ \vdots\\ y_n
\end{bmatrix}
\]</span></p>
<p>æ¨¡ç›¸åŒçš„æ­£äº¤åˆ—å‘é‡æ„æˆçš„çŸ©é˜µçš„é€†æ˜¯è½¬ç½®çš„æ¨¡åˆ†ä¹‹ä¸€å€ï¼Œæ‰€ä»¥ï¼š</p>
<p><span class="math display">\[
\begin{bmatrix}
(\omega_n^0)^0 &amp; (\omega_n^0)^1 &amp; (\omega_n^0)^2 &amp;\cdots &amp;(\omega_n^0)^n\\
(\omega_n^1)^0 &amp; (\omega_n^1)^1 &amp; (\omega_n^1)^2 &amp;\cdots &amp; (\omega_n^1)^n\\
\vdots &amp; \vdots &amp; \vdots &amp; &amp;\vdots\\
(\omega_n^{n})^0 &amp; (\omega_n^{n})^1 &amp; (\omega_n^{n})^2 &amp; \cdots &amp; (\omega_n^n)^n
\end{bmatrix}^{-1} =\frac {1}{n+1} \begin{bmatrix}
(\omega_n^{-0})^0 &amp; (\omega_n^{-0})^1 &amp; (\omega_n^{-0})^2 &amp;\cdots &amp;(\omega_n^{-0})^n\\
(\omega_n^{-1})^0 &amp; (\omega_n^{-1})^1 &amp; (\omega_n^{-1})^2 &amp;\cdots &amp; (\omega_n^{-1})^n\\
\vdots &amp; \vdots &amp; \vdots &amp; &amp;\vdots\\
(\omega_n^{-n})^0 &amp; (\omega_n^{-n})^1 &amp; (\omega_n^{-n})^2 &amp; \cdots &amp; (\omega_n^{-n})^n
\end{bmatrix}
\]</span></p>
<p>æ‰€ä»¥ä¸éš¾å‘ç°ï¼ŒIDFT å…¶å®å°±æ˜¯å†åšäº†ä¸€é DFTï¼Œåªä¸è¿‡æ˜¯åèµ·æ¥çš„ã€‚åªæ˜¯ç®—å‡ºæ¥æœ€åçš„ç³»æ•°ç»“æœéƒ½è¦é™¤ä»¥ç‚¹å€¼çš„ä¸ªæ•°ï¼Œåæ˜ åœ¨ä»£ç é‡Œé¢å°±æ˜¯é‚£ä¸ª <code>lim</code> å˜é‡ã€‚</p>
<p>ä¸éš¾å‘ç° <span class="math inline">\(\omega_n^k\)</span> çš„å…±è½­å°±æ˜¯è™šéƒ¨å–åï¼Œæ‰€ä»¥å¯ä»¥åœ¨ DFT å‡½æ•°é‡Œé¢ä¼ ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦ä¸º IDFTã€‚</p>
<p>è¿™æ ·å­ä¸€ä¸ªé€’å½’ç‰ˆçš„ FFT å°±å†™å®Œäº†ï¼Œæ€»ä½“çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a aria-hidden="true" href="#cb2-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span>
<span id="cb2-2"><a aria-hidden="true" href="#cb2-2"></a><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></span>
<span id="cb2-3"><a aria-hidden="true" href="#cb2-3"></a><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></span>
<span id="cb2-4"><a aria-hidden="true" href="#cb2-4"></a><span class="pp">#define FOR</span>(i,<span class="pp"> </span>a,<span class="pp"> </span>b)<span class="pp"> </span><span class="cf">for</span><span class="pp"> </span>(<span class="dt">int</span><span class="pp"> </span>i<span class="pp"> </span>=<span class="pp"> </span>a;<span class="pp"> </span>i<span class="pp"> </span>&lt;=<span class="pp"> </span>b;<span class="pp"> </span>++i)</span>
<span id="cb2-5"><a aria-hidden="true" href="#cb2-5"></a></span>
<span id="cb2-6"><a aria-hidden="true" href="#cb2-6"></a><span class="at">const</span> <span class="dt">int</span> maxn = <span class="fl">2e6</span> + <span class="dv">5</span>;</span>
<span id="cb2-7"><a aria-hidden="true" href="#cb2-7"></a><span class="at">const</span> <span class="dt">double</span> pi = acos(-<span class="fl">1.0</span>);</span>
<span id="cb2-8"><a aria-hidden="true" href="#cb2-8"></a></span>
<span id="cb2-9"><a aria-hidden="true" href="#cb2-9"></a><span class="kw">inline</span> <span class="dt">int</span> read()</span>
<span id="cb2-10"><a aria-hidden="true" href="#cb2-10"></a>{</span>
<span id="cb2-11"><a aria-hidden="true" href="#cb2-11"></a>    <span class="dt">char</span> c = getchar();</span>
<span id="cb2-12"><a aria-hidden="true" href="#cb2-12"></a>    <span class="dt">int</span> s = <span class="dv">0</span>;</span>
<span id="cb2-13"><a aria-hidden="true" href="#cb2-13"></a>    <span class="cf">while</span> (!isdigit(c))</span>
<span id="cb2-14"><a aria-hidden="true" href="#cb2-14"></a>        c = getchar();</span>
<span id="cb2-15"><a aria-hidden="true" href="#cb2-15"></a>    <span class="cf">while</span> (isdigit(c))</span>
<span id="cb2-16"><a aria-hidden="true" href="#cb2-16"></a>        s = <span class="dv">10</span> * s + c - <span class="ch">'0'</span>, c = getchar();</span>
<span id="cb2-17"><a aria-hidden="true" href="#cb2-17"></a>    <span class="cf">return</span> s;</span>
<span id="cb2-18"><a aria-hidden="true" href="#cb2-18"></a>}</span>
<span id="cb2-19"><a aria-hidden="true" href="#cb2-19"></a></span>
<span id="cb2-20"><a aria-hidden="true" href="#cb2-20"></a><span class="kw">struct</span> complex</span>
<span id="cb2-21"><a aria-hidden="true" href="#cb2-21"></a>{</span>
<span id="cb2-22"><a aria-hidden="true" href="#cb2-22"></a>    <span class="dt">double</span> x, y;</span>
<span id="cb2-23"><a aria-hidden="true" href="#cb2-23"></a>    complex(<span class="dt">double</span> xx = <span class="dv">0</span>, <span class="dt">double</span> yy = <span class="dv">0</span>)</span>
<span id="cb2-24"><a aria-hidden="true" href="#cb2-24"></a>    {</span>
<span id="cb2-25"><a aria-hidden="true" href="#cb2-25"></a>        x = xx, y = yy;</span>
<span id="cb2-26"><a aria-hidden="true" href="#cb2-26"></a>    }</span>
<span id="cb2-27"><a aria-hidden="true" href="#cb2-27"></a>} a[maxn], b[maxn];</span>
<span id="cb2-28"><a aria-hidden="true" href="#cb2-28"></a></span>
<span id="cb2-29"><a aria-hidden="true" href="#cb2-29"></a>complex <span class="kw">operator</span>+(<span class="at">const</span> complex &amp;a, <span class="at">const</span> complex &amp;b) {<span class="cf">return</span> complex(a.x + b.x, a.y + b.y);}</span>
<span id="cb2-30"><a aria-hidden="true" href="#cb2-30"></a>complex <span class="kw">operator</span>-(<span class="at">const</span> complex &amp;a, <span class="at">const</span> complex &amp;b) {<span class="cf">return</span> complex(a.x - b.x, a.y - b.y);}</span>
<span id="cb2-31"><a aria-hidden="true" href="#cb2-31"></a>complex <span class="kw">operator</span>*(<span class="at">const</span> complex &amp;a, <span class="at">const</span> complex &amp;b) {<span class="cf">return</span> complex(a.x * b.x - a.y * b.y, a.x * b.y + a.y * b.x);}</span>
<span id="cb2-32"><a aria-hidden="true" href="#cb2-32"></a></span>
<span id="cb2-33"><a aria-hidden="true" href="#cb2-33"></a><span class="dt">void</span> dft(<span class="dt">int</span> lim, complex *a, <span class="dt">int</span> type)<span class="co">//type = 1 DFTï¼›type = -1 IDFT</span></span>
<span id="cb2-34"><a aria-hidden="true" href="#cb2-34"></a>{</span>
<span id="cb2-35"><a aria-hidden="true" href="#cb2-35"></a>    <span class="cf">if</span> (lim == <span class="dv">1</span>) <span class="cf">return</span>;<span class="co">//è¿”å›å¸¸æ•°é¡¹</span></span>
<span id="cb2-36"><a aria-hidden="true" href="#cb2-36"></a>    complex a1[lim &gt;&gt; <span class="dv">1</span>], a2[lim &gt;&gt; <span class="dv">1</span>];</span>
<span id="cb2-37"><a aria-hidden="true" href="#cb2-37"></a>    <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; lim; i += <span class="dv">2</span>)</span>
<span id="cb2-38"><a aria-hidden="true" href="#cb2-38"></a>        a1[i &gt;&gt; <span class="dv">1</span>] = a[i], a2[i &gt;&gt; <span class="dv">1</span>] = a[i + <span class="dv">1</span>];</span>
<span id="cb2-39"><a aria-hidden="true" href="#cb2-39"></a>    dft(lim &gt;&gt; <span class="dv">1</span>, a1, type);</span>
<span id="cb2-40"><a aria-hidden="true" href="#cb2-40"></a>    dft(lim &gt;&gt; <span class="dv">1</span>, a2, type);</span>
<span id="cb2-41"><a aria-hidden="true" href="#cb2-41"></a>    complex Wn = complex(cos(<span class="fl">2.0</span> * pi / lim), type * sin(<span class="fl">2.0</span> * pi / lim)), w = complex(<span class="dv">1</span>, <span class="dv">0</span>);</span>
<span id="cb2-42"><a aria-hidden="true" href="#cb2-42"></a>    <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; (lim &gt;&gt; <span class="dv">1</span>); ++i, w = w * Wn)</span>
<span id="cb2-43"><a aria-hidden="true" href="#cb2-43"></a>    {</span>
<span id="cb2-44"><a aria-hidden="true" href="#cb2-44"></a>        a[i] = a1[i] + w * a2[i];</span>
<span id="cb2-45"><a aria-hidden="true" href="#cb2-45"></a>        a[i + (lim &gt;&gt; <span class="dv">1</span>)] = a1[i] - w * a2[i];</span>
<span id="cb2-46"><a aria-hidden="true" href="#cb2-46"></a>    }</span>
<span id="cb2-47"><a aria-hidden="true" href="#cb2-47"></a>    <span class="cf">return</span>;</span>
<span id="cb2-48"><a aria-hidden="true" href="#cb2-48"></a>}</span>
<span id="cb2-49"><a aria-hidden="true" href="#cb2-49"></a></span>
<span id="cb2-50"><a aria-hidden="true" href="#cb2-50"></a><span class="dt">int</span> main()</span>
<span id="cb2-51"><a aria-hidden="true" href="#cb2-51"></a>{</span>
<span id="cb2-52"><a aria-hidden="true" href="#cb2-52"></a>    <span class="dt">int</span> n = read(), m = read();</span>
<span id="cb2-53"><a aria-hidden="true" href="#cb2-53"></a>    FOR(i, <span class="dv">0</span>, n) a[i].x = read();</span>
<span id="cb2-54"><a aria-hidden="true" href="#cb2-54"></a>    FOR(i, <span class="dv">0</span>, m) b[i].x = read();</span>
<span id="cb2-55"><a aria-hidden="true" href="#cb2-55"></a>    <span class="dt">int</span> lim = <span class="dv">1</span>;</span>
<span id="cb2-56"><a aria-hidden="true" href="#cb2-56"></a>    <span class="cf">while</span> (lim &lt;= n + m) lim &lt;&lt;= <span class="dv">1</span>;<span class="co">//limä¸€å®šè¦å¤§äº n + m</span></span>
<span id="cb2-57"><a aria-hidden="true" href="#cb2-57"></a>    dft(lim, a, <span class="dv">1</span>);</span>
<span id="cb2-58"><a aria-hidden="true" href="#cb2-58"></a>    dft(lim, b, <span class="dv">1</span>);</span>
<span id="cb2-59"><a aria-hidden="true" href="#cb2-59"></a>    FOR(i, <span class="dv">0</span>, lim)</span>
<span id="cb2-60"><a aria-hidden="true" href="#cb2-60"></a>        a[i] = a[i] * b[i];<span class="co">//ç‚¹å€¼ä¹˜èµ·æ¥</span></span>
<span id="cb2-61"><a aria-hidden="true" href="#cb2-61"></a>    dft(lim, a, -<span class="dv">1</span>);<span class="co">//IDFTè¿˜å›å»</span></span>
<span id="cb2-62"><a aria-hidden="true" href="#cb2-62"></a>    FOR(i, <span class="dv">0</span>, n + m)</span>
<span id="cb2-63"><a aria-hidden="true" href="#cb2-63"></a>        printf(<span class="st">"</span><span class="sc">%d</span><span class="st"> "</span>, (<span class="dt">int</span>)(a[i].x / lim + <span class="fl">0.5</span>));<span class="co">//æœ€åè¦é™¤é‚£ä¸ªæ•°ç„¶åè¿˜åŸå›å»ï¼Œå››èˆäº”å…¥</span></span>
<span id="cb2-64"><a aria-hidden="true" href="#cb2-64"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb2-65"><a aria-hidden="true" href="#cb2-65"></a>}</span></code></pre></div>
<h3 id="ä½é€†åºç½®æ¢">ä½é€†åºç½®æ¢</h3>
<p>ç„¶è€Œï¼Œä¸Šé¢çš„ä»£ç è¿æ¨¡æ¿éƒ½è·‘ä¸è¿‡å»â€¦â€¦</p>
<p>è€ƒè™‘ç»§ç»­ä¼˜åŒ– DFT çš„è¿‡ç¨‹ã€‚é€’å½’çš„è¿‡ç¨‹ä¸­å¼€äº†å¤§é‡çš„ç©ºé—´å¹¶ä¸”å¸¸æ•°å·¨å¤§ï¼Œè€ƒè™‘éé€’å½’å†™æ³•ã€‚</p>
<p>åªè€ƒè™‘æˆ‘ä»¬å¯¹ <span class="math inline">\(0\)</span> åˆ° <span class="math inline">\(7\)</span> æ“ä½œï¼š</p>
<p>é€’å½’çš„è¿‡ç¨‹ï¼š</p>
<pre class="plain"><code>original        0   1   2   3   4   5   6   7
recursion#1     0   2   4   6   1   3   5   7
recursion#2     0   4   2   6   1   5   3   7
recursion#3     0   4   2   6   1   5   3   7
original bin    000 001 010 011 100 101 110 111
now bin         000 100 010 110 001 101 011 111</code></pre>
<p>å¯è§é€’å½’åˆ°æœ€åçš„ç»“æœæ— éå°±æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶åè½¬ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘éé€’å½’ï¼Œä¸€å¼€å§‹å°±å…ˆæŠŠæ‰€æœ‰çš„æ•°æ”¾åˆ°æœ€åçš„ä½ç½®ï¼Œç„¶åè¿­ä»£çš„æ—¶å€™ä¸€æ­¥æ­¥è¿˜å›å»å³å¯ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ä½é€†åºç½®æ¢ï¼ˆè´è¶å˜æ¢ï¼‰</p>
<p>è€ƒè™‘å¤„ç†å‡º <span class="math inline">\(x\)</span> äºŒè¿›åˆ¶ä½ç¿»è½¬ä¹‹åçš„æ•° <span class="math inline">\(R(x)\)</span>ã€‚æ˜“çŸ¥ <span class="math inline">\(R(0) = 0\)</span>ã€‚æˆ‘ä»¬å¯ä»¥ä»å°åˆ°å¤§æ±‚ <span class="math inline">\(R(x)\)</span>ã€‚å¾ˆæ˜æ˜¾ï¼Œ<span class="math inline">\(\lfloor x/2\rfloor\)</span> çš„äºŒè¿›åˆ¶ä½æ˜¯ <span class="math inline">\(x\)</span> å³ç§»ä¸€ä½ï¼Œé‚£ä¹ˆå¦‚æœçŸ¥é“äº† <span class="math inline">\(R(\lfloor x/2\rfloor)\)</span> å°±å¯ä»¥å¾ˆå®¹æ˜“çš„æ±‚å‡º <span class="math inline">\(R(x)\)</span>ï¼Œå†åˆ† <span class="math inline">\(x\)</span> çš„å¥‡å¶æ€§åˆ¤æ–­å°±å¯ä»¥äº†ã€‚ <span class="math display">\[
R(x) = \left\lfloor\frac{R(\lfloor x/2\rfloor)}{2}\right\rfloor + (x\bmod 2)\times\frac{len}2
\]</span> ä¸¾ä¸ªä¾‹å­ï¼šç¿»è½¬ <span class="math inline">\((10101110)_2\)</span>ï¼Œé¦–å…ˆæˆ‘ä»¬çŸ¥é“å®ƒçš„äºŒåˆ†ä¹‹ä¸€å€ä¸º <span class="math inline">\((01010111)_2\)</span>ï¼Œå…¶ç¿»è½¬ç»“æœä¸º <span class="math inline">\((11101010)_2\)</span>ï¼Œé™¤ä»¥äºŒå˜ä¸º <span class="math inline">\((01110101)_2\)</span>ï¼Œç”±äºå®ƒæ˜¯å¶æ•°æ‰€ä»¥å‰é¢ä¸ç”¨è¡¥ <span class="math inline">\(1\)</span>ã€‚ä¸éš¾å‘ç°å…¶å°±æ˜¯ä¸€å¼€å§‹è¦æ±‚çš„ç¿»è½¬ç»“æœã€‚</p>
<p>é¢„å¤„ç†ç¿»è½¬ç»“æœçš„ä»£ç ï¼š</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a aria-hidden="true" href="#cb4-1"></a><span class="cf">while</span> (lim &lt;= n + m) lim &lt;&lt;= <span class="dv">1</span>;</span>
<span id="cb4-2"><a aria-hidden="true" href="#cb4-2"></a>FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb4-3"><a aria-hidden="true" href="#cb4-3"></a>    rev[i] = ((rev[i &gt;&gt; <span class="dv">1</span>] &gt;&gt; <span class="dv">1</span>) | (((i &amp; <span class="dv">1</span>) ? (lim &gt;&gt; <span class="dv">1</span>) : <span class="dv">0</span>)));</span></code></pre></div>
<p>ç„¶ååœ¨å¤„ç†ç¿»è½¬çš„æ—¶å€™åªéœ€è¦ä¸‹é¢å‡ è¡Œï¼š</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a aria-hidden="true" href="#cb5-1"></a>FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb5-2"><a aria-hidden="true" href="#cb5-2"></a>    <span class="cf">if</span> (i &lt; rev[i])</span>
<span id="cb5-3"><a aria-hidden="true" href="#cb5-3"></a>        myswap(a[i], a[rev[i]]);</span></code></pre></div>
<p>ä¸éš¾éªŒè¯å…¶æ­£ç¡®æ€§ã€‚</p>
<p>è€Œä¸”è§‚å¯Ÿæˆ‘ä»¬åœ¨æ±‚ <span class="math inline">\(\mathrm{DFT}(f(\omega_n^k))\)</span> æ—¶æˆ‘ä»¬éœ€è¦ç®—ä¸¤é <span class="math inline">\(\omega_n^k\mathrm{DFT}(f_1(\omega_{\frac n2^k}))\)</span>ï¼Œå¤æ•°çš„ä¹˜æ³•å¸¸æ•°å¾ˆå¤§ï¼Œè€ƒè™‘ä½¿ç”¨ä¸´æ—¶å˜é‡è®°å½•ä»¥é™ä½å¸¸æ•°ã€‚</p>
<p>è¿™æ ·å­çš„è¯è¿­ä»£ç‰ˆçš„ DFT è¿‡ç¨‹å°±å¾ˆå¥½å†™äº†ï¼š</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a aria-hidden="true" href="#cb6-1"></a><span class="dt">void</span> DFT(<span class="dt">int</span> lim, complex *a, <span class="dt">int</span> type)</span>
<span id="cb6-2"><a aria-hidden="true" href="#cb6-2"></a>{</span>
<span id="cb6-3"><a aria-hidden="true" href="#cb6-3"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb6-4"><a aria-hidden="true" href="#cb6-4"></a>        <span class="cf">if</span> (i &lt; rev[i])</span>
<span id="cb6-5"><a aria-hidden="true" href="#cb6-5"></a>            myswap(a[i], a[rev[i]]);<span class="co">//å…ˆé¢„å¤„ç†ç¿»è½¬å®Œäº†çš„ç»“æœ</span></span>
<span id="cb6-6"><a aria-hidden="true" href="#cb6-6"></a>    <span class="cf">for</span> (<span class="dt">int</span> p = <span class="dv">2</span>; p &lt;= lim; p &lt;&lt;= <span class="dv">1</span>)<span class="co">//æ¨¡æ‹Ÿåˆå¹¶ç­”æ¡ˆçš„è¿‡ç¨‹ï¼Œå³ä¸ºæ‰€è°“çš„ n</span></span>
<span id="cb6-7"><a aria-hidden="true" href="#cb6-7"></a>    {</span>
<span id="cb6-8"><a aria-hidden="true" href="#cb6-8"></a>        <span class="dt">int</span> len = p &gt;&gt; <span class="dv">1</span>;<span class="co">//å³ä¸Šé¢çš„ n / 2</span></span>
<span id="cb6-9"><a aria-hidden="true" href="#cb6-9"></a>        complex Wp = complex(cos(<span class="dv">2</span> * pi / p), type * sin(<span class="dv">2</span> * pi / p));<span class="co">//å¤„ç†å‡º p æ¬¡å•ä½æ ¹</span></span>
<span id="cb6-10"><a aria-hidden="true" href="#cb6-10"></a>        <span class="cf">for</span> (<span class="dt">int</span> k = <span class="dv">0</span>; k &lt; lim; k += p)<span class="co">//å¯¹æ¯ä¸€ä¸ªè¿›è¡Œåˆå¹¶</span></span>
<span id="cb6-11"><a aria-hidden="true" href="#cb6-11"></a>        {</span>
<span id="cb6-12"><a aria-hidden="true" href="#cb6-12"></a>            complex w = complex(<span class="dv">1</span>, <span class="dv">0</span>);<span class="co">//å¤„ç† \omega_p^0</span></span>
<span id="cb6-13"><a aria-hidden="true" href="#cb6-13"></a>            <span class="cf">for</span> (<span class="dt">int</span> l = k; l &lt; k + len; ++l, w = w * Wp)<span class="co">//å¼€å§‹åˆå¹¶</span></span>
<span id="cb6-14"><a aria-hidden="true" href="#cb6-14"></a>            {</span>
<span id="cb6-15"><a aria-hidden="true" href="#cb6-15"></a>                <span class="co">//æ­¤æ—¶çš„ a[l] å°±æ˜¯ä¹‹å‰çš„ a1[i]ï¼Œa[len + l] å°±æ˜¯ä¹‹å‰çš„ a2[i]</span></span>
<span id="cb6-16"><a aria-hidden="true" href="#cb6-16"></a>                complex tmp = w * a[len + l];</span>
<span id="cb6-17"><a aria-hidden="true" href="#cb6-17"></a>                a[len + l] = a[l] - tmp;<span class="co">//ç›¸å½“äºä¸Šé¢çš„ a[i + (lim &gt;&gt; 1)] = a1[i] - w * a2[i]</span></span>
<span id="cb6-18"><a aria-hidden="true" href="#cb6-18"></a>                a[l] = a[l] + tmp;<span class="co">//ç›¸å½“äºä¸Šé¢çš„ a[i] = a1[i] + w * a2[i]</span></span>
<span id="cb6-19"><a aria-hidden="true" href="#cb6-19"></a>            }</span>
<span id="cb6-20"><a aria-hidden="true" href="#cb6-20"></a>        }</span>
<span id="cb6-21"><a aria-hidden="true" href="#cb6-21"></a>    }</span>
<span id="cb6-22"><a aria-hidden="true" href="#cb6-22"></a>}</span></code></pre></div>
<h3 id="å¤šé¡¹å¼ä¹˜æ³•çš„å®ç°">å¤šé¡¹å¼ä¹˜æ³•çš„å®ç°</h3>
<p>æ€»çš„ä¸€ä¸ªéé€’å½’ç‰ˆ FFT çš„å®ç°å¦‚ä¸‹ï¼ˆ<a href="https://www.luogu.com.cn/problem/P3803">æ´›è°· P3803</a>ï¼‰ï¼š</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a aria-hidden="true" href="#cb7-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span>
<span id="cb7-2"><a aria-hidden="true" href="#cb7-2"></a><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></span>
<span id="cb7-3"><a aria-hidden="true" href="#cb7-3"></a><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></span>
<span id="cb7-4"><a aria-hidden="true" href="#cb7-4"></a><span class="pp">#define FOR</span>(i,<span class="pp"> </span>a,<span class="pp"> </span>b)<span class="pp"> </span><span class="cf">for</span><span class="pp"> </span>(<span class="dt">int</span><span class="pp"> </span>i<span class="pp"> </span>=<span class="pp"> </span>a;<span class="pp"> </span>i<span class="pp"> </span>&lt;=<span class="pp"> </span>b;<span class="pp"> </span>++i)</span>
<span id="cb7-5"><a aria-hidden="true" href="#cb7-5"></a></span>
<span id="cb7-6"><a aria-hidden="true" href="#cb7-6"></a><span class="at">const</span> <span class="dt">int</span> maxn = <span class="fl">3e6</span> + <span class="dv">5</span>;</span>
<span id="cb7-7"><a aria-hidden="true" href="#cb7-7"></a><span class="at">const</span> <span class="dt">double</span> pi = acos(-<span class="fl">1.0</span>);</span>
<span id="cb7-8"><a aria-hidden="true" href="#cb7-8"></a></span>
<span id="cb7-9"><a aria-hidden="true" href="#cb7-9"></a><span class="kw">inline</span> <span class="dt">int</span> read()</span>
<span id="cb7-10"><a aria-hidden="true" href="#cb7-10"></a>{</span>
<span id="cb7-11"><a aria-hidden="true" href="#cb7-11"></a>    <span class="dt">char</span> c = getchar();</span>
<span id="cb7-12"><a aria-hidden="true" href="#cb7-12"></a>    <span class="dt">int</span> s = <span class="dv">0</span>;</span>
<span id="cb7-13"><a aria-hidden="true" href="#cb7-13"></a>    <span class="cf">while</span> (!isdigit(c))</span>
<span id="cb7-14"><a aria-hidden="true" href="#cb7-14"></a>        c = getchar();</span>
<span id="cb7-15"><a aria-hidden="true" href="#cb7-15"></a>    <span class="cf">while</span> (isdigit(c))</span>
<span id="cb7-16"><a aria-hidden="true" href="#cb7-16"></a>        s = <span class="dv">10</span> * s + c - <span class="ch">'0'</span>, c = getchar();</span>
<span id="cb7-17"><a aria-hidden="true" href="#cb7-17"></a>    <span class="cf">return</span> s;</span>
<span id="cb7-18"><a aria-hidden="true" href="#cb7-18"></a>}</span>
<span id="cb7-19"><a aria-hidden="true" href="#cb7-19"></a></span>
<span id="cb7-20"><a aria-hidden="true" href="#cb7-20"></a><span class="kw">template</span>&lt;<span class="kw">typename</span> T&gt; <span class="kw">inline</span> <span class="dt">void</span> myswap(T &amp;a, T &amp;b)</span>
<span id="cb7-21"><a aria-hidden="true" href="#cb7-21"></a>{</span>
<span id="cb7-22"><a aria-hidden="true" href="#cb7-22"></a>    T t = a;</span>
<span id="cb7-23"><a aria-hidden="true" href="#cb7-23"></a>    a = b;</span>
<span id="cb7-24"><a aria-hidden="true" href="#cb7-24"></a>    b = t;</span>
<span id="cb7-25"><a aria-hidden="true" href="#cb7-25"></a>    <span class="cf">return</span>;</span>
<span id="cb7-26"><a aria-hidden="true" href="#cb7-26"></a>}</span>
<span id="cb7-27"><a aria-hidden="true" href="#cb7-27"></a></span>
<span id="cb7-28"><a aria-hidden="true" href="#cb7-28"></a><span class="kw">struct</span> complex</span>
<span id="cb7-29"><a aria-hidden="true" href="#cb7-29"></a>{</span>
<span id="cb7-30"><a aria-hidden="true" href="#cb7-30"></a>    <span class="dt">double</span> x, y;</span>
<span id="cb7-31"><a aria-hidden="true" href="#cb7-31"></a>    complex(<span class="dt">double</span> xx = <span class="dv">0</span>, <span class="dt">double</span> yy = <span class="dv">0</span>)</span>
<span id="cb7-32"><a aria-hidden="true" href="#cb7-32"></a>    {</span>
<span id="cb7-33"><a aria-hidden="true" href="#cb7-33"></a>        x = xx, y = yy;</span>
<span id="cb7-34"><a aria-hidden="true" href="#cb7-34"></a>    }</span>
<span id="cb7-35"><a aria-hidden="true" href="#cb7-35"></a>} a[maxn], b[maxn];</span>
<span id="cb7-36"><a aria-hidden="true" href="#cb7-36"></a></span>
<span id="cb7-37"><a aria-hidden="true" href="#cb7-37"></a><span class="dt">int</span> rev[maxn];</span>
<span id="cb7-38"><a aria-hidden="true" href="#cb7-38"></a></span>
<span id="cb7-39"><a aria-hidden="true" href="#cb7-39"></a>complex <span class="kw">operator</span>+(<span class="at">const</span> complex &amp;a, <span class="at">const</span> complex &amp;b) {<span class="cf">return</span> complex(a.x + b.x, a.y + b.y);}</span>
<span id="cb7-40"><a aria-hidden="true" href="#cb7-40"></a>complex <span class="kw">operator</span>-(<span class="at">const</span> complex &amp;a, <span class="at">const</span> complex &amp;b) {<span class="cf">return</span> complex(a.x - b.x, a.y - b.y);}</span>
<span id="cb7-41"><a aria-hidden="true" href="#cb7-41"></a>complex <span class="kw">operator</span>*(<span class="at">const</span> complex &amp;a, <span class="at">const</span> complex &amp;b) {<span class="cf">return</span> complex(a.x * b.x - a.y * b.y, a.x * b.y + a.y * b.x);}</span>
<span id="cb7-42"><a aria-hidden="true" href="#cb7-42"></a></span>
<span id="cb7-43"><a aria-hidden="true" href="#cb7-43"></a><span class="dt">void</span> DFT(<span class="dt">int</span> lim, complex *a, <span class="dt">int</span> type)</span>
<span id="cb7-44"><a aria-hidden="true" href="#cb7-44"></a>{</span>
<span id="cb7-45"><a aria-hidden="true" href="#cb7-45"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb7-46"><a aria-hidden="true" href="#cb7-46"></a>        <span class="cf">if</span> (i &lt; rev[i])</span>
<span id="cb7-47"><a aria-hidden="true" href="#cb7-47"></a>            myswap(a[i], a[rev[i]]);<span class="co">//å…ˆé¢„å¤„ç†ç¿»è½¬å®Œäº†çš„ç»“æœ</span></span>
<span id="cb7-48"><a aria-hidden="true" href="#cb7-48"></a>    <span class="cf">for</span> (<span class="dt">int</span> p = <span class="dv">2</span>; p &lt;= lim; p &lt;&lt;= <span class="dv">1</span>)<span class="co">//æ¨¡æ‹Ÿåˆå¹¶ç­”æ¡ˆçš„è¿‡ç¨‹ï¼Œå³ä¸ºæ‰€è°“çš„ n</span></span>
<span id="cb7-49"><a aria-hidden="true" href="#cb7-49"></a>    {</span>
<span id="cb7-50"><a aria-hidden="true" href="#cb7-50"></a>        <span class="dt">int</span> len = p &gt;&gt; <span class="dv">1</span>;<span class="co">//å³ä¸Šé¢çš„ n / 2</span></span>
<span id="cb7-51"><a aria-hidden="true" href="#cb7-51"></a>        complex Wp = complex(cos(<span class="dv">2</span> * pi / p), type * sin(<span class="dv">2</span> * pi / p));<span class="co">//å¤„ç†å‡º p æ¬¡å•ä½æ ¹</span></span>
<span id="cb7-52"><a aria-hidden="true" href="#cb7-52"></a>        <span class="cf">for</span> (<span class="dt">int</span> k = <span class="dv">0</span>; k &lt; lim; k += p)<span class="co">//å¯¹æ¯ä¸€ä¸ªè¿›è¡Œåˆå¹¶</span></span>
<span id="cb7-53"><a aria-hidden="true" href="#cb7-53"></a>        {</span>
<span id="cb7-54"><a aria-hidden="true" href="#cb7-54"></a>            complex w = complex(<span class="dv">1</span>, <span class="dv">0</span>);<span class="co">//å¤„ç† \omega_p^0</span></span>
<span id="cb7-55"><a aria-hidden="true" href="#cb7-55"></a>            <span class="cf">for</span> (<span class="dt">int</span> l = k; l &lt; k + len; ++l, w = w * Wp)<span class="co">//å¼€å§‹åˆå¹¶</span></span>
<span id="cb7-56"><a aria-hidden="true" href="#cb7-56"></a>            {</span>
<span id="cb7-57"><a aria-hidden="true" href="#cb7-57"></a>                <span class="co">//æ­¤æ—¶çš„ a[l] å°±æ˜¯ä¹‹å‰çš„ a1[i]ï¼Œa[len + l] å°±æ˜¯ä¹‹å‰çš„ a2[i]</span></span>
<span id="cb7-58"><a aria-hidden="true" href="#cb7-58"></a>                complex tmp = w * a[len + l];</span>
<span id="cb7-59"><a aria-hidden="true" href="#cb7-59"></a>                a[len + l] = a[l] - tmp;<span class="co">//ç›¸å½“äºä¸Šé¢çš„ a[i + (lim &gt;&gt; 1)] = a1[i] - w * a2[i]</span></span>
<span id="cb7-60"><a aria-hidden="true" href="#cb7-60"></a>                a[l] = a[l] + tmp;<span class="co">//ç›¸å½“äºä¸Šé¢çš„ a[i] = a1[i] + w * a2[i]</span></span>
<span id="cb7-61"><a aria-hidden="true" href="#cb7-61"></a>            }</span>
<span id="cb7-62"><a aria-hidden="true" href="#cb7-62"></a>        }</span>
<span id="cb7-63"><a aria-hidden="true" href="#cb7-63"></a>    }</span>
<span id="cb7-64"><a aria-hidden="true" href="#cb7-64"></a>}</span>
<span id="cb7-65"><a aria-hidden="true" href="#cb7-65"></a></span>
<span id="cb7-66"><a aria-hidden="true" href="#cb7-66"></a><span class="dt">int</span> main()</span>
<span id="cb7-67"><a aria-hidden="true" href="#cb7-67"></a>{</span>
<span id="cb7-68"><a aria-hidden="true" href="#cb7-68"></a>    <span class="dt">int</span> n = read(), m = read();</span>
<span id="cb7-69"><a aria-hidden="true" href="#cb7-69"></a>    FOR(i, <span class="dv">0</span>, n) a[i].x = read();</span>
<span id="cb7-70"><a aria-hidden="true" href="#cb7-70"></a>    FOR(i, <span class="dv">0</span>, m) b[i].x = read();</span>
<span id="cb7-71"><a aria-hidden="true" href="#cb7-71"></a>    <span class="dt">int</span> lim = <span class="dv">1</span>;</span>
<span id="cb7-72"><a aria-hidden="true" href="#cb7-72"></a>    <span class="cf">while</span> (lim &lt;= n + m) lim &lt;&lt;= <span class="dv">1</span>;<span class="co">//è¡¥é½é«˜ä½</span></span>
<span id="cb7-73"><a aria-hidden="true" href="#cb7-73"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb7-74"><a aria-hidden="true" href="#cb7-74"></a>        rev[i] = ((rev[i &gt;&gt; <span class="dv">1</span>] &gt;&gt; <span class="dv">1</span>) | (((i &amp; <span class="dv">1</span>) ? (lim &gt;&gt; <span class="dv">1</span>) : <span class="dv">0</span>)));<span class="co">//å…ˆå¤„ç†ç¿»è½¬å®Œçš„ç»“æœ</span></span>
<span id="cb7-75"><a aria-hidden="true" href="#cb7-75"></a>    DFT(lim, a, <span class="dv">1</span>);<span class="co">//DFT</span></span>
<span id="cb7-76"><a aria-hidden="true" href="#cb7-76"></a>    DFT(lim, b, <span class="dv">1</span>);<span class="co">//DFT</span></span>
<span id="cb7-77"><a aria-hidden="true" href="#cb7-77"></a>    FOR(i, <span class="dv">0</span>, lim)</span>
<span id="cb7-78"><a aria-hidden="true" href="#cb7-78"></a>        a[i] = a[i] * b[i];<span class="co">//å¯¹å¤„ç†å‡ºæ¥çš„ç‚¹å€¼è¿›è¡Œä¹˜æ³•</span></span>
<span id="cb7-79"><a aria-hidden="true" href="#cb7-79"></a>    DFT(lim, a, -<span class="dv">1</span>);<span class="co">//IDFT</span></span>
<span id="cb7-80"><a aria-hidden="true" href="#cb7-80"></a>    FOR(i, <span class="dv">0</span>, n + m)</span>
<span id="cb7-81"><a aria-hidden="true" href="#cb7-81"></a>        printf(<span class="st">"</span><span class="sc">%d</span><span class="st"> "</span>, (<span class="dt">int</span>)(a[i].x / lim + <span class="fl">0.5</span>));</span>
<span id="cb7-82"><a aria-hidden="true" href="#cb7-82"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb7-83"><a aria-hidden="true" href="#cb7-83"></a>}</span></code></pre></div>
<p>ä½¿ç”¨ FFT æ¥æ±‚é«˜ç²¾åº¦æ•´æ•°ä¹˜æ³•çš„å®ç°ï¼ˆ<a href="https://www.luogu.com.cn/problem/P1919">æ´›è°· P1919</a>ï¼‰ï¼š</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a aria-hidden="true" href="#cb8-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span>
<span id="cb8-2"><a aria-hidden="true" href="#cb8-2"></a><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></span>
<span id="cb8-3"><a aria-hidden="true" href="#cb8-3"></a><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></span>
<span id="cb8-4"><a aria-hidden="true" href="#cb8-4"></a><span class="pp">#define FOR</span>(i,<span class="pp"> </span>a,<span class="pp"> </span>b)<span class="pp"> </span><span class="cf">for</span><span class="pp"> </span>(<span class="dt">int</span><span class="pp"> </span>i<span class="pp"> </span>=<span class="pp"> </span>a;<span class="pp"> </span>i<span class="pp"> </span>&lt;=<span class="pp"> </span>b;<span class="pp"> </span>++i)</span>
<span id="cb8-5"><a aria-hidden="true" href="#cb8-5"></a><span class="pp">#define DEC</span>(i,<span class="pp"> </span>a,<span class="pp"> </span>b)<span class="pp"> </span><span class="cf">for</span><span class="pp"> </span>(<span class="dt">int</span><span class="pp"> </span>i<span class="pp"> </span>=<span class="pp"> </span>a;<span class="pp"> </span>i<span class="pp"> </span>&gt;=<span class="pp"> </span>b;<span class="pp"> </span>--i)</span>
<span id="cb8-6"><a aria-hidden="true" href="#cb8-6"></a></span>
<span id="cb8-7"><a aria-hidden="true" href="#cb8-7"></a><span class="kw">template</span>&lt;<span class="kw">typename</span> T&gt; <span class="kw">inline</span> <span class="dt">void</span> myswap(T &amp;a, T &amp;b) {T t = a; a = b; b = t; <span class="cf">return</span>;}</span>
<span id="cb8-8"><a aria-hidden="true" href="#cb8-8"></a></span>
<span id="cb8-9"><a aria-hidden="true" href="#cb8-9"></a><span class="kw">typedef</span> <span class="dt">double</span> db;</span>
<span id="cb8-10"><a aria-hidden="true" href="#cb8-10"></a></span>
<span id="cb8-11"><a aria-hidden="true" href="#cb8-11"></a><span class="at">const</span> <span class="dt">int</span> maxn = <span class="dv">3000000</span> + <span class="dv">5</span>;</span>
<span id="cb8-12"><a aria-hidden="true" href="#cb8-12"></a><span class="at">const</span> db pi = acos(-<span class="fl">1.0</span>);</span>
<span id="cb8-13"><a aria-hidden="true" href="#cb8-13"></a></span>
<span id="cb8-14"><a aria-hidden="true" href="#cb8-14"></a><span class="kw">struct</span> cmplx</span>
<span id="cb8-15"><a aria-hidden="true" href="#cb8-15"></a>{</span>
<span id="cb8-16"><a aria-hidden="true" href="#cb8-16"></a>    db x, y;</span>
<span id="cb8-17"><a aria-hidden="true" href="#cb8-17"></a>    cmplx(db xx = <span class="dv">0</span>, db yy = <span class="dv">0</span>) {x = xx, y = yy;}</span>
<span id="cb8-18"><a aria-hidden="true" href="#cb8-18"></a>} a[maxn], b[maxn];</span>
<span id="cb8-19"><a aria-hidden="true" href="#cb8-19"></a></span>
<span id="cb8-20"><a aria-hidden="true" href="#cb8-20"></a>cmplx <span class="kw">operator</span>+(<span class="at">const</span> cmplx &amp;a, <span class="at">const</span> cmplx &amp;b) {<span class="cf">return</span> cmplx(a.x + b.x, a.y + b.y);}</span>
<span id="cb8-21"><a aria-hidden="true" href="#cb8-21"></a>cmplx <span class="kw">operator</span>-(<span class="at">const</span> cmplx &amp;a, <span class="at">const</span> cmplx &amp;b) {<span class="cf">return</span> cmplx(a.x - b.x, a.y - b.y);}</span>
<span id="cb8-22"><a aria-hidden="true" href="#cb8-22"></a>cmplx <span class="kw">operator</span>*(<span class="at">const</span> cmplx &amp;a, <span class="at">const</span> cmplx &amp;b) {<span class="cf">return</span> cmplx(a.x * b.x - a.y * b.y, a.x * b.y + a.y * b.x);}</span>
<span id="cb8-23"><a aria-hidden="true" href="#cb8-23"></a></span>
<span id="cb8-24"><a aria-hidden="true" href="#cb8-24"></a><span class="dt">char</span> s1[maxn], s2[maxn];</span>
<span id="cb8-25"><a aria-hidden="true" href="#cb8-25"></a><span class="dt">int</span> rev[maxn], ans[maxn];</span>
<span id="cb8-26"><a aria-hidden="true" href="#cb8-26"></a></span>
<span id="cb8-27"><a aria-hidden="true" href="#cb8-27"></a><span class="dt">void</span> DFT(cmplx *f, <span class="dt">int</span> lim, <span class="dt">int</span> type)</span>
<span id="cb8-28"><a aria-hidden="true" href="#cb8-28"></a>{</span>
<span id="cb8-29"><a aria-hidden="true" href="#cb8-29"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb8-30"><a aria-hidden="true" href="#cb8-30"></a>        <span class="cf">if</span> (i &lt; rev[i])</span>
<span id="cb8-31"><a aria-hidden="true" href="#cb8-31"></a>            myswap(f[i], f[rev[i]]);</span>
<span id="cb8-32"><a aria-hidden="true" href="#cb8-32"></a>    <span class="cf">for</span> (<span class="dt">int</span> p = <span class="dv">2</span>; p &lt;= lim; p &lt;&lt;= <span class="dv">1</span>)</span>
<span id="cb8-33"><a aria-hidden="true" href="#cb8-33"></a>    {</span>
<span id="cb8-34"><a aria-hidden="true" href="#cb8-34"></a>        <span class="dt">int</span> len = p &gt;&gt; <span class="dv">1</span>;</span>
<span id="cb8-35"><a aria-hidden="true" href="#cb8-35"></a>        cmplx Wp(cos(<span class="fl">2.0</span> * pi / p), type * sin(<span class="fl">2.0</span> * pi / p));</span>
<span id="cb8-36"><a aria-hidden="true" href="#cb8-36"></a>        <span class="cf">for</span> (<span class="dt">int</span> k = <span class="dv">0</span>; k &lt; lim; k += p)</span>
<span id="cb8-37"><a aria-hidden="true" href="#cb8-37"></a>        {</span>
<span id="cb8-38"><a aria-hidden="true" href="#cb8-38"></a>            cmplx w(<span class="dv">1</span>, <span class="dv">0</span>);</span>
<span id="cb8-39"><a aria-hidden="true" href="#cb8-39"></a>            <span class="cf">for</span> (<span class="dt">int</span> l = k; l &lt; k + len; ++l, w = w * Wp)</span>
<span id="cb8-40"><a aria-hidden="true" href="#cb8-40"></a>            {</span>
<span id="cb8-41"><a aria-hidden="true" href="#cb8-41"></a>                cmplx tmp = w * f[l + len];</span>
<span id="cb8-42"><a aria-hidden="true" href="#cb8-42"></a>                f[l + len] = f[l] - tmp;</span>
<span id="cb8-43"><a aria-hidden="true" href="#cb8-43"></a>                f[l] = f[l] + tmp;</span>
<span id="cb8-44"><a aria-hidden="true" href="#cb8-44"></a>            }</span>
<span id="cb8-45"><a aria-hidden="true" href="#cb8-45"></a>        }</span>
<span id="cb8-46"><a aria-hidden="true" href="#cb8-46"></a>    }</span>
<span id="cb8-47"><a aria-hidden="true" href="#cb8-47"></a>    <span class="cf">return</span>;</span>
<span id="cb8-48"><a aria-hidden="true" href="#cb8-48"></a>}</span>
<span id="cb8-49"><a aria-hidden="true" href="#cb8-49"></a></span>
<span id="cb8-50"><a aria-hidden="true" href="#cb8-50"></a><span class="dt">int</span> main()</span>
<span id="cb8-51"><a aria-hidden="true" href="#cb8-51"></a>{</span>
<span id="cb8-52"><a aria-hidden="true" href="#cb8-52"></a>    scanf(<span class="st">"</span><span class="sc">%s\n%s</span><span class="st">"</span>, s1, s2);</span>
<span id="cb8-53"><a aria-hidden="true" href="#cb8-53"></a>    <span class="dt">int</span> n1 = -<span class="dv">1</span>, n2 = -<span class="dv">1</span>;</span>
<span id="cb8-54"><a aria-hidden="true" href="#cb8-54"></a>    DEC(i, strlen(s1) - <span class="dv">1</span>, <span class="dv">0</span>) a[++n1].x = s1[i] - <span class="ch">'0'</span>;</span>
<span id="cb8-55"><a aria-hidden="true" href="#cb8-55"></a>    DEC(i, strlen(s2) - <span class="dv">1</span>, <span class="dv">0</span>) b[++n2].x = s2[i] - <span class="ch">'0'</span>;</span>
<span id="cb8-56"><a aria-hidden="true" href="#cb8-56"></a>    <span class="dt">int</span> lim = <span class="dv">1</span>;</span>
<span id="cb8-57"><a aria-hidden="true" href="#cb8-57"></a>    <span class="cf">while</span> (lim &lt;= n1 + n2) lim &lt;&lt;= <span class="dv">1</span>;</span>
<span id="cb8-58"><a aria-hidden="true" href="#cb8-58"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb8-59"><a aria-hidden="true" href="#cb8-59"></a>        rev[i] = ((rev[i &gt;&gt; <span class="dv">1</span>] &gt;&gt; <span class="dv">1</span>) | (((i &amp; <span class="dv">1</span>) ? (lim &gt;&gt; <span class="dv">1</span>) : <span class="dv">0</span>)));</span>
<span id="cb8-60"><a aria-hidden="true" href="#cb8-60"></a>    DFT(a, lim, <span class="dv">1</span>);</span>
<span id="cb8-61"><a aria-hidden="true" href="#cb8-61"></a>    DFT(b, lim, <span class="dv">1</span>);</span>
<span id="cb8-62"><a aria-hidden="true" href="#cb8-62"></a>    FOR(i, <span class="dv">0</span>, lim)</span>
<span id="cb8-63"><a aria-hidden="true" href="#cb8-63"></a>        a[i] = a[i] * b[i];</span>
<span id="cb8-64"><a aria-hidden="true" href="#cb8-64"></a>    DFT(a, lim, -<span class="dv">1</span>);</span>
<span id="cb8-65"><a aria-hidden="true" href="#cb8-65"></a>    FOR(i, <span class="dv">0</span>, lim)</span>
<span id="cb8-66"><a aria-hidden="true" href="#cb8-66"></a>        ans[i] = (<span class="dt">int</span>)(a[i].x / lim + <span class="fl">0.5</span>);</span>
<span id="cb8-67"><a aria-hidden="true" href="#cb8-67"></a>    FOR(i, <span class="dv">0</span>, lim)</span>
<span id="cb8-68"><a aria-hidden="true" href="#cb8-68"></a>        <span class="cf">if</span> (ans[i] &gt;= <span class="dv">10</span>) ans[i + <span class="dv">1</span>] += ans[i] / <span class="dv">10</span>, ans[i] %= <span class="dv">10</span>, lim += (i == lim);</span>
<span id="cb8-69"><a aria-hidden="true" href="#cb8-69"></a>    <span class="cf">while</span> (!ans[lim] &amp;&amp; lim &gt; -<span class="dv">1</span>) --lim;</span>
<span id="cb8-70"><a aria-hidden="true" href="#cb8-70"></a>    <span class="cf">if</span> (lim == -<span class="dv">1</span>) puts(<span class="st">"0"</span>);</span>
<span id="cb8-71"><a aria-hidden="true" href="#cb8-71"></a>    <span class="cf">else</span> DEC(i, lim, <span class="dv">0</span>) printf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>, ans[i]);</span>
<span id="cb8-72"><a aria-hidden="true" href="#cb8-72"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb8-73"><a aria-hidden="true" href="#cb8-73"></a>}</span></code></pre></div>
<p><strong>å½“ç„¶ï¼Œåƒä¸‡è¦è®°å¾— IDFT è¿˜å›å»çš„æ—¶å€™è¦é™¤ä»¥ <code>lim</code>ï¼Œå®åœ¨æ€•è®°ä¸ä½å°±åœ¨ DFT å‡½æ•°é‡Œé¢åŠ å‡ å¥è¯ç›´æ¥å¤„ç†å¥½</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a aria-hidden="true" href="#cb9-1"></a><span class="cf">if</span> (type == -<span class="dv">1</span>)</span>
<span id="cb9-2"><a aria-hidden="true" href="#cb9-2"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb9-3"><a aria-hidden="true" href="#cb9-3"></a>        f[i].x /= lim;</span></code></pre></div>
<h3 id="é’ˆå¯¹å¤šé¡¹å¼ä¹˜æ³•ä¸‰æ¬¡å˜ä¸¤æ¬¡ä¼˜åŒ–">é’ˆå¯¹å¤šé¡¹å¼ä¹˜æ³•ï¼šä¸‰æ¬¡å˜ä¸¤æ¬¡ä¼˜åŒ–</h3>
<p>æˆ‘ä»¬å‘ç°æˆ‘ä»¬åœ¨åšå¤šé¡¹å¼ä¹˜æ³•çš„æ—¶å€™ï¼Œéœ€è¦å…ˆ DFT <span class="math inline">\(A(x)\)</span>ï¼Œ<span class="math inline">\(B(x)\)</span>ï¼Œä¹˜åœ¨ä¸€èµ·ä¹‹åå† IDFT è¿˜å›æ¥ <span class="math inline">\(C(x)\)</span>ï¼Œä¸€å…±è¿›è¡Œäº†ä¸‰æ¬¡è¿™æ ·çš„æ“ä½œã€‚è€ƒè™‘å¦‚ä½•å‡å°‘æˆ‘ä»¬è°ƒç”¨ DFT çš„æ¬¡æ•°ã€‚</p>
<p>å¯ä»¥æŠŠ <span class="math inline">\(B(x)\)</span> çš„ç³»æ•°æ”¾åˆ° <span class="math inline">\(A(x)\)</span> ç³»æ•°çš„è™šéƒ¨ä¸Šé¢ï¼Œå³ <span class="math inline">\(a + b\mathrm i\)</span>ï¼Œç„¶å DFT ä¸€ä¸‹ <span class="math inline">\(A(x)\)</span> å†æ±‚ä¸ªå¹³æ–¹ï¼Œå¾—åˆ° <span class="math inline">\(A^2(x)\)</span>ï¼Œå† IDFT å›å»ã€‚æˆ‘ä»¬å¯ä»¥å‘ç°å¾—åˆ°çš„ç³»æ•°éƒ½æ˜¯ <span class="math inline">\((a + b\mathrm i)^2 = a^2 - b^2 + 2ab\mathrm i\)</span> çš„å½¢å¼çš„ï¼Œæ‰€ä»¥åªéœ€è¦å–å‡ºè™šéƒ¨å†é™¤ä»¥äºŒå°±å¾—åˆ°ç­”æ¡ˆäº†ã€‚</p>
<p>è¿™æ ·çš„å†™æ³•å¯ä»¥å‡å°å¸¸æ•°ï¼Œè·‘çš„æ¯” NTT è¿˜å¿«ã€‚</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a aria-hidden="true" href="#cb10-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span>
<span id="cb10-2"><a aria-hidden="true" href="#cb10-2"></a><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></span>
<span id="cb10-3"><a aria-hidden="true" href="#cb10-3"></a><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></span>
<span id="cb10-4"><a aria-hidden="true" href="#cb10-4"></a><span class="pp">#define FOR</span>(i,<span class="pp"> </span>a,<span class="pp"> </span>b)<span class="pp"> </span><span class="cf">for</span><span class="pp"> </span>(<span class="dt">int</span><span class="pp"> </span>i<span class="pp"> </span>=<span class="pp"> </span>a;<span class="pp"> </span>i<span class="pp"> </span>&lt;=<span class="pp"> </span>b;<span class="pp"> </span>++i)</span>
<span id="cb10-5"><a aria-hidden="true" href="#cb10-5"></a></span>
<span id="cb10-6"><a aria-hidden="true" href="#cb10-6"></a><span class="kw">typedef</span> <span class="dt">double</span> db;</span>
<span id="cb10-7"><a aria-hidden="true" href="#cb10-7"></a></span>
<span id="cb10-8"><a aria-hidden="true" href="#cb10-8"></a><span class="at">const</span> <span class="dt">int</span> maxn = <span class="fl">3e6</span> + <span class="dv">5</span>;</span>
<span id="cb10-9"><a aria-hidden="true" href="#cb10-9"></a><span class="at">const</span> db pi = acos(-<span class="fl">1.0</span>);</span>
<span id="cb10-10"><a aria-hidden="true" href="#cb10-10"></a></span>
<span id="cb10-11"><a aria-hidden="true" href="#cb10-11"></a><span class="kw">inline</span> <span class="dt">int</span> read()</span>
<span id="cb10-12"><a aria-hidden="true" href="#cb10-12"></a>{</span>
<span id="cb10-13"><a aria-hidden="true" href="#cb10-13"></a>    <span class="dt">char</span> c = getchar();</span>
<span id="cb10-14"><a aria-hidden="true" href="#cb10-14"></a>    <span class="dt">int</span> s = <span class="dv">0</span>;</span>
<span id="cb10-15"><a aria-hidden="true" href="#cb10-15"></a>    <span class="cf">while</span> (!isdigit(c))</span>
<span id="cb10-16"><a aria-hidden="true" href="#cb10-16"></a>        c = getchar();</span>
<span id="cb10-17"><a aria-hidden="true" href="#cb10-17"></a>    <span class="cf">while</span> (isdigit(c))</span>
<span id="cb10-18"><a aria-hidden="true" href="#cb10-18"></a>        s = <span class="dv">10</span> * s + c - <span class="ch">'0'</span>, c = getchar();</span>
<span id="cb10-19"><a aria-hidden="true" href="#cb10-19"></a>    <span class="cf">return</span> s;</span>
<span id="cb10-20"><a aria-hidden="true" href="#cb10-20"></a>}</span>
<span id="cb10-21"><a aria-hidden="true" href="#cb10-21"></a></span>
<span id="cb10-22"><a aria-hidden="true" href="#cb10-22"></a><span class="kw">template</span>&lt;<span class="kw">typename</span> T&gt; <span class="kw">inline</span> <span class="dt">void</span> myswap(T &amp;a, T &amp;b)</span>
<span id="cb10-23"><a aria-hidden="true" href="#cb10-23"></a>{</span>
<span id="cb10-24"><a aria-hidden="true" href="#cb10-24"></a>    T t = a;</span>
<span id="cb10-25"><a aria-hidden="true" href="#cb10-25"></a>    a = b;</span>
<span id="cb10-26"><a aria-hidden="true" href="#cb10-26"></a>    b = t;</span>
<span id="cb10-27"><a aria-hidden="true" href="#cb10-27"></a>    <span class="cf">return</span>;</span>
<span id="cb10-28"><a aria-hidden="true" href="#cb10-28"></a>}</span>
<span id="cb10-29"><a aria-hidden="true" href="#cb10-29"></a></span>
<span id="cb10-30"><a aria-hidden="true" href="#cb10-30"></a><span class="kw">struct</span> cmplx</span>
<span id="cb10-31"><a aria-hidden="true" href="#cb10-31"></a>{</span>
<span id="cb10-32"><a aria-hidden="true" href="#cb10-32"></a>    db x, y;</span>
<span id="cb10-33"><a aria-hidden="true" href="#cb10-33"></a>    cmplx(db xx = <span class="dv">0</span>, db yy = <span class="dv">0</span>)</span>
<span id="cb10-34"><a aria-hidden="true" href="#cb10-34"></a>    {</span>
<span id="cb10-35"><a aria-hidden="true" href="#cb10-35"></a>        x = xx, y = yy;</span>
<span id="cb10-36"><a aria-hidden="true" href="#cb10-36"></a>    }</span>
<span id="cb10-37"><a aria-hidden="true" href="#cb10-37"></a>} a[maxn];</span>
<span id="cb10-38"><a aria-hidden="true" href="#cb10-38"></a></span>
<span id="cb10-39"><a aria-hidden="true" href="#cb10-39"></a><span class="dt">int</span> rev[maxn];</span>
<span id="cb10-40"><a aria-hidden="true" href="#cb10-40"></a></span>
<span id="cb10-41"><a aria-hidden="true" href="#cb10-41"></a>cmplx <span class="kw">operator</span>+(<span class="at">const</span> cmplx &amp;a, <span class="at">const</span> cmplx &amp;b) {<span class="cf">return</span> cmplx(a.x + b.x, a.y + b.y);}</span>
<span id="cb10-42"><a aria-hidden="true" href="#cb10-42"></a>cmplx <span class="kw">operator</span>-(<span class="at">const</span> cmplx &amp;a, <span class="at">const</span> cmplx &amp;b) {<span class="cf">return</span> cmplx(a.x - b.x, a.y - b.y);}</span>
<span id="cb10-43"><a aria-hidden="true" href="#cb10-43"></a>cmplx <span class="kw">operator</span>*(<span class="at">const</span> cmplx &amp;a, <span class="at">const</span> cmplx &amp;b) {<span class="cf">return</span> cmplx(a.x * b.x - a.y * b.y, a.x * b.y + a.y * b.x);}</span>
<span id="cb10-44"><a aria-hidden="true" href="#cb10-44"></a></span>
<span id="cb10-45"><a aria-hidden="true" href="#cb10-45"></a><span class="dt">void</span> DFT(cmplx *f, <span class="dt">int</span> lim, <span class="dt">int</span> type)</span>
<span id="cb10-46"><a aria-hidden="true" href="#cb10-46"></a>{</span>
<span id="cb10-47"><a aria-hidden="true" href="#cb10-47"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb10-48"><a aria-hidden="true" href="#cb10-48"></a>        <span class="cf">if</span> (i &lt; rev[i])</span>
<span id="cb10-49"><a aria-hidden="true" href="#cb10-49"></a>            myswap(f[i], f[rev[i]]);</span>
<span id="cb10-50"><a aria-hidden="true" href="#cb10-50"></a>    <span class="cf">for</span> (<span class="dt">int</span> p = <span class="dv">2</span>; p &lt;= lim; p &lt;&lt;= <span class="dv">1</span>)</span>
<span id="cb10-51"><a aria-hidden="true" href="#cb10-51"></a>    {</span>
<span id="cb10-52"><a aria-hidden="true" href="#cb10-52"></a>        <span class="dt">int</span> len = p &gt;&gt; <span class="dv">1</span>;</span>
<span id="cb10-53"><a aria-hidden="true" href="#cb10-53"></a>        cmplx Wp(cos(<span class="dv">2</span> * pi / p), type * sin(<span class="dv">2</span> * pi / p));</span>
<span id="cb10-54"><a aria-hidden="true" href="#cb10-54"></a>        <span class="cf">for</span> (<span class="dt">int</span> k = <span class="dv">0</span>; k &lt; lim; k += p)</span>
<span id="cb10-55"><a aria-hidden="true" href="#cb10-55"></a>        {</span>
<span id="cb10-56"><a aria-hidden="true" href="#cb10-56"></a>            cmplx w(<span class="dv">1</span>, <span class="dv">0</span>);</span>
<span id="cb10-57"><a aria-hidden="true" href="#cb10-57"></a>            <span class="cf">for</span> (<span class="dt">int</span> l = k; l &lt; k + len; ++l, w = w * Wp)</span>
<span id="cb10-58"><a aria-hidden="true" href="#cb10-58"></a>            {</span>
<span id="cb10-59"><a aria-hidden="true" href="#cb10-59"></a>                cmplx tmp = w * f[len + l];</span>
<span id="cb10-60"><a aria-hidden="true" href="#cb10-60"></a>                f[len + l] = f[l] - tmp;</span>
<span id="cb10-61"><a aria-hidden="true" href="#cb10-61"></a>                f[l] = f[l] + tmp;</span>
<span id="cb10-62"><a aria-hidden="true" href="#cb10-62"></a>            }</span>
<span id="cb10-63"><a aria-hidden="true" href="#cb10-63"></a>        }</span>
<span id="cb10-64"><a aria-hidden="true" href="#cb10-64"></a>    }</span>
<span id="cb10-65"><a aria-hidden="true" href="#cb10-65"></a>}</span>
<span id="cb10-66"><a aria-hidden="true" href="#cb10-66"></a></span>
<span id="cb10-67"><a aria-hidden="true" href="#cb10-67"></a><span class="dt">int</span> main()</span>
<span id="cb10-68"><a aria-hidden="true" href="#cb10-68"></a>{</span>
<span id="cb10-69"><a aria-hidden="true" href="#cb10-69"></a>    <span class="dt">int</span> n = read(), m = read();</span>
<span id="cb10-70"><a aria-hidden="true" href="#cb10-70"></a>    FOR(i, <span class="dv">0</span>, n) a[i].x = read();</span>
<span id="cb10-71"><a aria-hidden="true" href="#cb10-71"></a>    FOR(i, <span class="dv">0</span>, m) a[i].y = read();</span>
<span id="cb10-72"><a aria-hidden="true" href="#cb10-72"></a>    <span class="dt">int</span> lim = <span class="dv">1</span>;</span>
<span id="cb10-73"><a aria-hidden="true" href="#cb10-73"></a>    <span class="cf">while</span> (lim &lt;= n + m) lim &lt;&lt;= <span class="dv">1</span>;</span>
<span id="cb10-74"><a aria-hidden="true" href="#cb10-74"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb10-75"><a aria-hidden="true" href="#cb10-75"></a>        rev[i] = ((rev[i &gt;&gt; <span class="dv">1</span>] &gt;&gt; <span class="dv">1</span>) | ((i &amp; <span class="dv">1</span>) ? (lim &gt;&gt; <span class="dv">1</span>) : <span class="dv">0</span>));</span>
<span id="cb10-76"><a aria-hidden="true" href="#cb10-76"></a>    DFT(a, lim, <span class="dv">1</span>);</span>
<span id="cb10-77"><a aria-hidden="true" href="#cb10-77"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb10-78"><a aria-hidden="true" href="#cb10-78"></a>        a[i] = a[i] * a[i];</span>
<span id="cb10-79"><a aria-hidden="true" href="#cb10-79"></a>    DFT(a, lim, -<span class="dv">1</span>);</span>
<span id="cb10-80"><a aria-hidden="true" href="#cb10-80"></a>    FOR(i, <span class="dv">0</span>, n + m)</span>
<span id="cb10-81"><a aria-hidden="true" href="#cb10-81"></a>        printf(<span class="st">"</span><span class="sc">%d</span><span class="st"> "</span>, (<span class="dt">int</span>)(a[i].y / lim / <span class="fl">2.0</span> + <span class="fl">0.5</span>));</span>
<span id="cb10-82"><a aria-hidden="true" href="#cb10-82"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb10-83"><a aria-hidden="true" href="#cb10-83"></a>}</span></code></pre></div>
<h2 id="å¿«é€Ÿæ•°è®ºå˜æ¢ntt">å¿«é€Ÿæ•°è®ºå˜æ¢ï¼ˆNTTï¼‰</h2>
<p>æœ‰äº† FFTï¼Œæˆ‘ä»¬å·²ç»æœ‰èƒ½åŠ›åœ¨ <span class="math inline">\(O(n\log n)\)</span> çš„æ—¶é—´å†…æ±‚å‡ºä¸¤ä¸ªå¤šé¡¹å¼çš„å·ç§¯äº†ã€‚ä½†æ˜¯ FFT ä¹Ÿæœ‰å®ƒçš„ç¼ºç‚¹ï¼šå¤æ•°é‡‡ç”¨çš„æµ®ç‚¹è¿ç®—ä¸ä»…é€ æˆç²¾åº¦çš„é—®é¢˜ï¼Œè¿˜ä¼šå¢å¤§å¸¸æ•°ã€‚é—æ†¾çš„æ˜¯æ•°å­¦å®¶ä»¬å·²ç»è¯æ˜äº† <span class="math inline">\(\mathbb C\)</span> ä¸­åªæœ‰å•ä½å¤æ•°æ ¹æ»¡è¶³ FFT çš„è¦æ±‚ã€‚</p>
<p>è€ƒè™‘åˆ°åˆ©ç”¨å¤šé¡¹å¼çš„è®¡æ•°é¢˜å¾ˆå¤šéƒ½æ˜¯æ¨¡æ„ä¹‰ä¸‹çš„ï¼Œæ‰€ä»¥è‡ªç„¶å¸Œæœ›ä¸ºå•ä½å¤æ•°æ ¹æ‰¾ä¸€ä¸ªæ¨¡æ„ä¹‰ä¸‹çš„æ›¿ä»£å“ã€‚æ­¤æ—¶å°±è¿›å…¥ä¸‹é¢çš„å‰ç½®çŸ¥è¯†ï¼šåŸæ ¹ã€‚</p>
<h3 id="åŸæ ¹">åŸæ ¹</h3>
<p>è®¾æ•´æ•° <span class="math inline">\(r,n\)</span> æ»¡è¶³ <span class="math inline">\(r\perp n\land r \not= 0 \land n &gt; 0\)</span>ï¼Œä½¿å¾— <span class="math inline">\(r^x \equiv 1\pmod n\)</span> çš„<strong>æœ€å°æ­£æ•´æ•°</strong> <span class="math inline">\(x\)</span> ç§°ä¸º <span class="math inline">\(r\)</span> æ¨¡ <span class="math inline">\(n\)</span> çš„<strong>é˜¶</strong>ï¼Œè®°ä¸º <span class="math inline">\(\mathrm{ord}_nr\)</span> æˆ– <span class="math inline">\(\delta_n(r)\)</span>ã€‚</p>
<p>è‹¥ <span class="math inline">\(r,n\in\mathbb N^+\land r\perp n\)</span>ï¼Œå½“ <span class="math inline">\(\operatorname{ord}_nr = \phi(n)\)</span> æ—¶ï¼Œç§° <span class="math inline">\(r\)</span> æ˜¯æ¨¡ <span class="math inline">\(n\)</span> çš„åŸæ ¹æˆ–è€… <span class="math inline">\(n\)</span> çš„åŸæ ¹ã€‚</p>
<h3 id="ntt">NTT</h3>
<p>å¯¹äºè´¨æ•° <span class="math inline">\(p = qn + 1\:(n = 2^m)\)</span>ï¼ŒåŸæ ¹ <span class="math inline">\(g\)</span> æ»¡è¶³ <span class="math inline">\(g^{qn}\equiv 1\pmod p\)</span>ï¼Œå°† <span class="math inline">\(g_n = g^q\pmod p\)</span> çœ‹ä½œ <span class="math inline">\(\omega_n\)</span> çš„ç­‰ä»·ï¼Œå…¶æ»¡è¶³ç›¸ä¼¼çš„æ€§è´¨ï¼Œæ¯”å¦‚ <span class="math inline">\(g_n^n\equiv 1\pmod p,g_n^{n/2} \equiv -1\pmod p\)</span>ã€‚</p>
<p>å¸¸è§çš„è´¨æ•° <span class="math display">\[
\begin{aligned}
p &amp;= 998244353 = 7\times17\times2^{23} + 1,&amp;g = 3\\
p &amp;= 1004535809 = 479\times 2^{21} + 1,&amp;g =  3
\end{aligned}
\]</span> è¿­ä»£åˆ°é•¿åº¦ä¸º <span class="math inline">\(l\)</span> æ—¶ï¼Œ<span class="math inline">\(g_l = g^{\frac{p - 1}{l}}\)</span></p>
<p>ç›´æ¥çœ‹ä»£ç ï¼š</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb11-1"><a aria-hidden="true" href="#cb11-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span>
<span id="cb11-2"><a aria-hidden="true" href="#cb11-2"></a><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></span>
<span id="cb11-3"><a aria-hidden="true" href="#cb11-3"></a><span class="pp">#define FOR</span>(i,<span class="pp"> </span>a,<span class="pp"> </span>b)<span class="pp"> </span><span class="cf">for</span><span class="pp"> </span>(<span class="dt">int</span><span class="pp"> </span>i<span class="pp"> </span>=<span class="pp"> </span>a;<span class="pp"> </span>i<span class="pp"> </span>&lt;=<span class="pp"> </span>b;<span class="pp"> </span>++i)</span>
<span id="cb11-4"><a aria-hidden="true" href="#cb11-4"></a></span>
<span id="cb11-5"><a aria-hidden="true" href="#cb11-5"></a><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</span>
<span id="cb11-6"><a aria-hidden="true" href="#cb11-6"></a></span>
<span id="cb11-7"><a aria-hidden="true" href="#cb11-7"></a><span class="at">const</span> ll G = <span class="dv">3</span>;</span>
<span id="cb11-8"><a aria-hidden="true" href="#cb11-8"></a><span class="at">const</span> ll mod = <span class="dv">998244353</span>;</span>
<span id="cb11-9"><a aria-hidden="true" href="#cb11-9"></a><span class="at">const</span> <span class="dt">int</span> maxn = <span class="fl">3e6</span> + <span class="dv">5</span>;</span>
<span id="cb11-10"><a aria-hidden="true" href="#cb11-10"></a></span>
<span id="cb11-11"><a aria-hidden="true" href="#cb11-11"></a><span class="kw">inline</span> <span class="dt">int</span> read()</span>
<span id="cb11-12"><a aria-hidden="true" href="#cb11-12"></a>{</span>
<span id="cb11-13"><a aria-hidden="true" href="#cb11-13"></a>    <span class="dt">char</span> c = getchar();</span>
<span id="cb11-14"><a aria-hidden="true" href="#cb11-14"></a>    <span class="dt">int</span> s = <span class="dv">0</span>;</span>
<span id="cb11-15"><a aria-hidden="true" href="#cb11-15"></a>    <span class="cf">while</span> (!isdigit(c))</span>
<span id="cb11-16"><a aria-hidden="true" href="#cb11-16"></a>        c = getchar();</span>
<span id="cb11-17"><a aria-hidden="true" href="#cb11-17"></a>    <span class="cf">while</span> (isdigit(c))</span>
<span id="cb11-18"><a aria-hidden="true" href="#cb11-18"></a>        s = <span class="dv">10</span> * s + c - <span class="ch">'0'</span>, c = getchar();</span>
<span id="cb11-19"><a aria-hidden="true" href="#cb11-19"></a>    <span class="cf">return</span> s;</span>
<span id="cb11-20"><a aria-hidden="true" href="#cb11-20"></a>}</span>
<span id="cb11-21"><a aria-hidden="true" href="#cb11-21"></a></span>
<span id="cb11-22"><a aria-hidden="true" href="#cb11-22"></a><span class="kw">template</span>&lt;<span class="kw">typename</span> T&gt; <span class="kw">inline</span> <span class="dt">void</span> myswap(T &amp;a, T &amp;b)</span>
<span id="cb11-23"><a aria-hidden="true" href="#cb11-23"></a>{</span>
<span id="cb11-24"><a aria-hidden="true" href="#cb11-24"></a>    T t = a;</span>
<span id="cb11-25"><a aria-hidden="true" href="#cb11-25"></a>    a = b;</span>
<span id="cb11-26"><a aria-hidden="true" href="#cb11-26"></a>    b = t;</span>
<span id="cb11-27"><a aria-hidden="true" href="#cb11-27"></a>    <span class="cf">return</span>;</span>
<span id="cb11-28"><a aria-hidden="true" href="#cb11-28"></a>}</span>
<span id="cb11-29"><a aria-hidden="true" href="#cb11-29"></a></span>
<span id="cb11-30"><a aria-hidden="true" href="#cb11-30"></a>ll pow(ll base, ll p = mod - <span class="dv">2</span>)</span>
<span id="cb11-31"><a aria-hidden="true" href="#cb11-31"></a>{</span>
<span id="cb11-32"><a aria-hidden="true" href="#cb11-32"></a>    ll ret = <span class="dv">1</span>;</span>
<span id="cb11-33"><a aria-hidden="true" href="#cb11-33"></a>    <span class="cf">for</span> (; p; p &gt;&gt;= <span class="dv">1</span>)</span>
<span id="cb11-34"><a aria-hidden="true" href="#cb11-34"></a>    {</span>
<span id="cb11-35"><a aria-hidden="true" href="#cb11-35"></a>        <span class="cf">if</span> (p &amp; <span class="dv">1</span>)</span>
<span id="cb11-36"><a aria-hidden="true" href="#cb11-36"></a>            ret = ret * base % mod;</span>
<span id="cb11-37"><a aria-hidden="true" href="#cb11-37"></a>        base = base * base % mod;</span>
<span id="cb11-38"><a aria-hidden="true" href="#cb11-38"></a>    }</span>
<span id="cb11-39"><a aria-hidden="true" href="#cb11-39"></a>    <span class="cf">return</span> ret;</span>
<span id="cb11-40"><a aria-hidden="true" href="#cb11-40"></a>}</span>
<span id="cb11-41"><a aria-hidden="true" href="#cb11-41"></a></span>
<span id="cb11-42"><a aria-hidden="true" href="#cb11-42"></a><span class="dt">int</span> rev[maxn];</span>
<span id="cb11-43"><a aria-hidden="true" href="#cb11-43"></a>ll f[maxn], g[maxn];</span>
<span id="cb11-44"><a aria-hidden="true" href="#cb11-44"></a><span class="at">const</span> ll invG = pow(G);</span>
<span id="cb11-45"><a aria-hidden="true" href="#cb11-45"></a></span>
<span id="cb11-46"><a aria-hidden="true" href="#cb11-46"></a><span class="dt">void</span> NTT(ll *f, <span class="dt">int</span> lim, <span class="dt">int</span> type)</span>
<span id="cb11-47"><a aria-hidden="true" href="#cb11-47"></a>{</span>
<span id="cb11-48"><a aria-hidden="true" href="#cb11-48"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb11-49"><a aria-hidden="true" href="#cb11-49"></a>        <span class="cf">if</span> (i &lt; rev[i])</span>
<span id="cb11-50"><a aria-hidden="true" href="#cb11-50"></a>            myswap(f[i], f[rev[i]]);</span>
<span id="cb11-51"><a aria-hidden="true" href="#cb11-51"></a>    <span class="cf">for</span> (<span class="dt">int</span> p = <span class="dv">2</span>; p &lt;= lim; p &lt;&lt;= <span class="dv">1</span>)</span>
<span id="cb11-52"><a aria-hidden="true" href="#cb11-52"></a>    {</span>
<span id="cb11-53"><a aria-hidden="true" href="#cb11-53"></a>        <span class="dt">int</span> len = p &gt;&gt; <span class="dv">1</span>;</span>
<span id="cb11-54"><a aria-hidden="true" href="#cb11-54"></a>        ll tG = pow(type ? G : invG, (mod - <span class="dv">1</span>) / p);</span>
<span id="cb11-55"><a aria-hidden="true" href="#cb11-55"></a>        <span class="cf">for</span> (<span class="dt">int</span> k = <span class="dv">0</span>; k &lt; lim; k += p)</span>
<span id="cb11-56"><a aria-hidden="true" href="#cb11-56"></a>        {</span>
<span id="cb11-57"><a aria-hidden="true" href="#cb11-57"></a>            ll buf = <span class="dv">1</span>;</span>
<span id="cb11-58"><a aria-hidden="true" href="#cb11-58"></a>            <span class="cf">for</span> (<span class="dt">int</span> l = k; l &lt; k + len; ++l, buf = buf * tG % mod)</span>
<span id="cb11-59"><a aria-hidden="true" href="#cb11-59"></a>            {</span>
<span id="cb11-60"><a aria-hidden="true" href="#cb11-60"></a>                ll tmp = buf * f[len + l] % mod;</span>
<span id="cb11-61"><a aria-hidden="true" href="#cb11-61"></a>                f[len + l] = f[l] - tmp;</span>
<span id="cb11-62"><a aria-hidden="true" href="#cb11-62"></a>                <span class="cf">if</span> (f[len + l] &lt; <span class="dv">0</span>) f[len + l] += mod;<span class="co">//åŠæ—¶å–æ¨¡</span></span>
<span id="cb11-63"><a aria-hidden="true" href="#cb11-63"></a>                f[l] = f[l] + tmp;</span>
<span id="cb11-64"><a aria-hidden="true" href="#cb11-64"></a>                <span class="cf">if</span> (f[l] &gt; mod) f[l] -= mod;<span class="co">//åŠæ—¶å–æ¨¡</span></span>
<span id="cb11-65"><a aria-hidden="true" href="#cb11-65"></a>            }</span>
<span id="cb11-66"><a aria-hidden="true" href="#cb11-66"></a>        }</span>
<span id="cb11-67"><a aria-hidden="true" href="#cb11-67"></a>    }</span>
<span id="cb11-68"><a aria-hidden="true" href="#cb11-68"></a>    ll invlim = pow(lim);<span class="co">//æœ€åè¿˜å›å»ï¼Œé™¤ä»¥limç›¸å½“äºä¹˜ä¸Šlimçš„é€†å…ƒ</span></span>
<span id="cb11-69"><a aria-hidden="true" href="#cb11-69"></a>    <span class="cf">if</span> (!type)</span>
<span id="cb11-70"><a aria-hidden="true" href="#cb11-70"></a>        FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb11-71"><a aria-hidden="true" href="#cb11-71"></a>            f[i] = (f[i] * invlim % mod);</span>
<span id="cb11-72"><a aria-hidden="true" href="#cb11-72"></a>    <span class="cf">return</span>;</span>
<span id="cb11-73"><a aria-hidden="true" href="#cb11-73"></a>}</span>
<span id="cb11-74"><a aria-hidden="true" href="#cb11-74"></a></span>
<span id="cb11-75"><a aria-hidden="true" href="#cb11-75"></a><span class="dt">int</span> main()</span>
<span id="cb11-76"><a aria-hidden="true" href="#cb11-76"></a>{</span>
<span id="cb11-77"><a aria-hidden="true" href="#cb11-77"></a>    <span class="dt">int</span> n = read(), m = read();</span>
<span id="cb11-78"><a aria-hidden="true" href="#cb11-78"></a>    FOR(i, <span class="dv">0</span>, n) f[i] = read();</span>
<span id="cb11-79"><a aria-hidden="true" href="#cb11-79"></a>    FOR(i, <span class="dv">0</span>, m) g[i] = read();</span>
<span id="cb11-80"><a aria-hidden="true" href="#cb11-80"></a>    <span class="dt">int</span> lim = <span class="dv">1</span>;</span>
<span id="cb11-81"><a aria-hidden="true" href="#cb11-81"></a>    <span class="cf">while</span> (lim &lt;= n + m) lim &lt;&lt;= <span class="dv">1</span>;</span>
<span id="cb11-82"><a aria-hidden="true" href="#cb11-82"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb11-83"><a aria-hidden="true" href="#cb11-83"></a>        rev[i] = (rev[i &gt;&gt; <span class="dv">1</span>] &gt;&gt; <span class="dv">1</span>) | ((i &amp; <span class="dv">1</span>) ? (lim &gt;&gt; <span class="dv">1</span>) : <span class="dv">0</span>);</span>
<span id="cb11-84"><a aria-hidden="true" href="#cb11-84"></a>    NTT(f, lim, <span class="dv">1</span>), NTT(g, lim, <span class="dv">1</span>);</span>
<span id="cb11-85"><a aria-hidden="true" href="#cb11-85"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb11-86"><a aria-hidden="true" href="#cb11-86"></a>        f[i] = f[i] * g[i] % mod;</span>
<span id="cb11-87"><a aria-hidden="true" href="#cb11-87"></a>    NTT(f, lim, <span class="dv">0</span>);</span>
<span id="cb11-88"><a aria-hidden="true" href="#cb11-88"></a>    FOR(i, <span class="dv">0</span>, n + m)</span>
<span id="cb11-89"><a aria-hidden="true" href="#cb11-89"></a>        printf(<span class="st">"</span><span class="sc">%d</span><span class="st"> "</span>, (<span class="dt">int</span>)f[i]);</span>
<span id="cb11-90"><a aria-hidden="true" href="#cb11-90"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb11-91"><a aria-hidden="true" href="#cb11-91"></a>}</span></code></pre></div>
<h2 id="ä»»æ„æ¨¡æ•°å¤šé¡¹å¼ä¹˜æ³•">ä»»æ„æ¨¡æ•°å¤šé¡¹å¼ä¹˜æ³•</h2>
<h3 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h3>
<p>æœ‰äº›æ¯’ç˜¤é¢˜ç›®é‡Œé¢ï¼Œæ¨¡æ•°ä¸ä¸€å®šæ˜¯æ»¡è¶³ <span class="math inline">\(p = a\times2^k + 1\)</span> çš„å½¢å¼ï¼Œè¿™å°±æ„å‘³ç€ NTT æ˜¯ä¸èƒ½ç”¨çš„ï¼Œè€Œæ™®é€šçš„ FFT ç²¾åº¦åˆä¸å¤Ÿï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>ä¸€èˆ¬çš„é—®é¢˜å½¢å¼ï¼šç»™å®š <span class="math inline">\(f(x)\)</span> å’Œ <span class="math inline">\(g(x)\)</span>ï¼Œæ±‚ <span class="math inline">\(h(x) = f(x)\times g(x)\)</span>ï¼Œç³»æ•°å¯¹ <span class="math inline">\(10^9 + 7\)</span> å–æ¨¡ã€‚</p>
<h3 id="æ³•-1ä¸‰æ¨¡-ntt">æ³• 1ï¼šä¸‰æ¨¡ NTT</h3>
<p>åˆ†æå¯å¾—æœ€å¤§çš„æ•°åº”è¯¥æ˜¯ <span class="math inline">\(p^2\times\max\{\deg f, \deg g\}\)</span>ï¼Œæ˜¯ <span class="math inline">\(10^{23}\)</span> çº§åˆ«çš„ã€‚æ‰€ä»¥é€‰ä¸‰ä¸ªæ¨¡æ•°åˆ†åˆ«åš NTT ç„¶åç”¨ CRT åˆå¹¶å³å¯ã€‚éœ€è¦åš <span class="math inline">\(9\)</span> æ¬¡ DFTï¼Œå¸¸æ•°è¾ƒå¤§ï¼Œæš‚ä¸è€ƒè™‘ã€‚</p>
<h3 id="æ³•-2æ‹†ç³»æ•°-fftmtt">æ³• 2ï¼šæ‹†ç³»æ•° FFTï¼ˆMTTï¼‰</h3>
<p>è€ƒè™‘æŠŠå¤šé¡¹å¼çš„ç³»æ•°æ‹†æˆå½¢å¦‚ <span class="math inline">\(a\times 2^{15} + b\)</span> çš„å½¢å¼ï¼Œé‚£ä¹ˆ <span class="math inline">\(a, b\le 2^{15}\)</span>ã€‚è¿™æ ·å­ç›¸ä¹˜çš„å€¼åŸŸå¤§æ¦‚æ˜¯ <span class="math inline">\(10^{14}\)</span> çº§åˆ«çš„ã€‚</p>
<p>äºæ˜¯æœ‰ <span class="math inline">\(c_1c_2 = (a_1\times 2^{15} + b_1)(a_2\times 2^{15}+b_2) = a_1a_2\times 2^{30} + (a_1b_2 + a_2b_1)2^{15} + b_1b_2\)</span>ã€‚ç„¶è€Œè¿™æ ·çœ‹ä¼¼è¦æ±‚å››æ¬¡å¤šé¡¹å¼ä¹˜æ³•ï¼Œ<span class="math inline">\(12\)</span> æ¬¡ DFTï¼Œä¼¼ä¹æ›´åŠ å±‘äº†ã€‚</p>
<p>å†·é™åˆ†æä¸€ä¸‹ï¼šç°åœ¨çš„é—®é¢˜æ˜¯æœ‰å››ä¸ªå¤šé¡¹å¼ <span class="math inline">\(A_1\)</span>ï¼Œ<span class="math inline">\(A_2\)</span>ï¼Œ<span class="math inline">\(B_1\)</span> å’Œ <span class="math inline">\(B_2\)</span>ï¼Œè¦æ±‚è¿™äº›å¤šé¡¹å¼çš„ä¸¤ä¸¤ä¹˜ç§¯ã€‚</p>
<p>åˆ©ç”¨å¤æ•°çš„æ€§è´¨ï¼šè€ƒè™‘ <span class="math inline">\((a + bi)(c + di) = ac - bd + (ad + bc)i\)</span>ã€‚é‚£ä¹ˆä»¤å¤å¤šé¡¹å¼ <span class="math inline">\(P = A_1 + iA_2\)</span>ï¼Œ<span class="math inline">\(Q = B_1 + iB_2\)</span>ã€‚</p>
<p>æœ‰ <span class="math inline">\(T_1 = P\times Q = A_1B_1 - A_2B_2 + (A_1B_2 + A_2B_1)i\)</span>ã€‚</p>
<p>å†è®¾ <span class="math inline">\(P' = A_1 - iA_2\)</span>ï¼Œé‚£ä¹ˆæœ‰ <span class="math inline">\(T_2 = P'\times Q = A_1B_1 + A_2B_2 + (A_1B_2 - A_2B_1)i\)</span>ã€‚</p>
<p>ä¸¤å¼ç›¸åŠ å¯ä»¥å¾—åˆ° <span class="math inline">\(2A_1B_1 + 2A_1B_2i\)</span>ï¼Œä¸¤å¼ç›¸å‡å¯ä»¥å¾—åˆ° <span class="math inline">\(2A_2B_2 - 2A_2B_1i\)</span>ã€‚æŠŠè¿™ä¸¤ä¸ªå¤šé¡¹å¼çš„å®éƒ¨è™šéƒ¨æ‹†å‡ºæ¥å°±å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœäº†ã€‚</p>
<p>è¿™æ ·å­éœ€è¦åš <span class="math inline">\(5\)</span> æ¬¡ DFTï¼Œå¸¸æ•°ä¸å°ä½†æ¯” <span class="math inline">\(9\)</span> æ¬¡ NTT ä¼˜ã€‚</p>
<h3 id="å®ç°">å®ç°</h3>
<p>å¯ä»¥ç›´æ¥é…åˆåé¢çš„ <code>vector</code> ç‰ˆå¤šé¡¹å¼æ¿å­é£Ÿç”¨ã€‚</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a aria-hidden="true" href="#cb12-1"></a><span class="kw">namespace</span> complex {</span>
<span id="cb12-2"><a aria-hidden="true" href="#cb12-2"></a>    <span class="kw">struct</span> cmplx {</span>
<span id="cb12-3"><a aria-hidden="true" href="#cb12-3"></a>        db x, y;</span>
<span id="cb12-4"><a aria-hidden="true" href="#cb12-4"></a>        cmplx(db xx = <span class="dv">0</span>, db yy = <span class="dv">0</span>) : x(xx), y(yy) {}</span>
<span id="cb12-5"><a aria-hidden="true" href="#cb12-5"></a>    };</span>
<span id="cb12-6"><a aria-hidden="true" href="#cb12-6"></a>    il cmplx <span class="kw">operator</span>+(<span class="at">const</span> cmplx &amp;a, <span class="at">const</span> cmplx &amp;b) {<span class="cf">return</span> cmplx(a.x + b.x, a.y + b.y);}</span>
<span id="cb12-7"><a aria-hidden="true" href="#cb12-7"></a>    il cmplx <span class="kw">operator</span>-(<span class="at">const</span> cmplx &amp;a, <span class="at">const</span> cmplx &amp;b) {<span class="cf">return</span> cmplx(a.x - b.x, a.y - b.y);}</span>
<span id="cb12-8"><a aria-hidden="true" href="#cb12-8"></a>    il cmplx <span class="kw">operator</span>*(<span class="at">const</span> cmplx &amp;a, <span class="at">const</span> cmplx &amp;b) {<span class="cf">return</span> cmplx(a.x * b.x - a.y * b.y, a.x * b.y + a.y * b.x);}</span>
<span id="cb12-9"><a aria-hidden="true" href="#cb12-9"></a>} <span class="kw">using</span> <span class="kw">namespace</span> complex;</span>
<span id="cb12-10"><a aria-hidden="true" href="#cb12-10"></a></span>
<span id="cb12-11"><a aria-hidden="true" href="#cb12-11"></a><span class="kw">namespace</span> MTT {</span>
<span id="cb12-12"><a aria-hidden="true" href="#cb12-12"></a>    <span class="kw">using</span> <span class="bu">std::</span>sin;</span>
<span id="cb12-13"><a aria-hidden="true" href="#cb12-13"></a>    <span class="kw">using</span> <span class="bu">std::</span>cos;</span>
<span id="cb12-14"><a aria-hidden="true" href="#cb12-14"></a>    <span class="kw">using</span> <span class="bu">std::</span>acos;</span>
<span id="cb12-15"><a aria-hidden="true" href="#cb12-15"></a>    <span class="kw">using</span> <span class="bu">std::</span>floor;</span>
<span id="cb12-16"><a aria-hidden="true" href="#cb12-16"></a>    <span class="at">const</span> db PI = acos(-<span class="fl">1.0</span>);</span>
<span id="cb12-17"><a aria-hidden="true" href="#cb12-17"></a>    <span class="at">const</span> <span class="dt">int</span> DIV = <span class="dv">32768</span>;</span>
<span id="cb12-18"><a aria-hidden="true" href="#cb12-18"></a>    <span class="dt">int</span> mod;</span>
<span id="cb12-19"><a aria-hidden="true" href="#cb12-19"></a></span>
<span id="cb12-20"><a aria-hidden="true" href="#cb12-20"></a>    <span class="pp">#define clr2</span>(f,<span class="pp"> </span>n)<span class="pp"> </span>memset(f,<span class="pp"> </span><span class="dv">0</span>,<span class="pp"> </span>(<span class="kw">sizeof</span>(cmplx))<span class="pp"> </span>*<span class="pp"> </span>n)</span>
<span id="cb12-21"><a aria-hidden="true" href="#cb12-21"></a></span>
<span id="cb12-22"><a aria-hidden="true" href="#cb12-22"></a>    <span class="dt">void</span> DFT(cmplx *g, <span class="dt">int</span> type, <span class="dt">int</span> lim) {</span>
<span id="cb12-23"><a aria-hidden="true" href="#cb12-23"></a>        <span class="at">static</span> cmplx f[maxn &lt;&lt; <span class="dv">1</span>];</span>
<span id="cb12-24"><a aria-hidden="true" href="#cb12-24"></a>        getTr(lim);</span>
<span id="cb12-25"><a aria-hidden="true" href="#cb12-25"></a>        FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>) f[i] = g[<span class="fu">tr</span>[i]];</span>
<span id="cb12-26"><a aria-hidden="true" href="#cb12-26"></a>        <span class="cf">for</span> (<span class="dt">int</span> p = <span class="dv">2</span>; p &lt;= lim; p &lt;&lt;= <span class="dv">1</span>) {</span>
<span id="cb12-27"><a aria-hidden="true" href="#cb12-27"></a>            <span class="dt">int</span> len = p &gt;&gt; <span class="dv">1</span>;</span>
<span id="cb12-28"><a aria-hidden="true" href="#cb12-28"></a>            cmplx Wp(<span class="bu">std::</span>cos(PI / len), type * <span class="bu">std::</span>sin(PI / len));</span>
<span id="cb12-29"><a aria-hidden="true" href="#cb12-29"></a>            <span class="cf">for</span> (<span class="dt">int</span> k = <span class="dv">0</span>; k &lt; lim; k += p) {</span>
<span id="cb12-30"><a aria-hidden="true" href="#cb12-30"></a>                cmplx w(<span class="dv">1</span>, <span class="dv">0</span>);</span>
<span id="cb12-31"><a aria-hidden="true" href="#cb12-31"></a>                <span class="cf">for</span> (<span class="dt">int</span> l = k; l &lt; k + len; ++l, w = w * Wp) {</span>
<span id="cb12-32"><a aria-hidden="true" href="#cb12-32"></a>                    cmplx tmp = w * f[len + l];</span>
<span id="cb12-33"><a aria-hidden="true" href="#cb12-33"></a>                    f[len + l] = f[l] - tmp;</span>
<span id="cb12-34"><a aria-hidden="true" href="#cb12-34"></a>                    f[l] = f[l] + tmp;</span>
<span id="cb12-35"><a aria-hidden="true" href="#cb12-35"></a>                }</span>
<span id="cb12-36"><a aria-hidden="true" href="#cb12-36"></a>            }</span>
<span id="cb12-37"><a aria-hidden="true" href="#cb12-37"></a>        }</span>
<span id="cb12-38"><a aria-hidden="true" href="#cb12-38"></a>        FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb12-39"><a aria-hidden="true" href="#cb12-39"></a>            <span class="cf">if</span> (type == -<span class="dv">1</span>) g[i] = cmplx(f[i].x / lim, f[i].y / lim);</span>
<span id="cb12-40"><a aria-hidden="true" href="#cb12-40"></a>            <span class="cf">else</span> g[i] = f[i];</span>
<span id="cb12-41"><a aria-hidden="true" href="#cb12-41"></a>        <span class="cf">return</span>;</span>
<span id="cb12-42"><a aria-hidden="true" href="#cb12-42"></a>    }</span>
<span id="cb12-43"><a aria-hidden="true" href="#cb12-43"></a></span>
<span id="cb12-44"><a aria-hidden="true" href="#cb12-44"></a>    Poly <span class="kw">operator</span>*(<span class="at">const</span> Poly &amp;A, <span class="at">const</span> Poly &amp;B) {</span>
<span id="cb12-45"><a aria-hidden="true" href="#cb12-45"></a>        <span class="at">static</span> cmplx p1[maxn &lt;&lt; <span class="dv">1</span>], p2[maxn &lt;&lt; <span class="dv">1</span>], q[maxn &lt;&lt; <span class="dv">1</span>], t1[maxn &lt;&lt; <span class="dv">1</span>], t2[maxn &lt;&lt; <span class="dv">1</span>];</span>
<span id="cb12-46"><a aria-hidden="true" href="#cb12-46"></a>        VEC(i, A) p1[i] = cmplx(A[i] / DIV, A[i] % DIV), p2[i] = cmplx(A[i] / DIV, -p1[i].y);</span>
<span id="cb12-47"><a aria-hidden="true" href="#cb12-47"></a>        VEC(i, B) q[i] = cmplx(B[i] / DIV, B[i] % DIV);</span>
<span id="cb12-48"><a aria-hidden="true" href="#cb12-48"></a>        Poly C; C.resize(min(lim, (<span class="dt">int</span>)A.size() + (<span class="dt">int</span>)B.size() - <span class="dv">1</span>));</span>
<span id="cb12-49"><a aria-hidden="true" href="#cb12-49"></a>        <span class="dt">int</span> n; <span class="cf">for</span> (n = <span class="dv">1</span>; n &lt; (<span class="dt">int</span>)(A.size() + B.size() - <span class="dv">1</span>); n &lt;&lt;= <span class="dv">1</span>);</span>
<span id="cb12-50"><a aria-hidden="true" href="#cb12-50"></a></span>
<span id="cb12-51"><a aria-hidden="true" href="#cb12-51"></a>        DFT(p1, <span class="dv">1</span>, n), DFT(p2, <span class="dv">1</span>, n), DFT(q, <span class="dv">1</span>, n);</span>
<span id="cb12-52"><a aria-hidden="true" href="#cb12-52"></a>        FOR(i, <span class="dv">0</span>, n - <span class="dv">1</span>) t1[i] = p1[i] * q[i], t2[i] = p2[i] * q[i];</span>
<span id="cb12-53"><a aria-hidden="true" href="#cb12-53"></a>        DFT(t1, -<span class="dv">1</span>, n), DFT(t2, -<span class="dv">1</span>, n);</span>
<span id="cb12-54"><a aria-hidden="true" href="#cb12-54"></a></span>
<span id="cb12-55"><a aria-hidden="true" href="#cb12-55"></a>        VEC(i, C) {</span>
<span id="cb12-56"><a aria-hidden="true" href="#cb12-56"></a>            ll a1b1, a1b2, a2b1, a2b2;</span>
<span id="cb12-57"><a aria-hidden="true" href="#cb12-57"></a>            a1b1 = (ll)floor((t1[i].x + t2[i].x) / <span class="fl">2.0</span> + <span class="fl">0.49</span>) % mod;</span>
<span id="cb12-58"><a aria-hidden="true" href="#cb12-58"></a>            a1b2 = (ll)floor((t1[i].y + t2[i].y) / <span class="fl">2.0</span> + <span class="fl">0.49</span>) % mod;</span>
<span id="cb12-59"><a aria-hidden="true" href="#cb12-59"></a>            a2b1 = ((ll)floor(t1[i].y + <span class="fl">0.49</span>) - a1b2) % mod;</span>
<span id="cb12-60"><a aria-hidden="true" href="#cb12-60"></a>            a2b2 = ((ll)floor(t2[i].x + <span class="fl">0.49</span>) - a1b1) % mod;</span>
<span id="cb12-61"><a aria-hidden="true" href="#cb12-61"></a>            C[i] = ((((a1b1 &lt;&lt; <span class="dv">15</span>) + (a1b2 + a2b1)) &lt;&lt; <span class="dv">15</span>) + a2b2) % mod;</span>
<span id="cb12-62"><a aria-hidden="true" href="#cb12-62"></a>            C[i] = (C[i] + mod) % mod;</span>
<span id="cb12-63"><a aria-hidden="true" href="#cb12-63"></a>        }</span>
<span id="cb12-64"><a aria-hidden="true" href="#cb12-64"></a></span>
<span id="cb12-65"><a aria-hidden="true" href="#cb12-65"></a>        clr2(p1, n), clr2(p2, n), clr2(q, n), clr2(t1, n), clr2(t2, n);</span>
<span id="cb12-66"><a aria-hidden="true" href="#cb12-66"></a>        <span class="cf">return</span> C;</span>
<span id="cb12-67"><a aria-hidden="true" href="#cb12-67"></a>    }</span>
<span id="cb12-68"><a aria-hidden="true" href="#cb12-68"></a>} <span class="kw">using</span> <span class="kw">namespace</span> MTT;</span></code></pre></div>
<h2 id="fftntt-ä¼˜åŒ–å·ç§¯çš„ä¸€äº›ä¾‹å­">FFT/NTT ä¼˜åŒ–å·ç§¯çš„ä¸€äº›ä¾‹å­</h2>
<p>åœ¨ç»§ç»­ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ FFT/NTT çš„ä¸€äº›åº”ç”¨ã€‚ï¼ˆé«˜ç²¾åº¦ä¹˜æ³•å°±ä¸è¯´äº†ï¼Œè®°å¾—æœ€åè¿›ä½å°±å¯ä»¥äº†ï¼‰</p>
<ul>
<li>ä¼˜åŒ–ä¸€èˆ¬çš„å·ç§¯</li>
<li>å’Œç”Ÿæˆå‡½æ•°ä¸€èµ·é£Ÿç”¨</li>
<li>å­—ç¬¦ä¸²åŒ¹é…ï¼ˆä½ æ²¡çœ‹é”™ï¼‰</li>
</ul>
<h3 id="æ´›è°·-p3338-zjoi2014åŠ›"><a href="https://www.luogu.com.cn/problem/P3338">æ´›è°· P3338 [ZJOI2014]åŠ›</a></h3>
<p>é¢˜æ„ï¼šç»™å®š <span class="math inline">\(\{q\}\)</span>ï¼Œå®šä¹‰ <span class="math display">\[
F_i = \sum_{j = 1}^{i - 1}\frac{q_iq_j}{(i - j)^2} - \sum_{j = i + 1}^n\frac{q_iq_j}{(i - j)^2}
\]</span> æ±‚ <span class="math display">\[
E_i=\frac{F_i}{q_i}
\]</span> è€ƒè™‘æš´åŠ›çš„è¯ï¼Œè¿™é“é¢˜æ˜¯ <span class="math inline">\(O(n^2)\)</span> çš„ï¼Œè¿‡ä¸å»ï¼Œè€ƒè™‘è½¬åŒ–å¼å­ï¼š <span class="math display">\[
\begin{aligned}
E_i &amp;= \frac{F_i}{q_i}\\
&amp;=\sum_{j = 1}^{i - 1}\frac{q_j}{(i - j)^2} - \sum_{j = i + 1}^n\frac{q_j}{(i - j)^2}\\
\end{aligned}
\]</span> æˆ‘ä»¬å°è¯•å°†å…¶åŒ–ä¸ºå·ç§¯çš„å½¢å¼ï¼Œä»¤ <span class="math inline">\(f_i = q_i\)</span>ï¼Œä¸” <span class="math inline">\(f_0 = 0\)</span>ï¼›<span class="math inline">\(g_i =\dfrac{1}{i^2}\)</span>ï¼Œä¸” <span class="math inline">\(g_0 = 0\)</span>ï¼Œå›ä»£ï¼š <span class="math display">\[
\begin{aligned}
E_i &amp;= \sum_{j = 0}^{i}f_jg_{i - j} - \sum_{j = i}^nf_jg_{j - i}
\end{aligned}
\]</span> å·¦è¾¹çš„éƒ¨åˆ†å·²ç»æ˜¯ä¸€ä¸ªå·ç§¯çš„å½¢å¼äº†ï¼Œè€ƒè™‘ç»§ç»­åŒ–ç®€å³è¾¹ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç¿»è½¬çš„æŠ€å·§ï¼Œä»¤ <span class="math inline">\(f'_i = f_{n - i}\)</span>ï¼Œ<span class="math inline">\(t = n - i\)</span>ï¼Œåˆ™å³åŠè¾¹çš„å¼å­å¯ä»¥åŒ–ä¸º <span class="math inline">\(\displaystyle\sum_{j = 0}^{t}f'_{t - j}g_j\)</span>ã€‚ç°åœ¨ä¸¤è¾¹éƒ½åŒ–ä¸ºå·ç§¯çš„å½¢å¼äº†ï¼Œå¯ä»¥æ„‰å¿«çš„ä½¿ç”¨ FFT åŠ é€Ÿäº†ã€‚</p>
<p>å³æˆ‘ä»¬è®¾å¤šé¡¹å¼ <span class="math inline">\(A(x) =\displaystyle\sum_{i = 0}^nf_ix^n\)</span>ï¼Œ<span class="math inline">\(B(x) = \displaystyle\sum_{i = 0}^ng_ix^n\)</span>ï¼Œ<span class="math inline">\(C(x) = \displaystyle\sum_{i = 0}^nf'_i\)</span>ã€‚å†ä»¤ <span class="math inline">\(L(x) = A(x)B(x)\)</span>ï¼Œ<span class="math inline">\(R(x) = B(x)C(x)\)</span>ï¼Œä¸éš¾å‘ç°ç­”æ¡ˆ <span class="math inline">\(E_i = l_i - r_{n - i}\)</span>ï¼Œå…¶ä¸­ <span class="math inline">\(l_i\)</span> å’Œ <span class="math inline">\(r_i\)</span> åˆ†åˆ«ä¸º <span class="math inline">\(L(x)\)</span> å’Œ <span class="math inline">\(R(x)\)</span> ä¸­ <span class="math inline">\(x^i\)</span> çš„ç³»æ•°ã€‚</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb13-1"><a aria-hidden="true" href="#cb13-1"></a><span class="dt">int</span> main()</span>
<span id="cb13-2"><a aria-hidden="true" href="#cb13-2"></a>{</span>
<span id="cb13-3"><a aria-hidden="true" href="#cb13-3"></a>    <span class="dt">int</span> n; scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>, &amp;n);</span>
<span id="cb13-4"><a aria-hidden="true" href="#cb13-4"></a>    FOR(i, <span class="dv">1</span>, n)</span>
<span id="cb13-5"><a aria-hidden="true" href="#cb13-5"></a>    {</span>
<span id="cb13-6"><a aria-hidden="true" href="#cb13-6"></a>        scanf(<span class="st">"</span><span class="sc">%lf</span><span class="st">"</span>, &amp;a[i].x);</span>
<span id="cb13-7"><a aria-hidden="true" href="#cb13-7"></a>        b[i].x = (<span class="fl">1.0</span> / i / i);</span>
<span id="cb13-8"><a aria-hidden="true" href="#cb13-8"></a>        c[n - i].x = a[i].x;</span>
<span id="cb13-9"><a aria-hidden="true" href="#cb13-9"></a>    }</span>
<span id="cb13-10"><a aria-hidden="true" href="#cb13-10"></a>    <span class="dt">int</span> lim = <span class="dv">1</span>;</span>
<span id="cb13-11"><a aria-hidden="true" href="#cb13-11"></a>    <span class="cf">while</span> (lim &lt;= (n &lt;&lt; <span class="dv">1</span>)) lim &lt;&lt;= <span class="dv">1</span>;</span>
<span id="cb13-12"><a aria-hidden="true" href="#cb13-12"></a>    FOR(i, <span class="dv">0</span>, lim)</span>
<span id="cb13-13"><a aria-hidden="true" href="#cb13-13"></a>        rev[i] = ((rev[i &gt;&gt; <span class="dv">1</span>] &gt;&gt; <span class="dv">1</span>) | ((i &amp; <span class="dv">1</span>) ? (lim &gt;&gt; <span class="dv">1</span>) : <span class="dv">0</span>));</span>
<span id="cb13-14"><a aria-hidden="true" href="#cb13-14"></a>    DFT(a, lim, <span class="dv">1</span>), DFT(b, lim, <span class="dv">1</span>), DFT(c, lim, <span class="dv">1</span>);</span>
<span id="cb13-15"><a aria-hidden="true" href="#cb13-15"></a>    FOR(i, <span class="dv">0</span>, lim)</span>
<span id="cb13-16"><a aria-hidden="true" href="#cb13-16"></a>        a[i] = a[i] * b[i], c[i] = b[i] * c[i];</span>
<span id="cb13-17"><a aria-hidden="true" href="#cb13-17"></a>    DFT(a, lim, -<span class="dv">1</span>), DFT(c, lim, -<span class="dv">1</span>);</span>
<span id="cb13-18"><a aria-hidden="true" href="#cb13-18"></a>    FOR(i, <span class="dv">1</span>, n)</span>
<span id="cb13-19"><a aria-hidden="true" href="#cb13-19"></a>        printf(<span class="st">"</span><span class="sc">%.3lf\n</span><span class="st">"</span>, a[i].x - c[n - i].x);</span>
<span id="cb13-20"><a aria-hidden="true" href="#cb13-20"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb13-21"><a aria-hidden="true" href="#cb13-21"></a>}</span></code></pre></div>
<h3 id="æ´›è°·-p3723-ah2017hnoi2017ç¤¼ç‰©"><a href="https://www.luogu.com.cn/problem/P3723">æ´›è°· P3723 [AH2017/HNOI2017]ç¤¼ç‰©</a></h3>
<p>é¢˜æ„ï¼šç»™å®šä¸¤ä¸ªåºåˆ— <span class="math inline">\(\{x\}\)</span> å’Œ <span class="math inline">\(\{y\}\)</span>ï¼Œå¯ä»¥æ•´ä½“å¹³ç§»åºåˆ—æˆ–è€…æ•´ä½“åŠ /å‡æŸä¸ªæ•°ï¼Œæ±‚æœ€ç»ˆåºåˆ—</p>
<p><span class="math display">\[
\sum_{i = 1}^n(x_i - y_i)^2
\]</span></p>
<p>çš„æœ€å°å€¼ã€‚</p>
<p>åˆ†æï¼šè®¾æ•´ä½“åŠ å‡çš„æ•°ä¸º <span class="math inline">\(c\)</span>ï¼ˆ<span class="math inline">\(c\)</span> å¯æ­£å¯è´Ÿï¼‰ï¼Œæˆ‘ä»¬éœ€è¦æœ€å°åŒ–çš„å°±æ˜¯ä¸‹é¢è¿™ä¸ªå¼å­ï¼š</p>
<p><span class="math display">\[
\sum_{i = 1}^n(x_i - y_i + c)^2
\]</span></p>
<p>å±•å¼€ä¸Šé¢çš„å¼å­ï¼Œç”± <span class="math inline">\((x_i - y_i +c)^2 = x_i^2 + y_i^2 + c^2 + 2x_ic - 2y_ic - 2x_iy_i\)</span> å¯ä»¥å¾—åˆ°åŸå¼å¯åŒ–ç®€ä¸º</p>
<p><span class="math display">\[
\sum x_i^2 + \sum y_i^2 + nc^2 + 2c\sum x_i - 2c\sum y_i - 2\sum x_iy_i
\]</span></p>
<p>ï¼ˆä¸‹æ ‡çœç•¥ï¼‰</p>
<p>ä¸éš¾å‘ç°æˆ‘ä»¬åªéœ€è¦æœ€å¤§åŒ– <span class="math inline">\(\sum x_iy_i\)</span> å°±å¯ä»¥å•¦ã€‚</p>
<p>è®¾ <span class="math inline">\(f_k\)</span> ä¸ºæ—‹è½¬äº† <span class="math inline">\(k\)</span> ä¸ªå•ä½å <span class="math inline">\(\sum x_iy_i\)</span> çš„å–å€¼ï¼Œå…ˆæŠŠ <span class="math inline">\(\{x\}\)</span> å€é•¿ä¸€æ³¢ï¼Œåˆ™</p>
<p><span class="math display">\[
f_k = \sum_{i = 1}^nx_{i + k}y_k
\]</span></p>
<p>ç¿»è½¬ <span class="math inline">\(y\)</span>ï¼š</p>
<p><span class="math display">\[
f_k = \sum_{i = 1}^nx_{i + k}y_{n - i + 1}'
\]</span></p>
<p>è€ƒè™‘å¤šé¡¹å¼ <span class="math inline">\(f(t) = \sum_{i = 1}^n x_it^i\)</span>ï¼Œ<span class="math inline">\(g(t) = \sum_{i = 1}^n y_it^i\)</span>ï¼Œä»¤ <span class="math inline">\(h(t) = f(t) * g(t)\)</span>ï¼Œä¸éš¾å‘ç°å…¶ <span class="math inline">\(t^{n + k + 1}\)</span> çš„ç³»æ•°å³ä¸º <span class="math inline">\(f_k\)</span>ã€‚å› æ­¤å¯ä»¥ä½¿ç”¨ FFT/NTT å°†å€é•¿è¿‡çš„ <span class="math inline">\(\{x\}\)</span> ä¸ç¿»è½¬è¿‡çš„ <span class="math inline">\(\{y\}\)</span> å·èµ·æ¥ï¼Œç„¶åæŠŠç»“æœä»ç¬¬ <span class="math inline">\(n + 1\)</span> åˆ°ç¬¬ <span class="math inline">\(2n\)</span> å¤„æ‰¾æœ€å€¼å°±å¯ä»¥äº†</p>
<p>NTT çš„å®ç°ï¼š</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb14-1"><a aria-hidden="true" href="#cb14-1"></a>ll a[maxn], b[maxn];</span>
<span id="cb14-2"><a aria-hidden="true" href="#cb14-2"></a>ll suma, sumb, suma2, sumb2, n, m;</span>
<span id="cb14-3"><a aria-hidden="true" href="#cb14-3"></a><span class="dt">int</span> rev[maxn];</span>
<span id="cb14-4"><a aria-hidden="true" href="#cb14-4"></a></span>
<span id="cb14-5"><a aria-hidden="true" href="#cb14-5"></a><span class="dt">void</span> NTT(ll *f, <span class="dt">int</span> lim, <span class="dt">int</span> type)</span>
<span id="cb14-6"><a aria-hidden="true" href="#cb14-6"></a>{</span>
<span id="cb14-7"><a aria-hidden="true" href="#cb14-7"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb14-8"><a aria-hidden="true" href="#cb14-8"></a>        <span class="cf">if</span> (i &lt; rev[i])</span>
<span id="cb14-9"><a aria-hidden="true" href="#cb14-9"></a>            swap(f[i], f[rev[i]]);</span>
<span id="cb14-10"><a aria-hidden="true" href="#cb14-10"></a>    <span class="cf">for</span> (<span class="dt">int</span> p = <span class="dv">2</span>; p &lt;= lim; p &lt;&lt;= <span class="dv">1</span>)</span>
<span id="cb14-11"><a aria-hidden="true" href="#cb14-11"></a>    {</span>
<span id="cb14-12"><a aria-hidden="true" href="#cb14-12"></a>        <span class="dt">int</span> len = p &gt;&gt; <span class="dv">1</span>;</span>
<span id="cb14-13"><a aria-hidden="true" href="#cb14-13"></a>        ll Gp = pow(type ? G : invG, (mod - <span class="dv">1</span>) / p);</span>
<span id="cb14-14"><a aria-hidden="true" href="#cb14-14"></a>        <span class="cf">for</span> (<span class="dt">int</span> k = <span class="dv">0</span>; k &lt; lim; k += p)</span>
<span id="cb14-15"><a aria-hidden="true" href="#cb14-15"></a>        {</span>
<span id="cb14-16"><a aria-hidden="true" href="#cb14-16"></a>            ll buf = <span class="dv">1</span>;</span>
<span id="cb14-17"><a aria-hidden="true" href="#cb14-17"></a>            <span class="cf">for</span> (<span class="dt">int</span> l = k; l &lt; k + len; ++l, buf = buf * Gp % mod)</span>
<span id="cb14-18"><a aria-hidden="true" href="#cb14-18"></a>            {</span>
<span id="cb14-19"><a aria-hidden="true" href="#cb14-19"></a>                ll tmp = buf * f[l + len] % mod;</span>
<span id="cb14-20"><a aria-hidden="true" href="#cb14-20"></a>                f[l + len] = f[l] - tmp;</span>
<span id="cb14-21"><a aria-hidden="true" href="#cb14-21"></a>                <span class="cf">if</span> (f[l + len] &lt; <span class="dv">0</span>) f[l + len] += mod;</span>
<span id="cb14-22"><a aria-hidden="true" href="#cb14-22"></a>                f[l] = f[l] + tmp;</span>
<span id="cb14-23"><a aria-hidden="true" href="#cb14-23"></a>                <span class="cf">if</span> (f[l] &gt; mod) f[l] -= mod;</span>
<span id="cb14-24"><a aria-hidden="true" href="#cb14-24"></a>            }</span>
<span id="cb14-25"><a aria-hidden="true" href="#cb14-25"></a>        }</span>
<span id="cb14-26"><a aria-hidden="true" href="#cb14-26"></a>    }</span>
<span id="cb14-27"><a aria-hidden="true" href="#cb14-27"></a>    ll invlim = pow(lim);</span>
<span id="cb14-28"><a aria-hidden="true" href="#cb14-28"></a>    <span class="cf">if</span> (!type)</span>
<span id="cb14-29"><a aria-hidden="true" href="#cb14-29"></a>        FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb14-30"><a aria-hidden="true" href="#cb14-30"></a>            f[i] = f[i] * invlim % mod;</span>
<span id="cb14-31"><a aria-hidden="true" href="#cb14-31"></a>    <span class="cf">return</span>;</span>
<span id="cb14-32"><a aria-hidden="true" href="#cb14-32"></a>}</span>
<span id="cb14-33"><a aria-hidden="true" href="#cb14-33"></a></span>
<span id="cb14-34"><a aria-hidden="true" href="#cb14-34"></a><span class="dt">int</span> main()</span>
<span id="cb14-35"><a aria-hidden="true" href="#cb14-35"></a>{</span>
<span id="cb14-36"><a aria-hidden="true" href="#cb14-36"></a>    n = read(), m = read();</span>
<span id="cb14-37"><a aria-hidden="true" href="#cb14-37"></a>    FOR(i, <span class="dv">1</span>, n)</span>
<span id="cb14-38"><a aria-hidden="true" href="#cb14-38"></a>        a[i] = a[i + n] = read(), suma += a[i], suma2 += a[i] * a[i];</span>
<span id="cb14-39"><a aria-hidden="true" href="#cb14-39"></a>    FOR(i, <span class="dv">1</span>, n)</span>
<span id="cb14-40"><a aria-hidden="true" href="#cb14-40"></a>        b[n - i + <span class="dv">1</span>] = read(), sumb += b[n - i + <span class="dv">1</span>], sumb2 += b[n - i + <span class="dv">1</span>] * b[n - i + <span class="dv">1</span>];</span>
<span id="cb14-41"><a aria-hidden="true" href="#cb14-41"></a>    <span class="dt">int</span> lim = <span class="dv">1</span>;</span>
<span id="cb14-42"><a aria-hidden="true" href="#cb14-42"></a>    <span class="cf">while</span> (lim &lt;= <span class="dv">3</span> * n) lim &lt;&lt;= <span class="dv">1</span>;</span>
<span id="cb14-43"><a aria-hidden="true" href="#cb14-43"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb14-44"><a aria-hidden="true" href="#cb14-44"></a>        rev[i] = (rev[i &gt;&gt; <span class="dv">1</span>] &gt;&gt; <span class="dv">1</span>) | ((i &amp; <span class="dv">1</span>) ? (lim &gt;&gt; <span class="dv">1</span>) : <span class="dv">0</span>);</span>
<span id="cb14-45"><a aria-hidden="true" href="#cb14-45"></a>    NTT(a, lim, <span class="dv">1</span>), NTT(b, lim, <span class="dv">1</span>);</span>
<span id="cb14-46"><a aria-hidden="true" href="#cb14-46"></a>    FOR(i, <span class="dv">0</span>, lim)</span>
<span id="cb14-47"><a aria-hidden="true" href="#cb14-47"></a>        a[i] = a[i] * b[i] % mod;<span class="co">//åƒä¸‡ä¸è¦å¿˜è®°å–æ¨¡</span></span>
<span id="cb14-48"><a aria-hidden="true" href="#cb14-48"></a>    NTT(a, lim, <span class="dv">0</span>);</span>
<span id="cb14-49"><a aria-hidden="true" href="#cb14-49"></a>    ll ans = <span class="fl">1e18</span>;</span>
<span id="cb14-50"><a aria-hidden="true" href="#cb14-50"></a>    FOR(i, <span class="dv">1</span>, n)</span>
<span id="cb14-51"><a aria-hidden="true" href="#cb14-51"></a>        FOR(j, -m, m)</span>
<span id="cb14-52"><a aria-hidden="true" href="#cb14-52"></a>            ans = min(ans, suma2 + sumb2 + j * j * n + <span class="dv">2</span> * j * (suma - sumb) - <span class="dv">2</span> * a[i + n]);</span>
<span id="cb14-53"><a aria-hidden="true" href="#cb14-53"></a>    printf(<span class="st">"</span><span class="sc">%lld\n</span><span class="st">"</span>, ans);</span>
<span id="cb14-54"><a aria-hidden="true" href="#cb14-54"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb14-55"><a aria-hidden="true" href="#cb14-55"></a>}</span></code></pre></div>
<h3 id="bzoj3771-triple">BZOJ3771 Triple</h3>
<p>é¢˜æ„ï¼šæœ‰ <span class="math inline">\(n\)</span> æŠŠä»·å€¼åˆ†åˆ«ä¸º <span class="math inline">\(a_i\)</span> çš„æ–§å­ï¼Œæ²³ç¥å¯èƒ½æ‹¿èµ° 1 - 3 æŠŠï¼Œé—®æ¯ç§å¯èƒ½çš„æŸå¤±ä»·å€¼åŠå…¶å¯¹åº”æ–¹æ¡ˆæ•°ã€‚ï¼ˆä¸è®¡é¡ºåºï¼‰</p>
<p>æ€è·¯ï¼šè¿™æ˜¯ä¸€é“ç”Ÿæˆå‡½æ•°çš„å…¥é—¨é¢˜ã€‚</p>
<p>è€ƒè™‘è®¾å‡ºå¤šé¡¹å¼ <span class="math inline">\(A(x)\)</span>ï¼Œå…¶ç³»æ•°æœ‰ <span class="math inline">\(A[a_i] = 1\)</span>ï¼Œä»£è¡¨é€‰ä¸€æŠŠçš„ã€‚åˆ™ä½ å¯èƒ½ä¼šè§‰å¾—ç­”æ¡ˆä¸º <span class="math inline">\(A(x) + A^2(x) + A^3(x)\)</span>ã€‚ä½†æ˜¯è¿™æ ·æ˜¯æ˜¾ç„¶ä¸å¯¹çš„ã€‚ä¸ºä»€ä¹ˆï¼Ÿ</p>
<p>å› ä¸ºè¿™æ ·çš„è¯åŒä¸€ä¸ªå…ƒç´ å¯èƒ½è¢«é€‰ä¸¤æ¬¡æˆ–ä¸‰æ¬¡ï¼Œå¯¹äºè¿™ç§æƒ…å†µå®šä¹‰ <span class="math inline">\(B(x)\)</span> å’Œ <span class="math inline">\(C(x)\)</span> æ»¡è¶³ <span class="math inline">\(B[2a_i] = 1\)</span> å’Œ <span class="math inline">\(C[3a_i] = 1\)</span>ï¼Œä»£è¡¨åŒæ—¶é€‰ä¸¤æ¬¡/ä¸‰æ¬¡çš„ï¼Œå‡æ‰è¿™äº›æ–¹æ¡ˆæ•°å°±å¯ä»¥äº†ã€‚ç„¶åéœ€è¦æ³¨æ„é¡ºåºé—®é¢˜ï¼š</p>
<p>é€‰ä¸€æŠŠçš„ç­”æ¡ˆä¸º <span class="math inline">\(A(x)\)</span>ï¼Œä¸éš¾å‘ç°é€‰ä¸¤ç§çš„å³ä¸º <span class="math inline">\(\dfrac{A^2(x) - B(x)}{2}\)</span>ï¼Œé€‰ä¸‰ç§çš„æ¯”è¾ƒéº»çƒ¦ï¼šä¸èƒ½åŒæ—¶é€‰ä¸¤ç§ä¸€æ ·çš„ï¼Œå³å‡å» <span class="math inline">\(3A(x)B(x)\)</span>ï¼Œï¼Œä½†æ˜¯é€‰ä¸‰ç§åŒæ ·çš„åˆä¼šè¢«å¤šå‡ä¸¤æ¬¡ï¼Œæœ€åé™¤ä»¥ <span class="math inline">\(3!\)</span> å»æ‰é¡ºåºé—®é¢˜ï¼Œæ‰€ä»¥æœ€ç»ˆç­”æ¡ˆä¸ºï¼š</p>
<p><span class="math display">\[
A(x) + \frac{A^2(x) - B(x)}{2} + \frac{A^3(x) - 3A(x)B(x) + 2C(x)}{6}
\]</span></p>
<p>ç”Ÿæˆå‡½æ•°çš„å·ç§¯ä½¿ç”¨ NTT æˆ– FFT ä¼˜åŒ–å³å¯ã€‚æ³¨æ„æ­¤æ—¶ NTT æ¨¡æ•°è¦å–ä¸€ä¸ªæ›´å¤§çš„è´¨æ•°ã€‚<strong>ä¸çŸ¥é“ä¸ºä»€ä¹ˆç”Ÿæˆå‡½æ•°èƒ½è¿™æ ·å¯¹åº”çš„å¯ä»¥æ„ä¼šä¸€ä¸‹å¤šé¡¹å¼å·ç§¯çš„å®šä¹‰å¼ä»¥åŠè¿™äº›ç³»æ•°çš„ç»„åˆæ„ä¹‰</strong>ã€‚</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb15-1"><a aria-hidden="true" href="#cb15-1"></a>ll f1[maxn], f2[maxn], f3[maxn], ans[maxn];</span>
<span id="cb15-2"><a aria-hidden="true" href="#cb15-2"></a>ll g[maxn], t[maxn];</span>
<span id="cb15-3"><a aria-hidden="true" href="#cb15-3"></a></span>
<span id="cb15-4"><a aria-hidden="true" href="#cb15-4"></a><span class="dt">int</span> main()</span>
<span id="cb15-5"><a aria-hidden="true" href="#cb15-5"></a>{</span>
<span id="cb15-6"><a aria-hidden="true" href="#cb15-6"></a>    <span class="dt">int</span> n = read();</span>
<span id="cb15-7"><a aria-hidden="true" href="#cb15-7"></a>    <span class="cf">while</span> (n--)</span>
<span id="cb15-8"><a aria-hidden="true" href="#cb15-8"></a>    {</span>
<span id="cb15-9"><a aria-hidden="true" href="#cb15-9"></a>        <span class="dt">int</span> tmp = read();</span>
<span id="cb15-10"><a aria-hidden="true" href="#cb15-10"></a>        ++f1[tmp], ++g[tmp], ++ans[tmp];</span>
<span id="cb15-11"><a aria-hidden="true" href="#cb15-11"></a>        ++f2[tmp &lt;&lt; <span class="dv">1</span>], ++f3[tmp * <span class="dv">3</span>];</span>
<span id="cb15-12"><a aria-hidden="true" href="#cb15-12"></a>    }</span>
<span id="cb15-13"><a aria-hidden="true" href="#cb15-13"></a>    <span class="dt">int</span> lim = <span class="dv">1</span>;</span>
<span id="cb15-14"><a aria-hidden="true" href="#cb15-14"></a>    <span class="cf">while</span> (lim &lt;= (<span class="dv">40000</span> * <span class="dv">3</span> + <span class="dv">5</span>)) lim &lt;&lt;= <span class="dv">1</span>;</span>
<span id="cb15-15"><a aria-hidden="true" href="#cb15-15"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb15-16"><a aria-hidden="true" href="#cb15-16"></a>        rev[i] = (rev[i &gt;&gt; <span class="dv">1</span>] &gt;&gt; <span class="dv">1</span>) | ((i &amp; <span class="dv">1</span>) ? (lim &gt;&gt; <span class="dv">1</span>) : <span class="dv">0</span>);</span>
<span id="cb15-17"><a aria-hidden="true" href="#cb15-17"></a>    NTT(f1, lim, <span class="dv">1</span>), NTT(g, lim, <span class="dv">1</span>);</span>
<span id="cb15-18"><a aria-hidden="true" href="#cb15-18"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb15-19"><a aria-hidden="true" href="#cb15-19"></a>        g[i] = f1[i] * g[i] % mod;</span>
<span id="cb15-20"><a aria-hidden="true" href="#cb15-20"></a>    NTT(g, lim, <span class="dv">0</span>);</span>
<span id="cb15-21"><a aria-hidden="true" href="#cb15-21"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb15-22"><a aria-hidden="true" href="#cb15-22"></a>        ans[i] += (g[i] - f2[i]) / <span class="dv">2</span>;</span>
<span id="cb15-23"><a aria-hidden="true" href="#cb15-23"></a>    NTT(g, lim, <span class="dv">1</span>);</span>
<span id="cb15-24"><a aria-hidden="true" href="#cb15-24"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb15-25"><a aria-hidden="true" href="#cb15-25"></a>        g[i] = f1[i] * g[i] % mod;</span>
<span id="cb15-26"><a aria-hidden="true" href="#cb15-26"></a>    NTT(g, lim, <span class="dv">0</span>);</span>
<span id="cb15-27"><a aria-hidden="true" href="#cb15-27"></a>    NTT(f2, lim, <span class="dv">1</span>);</span>
<span id="cb15-28"><a aria-hidden="true" href="#cb15-28"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb15-29"><a aria-hidden="true" href="#cb15-29"></a>        f2[i] = f2[i] * f1[i] % mod;</span>
<span id="cb15-30"><a aria-hidden="true" href="#cb15-30"></a>    NTT(f2, lim, <span class="dv">0</span>);</span>
<span id="cb15-31"><a aria-hidden="true" href="#cb15-31"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb15-32"><a aria-hidden="true" href="#cb15-32"></a>    {</span>
<span id="cb15-33"><a aria-hidden="true" href="#cb15-33"></a>        ans[i] += (g[i] - <span class="dv">3</span> * f2[i] + <span class="dv">2</span> * f3[i]) / <span class="dv">6</span>;</span>
<span id="cb15-34"><a aria-hidden="true" href="#cb15-34"></a>        <span class="cf">if</span> (ans[i]) printf(<span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%lld\n</span><span class="st">"</span>, i, ans[i]);</span>
<span id="cb15-35"><a aria-hidden="true" href="#cb15-35"></a>    }</span>
<span id="cb15-36"><a aria-hidden="true" href="#cb15-36"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb15-37"><a aria-hidden="true" href="#cb15-37"></a>}</span></code></pre></div>
<h3 id="fftntt-ä¸å­—ç¬¦ä¸²åŒ¹é…">FFT/NTT ä¸å­—ç¬¦ä¸²åŒ¹é…</h3>
<p><strong>å­—ç¬¦ä¸²ä¸‹æ ‡ä» <span class="math inline">\(1\)</span> å¼€å§‹</strong></p>
<h4 id="æœ€ä¸€èˆ¬çš„æƒ…å†µ">æœ€ä¸€èˆ¬çš„æƒ…å†µ</h4>
<p>è€ƒè™‘æ–‡æœ¬ä¸² <span class="math inline">\(S\)</span> å’Œæ¨¡å¼ä¸² <span class="math inline">\(T\)</span>ï¼Œä¸²é•¿ <span class="math inline">\(n = |S|\)</span>ï¼Œ<span class="math inline">\(m = |T|\)</span>ï¼Œä¿è¯ <span class="math inline">\(n \ge m\)</span>ï¼Œç°åœ¨éœ€è¦æ‰¾å‡º <span class="math inline">\(T\)</span> åœ¨ <span class="math inline">\(S\)</span> ä¸­å‡ºç°çš„æ¯ä¸ªä½ç½®ã€‚ç›´æ¥è·‘ KMP å°±å¯ä»¥äº†ï¼Œä½†æ˜¯è¿™ä¸ªä¸æ˜¯è¦æçš„é‡ç‚¹ã€‚è€ƒè™‘ä¸² <span class="math inline">\(S\)</span> çš„ç¬¬ <span class="math inline">\(i\)</span> ä¸ªå­—ç¬¦ä¸º <span class="math inline">\(S[i]\)</span>ï¼Œé‚£ä¹ˆåŒ¹é…å°±å¯ä»¥å†™æˆ <span class="math inline">\(S[i] - T[j] = 0\)</span>ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯æ¯”è¾ƒå¥½æƒ³çš„ã€‚</p>
<p>å‡è®¾ <span class="math inline">\(T\)</span> åœ¨ <span class="math inline">\(S\)</span> çš„ç¬¬ <span class="math inline">\(i\)</span> ä½å¼€å§‹æˆåŠŸåŒ¹é…ï¼Œåˆ™æˆ‘ä»¬æœ‰</p>
<p><span class="math display">\[
\sum_{j = 1}^{m} (S[i + j - 1] - T[j])^2 = 0
\]</span></p>
<p>ä¸ºäº†é˜²æ­¢æ­£è´Ÿå·ç›¸äº’æŠµæ¶ˆï¼Œæ‰€ä»¥éœ€è¦å¹³æ–¹ã€‚ç”±äº <span class="math inline">\(i + j - 1 + j\)</span> ä¸æ˜¯å®šå€¼ï¼Œä¸ç¬¦åˆæˆ‘ä»¬éœ€è¦çš„å·ç§¯çš„å½¢å¼ï¼Œæ‰€ä»¥ç¿»è½¬ä¸€ä¸‹ <span class="math inline">\(T\)</span> è®©å…¶å˜ä¸º <span class="math inline">\(T'\)</span>ï¼š</p>
<p><span class="math display">\[
\sum_{j = 1}^{m} (S[i + j - 1] - T[m - j + 1])^2 = 0
\]</span></p>
<p>æ‰“å¼€æ¥æˆ‘ä»¬å°±ä¼šå‘ç°</p>
<p><span class="math display">\[
\sum_{j = 1}^{m} (S[i + j - 1]^2 + T[j]^2 - 2S[i + j - 1]T[m - j + 1]) = 0
\]</span></p>
<p><span class="math inline">\(i + j - 1 + m - j + 1 = i + m\)</span>ï¼Œä¸ºå®šå€¼ã€‚</p>
<p>æ‰€ä»¥ä¸Šé¢çš„å¼å­å°±å¯ä»¥åŒ–æˆ</p>
<p><span class="math display">\[
\sum_{j = 1}^m S[i + j - 1]^2 + \sum_{j = 1}^m T[j]^2 - 2\sum_{x + y = i + m}S[x]T[y]
\]</span></p>
<p>ç¬¬ä¸€é¡¹ç›´æ¥å‰ç¼€å’Œå°±å¯ä»¥è§£å†³ï¼Œç¬¬äºŒé¡¹å¸¸æ•°ï¼Œç¬¬ä¸‰é¡¹ä½¿ç”¨ FFT/NTTã€‚</p>
<p>æ›´åŠ å¥½ç†è§£åœ°ï¼Œè®¾ <span class="math inline">\(f(x) = \sum_{i + j = x + m}S[i]T[j]\)</span>ï¼Œæˆ‘ä»¬åªéœ€è¦æ±‚å‡ºè¿™ä¸ª <span class="math inline">\(f(x)\)</span> å°±å¯ä»¥äº†ã€‚</p>
<p>é—®é¢˜æ¥äº†ï¼Œè¿™æ ·éš¾å†™å¤æ‚åº¦é«˜å¸¸æ•°å¤§å…¨æ–¹ä½è¢« KMP åŠæ‰“çš„ç®—æ³•æœ‰ä»€ä¹ˆå­˜åœ¨çš„æ„ä¹‰å—ï¼Ÿå¯¹ä¸èµ·è¿˜çœŸçš„æœ‰ï¼š</p>
<h4 id="å¸¦é€šé…ç¬¦çš„å­—ç¬¦ä¸²åŒ¹é…">å¸¦é€šé…ç¬¦çš„å­—ç¬¦ä¸²åŒ¹é…</h4>
<p>è¯·çœ‹ä¾‹é¢˜ <a href="https://www.luogu.com.cn/problem/P4173">æ´›è°· P4173 æ®‹ç¼ºçš„å­—ç¬¦ä¸²</a>ã€‚ä»ç„¶æ˜¯å­—ç¬¦ä¸²åŒ¹é…ï¼Œä½†æ˜¯æ¯ä¸ªä¸²éƒ½æœ‰<strong>é€šé…ç¬¦</strong>ï¼Œè¿™ä¸ªæ—¶å€™ KMP å°±æ˜¾å¾—æ— èƒ½ä¸ºåŠ›äº†ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿå¥½å¥½æ€è€ƒä¸€ä¸‹ä¸¤ä¸ªå­—ç¬¦å¦‚ä½•æ‰èƒ½åŒ¹é…ï¼š</p>
<ul>
<li>ä¸¤ä¸ªå­—ç¬¦å®Œå…¨ä¸€æ ·</li>
<li>å…¶ä¸­è‡³å°‘ä¸€ä¸ªä¸ºé€šé…ç¬¦</li>
</ul>
<p>ä¸¤è€…æ˜¯é€»è¾‘æˆ–çš„å…³ç³»ï¼Œæˆ‘ä»¬é­”æ”¹ä¸€ä¸‹ä¸Šé¢çš„å¼å­ï¼Œä¸éš¾å‘ç°æˆ‘ä»¬åªéœ€è¦æŠŠé€šé…ç¬¦çš„å€¼è®¾ä¸º <span class="math inline">\(0\)</span> å°±å¯ä»¥è§£å†³äº†ï¼š</p>
<p>å®šä¹‰åŒ¹é…å‡½æ•° <span class="math inline">\(F(x)\)</span> è¡¨ç¤º <span class="math inline">\(S\)</span> çš„ç¬¬ <span class="math inline">\(x\)</span> ä½å¼€å§‹å’Œ <span class="math inline">\(T\)</span> æ˜¯å¦åŒ¹é…ï¼ŒåŒ¹é…çš„è¯ <span class="math inline">\(F(x) = 0\)</span>ã€‚</p>
<p><span class="math display">\[
F(x) = \sum_{j = 1}^m(S[x + j - 1] - T[j])^2S[x + j - 1]T[j]
\]</span></p>
<p>åŒ–ç®€ï¼š</p>
<p><span class="math display">\[
\begin{aligned}
F(x) &amp;= \sum_{j = 1}^m(S[x + j - 1] - T[j])^2S[x + j - 1]T[j]\\
&amp;= \sum_{j = 1}^m(S[x + j - 1] - T'[m - j + 1])^2S[x + j - 1]T'[m - j + 1]\\
&amp;= \sum_{j = 1}^m(S[x + j - 1]^2 + T'[m - j + 1]^2 - 2S[x + j - 1]T'[m - j + 1])S[x + j - 1]T'[m - j + 1]\\
&amp;= \sum_{j = 1}^m S[x + j - 1]^3T'[m - j + 1] + \sum_{j = 1}^m S[x + j - 1]T'[m - j + 1]^3- 2\sum_{j = 1}^m S[x + j - 1]^2T'[m - j + 1]^2\\
&amp;= \sum_{i + j = x + m}S[i]^3T'[j] + \sum_{i + j = x + m}S[i]T'[j]^3 - 2\sum_{i + j = x + m}S[i]^2T[j]^2
\end{aligned}
\]</span></p>
<p>äºæ˜¯é—®é¢˜å°±è§£å†³äº†ï¼Œåªéœ€è¦ç”¨ NTT/FFT è®¡ç®—å‡ºä¸Šé¢ä¸‰é¡¹æ¶å¿ƒçš„ä¸œè¥¿å‡ºæ¥å°± OK äº†ã€‚ä¸€å…±è¿›è¡Œ <span class="math inline">\(7\)</span> æ¬¡ NTT å³å¯ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯æœ€åæšä¸¾ç­”æ¡ˆçš„æ—¶å€™åªèƒ½æšä¸¾åˆ° <span class="math inline">\(n - m + 1\)</span> å¤„ï¼Œå¦åˆ™åªæœ‰ <span class="math inline">\(35\)</span> åˆ†ã€‚</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb16-1"><a aria-hidden="true" href="#cb16-1"></a><span class="dt">int</span> f[maxn &lt;&lt; <span class="dv">1</span>], g[maxn &lt;&lt; <span class="dv">1</span>], f2[maxn &lt;&lt; <span class="dv">1</span>], g2[maxn &lt;&lt; <span class="dv">1</span>], f3[maxn &lt;&lt; <span class="dv">1</span>], g3[maxn &lt;&lt; <span class="dv">1</span>];</span>
<span id="cb16-2"><a aria-hidden="true" href="#cb16-2"></a><span class="dt">int</span> ans[maxn &lt;&lt; <span class="dv">1</span>], vec[maxn &lt;&lt; <span class="dv">1</span>], tot;</span>
<span id="cb16-3"><a aria-hidden="true" href="#cb16-3"></a></span>
<span id="cb16-4"><a aria-hidden="true" href="#cb16-4"></a><span class="dt">int</span> n, m;</span>
<span id="cb16-5"><a aria-hidden="true" href="#cb16-5"></a><span class="dt">char</span> a[maxn], b[maxn];</span>
<span id="cb16-6"><a aria-hidden="true" href="#cb16-6"></a></span>
<span id="cb16-7"><a aria-hidden="true" href="#cb16-7"></a><span class="dt">int</span> main()</span>
<span id="cb16-8"><a aria-hidden="true" href="#cb16-8"></a>{</span>
<span id="cb16-9"><a aria-hidden="true" href="#cb16-9"></a>    m = readInt(), n = readInt();</span>
<span id="cb16-10"><a aria-hidden="true" href="#cb16-10"></a>    scanf(<span class="st">"</span><span class="sc">%s</span><span class="st">"</span>, a + <span class="dv">1</span>);</span>
<span id="cb16-11"><a aria-hidden="true" href="#cb16-11"></a>    scanf(<span class="st">"</span><span class="sc">%s</span><span class="st">"</span>, b + <span class="dv">1</span>);</span>
<span id="cb16-12"><a aria-hidden="true" href="#cb16-12"></a>    FOR(i, <span class="dv">1</span>, m)</span>
<span id="cb16-13"><a aria-hidden="true" href="#cb16-13"></a>    {</span>
<span id="cb16-14"><a aria-hidden="true" href="#cb16-14"></a>        g[i] = (a[m - i + <span class="dv">1</span>] == <span class="ch">'*'</span>) ? <span class="dv">0</span> : a[m - i + <span class="dv">1</span>] - <span class="ch">'a'</span> + <span class="dv">1</span>;</span>
<span id="cb16-15"><a aria-hidden="true" href="#cb16-15"></a>        g2[i] = g[i] * g[i], g3[i] = g2[i] * g[i];</span>
<span id="cb16-16"><a aria-hidden="true" href="#cb16-16"></a>    }</span>
<span id="cb16-17"><a aria-hidden="true" href="#cb16-17"></a>    FOR(i, <span class="dv">1</span>, n)</span>
<span id="cb16-18"><a aria-hidden="true" href="#cb16-18"></a>    {</span>
<span id="cb16-19"><a aria-hidden="true" href="#cb16-19"></a>        f[i] = (b[i] == <span class="ch">'*'</span>) ? <span class="dv">0</span> : b[i] - <span class="ch">'a'</span> + <span class="dv">1</span>;</span>
<span id="cb16-20"><a aria-hidden="true" href="#cb16-20"></a>        f2[i] = f[i] * f[i], f3[i] = f2[i] * f[i];</span>
<span id="cb16-21"><a aria-hidden="true" href="#cb16-21"></a>    }</span>
<span id="cb16-22"><a aria-hidden="true" href="#cb16-22"></a>    <span class="dt">int</span> lim = <span class="dv">1</span>;</span>
<span id="cb16-23"><a aria-hidden="true" href="#cb16-23"></a>    <span class="cf">while</span> (lim &lt;= n + m) lim &lt;&lt;= <span class="dv">1</span>;</span>
<span id="cb16-24"><a aria-hidden="true" href="#cb16-24"></a>    NTT(f, lim, <span class="dv">1</span>), NTT(f2, lim, <span class="dv">1</span>), NTT(f3, lim, <span class="dv">1</span>);</span>
<span id="cb16-25"><a aria-hidden="true" href="#cb16-25"></a>    NTT(g, lim, <span class="dv">1</span>), NTT(g2, lim, <span class="dv">1</span>), NTT(g3, lim, <span class="dv">1</span>);</span>
<span id="cb16-26"><a aria-hidden="true" href="#cb16-26"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb16-27"><a aria-hidden="true" href="#cb16-27"></a>        ans[i] = (<span class="dv">1</span><span class="bu">ll</span> * f3[i] * g[i] % mod + <span class="dv">1</span><span class="bu">ll</span> * f[i] * g3[i] % mod - <span class="dv">2</span><span class="bu">ll</span> * f2[i] * g2[i] % mod) % mod;</span>
<span id="cb16-28"><a aria-hidden="true" href="#cb16-28"></a>    NTT(ans, lim, <span class="dv">0</span>);</span>
<span id="cb16-29"><a aria-hidden="true" href="#cb16-29"></a>    <span class="dt">int</span> cnt = <span class="dv">0</span>;</span>
<span id="cb16-30"><a aria-hidden="true" href="#cb16-30"></a>    FOR(i, <span class="dv">1</span>, n - m + <span class="dv">1</span>)</span>
<span id="cb16-31"><a aria-hidden="true" href="#cb16-31"></a>        <span class="cf">if</span> (ans[i + m] == <span class="dv">0</span>)</span>
<span id="cb16-32"><a aria-hidden="true" href="#cb16-32"></a>            ++cnt, vec[++tot] = i;</span>
<span id="cb16-33"><a aria-hidden="true" href="#cb16-33"></a>    printf(<span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span>, cnt);</span>
<span id="cb16-34"><a aria-hidden="true" href="#cb16-34"></a>    FOR(i, <span class="dv">1</span>, tot) printf(<span class="st">"</span><span class="sc">%d</span><span class="st"> "</span>, vec[i]);</span>
<span id="cb16-35"><a aria-hidden="true" href="#cb16-35"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb16-36"><a aria-hidden="true" href="#cb16-36"></a>}</span></code></pre></div>
<h4 id="å¦å¤–ä¸€é“ä¾‹é¢˜">å¦å¤–ä¸€é“ä¾‹é¢˜</h4>
<p>è¯·çœ‹ <a href="https://www.luogu.com.cn/problem/CF528D">CF528D Fuzzy Search</a>ã€‚é¢˜æ„ï¼šå­—ç¬¦ä¸²åŒ¹é…ï¼Œ<span class="math inline">\(1\le |T| \le |S| \le 2\times 10^5\)</span>ï¼Œå­—ç¬¦é›†åªæœ‰ <span class="math inline">\(\texttt{ATCG}\)</span>ã€‚<span class="math inline">\(T\)</span> åœ¨ <span class="math inline">\(S\)</span> ä¸­çš„ç¬¬ <span class="math inline">\(i\)</span> ä¸ªä½ç½®å‡ºç°å½“ä¸”ä»…å½“ <span class="math inline">\(\forall j\in [1,T]\)</span>ï¼Œ<span class="math inline">\(\exists p\)</span> ä½¿å¾— <span class="math inline">\(|i + j - 1 - p|\le k \land S[p] = T[j]\)</span>ã€‚å³åç§»é‡ä¸èƒ½è¶…è¿‡ <span class="math inline">\(k\)</span>ã€‚</p>
<p>æ³¨æ„åˆ°å­—ç¬¦é›†å¾ˆå°ï¼Œåªæœ‰ <span class="math inline">\(4\)</span> ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠå­—ç¬¦ä¸² 01 åŒ–ï¼Œåˆ†å¼€è€ƒè™‘æ¯ä¸ªå­—æ¯ã€‚æ¯”å¦‚ <span class="math inline">\(S = \texttt{ATCGAA}\)</span>ï¼Œ<span class="math inline">\(T = \texttt{ACAA}\)</span>ï¼Œç°åœ¨åªè€ƒè™‘å­—æ¯ <span class="math inline">\(\texttt A\)</span>ï¼ŒæŠŠ <span class="math inline">\(\texttt A\)</span> åŒ–æˆ <span class="math inline">\(1\)</span> è€Œå…¶ä»–çš„åŒ–ä¸º <span class="math inline">\(0\)</span>ï¼Œåˆ™ <span class="math inline">\(S = \texttt{100011}\)</span>ï¼Œ<span class="math inline">\(T= \texttt{1011}\)</span>ã€‚ç„¶åå‡è®¾ <span class="math inline">\(k = 1\)</span>ï¼ŒæŠŠèƒ½æ‰©å±•çš„éƒ½å¾€ä¸¤è¾¹æ‰©å±•ï¼Œåˆ™ <span class="math inline">\(S = \texttt{110111}\)</span>ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¾åŒ¹é… <span class="math inline">\(F(x, c)\)</span> è¡¨ç¤º <span class="math inline">\(T\)</span> ä» <span class="math inline">\(S\)</span> çš„ç¬¬ <span class="math inline">\(x\)</span> ä½å¼€å§‹å­—ç¬¦ <span class="math inline">\(c\)</span> èƒ½åŒ¹é…çš„æ•°é‡ï¼Œæœ€ç»ˆç­”æ¡ˆä¸º <span class="math inline">\(A(x) = \sum_{c\in\lbrace\texttt{A,T,C,G}\rbrace}F(x,c)\)</span>ï¼Œ<span class="math inline">\(T\)</span> åŒ¹é…æˆåŠŸå½“ä¸”ä»…å½“ <span class="math inline">\(A(x) = m\)</span>ï¼Œå³æ‰€æœ‰å­—ç¬¦éƒ½åŒ¹é…åˆ°äº†ï¼Œå¦åˆ™å¤±è´¥ã€‚</p>
<p>ä¸éš¾å‘ç° <span class="math inline">\(F(x, c) = \sum_{j = 1}^mS[x + j - 1]T[j]\)</span>ï¼Œè€å¥—è·¯ç¿»è½¬ä¸€ä¸‹å˜ä¸º <span class="math inline">\(F(x, c) = \sum_{j = 1}^m S[x + j - 1]T[m - j + 1] = \sum_{i + j = x + m}S[i]T[j]\)</span>ã€‚è¿™å°±æ˜¯å–œé—»ä¹è§çš„å·ç§¯å½¢å¼äº†ã€‚NTT ç›´æ¥ä¸Šå°±å®Œäº†ã€‚</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb17-1"><a aria-hidden="true" href="#cb17-1"></a><span class="dt">int</span> f[maxn &lt;&lt; <span class="dv">1</span>], g[maxn &lt;&lt; <span class="dv">1</span>];</span>
<span id="cb17-2"><a aria-hidden="true" href="#cb17-2"></a><span class="dt">int</span> ans[maxn &lt;&lt; <span class="dv">1</span>];</span>
<span id="cb17-3"><a aria-hidden="true" href="#cb17-3"></a></span>
<span id="cb17-4"><a aria-hidden="true" href="#cb17-4"></a><span class="dt">int</span> n, m, k, lim = <span class="dv">1</span>;</span>
<span id="cb17-5"><a aria-hidden="true" href="#cb17-5"></a><span class="dt">char</span> s[maxn &lt;&lt; <span class="dv">1</span>], t[maxn &lt;&lt; <span class="dv">1</span>];</span>
<span id="cb17-6"><a aria-hidden="true" href="#cb17-6"></a></span>
<span id="cb17-7"><a aria-hidden="true" href="#cb17-7"></a><span class="dt">void</span> proc(<span class="dt">char</span> c)</span>
<span id="cb17-8"><a aria-hidden="true" href="#cb17-8"></a>{</span>
<span id="cb17-9"><a aria-hidden="true" href="#cb17-9"></a>    clr(f, lim), clr(g, lim);</span>
<span id="cb17-10"><a aria-hidden="true" href="#cb17-10"></a>    <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">1</span>, lst = -<span class="fl">1e9</span>; i &lt;= n; ++i)</span>
<span id="cb17-11"><a aria-hidden="true" href="#cb17-11"></a>    {</span>
<span id="cb17-12"><a aria-hidden="true" href="#cb17-12"></a>        <span class="cf">if</span> (s[i] == c)</span>
<span id="cb17-13"><a aria-hidden="true" href="#cb17-13"></a>            lst = i;</span>
<span id="cb17-14"><a aria-hidden="true" href="#cb17-14"></a>        <span class="cf">if</span> (i - lst &lt;= k)</span>
<span id="cb17-15"><a aria-hidden="true" href="#cb17-15"></a>            f[i] = <span class="dv">1</span>;</span>
<span id="cb17-16"><a aria-hidden="true" href="#cb17-16"></a>    }</span>
<span id="cb17-17"><a aria-hidden="true" href="#cb17-17"></a>    <span class="cf">for</span> (<span class="dt">int</span> i = n, lst = <span class="fl">1e9</span>; i; --i)</span>
<span id="cb17-18"><a aria-hidden="true" href="#cb17-18"></a>    {</span>
<span id="cb17-19"><a aria-hidden="true" href="#cb17-19"></a>        <span class="cf">if</span> (s[i] == c)</span>
<span id="cb17-20"><a aria-hidden="true" href="#cb17-20"></a>            lst = i;</span>
<span id="cb17-21"><a aria-hidden="true" href="#cb17-21"></a>        <span class="cf">if</span> (lst - i &lt;= k)</span>
<span id="cb17-22"><a aria-hidden="true" href="#cb17-22"></a>            f[i] = <span class="dv">1</span>;</span>
<span id="cb17-23"><a aria-hidden="true" href="#cb17-23"></a>    }</span>
<span id="cb17-24"><a aria-hidden="true" href="#cb17-24"></a>    FOR(i, <span class="dv">1</span>, m)</span>
<span id="cb17-25"><a aria-hidden="true" href="#cb17-25"></a>        g[i] = (t[m - i + <span class="dv">1</span>] == c);</span>
<span id="cb17-26"><a aria-hidden="true" href="#cb17-26"></a>    NTT(f, lim, <span class="dv">1</span>), NTT(g, lim, <span class="dv">1</span>);</span>
<span id="cb17-27"><a aria-hidden="true" href="#cb17-27"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb17-28"><a aria-hidden="true" href="#cb17-28"></a>        f[i] = <span class="dv">1</span><span class="bu">ll</span> * f[i] * g[i] % mod;</span>
<span id="cb17-29"><a aria-hidden="true" href="#cb17-29"></a>    NTT(f, lim, <span class="dv">0</span>);</span>
<span id="cb17-30"><a aria-hidden="true" href="#cb17-30"></a>    FOR(i, <span class="dv">1</span>, n)</span>
<span id="cb17-31"><a aria-hidden="true" href="#cb17-31"></a>        ans[i] += f[i + m];</span>
<span id="cb17-32"><a aria-hidden="true" href="#cb17-32"></a>}</span>
<span id="cb17-33"><a aria-hidden="true" href="#cb17-33"></a></span>
<span id="cb17-34"><a aria-hidden="true" href="#cb17-34"></a><span class="dt">int</span> main()</span>
<span id="cb17-35"><a aria-hidden="true" href="#cb17-35"></a>{</span>
<span id="cb17-36"><a aria-hidden="true" href="#cb17-36"></a>    n = readInt(), m = readInt(), k = readInt();</span>
<span id="cb17-37"><a aria-hidden="true" href="#cb17-37"></a>    scanf(<span class="st">"</span><span class="sc">%s</span><span class="st">"</span>, s + <span class="dv">1</span>);</span>
<span id="cb17-38"><a aria-hidden="true" href="#cb17-38"></a>    scanf(<span class="st">"</span><span class="sc">%s</span><span class="st">"</span>, t + <span class="dv">1</span>);</span>
<span id="cb17-39"><a aria-hidden="true" href="#cb17-39"></a>    <span class="cf">while</span> (lim &lt;= n + m) lim &lt;&lt;= <span class="dv">1</span>;</span>
<span id="cb17-40"><a aria-hidden="true" href="#cb17-40"></a>    FOR(i, <span class="dv">0</span>, <span class="dv">3</span>) proc(<span class="st">"ATCG"</span>[i]);</span>
<span id="cb17-41"><a aria-hidden="true" href="#cb17-41"></a>    <span class="dt">int</span> cnt = <span class="dv">0</span>;</span>
<span id="cb17-42"><a aria-hidden="true" href="#cb17-42"></a>    FOR(i, <span class="dv">1</span>, n)</span>
<span id="cb17-43"><a aria-hidden="true" href="#cb17-43"></a>        cnt += (ans[i] == m);</span>
<span id="cb17-44"><a aria-hidden="true" href="#cb17-44"></a>    printf(<span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span>, cnt);</span>
<span id="cb17-45"><a aria-hidden="true" href="#cb17-45"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb17-46"><a aria-hidden="true" href="#cb17-46"></a>}</span></code></pre></div>
<h2 id="å…³äºå°è£…">å…³äºå°è£…</h2>
<p>ä»¥åçš„å…¨å®¶æ¡¶ä¼šå¤§é‡ä½¿ç”¨ NTT ç­‰åŸºç¡€æ“ä½œï¼Œè€ƒè™‘å®ç°ä¸€ä¸ªå¸¸æ•°è¾ƒå°çš„ä¸”æ–¹ä¾¿é˜…è¯»çš„å°è£…ï¼š</p>
<p>é¦–å…ˆæ˜¯å„ç§ <code>#define</code>ã€‚ç”±äºæˆ‘ä»¬åœ¨è¿›è¡Œå¤šé¡¹å¼è¿ç®—çš„æ—¶å€™éœ€è¦è€ƒè™‘ç•Œçš„é—®é¢˜ï¼Œ<strong>å› æ­¤ä¸€å®šè¦æŠŠè¶…è¿‡ç•Œäº†çš„ç»™æ¸…é›¶</strong>ï¼Œä¸ç„¶å¯èƒ½å‡ºç°å„ç§å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜æ¯”å¦‚å¤šå·äº†ä¹‹ç±»çš„ï¼š</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb18-1"><a aria-hidden="true" href="#cb18-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span>
<span id="cb18-2"><a aria-hidden="true" href="#cb18-2"></a><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></span>
<span id="cb18-3"><a aria-hidden="true" href="#cb18-3"></a><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></span>
<span id="cb18-4"><a aria-hidden="true" href="#cb18-4"></a><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></span>
<span id="cb18-5"><a aria-hidden="true" href="#cb18-5"></a><span class="pp">#define FOR</span>(i,<span class="pp"> </span>a,<span class="pp"> </span>b)<span class="pp"> </span><span class="cf">for</span><span class="pp"> </span>(<span class="dt">int</span><span class="pp"> </span>i<span class="pp"> </span>=<span class="pp"> </span>(a);<span class="pp"> </span>i<span class="pp"> </span>&lt;=<span class="pp"> </span>(b);<span class="pp"> </span>++i)</span>
<span id="cb18-6"><a aria-hidden="true" href="#cb18-6"></a><span class="pp">#define DEC</span>(i,<span class="pp"> </span>a,<span class="pp"> </span>b)<span class="pp"> </span><span class="cf">for</span><span class="pp"> </span>(<span class="dt">int</span><span class="pp"> </span>i<span class="pp"> </span>=<span class="pp"> </span>(a);<span class="pp"> </span>i<span class="pp"> </span>&gt;=<span class="pp"> </span>(b);<span class="pp"> </span>--i)</span>
<span id="cb18-7"><a aria-hidden="true" href="#cb18-7"></a><span class="pp">#define VEC</span>(i,<span class="pp"> </span>v)<span class="pp"> </span><span class="cf">for</span><span class="pp"> </span>(<span class="dt">int</span><span class="pp"> </span>i<span class="pp"> </span>=<span class="pp"> </span><span class="dv">0</span>;<span class="pp"> </span>i<span class="pp"> </span>&lt;<span class="pp"> </span>(<span class="dt">int</span>)v.size();<span class="pp"> </span>++i)</span>
<span id="cb18-8"><a aria-hidden="true" href="#cb18-8"></a><span class="pp">#define il </span><span class="kw">inline</span></span>
<span id="cb18-9"><a aria-hidden="true" href="#cb18-9"></a><span class="pp">#define ll </span><span class="dt">long</span><span class="pp"> </span><span class="dt">long</span></span>
<span id="cb18-10"><a aria-hidden="true" href="#cb18-10"></a><span class="pp">#define ull </span><span class="dt">unsigned</span><span class="pp"> </span><span class="dt">long</span><span class="pp"> </span><span class="dt">long</span></span>
<span id="cb18-11"><a aria-hidden="true" href="#cb18-11"></a><span class="pp">#define clr</span>(f,<span class="pp"> </span>n)<span class="pp"> </span>memset(f,<span class="pp"> </span><span class="dv">0</span>,<span class="pp"> </span>(<span class="kw">sizeof</span>(<span class="dt">int</span>))<span class="pp"> </span>*<span class="pp"> </span>(n))</span>
<span id="cb18-12"><a aria-hidden="true" href="#cb18-12"></a><span class="pp">#define cpy</span>(f,<span class="pp"> </span>g,<span class="pp"> </span>n)<span class="pp"> </span>memcpy(f,<span class="pp"> </span>g,<span class="pp"> </span>(<span class="kw">sizeof</span>(<span class="dt">int</span>))<span class="pp"> </span>*<span class="pp"> </span>(n))</span>
<span id="cb18-13"><a aria-hidden="true" href="#cb18-13"></a><span class="pp">#define MOD </span><span class="dv">998244353</span></span></code></pre></div>
<p><code>memset</code> å’Œ <code>memcpy</code> çš„ç”¨æ³•å»ºè®®è‡ªå·±å»æŸ¥ã€‚</p>
<p>æ¥ä¸‹æ¥æ˜¯ä¸€äº›åŸºæœ¬çš„ä¸œè¥¿ï¼Œä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ <code>vector</code> æ¥å®ç°å¤šé¡¹å¼ï¼Œè¿™æ ·å­çš„å¥½å¤„æ˜¯å¸¸æ•°ä¸å¤§è€Œä¸”æ–¹ä¾¿å¥½å†™ï¼š</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb19-1"><a aria-hidden="true" href="#cb19-1"></a><span class="at">const</span> <span class="dt">int</span> G = <span class="dv">3</span>, mod = MOD, maxn = <span class="dv">1</span> &lt;&lt; <span class="dv">17</span> | <span class="dv">500</span>;</span>
<span id="cb19-2"><a aria-hidden="true" href="#cb19-2"></a><span class="kw">typedef</span> <span class="bu">std::</span>vector&lt;<span class="dt">int</span>&gt; Poly;</span>
<span id="cb19-3"><a aria-hidden="true" href="#cb19-3"></a>ll qPow(ll a, ll b = mod - <span class="dv">2</span>) {</span>
<span id="cb19-4"><a aria-hidden="true" href="#cb19-4"></a>    ll ret = <span class="dv">1</span>;</span>
<span id="cb19-5"><a aria-hidden="true" href="#cb19-5"></a>    <span class="cf">for</span> (; b; b &gt;&gt;= <span class="dv">1</span>, a = a * a % mod)</span>
<span id="cb19-6"><a aria-hidden="true" href="#cb19-6"></a>        <span class="cf">if</span> (b &amp; <span class="dv">1</span>) ret = a * ret % mod;</span>
<span id="cb19-7"><a aria-hidden="true" href="#cb19-7"></a>    <span class="cf">return</span> ret;</span>
<span id="cb19-8"><a aria-hidden="true" href="#cb19-8"></a>}</span>
<span id="cb19-9"><a aria-hidden="true" href="#cb19-9"></a><span class="at">const</span> <span class="dt">int</span> invG = qPow(G);</span></code></pre></div>
<p>NTT æ—¶éœ€è¦ç”¨åˆ°çš„ä½é€†åºç½®æ¢ï¼š</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb20-1"><a aria-hidden="true" href="#cb20-1"></a><span class="dt">int</span> <span class="fu">tr</span>[maxn &lt;&lt; <span class="dv">1</span>], revLim;</span>
<span id="cb20-2"><a aria-hidden="true" href="#cb20-2"></a></span>
<span id="cb20-3"><a aria-hidden="true" href="#cb20-3"></a><span class="dt">void</span> getTr(<span class="dt">int</span> n) {</span>
<span id="cb20-4"><a aria-hidden="true" href="#cb20-4"></a>    <span class="cf">if</span> (revLim == n) <span class="cf">return</span>;</span>
<span id="cb20-5"><a aria-hidden="true" href="#cb20-5"></a>    revLim = n;</span>
<span id="cb20-6"><a aria-hidden="true" href="#cb20-6"></a>    FOR(i, <span class="dv">0</span>, n - <span class="dv">1</span>)</span>
<span id="cb20-7"><a aria-hidden="true" href="#cb20-7"></a>        <span class="fu">tr</span>[i] = (<span class="fu">tr</span>[i &gt;&gt; <span class="dv">1</span>] &gt;&gt; <span class="dv">1</span>) | ((i &amp; <span class="dv">1</span>) ? (n &gt;&gt; <span class="dv">1</span>) : <span class="dv">0</span>);</span>
<span id="cb20-8"><a aria-hidden="true" href="#cb20-8"></a>}</span></code></pre></div>
<p>è¿™æ ·å­å¯ä»¥åœ¨éœ€è¦è¿›è¡Œå¾ˆå¤šæ¬¡ NTT çš„æ—¶å€™æ™ºèƒ½çš„æ±‚å‡ºå¯¹åº”éœ€è¦çš„ <code>tr</code>ã€‚</p>
<p>NTTï¼š<strong>å…³äº <code>static</code> å…³é”®å­—ç›¸å…³çš„å»ºè®®è‡ªå·±æŸ¥ä¸€ä¸‹ã€‚</strong></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb21-1"><a aria-hidden="true" href="#cb21-1"></a><span class="dt">void</span> NTT(<span class="dt">int</span> *g, <span class="dt">bool</span> op, <span class="dt">int</span> n) {</span>
<span id="cb21-2"><a aria-hidden="true" href="#cb21-2"></a>    getTr(n);</span>
<span id="cb21-3"><a aria-hidden="true" href="#cb21-3"></a>    <span class="at">static</span> ull f[maxn &lt;&lt; <span class="dv">1</span>], w[maxn &lt;&lt; <span class="dv">1</span>];</span>
<span id="cb21-4"><a aria-hidden="true" href="#cb21-4"></a>    w[<span class="dv">0</span>] = <span class="dv">1</span>;</span>
<span id="cb21-5"><a aria-hidden="true" href="#cb21-5"></a>    FOR(i, <span class="dv">0</span>, n - <span class="dv">1</span>) f[i] = (((ll)mod &lt;&lt; <span class="dv">5</span><span class="bu">ll</span>) + g[<span class="fu">tr</span>[i]]) % mod;</span>
<span id="cb21-6"><a aria-hidden="true" href="#cb21-6"></a>    <span class="cf">for</span> (<span class="dt">int</span> l = <span class="dv">1</span>; l &lt; n; l &lt;&lt;= <span class="dv">1</span>) {</span>
<span id="cb21-7"><a aria-hidden="true" href="#cb21-7"></a>        ull tG = qPow(op ? G : invG, (mod - <span class="dv">1</span>) / (l &lt;&lt; <span class="dv">1</span>));</span>
<span id="cb21-8"><a aria-hidden="true" href="#cb21-8"></a>        FOR(i, <span class="dv">1</span>, l - <span class="dv">1</span>) w[i] = w[i - <span class="dv">1</span>] * tG % mod;</span>
<span id="cb21-9"><a aria-hidden="true" href="#cb21-9"></a>        <span class="cf">for</span> (<span class="dt">int</span> k = <span class="dv">0</span>; k &lt; n; k += (l &lt;&lt; <span class="dv">1</span>))</span>
<span id="cb21-10"><a aria-hidden="true" href="#cb21-10"></a>            <span class="cf">for</span> (<span class="dt">int</span> p = <span class="dv">0</span>; p &lt; l; ++p) {</span>
<span id="cb21-11"><a aria-hidden="true" href="#cb21-11"></a>                <span class="dt">int</span> tt = w[p] * f[k | l | p] % mod;</span>
<span id="cb21-12"><a aria-hidden="true" href="#cb21-12"></a>                f[k | l | p] = f[k | p] + mod - tt;</span>
<span id="cb21-13"><a aria-hidden="true" href="#cb21-13"></a>                f[k | p] += tt;</span>
<span id="cb21-14"><a aria-hidden="true" href="#cb21-14"></a>            }</span>
<span id="cb21-15"><a aria-hidden="true" href="#cb21-15"></a>        <span class="cf">if</span> (l == (<span class="dv">1</span> &lt;&lt; <span class="dv">10</span>))</span>
<span id="cb21-16"><a aria-hidden="true" href="#cb21-16"></a>            FOR(i, <span class="dv">0</span>, n - <span class="dv">1</span>) f[i] %= mod;</span>
<span id="cb21-17"><a aria-hidden="true" href="#cb21-17"></a>    }</span>
<span id="cb21-18"><a aria-hidden="true" href="#cb21-18"></a>    <span class="cf">if</span> (!op) {</span>
<span id="cb21-19"><a aria-hidden="true" href="#cb21-19"></a>        ull invn = qPow(n);</span>
<span id="cb21-20"><a aria-hidden="true" href="#cb21-20"></a>        FOR(i, <span class="dv">0</span>, n - <span class="dv">1</span>) g[i] = f[i] % mod * invn % mod;</span>
<span id="cb21-21"><a aria-hidden="true" href="#cb21-21"></a>    } <span class="cf">else</span> FOR(i, <span class="dv">0</span>, n - <span class="dv">1</span>) g[i] = f[i] % mod;</span>
<span id="cb21-22"><a aria-hidden="true" href="#cb21-22"></a>}</span></code></pre></div>
<p>å…¶ä¸­æœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ã€‚ä½¿ç”¨ <code>ull</code> æ˜¯å› ä¸º <code>ull</code> å¯ä»¥å¤§å¹…å‡å°‘éœ€è¦çš„å–æ¨¡æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿­ä»£ <span class="math inline">\(10\)</span> æ¬¡å†å–æ¨¡ï¼Œå‡å°‘å¸¸æ•°ã€‚è€Œç¬¬äº”è¡Œåˆ™ä¸ºå»æ‰ä¼ è¿›æ¥çš„ <span class="math inline">\([x^i]g(x)\)</span> ä¸ºè´Ÿæ•°æ—¶å¯èƒ½äº§ç”Ÿçš„å½±å“ã€‚</p>
<p>ç„¶åæ˜¯ <code>poly</code> çš„å¸¸è§è¿ç®—ï¼Œé‡è½½äº†ä¹‹åä¼šéå¸¸æ–¹ä¾¿ã€‚</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb22-1"><a aria-hidden="true" href="#cb22-1"></a><span class="dt">void</span> mul(<span class="dt">int</span> *f, <span class="dt">int</span> *g, <span class="dt">int</span> n) {</span>
<span id="cb22-2"><a aria-hidden="true" href="#cb22-2"></a>    FOR(i, <span class="dv">0</span>, n - <span class="dv">1</span>) f[i] = <span class="dv">1</span><span class="bu">ll</span> * f[i] * g[i] % mod;</span>
<span id="cb22-3"><a aria-hidden="true" href="#cb22-3"></a>    <span class="cf">return</span>;</span>
<span id="cb22-4"><a aria-hidden="true" href="#cb22-4"></a>}</span>
<span id="cb22-5"><a aria-hidden="true" href="#cb22-5"></a></span>
<span id="cb22-6"><a aria-hidden="true" href="#cb22-6"></a>Poly <span class="kw">operator</span>+(<span class="at">const</span> Poly &amp;A, <span class="at">const</span> Poly &amp;B) {</span>
<span id="cb22-7"><a aria-hidden="true" href="#cb22-7"></a>    Poly C = A; C.resize(max(A.size(), B.size()));</span>
<span id="cb22-8"><a aria-hidden="true" href="#cb22-8"></a>    VEC(i, B) C[i] = (C[i] + B[i]) % mod;</span>
<span id="cb22-9"><a aria-hidden="true" href="#cb22-9"></a>    <span class="cf">return</span> C;</span>
<span id="cb22-10"><a aria-hidden="true" href="#cb22-10"></a>}</span>
<span id="cb22-11"><a aria-hidden="true" href="#cb22-11"></a>Poly <span class="kw">operator</span>-(<span class="at">const</span> Poly &amp;A, <span class="at">const</span> Poly &amp;B) {</span>
<span id="cb22-12"><a aria-hidden="true" href="#cb22-12"></a>    Poly C = A; C.resize(max(A.size(), B.size()));</span>
<span id="cb22-13"><a aria-hidden="true" href="#cb22-13"></a>    VEC(i, B) C[i] = (C[i] + mod - B[i]) % mod;</span>
<span id="cb22-14"><a aria-hidden="true" href="#cb22-14"></a>    <span class="cf">return</span> C;</span>
<span id="cb22-15"><a aria-hidden="true" href="#cb22-15"></a>}</span>
<span id="cb22-16"><a aria-hidden="true" href="#cb22-16"></a>Poly <span class="kw">operator</span>*(<span class="at">const</span> <span class="dt">int</span> c, <span class="at">const</span> Poly &amp;A) {</span>
<span id="cb22-17"><a aria-hidden="true" href="#cb22-17"></a>    Poly C = A;</span>
<span id="cb22-18"><a aria-hidden="true" href="#cb22-18"></a>    VEC(i, A) C[i] = <span class="dv">1</span><span class="bu">ll</span> * c * C[i] % mod;</span>
<span id="cb22-19"><a aria-hidden="true" href="#cb22-19"></a>    <span class="cf">return</span> C;</span>
<span id="cb22-20"><a aria-hidden="true" href="#cb22-20"></a>}</span>
<span id="cb22-21"><a aria-hidden="true" href="#cb22-21"></a></span>
<span id="cb22-22"><a aria-hidden="true" href="#cb22-22"></a><span class="dt">int</span> lim;<span class="co">//ä»£è¡¨å¤šé¡¹å¼è¿ç®—æ—¶çš„ç•Œ</span></span>
<span id="cb22-23"><a aria-hidden="true" href="#cb22-23"></a></span>
<span id="cb22-24"><a aria-hidden="true" href="#cb22-24"></a>Poly <span class="kw">operator</span>*(<span class="at">const</span> Poly &amp;A, <span class="at">const</span> Poly &amp;B) {</span>
<span id="cb22-25"><a aria-hidden="true" href="#cb22-25"></a>    <span class="at">static</span> <span class="dt">int</span> a[maxn &lt;&lt; <span class="dv">1</span>], b[maxn &lt;&lt; <span class="dv">1</span>];</span>
<span id="cb22-26"><a aria-hidden="true" href="#cb22-26"></a>    cpy(a, &amp;A[<span class="dv">0</span>], A.size());</span>
<span id="cb22-27"><a aria-hidden="true" href="#cb22-27"></a>    cpy(b, &amp;B[<span class="dv">0</span>], B.size());</span>
<span id="cb22-28"><a aria-hidden="true" href="#cb22-28"></a>    Poly C; C.resize(min(lim, (<span class="dt">int</span>)(A.size() + B.size() - <span class="dv">1</span>)));</span>
<span id="cb22-29"><a aria-hidden="true" href="#cb22-29"></a>    <span class="dt">int</span> n = <span class="dv">1</span>; <span class="cf">for</span> (n = <span class="dv">1</span>; n &lt; (<span class="dt">int</span>)(A.size() + B.size() - <span class="dv">1</span>); n &lt;&lt;= <span class="dv">1</span>);</span>
<span id="cb22-30"><a aria-hidden="true" href="#cb22-30"></a>    NTT(a, <span class="dv">1</span>, n), NTT(b, <span class="dv">1</span>, n);</span>
<span id="cb22-31"><a aria-hidden="true" href="#cb22-31"></a>    mul(a, b, n), NTT(a, <span class="dv">0</span>, n);</span>
<span id="cb22-32"><a aria-hidden="true" href="#cb22-32"></a>    cpy(&amp;C[<span class="dv">0</span>], a, C.size());</span>
<span id="cb22-33"><a aria-hidden="true" href="#cb22-33"></a>    clr(a, n), clr(b, n);</span>
<span id="cb22-34"><a aria-hidden="true" href="#cb22-34"></a>    <span class="cf">return</span> C;</span>
<span id="cb22-35"><a aria-hidden="true" href="#cb22-35"></a>}</span></code></pre></div>
<h2 id="å¤šé¡¹å¼ä¹˜æ³•é€†">å¤šé¡¹å¼ä¹˜æ³•é€†</h2>
<h3 id="å®šä¹‰">å®šä¹‰</h3>
<p>å½“ä¸¤ä¸ªå¤šé¡¹å¼ <span class="math inline">\(F(x)\)</span> ä¸ <span class="math inline">\(G(x)\)</span> åœ¨æ¯ä¸€é¡¹ç³»æ•°æ¨¡ <span class="math inline">\(p\)</span> æ—¶æœ‰ <span class="math inline">\(F(x)*G(x)\equiv 1\pmod{x^n}\)</span> æ—¶ï¼Œç§° <span class="math inline">\(F(x)\)</span> ä¸ <span class="math inline">\(G(x)\)</span> äº’ä¸ºä¹˜æ³•é€†å…ƒã€‚æ­¤å¤„ <span class="math inline">\(\pmod{x^n}\)</span> ä»£è¡¨æ¬¡æ•°é«˜äº <span class="math inline">\(n\)</span> çš„é¡¹éƒ½ä¸è€ƒè™‘ã€‚</p>
<p>éœ€è¦çš„å‰ç½®çŸ¥è¯†ï¼šNTTã€‚</p>
<h3 id="æ±‚æ³•">æ±‚æ³•</h3>
<p>è€ƒè™‘å€å¢ã€‚å‡è®¾æˆ‘ä»¬è¦æ±‚æ»¡è¶³ <span class="math inline">\(F(x)*G(x)\equiv 1\pmod{x^k}\)</span> çš„ <span class="math inline">\(G(x)\)</span>ï¼Œå¹¶ä¸”å·²ç»æ±‚å‡ºäº†æ»¡è¶³ <span class="math inline">\(F(x)*G'(x)\equiv1\pmod{x^{\lceil\frac x 2\rceil}}\)</span> çš„ <span class="math inline">\(G'(x)\)</span>ã€‚é‚£ä¹ˆæˆ‘ä»¬ç”± <span class="math display">\[
F(x)*G'(x)\equiv1\pmod{x^{\lceil\frac x 2\rceil}}
\]</span> å¿…ç„¶å¯ä»¥æ¨å‡º <span class="math display">\[
F(x)*G(x)\equiv1\pmod{x^{\lceil\frac x 2\rceil}}
\]</span> é‚£ä¹ˆ <span class="math display">\[
G(x) \equiv G'(x)\pmod{x^{\lceil\frac x 2\rceil}}
\]</span> ä½œå·®ï¼Œ <span class="math display">\[
G(x) - G'(x)\equiv 0\pmod{x^{\lceil\frac x2\rceil}}
\]</span> å°†ä¸¤è¾¹åŒæ—¶å¹³æ–¹ï¼Œä¸éš¾å‘ç°ç•Œä¼šä» <span class="math inline">\(\lceil\frac n2\rceil\)</span> å˜ä¸º <span class="math inline">\(n\)</span>ã€‚ <span class="math display">\[
G^2(x) - 2G(x)G'(x) + G'^2(x)\equiv 0\pmod{x^n}
\]</span> ç°åœ¨è¦æ±‚çš„æ˜¯ <span class="math inline">\(G(x)\)</span>ï¼Œè€Œæˆ‘ä»¬å‘ç° <span class="math inline">\(G^2(x)\)</span> ä¸å¥½å¤„ç†ï¼Œæ€ä¹ˆåŠï¼ŸåŒæ—¶ä¹˜ä»¥ <span class="math inline">\(F(x)\)</span> å°±å¯ä»¥æ¶ˆæ‰ä¸€ä¸ª <span class="math inline">\(G(x)\)</span>ï¼š <span class="math display">\[
G(x) - 2G'(x) + G'^2(x)F(x)\equiv 0\pmod{x^n}
\]</span> æ‰€ä»¥æˆ‘ä»¬å¾—åˆ°äº† <span class="math display">\[
G(x)\equiv 2G'(x) - G'^2(x)F(x)\pmod{x^n}
\]</span> æ ¹æ®è¿™ä¸ªï¼Œæˆ‘ä»¬å°±å¯ä»¥ä» <span class="math inline">\(G'(x)\)</span> æ¨å‡º <span class="math inline">\(G(x)\)</span> çš„å€¼å‡ºæ¥äº†ã€‚ä»ä¸Šå¾€ä¸‹é€’å½’æ±‚è§£ï¼Œåˆ°å¸¸æ•°é¡¹çš„æ—¶å€™ç›´æ¥è´¹é©¬å°å®šç†æ±‚é€†å…ƒç„¶åä¸€æ­¥æ­¥å›æº¯ä¸Šå»ã€‚ä¸éš¾å‘ç°å¤æ‚åº¦ä¸º <span class="math inline">\(T(n) = T(n/2) + O(n\log n)\)</span>ï¼Œç”±ä¸»å®šç†çŸ¥æ€»å¤æ‚åº¦ä¸º <span class="math inline">\(O(n\log n)\)</span>ã€‚</p>
<h3 id="å®ç°-1">å®ç°</h3>
<p>é€’å½’ç‰ˆå¤šé¡¹å¼æ±‚é€†ï¼Œå¥—ç”¨ä¸Šé¢çš„æ¿å­ï¼š</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb23-1"><a aria-hidden="true" href="#cb23-1"></a><span class="dt">void</span> polyInv(<span class="at">const</span> Poly &amp;A, Poly &amp;B, <span class="dt">int</span> n) {</span>
<span id="cb23-2"><a aria-hidden="true" href="#cb23-2"></a>    <span class="cf">if</span> (!n) <span class="cf">return</span>;</span>
<span id="cb23-3"><a aria-hidden="true" href="#cb23-3"></a>    <span class="cf">if</span> (n == <span class="dv">1</span>) B.push_back(qPow(A[<span class="dv">0</span>]));</span>
<span id="cb23-4"><a aria-hidden="true" href="#cb23-4"></a>    <span class="cf">else</span> <span class="cf">if</span> (n &amp; <span class="dv">1</span>) {</span>
<span id="cb23-5"><a aria-hidden="true" href="#cb23-5"></a>        polyInv(A, B, --n);</span>
<span id="cb23-6"><a aria-hidden="true" href="#cb23-6"></a>        <span class="dt">int</span> sav = <span class="dv">0</span>;</span>
<span id="cb23-7"><a aria-hidden="true" href="#cb23-7"></a>        FOR(i, <span class="dv">0</span>, n - <span class="dv">1</span>) sav = (sav + <span class="dv">1</span><span class="bu">ll</span> * B[i] * A[n - i]) % mod;</span>
<span id="cb23-8"><a aria-hidden="true" href="#cb23-8"></a>        B.push_back(<span class="dv">1</span><span class="bu">ll</span> * sav * qPow(mod - A[<span class="dv">0</span>]) % mod);</span>
<span id="cb23-9"><a aria-hidden="true" href="#cb23-9"></a>    } <span class="cf">else</span> {</span>
<span id="cb23-10"><a aria-hidden="true" href="#cb23-10"></a>        polyInv(A, B, n &gt;&gt; <span class="dv">1</span>);</span>
<span id="cb23-11"><a aria-hidden="true" href="#cb23-11"></a>        Poly sA; sA.resize(n);</span>
<span id="cb23-12"><a aria-hidden="true" href="#cb23-12"></a>        cpy(&amp;sA[<span class="dv">0</span>], &amp;A[<span class="dv">0</span>], n);</span>
<span id="cb23-13"><a aria-hidden="true" href="#cb23-13"></a>        B = <span class="dv">2</span> * B - B * B * sA;</span>
<span id="cb23-14"><a aria-hidden="true" href="#cb23-14"></a>        B.resize(n);</span>
<span id="cb23-15"><a aria-hidden="true" href="#cb23-15"></a>    }</span>
<span id="cb23-16"><a aria-hidden="true" href="#cb23-16"></a>    <span class="cf">return</span>;</span>
<span id="cb23-17"><a aria-hidden="true" href="#cb23-17"></a>}</span>
<span id="cb23-18"><a aria-hidden="true" href="#cb23-18"></a>Poly polyInv(<span class="at">const</span> Poly &amp;A) {</span>
<span id="cb23-19"><a aria-hidden="true" href="#cb23-19"></a>    Poly C; polyInv(A, C, A.size());</span>
<span id="cb23-20"><a aria-hidden="true" href="#cb23-20"></a>    <span class="cf">return</span> C;</span>
<span id="cb23-21"><a aria-hidden="true" href="#cb23-21"></a>}</span></code></pre></div>
<p>å…¶ä¸­æŠŠ <span class="math inline">\(n\)</span> ä¸ºå¥‡æ•°çš„æƒ…å†µè¿›è¡Œäº†ç‰¹åˆ¤ä¼˜åŒ–ï¼Œè°ƒç”¨å°±ç›´æ¥å¯¹ä¸‹é¢çš„ <code>polyInv</code> å‡½æ•°ä¼ å…¥ä¸€ä¸ª <code>vector</code> å³å¯ã€‚</p>
<h2 id="å¤šé¡¹å¼çš„å¯¼æ•°ç§¯åˆ†å¤åˆ">å¤šé¡¹å¼çš„å¯¼æ•°/ç§¯åˆ†/å¤åˆ</h2>
<p>å›é¡¾ä¸€ä¸‹ä¸€äº›åŸºç¡€çš„å¯¼æ•°å…¬å¼ï¼š <span class="math display">\[
\begin{aligned}
f(x) = e^x&amp;\implies f'(x) = e^x\\
f(x) = \ln x&amp;\implies f'(x) = \frac1x\\
f(x) = ax^k&amp;\implies f'(x) = akx^{k - 1}\\
(f(x)\pm g(x))'&amp;= f'(x)\pm g'(x)\\
(f(g(x)))' &amp;=f'(g(x))\times g'(x)
\end{aligned}
\]</span> æˆ‘ä»¬åœ¨è¿™é‡Œå®šä¹‰ä¸€ä¸‹å¤šé¡¹å¼çš„æ±‚å¯¼ï¼š <span class="math display">\[
f(x) = \sum_{i = 0}^na_ix^i\implies f'(x) = \sum_{i = 0}^{n - 1}(i + 1)a_{i + 1}x^i
\]</span> ç§¯åˆ†ä¸ºæ±‚å¯¼çš„é€†è¿ç®—ï¼š <span class="math display">\[
f(x) = \sum_{i = 0}^na_ix_i\implies\int f(x) \mathrm dx= \sum_{i = 1}^{n + 1}\frac{a_{i - 1}x^i}{i}
\]</span> æ‰€ä»¥å¤šé¡¹å¼æ±‚å¯¼å’Œæ±‚ç§¯åˆ†çš„ä»£ç å°±å¾ˆå®¹æ˜“å†™å‡ºæ¥äº†ï¼Œå½“ç„¶éœ€è¦ä¸€å¼€å§‹çº¿æ€§é¢„å¤„ç†ä¸€ä¸‹é€†å…ƒã€‚</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb24-1"><a aria-hidden="true" href="#cb24-1"></a><span class="dt">int</span> inv[maxn];</span>
<span id="cb24-2"><a aria-hidden="true" href="#cb24-2"></a><span class="dt">void</span> initInv() {</span>
<span id="cb24-3"><a aria-hidden="true" href="#cb24-3"></a>    inv[<span class="dv">1</span>] = <span class="dv">1</span>;</span>
<span id="cb24-4"><a aria-hidden="true" href="#cb24-4"></a>    FOR(i, <span class="dv">2</span>, lim) inv[i] = <span class="dv">1</span><span class="bu">ll</span> * inv[mod % i] * (mod - mod / i) % mod;</span>
<span id="cb24-5"><a aria-hidden="true" href="#cb24-5"></a>    <span class="cf">return</span>;</span>
<span id="cb24-6"><a aria-hidden="true" href="#cb24-6"></a>}</span>
<span id="cb24-7"><a aria-hidden="true" href="#cb24-7"></a></span>
<span id="cb24-8"><a aria-hidden="true" href="#cb24-8"></a>Poly deri(<span class="at">const</span> Poly &amp;A) {</span>
<span id="cb24-9"><a aria-hidden="true" href="#cb24-9"></a>    Poly C = A;</span>
<span id="cb24-10"><a aria-hidden="true" href="#cb24-10"></a>    <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">1</span>; i &lt; (<span class="dt">int</span>)C.size(); ++i) C[i - <span class="dv">1</span>] = <span class="dv">1</span><span class="bu">ll</span> * C[i] * i % mod;</span>
<span id="cb24-11"><a aria-hidden="true" href="#cb24-11"></a>    <span class="cf">if</span> (!C.empty()) C.pop_back();</span>
<span id="cb24-12"><a aria-hidden="true" href="#cb24-12"></a>    <span class="cf">return</span> C;</span>
<span id="cb24-13"><a aria-hidden="true" href="#cb24-13"></a>}</span>
<span id="cb24-14"><a aria-hidden="true" href="#cb24-14"></a></span>
<span id="cb24-15"><a aria-hidden="true" href="#cb24-15"></a>Poly ints(<span class="at">const</span> Poly &amp;A) {</span>
<span id="cb24-16"><a aria-hidden="true" href="#cb24-16"></a>    Poly C = A;</span>
<span id="cb24-17"><a aria-hidden="true" href="#cb24-17"></a>    <span class="cf">for</span> (<span class="dt">int</span> i = (<span class="dt">int</span>)C.size() - <span class="dv">1</span>; i &gt; <span class="dv">0</span>; --i)</span>
<span id="cb24-18"><a aria-hidden="true" href="#cb24-18"></a>        C[i] = <span class="dv">1</span><span class="bu">ll</span> * C[i - <span class="dv">1</span>] * inv[i] % mod;</span>
<span id="cb24-19"><a aria-hidden="true" href="#cb24-19"></a>    <span class="cf">if</span> (!C.empty()) C[<span class="dv">0</span>] = <span class="dv">0</span>;</span>
<span id="cb24-20"><a aria-hidden="true" href="#cb24-20"></a>    <span class="cf">return</span> C;</span>
<span id="cb24-21"><a aria-hidden="true" href="#cb24-21"></a>}</span></code></pre></div>
<p>éœ€è¦éå¸¸æ³¨æ„ä¼ è¿›æ¥çš„å¤šé¡¹å¼ä¸ºç©ºçš„æƒ…å†µï¼Œå¯¹ç©º <code>vector</code> è¿›è¡Œè°ƒç”¨ <code>pop_back()</code> å’Œè®¿é—®å…ƒç´ ä¼šç›´æ¥ REï¼Œéœ€è¦æ³¨æ„ã€‚</p>
<p>å®šä¹‰å¤šé¡¹å¼çš„å¤åˆï¼š</p>
<p><span class="math display">\[
f(g(x)) = \sum_{i = 0}f_i(g(x))^i
\]</span></p>
<p>åº”è¯¥æ¯”è¾ƒå¥½ç†è§£ï¼Œç›´æ¥æŠŠ <span class="math inline">\(g(x)\)</span> ä»£å…¥å³å¯ã€‚åé¢å­¦ä¹ ç‰›é¡¿è¿­ä»£çš„æ—¶å€™éœ€è¦ç”¨åˆ°ã€‚</p>
<h2 id="ç‰›é¡¿è¿­ä»£æ³•">ç‰›é¡¿è¿­ä»£æ³•</h2>
<p>è¿™èŠ‚å†…å®¹ç›¸å½“é‡è¦ï¼Œæ˜¯åé¢å­¦ä¹ å¼€æ ¹å’Œ <span class="math inline">\(\exp\)</span> çš„åŸºç¡€ï¼Œå»ºè®®æŒæ¡å¥½ã€‚</p>
<h3 id="ç‰›è¿­æ±‚å‡½æ•°é›¶ç‚¹">ç‰›è¿­æ±‚å‡½æ•°é›¶ç‚¹</h3>
<p>é¦–å…ˆå„ä½å¦‚æœå­¦è¿‡æ—§äººæ•™ç‰ˆé€‰ä¿® 2-2 çš„è¯åº”è¯¥éƒ½æœ‰çœ‹åˆ°è¿‡ç‰›é¡¿è¿­ä»£ã€‚</p>
<p>ç‰›é¡¿è¿­ä»£æ˜¯ä¸€ç§æ±‚å‡½æ•°é›¶ç‚¹çš„æ–¹æ³•ã€‚è®¾åˆå§‹è¿‘ä¼¼å€¼ä¸º <span class="math inline">\(x_0\)</span>ï¼Œåˆ™æˆ‘ä»¬æœ‰è¿™ç‚¹çš„åˆ‡çº¿æ–¹ç¨‹ <span class="math display">\[
y = f'(x_0)(x - x_0) + f(x_0)
\]</span> ä»¤ <span class="math inline">\(y = 0\)</span>ï¼Œå¾— <span class="math inline">\(x = x_0 - \dfrac{f(x_0)}{f'(x_0)}\)</span>ã€‚è¿™æ ·å­æˆ‘ä»¬å°±å¯ä»¥ä¸€ç›´è¿­ä»£ä¸‹å»ï¼Œä»¤ <span class="math inline">\(x_0\leftarrow x\)</span>ï¼Œå°±å¯ä»¥åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…å¾ˆæ¥è¿‘åœ°å¾—åˆ° <span class="math inline">\(f(x)\)</span> çš„é›¶ç‚¹ã€‚</p>
<h3 id="æ³°å‹’å±•å¼€">æ³°å‹’å±•å¼€</h3>
<p>ç®€å•æ‰¯ä¸€æ‰¯å§ï¼Œå®é™…ä¸Šå°±æ˜¯ä½¿ç”¨å¤šé¡¹å¼å‡½æ•°æ¥æ‹Ÿåˆ <span class="math inline">\(\ln\)</span> å•Š <span class="math inline">\(\sin\)</span> å•Šè¿™ç±»çš„å‡½æ•°ï¼ˆå› ä¸ºå¤šé¡¹å¼çœŸçš„æ–¹ä¾¿å•Šï¼‰ï¼Œå…¶åŸç†å°±æ˜¯åœ¨è¦æ±‚çš„å‡½æ•° <span class="math inline">\(f(x)\)</span> ä¸Šæ‰¾ä¸€ä¸ªç‚¹ <span class="math inline">\(x_0\)</span>ï¼Œæ„é€ ä¸€ä¸ªå¤šé¡¹å¼ <span class="math inline">\(g(x)\)</span> ä½¿å¾—è¿™ä¸ªå¤šé¡¹å¼åœ¨ <span class="math inline">\(x_0\)</span> å¤„çš„ <span class="math inline">\(n\)</span> é˜¶å¯¼æ•°éƒ½ç›¸ç­‰ï¼Œéšç€ <span class="math inline">\(n\)</span> è¶Šæ¥è¶Šå¤§ï¼Œæ‹Ÿåˆçš„æ•ˆæœå°±è¶Šæ¥è¶Šå¥½ã€‚</p>
<p>æ³°å‹’å±•å¼€çš„å…¬å¼æ˜¯é•¿è¿™æ ·çš„ï¼š</p>
<p><span class="math display">\[
f(x) = \frac{f(x_0)}{0!}(x - x_0)^0 + \frac{f'(x_0)}{1!}(x - x_0)^1 + \frac{f''(x_0)}{2!}(x - x_0)^2 + \cdots + \frac{f^{(n)}(x_0)}{n!}(x - x_0)^n + R_n(x)
\]</span></p>
<p>æˆ–è€…å†™æˆ</p>
<p><span class="math display">\[
f(x) \approx \sum_{i = 0}^n\frac{f^{(i)}(x_0)}{i!}(x - x_0)^i
\]</span></p>
<p>å…¶ä¸­ <span class="math inline">\(f^{(i)}(x_0)\)</span> è¡¨ç¤º <span class="math inline">\(f(x)\)</span> åœ¨ <span class="math inline">\(x_0\)</span> å¤„çš„ <span class="math inline">\(i\)</span> é˜¶å¯¼æ•°ã€‚</p>
<p><span class="math inline">\(x_0 = 0\)</span> æ—¶å¾—åˆ°çš„çº§æ•°å°±æ˜¯éº¦å…‹åŠ³æ—çº§æ•°ï¼Œä¸‹é¢çš„ä¸œè¥¿éœ€è¦ç‰¢è®°ï¼š</p>
<p><span class="math display">\[
\begin{aligned}
\mathrm e^x &amp;= \sum_{k = 0}^\infty\frac{x^k}{k!}\\
\sin x &amp;= x - \frac{x^3}{3!} + \frac{x^5}{5!} - \cdots + (-1)^n\frac{x^{2n - 1}}{(2n - 1)!} + \cdots\\
&amp;= \sum_{i = 0}^\infty(-1)^i\frac{x^{2i - 1}}{(2i - 1)!}\\
\cos x &amp;= 1 - \frac{x^2}{2!} + \frac{x^4}{4!} - \cdots + (-1)^n\frac{x^{2n}}{(2n)!}+\cdots\\
&amp;= \sum_{i = 0}^\infty(-1)^i\frac{x^{2i}}{(2i)!}\\
\ln(1 + x) &amp;= \sum_{i = 1}^\infty(-1)^{i - 1}\frac{x^i}{i}\\
\ln(1 - x) &amp;= -\sum_{i = 1}^\infty\frac{x^i}{i}
\end{aligned}
\]</span></p>
<p>å¤šé¡¹å¼çš„ <span class="math inline">\(\ln\)</span> æ˜¯å¦‚æ˜¯å®šä¹‰çš„ï¼š <span class="math display">\[
\ln(1 - f(x)) = -\sum_{i = 1}^{+\infty}\frac{f^i(x)}{i}\\\ln(1 + f(x)) = \sum_{i = 1}^{+\infty}\frac{(-1)^{i - 1}f^i(x)}{i}
\]</span> å¤šé¡¹å¼çš„ <span class="math inline">\(\exp\)</span> åˆ™æ˜¯è¿™æ ·ï¼š <span class="math display">\[
\exp f(x) = e^{f(x)}=\sum_{i = 0}^{+\infty}\frac{f^i(x)}{i!}
\]</span></p>
<h3 id="å¤šé¡¹å¼ç‰›è¿­">å¤šé¡¹å¼ç‰›è¿­</h3>
<p>ç°åœ¨è¦è§£å†³çš„æ˜¯ç»™å®š <span class="math inline">\(g(x)\)</span>ï¼Œæ±‚æ»¡è¶³ <span class="math inline">\(g(f(x))\equiv 0\pmod{x^n}\)</span> çš„ <span class="math inline">\(f(x)\)</span>ï¼ˆæ¨¡ <span class="math inline">\(x^n\)</span> æ„ä¹‰ä¸‹ï¼‰ã€‚</p>
<p>è€ƒè™‘å€å¢ã€‚</p>
<p>å½“ <span class="math inline">\(n = 1\)</span> çš„æ—¶å€™ï¼Œ<span class="math inline">\([x^0]g(f(x)) = 0\)</span> çš„è§£è¦å•ç‹¬çš„ç®—ã€‚</p>
<p>å‡è®¾å·²ç»æ±‚å‡ºäº†æ¨¡ <span class="math inline">\(x^{\left\lceil\frac n 2\right\rceil}\)</span> æ„ä¹‰ä¸‹çš„è§£ <span class="math inline">\(f_0(x)\)</span>ï¼Œè¦æ±‚æ¨¡ <span class="math inline">\(x^n\)</span> æ„ä¹‰ä¸‹çš„ <span class="math inline">\(f(x)\)</span>ã€‚</p>
<p>å°† <span class="math inline">\(g(f(x))\)</span> åœ¨ <span class="math inline">\(f_0(x)\)</span> å¤„æ³°å‹’å±•å¼€ï¼Œæœ‰ï¼š <span class="math display">\[
\sum_{i = 0}^{+\infty}\frac{g^{(i)}(f_0(x))}{i!}(f(x) - f_0(x))^i\equiv 0\pmod{x^n}
\]</span> å› ä¸º <span class="math inline">\(f(x) - f_0(x)\)</span> çš„æœ€ä½éé›¶é¡¹æ¬¡æ•°æœ€ä½ä¸º <span class="math inline">\(\left\lceil\frac n 2\right\rceil\)</span>ï¼Œæ‰€ä»¥å½“ <span class="math inline">\(i\ge 2\)</span> æ—¶æœ‰ <span class="math display">\[
(f(x) - f_0(x))^i\equiv 0\pmod{x^n}
\]</span> æ‰€ä»¥æ³°å‹’å±•å¼€çš„ç»“æœä¸º <span class="math display">\[
g(f_0(x)) + g'(f_0(x))(f(x) - f_0(x))\equiv 0\pmod{x^n}
\]</span> åŒ–ç®€ä¸‹æ¥å°±æ˜¯ <span class="math display">\[
f(x)\equiv f_0(x) - \frac{g(f_0(x))}{g'(f_0(x))}\pmod{x^n}
\]</span></p>
<h3 id="åº”ç”¨">åº”ç”¨</h3>
<p>è¿™ä¸ªå½¢å¼å¯èƒ½æš‚æ—¶çœ‹ä¸å‡ºæ¥æœ‰ä»€ä¹ˆç”¨ï¼Œä½†æ˜¯ç­‰ä¸€ä¸‹æ¶‰åŠåˆ° <span class="math inline">\(\exp\)</span> å’Œå¤šé¡¹å¼å¼€æ ¹ç­‰æ“ä½œæ—¶å…¶å°±ä¼šå‘æŒ¥å¤§ä½œç”¨ã€‚</p>
<h2 id="å¤šé¡¹å¼å¯¹æŒ‡å¼€æ ¹">å¤šé¡¹å¼å¯¹æŒ‡å¼€æ ¹</h2>
<p>å»ºè®®å…ˆäº†è§£æ¸…æ¥šé«˜ä¸­æ•°å­¦å¿…ä¿® 1 ä¸­çš„å¯¹æ•°å‡½æ•°/æŒ‡æ•°å‡½æ•°/å¹‚å‡½æ•°ä»¥åŠä¸€äº›æœ€åŸºç¡€çš„å¾®ç§¯åˆ†çŸ¥è¯†ï¼ˆåŸºç¡€å¯¼æ•°å…¬å¼ï¼Œæ³°å‹’å±•å¼€ï¼‰</p>
<h3 id="å¤šé¡¹å¼-ln">å¤šé¡¹å¼ ln</h3>
<h4 id="é—®é¢˜æè¿°-1">é—®é¢˜æè¿°</h4>
<p>ç»™å®š <span class="math inline">\(A(x)\)</span>ï¼Œæ±‚ <span class="math inline">\(B(x)\)</span> æ»¡è¶³ <span class="math inline">\(B(x)\equiv \ln A(x) \pmod{x^n}\)</span>ã€‚</p>
<p>ç”±ä¸Šæ–‡å¤šé¡¹å¼å¯¹æ•°çš„å®šä¹‰ï¼Œ<strong>å¤šé¡¹å¼çš„å¯¹æ•°ä»…åœ¨å¸¸æ•°é¡¹ä¸º <span class="math inline">\(1\)</span> æ—¶æ‰æœ‰æ„ä¹‰ã€‚</strong></p>
<h4 id="æ±‚æ³•-1">æ±‚æ³•</h4>
<p>ä¸ç®¡é‚£ä¹ˆå¤šäº†ï¼Œç›´æ¥æ±‚å¯¼å†ç§¯åˆ†ç§¯å›å»å°±å¯ä»¥äº†ï¼š</p>
<p><span class="math display">\[
\begin{aligned}
(\ln A(x))' &amp;= \frac{A'(x)}{A(x)}\\
\ln A(x) &amp;= \int \frac{A'(x)}{A(x)}\mathrm{d}x
\end{aligned}
\]</span></p>
<p>å‡åœ¨ <span class="math inline">\(\pmod{x^n}\)</span> æ„ä¹‰ä¸‹è¿›è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€æ±‚å¯¼ï¼Œæ±‚é€†ï¼Œä¹˜èµ·æ¥å†ç§¯ä¸ªåˆ†å°±å¯ä»¥äº†ã€‚</p>
<h4 id="å®ç°-2">å®ç°</h4>
<p>å°±ä¸€è¡Œï¼Œè¶…çº§çŸ­ã€‚</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb25-1"><a aria-hidden="true" href="#cb25-1"></a>Poly polyLn(<span class="at">const</span> Poly &amp;A) {</span>
<span id="cb25-2"><a aria-hidden="true" href="#cb25-2"></a>    <span class="cf">return</span> ints(deri(A) * polyInv(A));</span>
<span id="cb25-3"><a aria-hidden="true" href="#cb25-3"></a>}</span></code></pre></div>
<p><a href="https://www.luogu.com.cn/problem/P4725">æ´›è°· 4725</a> çš„å®ç°ï¼š</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb26-1"><a aria-hidden="true" href="#cb26-1"></a><span class="dt">int</span> n;</span>
<span id="cb26-2"><a aria-hidden="true" href="#cb26-2"></a>Poly f;</span>
<span id="cb26-3"><a aria-hidden="true" href="#cb26-3"></a></span>
<span id="cb26-4"><a aria-hidden="true" href="#cb26-4"></a><span class="dt">int</span> main() {</span>
<span id="cb26-5"><a aria-hidden="true" href="#cb26-5"></a>    read(n);</span>
<span id="cb26-6"><a aria-hidden="true" href="#cb26-6"></a>    lim = n; initInv();</span>
<span id="cb26-7"><a aria-hidden="true" href="#cb26-7"></a>    f.resize(n);</span>
<span id="cb26-8"><a aria-hidden="true" href="#cb26-8"></a>    FOR(i, <span class="dv">0</span>, n - <span class="dv">1</span>) read(f[i]);</span>
<span id="cb26-9"><a aria-hidden="true" href="#cb26-9"></a>    f = polyLn(f);</span>
<span id="cb26-10"><a aria-hidden="true" href="#cb26-10"></a>    print(f);</span>
<span id="cb26-11"><a aria-hidden="true" href="#cb26-11"></a>    <span class="cf">return</span> output(), <span class="dv">0</span>;</span>
<span id="cb26-12"><a aria-hidden="true" href="#cb26-12"></a>}</span></code></pre></div>
<h3 id="å¤šé¡¹å¼-exp">å¤šé¡¹å¼ exp</h3>
<h4 id="é—®é¢˜æè¿°-2">é—®é¢˜æè¿°</h4>
<p>ç»™å®šå¤šé¡¹å¼ <span class="math inline">\(A(x)\)</span>ï¼Œæ±‚ <span class="math inline">\(B(x)\)</span> æ»¡è¶³ <span class="math inline">\(B(x)\equiv \exp A(x)\pmod{x^n}\)</span>ã€‚</p>
<p><strong>å¤šé¡¹å¼çš„æŒ‡æ•°å‡½æ•°ä»…åœ¨å¸¸æ•°é¡¹ä¸º <span class="math inline">\(0\)</span> æ—¶æ‰æœ‰æ„ä¹‰ï¼Œ</strong>å¦åˆ™å¸¸æ•°é¡¹å°†ä¸æ”¶æ•›ã€‚</p>
<h4 id="æ±‚æ³•-1-ç‰›é¡¿è¿­ä»£">æ±‚æ³• 1 ç‰›é¡¿è¿­ä»£</h4>
<p>è€ƒè™‘ä½¿ç”¨ç‰›é¡¿è¿­ä»£ã€‚ <span class="math display">\[
\begin{aligned}B(x)&amp;\equiv \exp A(x)&amp;\pmod{x^n}\\\ln B(x) - A(x)&amp;\equiv 0&amp;\pmod{x^n}\\\end{aligned}
\]</span> ç°åœ¨æˆ‘ä»¬æŠŠ <span class="math inline">\(A(x)\)</span> çœ‹æˆä¸€ä¸ªå¸¸æ•°ï¼Œ<span class="math inline">\(B(x)\)</span> çœ‹æˆä¸€ä¸ªå˜é‡ï¼Œåˆ™æˆ‘ä»¬å°±æ˜¯è¦æ±‚è¿™ä¸ªå‹¾å…«ä¸œè¥¿çš„é›¶ç‚¹ã€‚ä»¤ <span class="math inline">\(G(B(x)) \equiv \ln B(x) - A(x)\pmod{x^n}\)</span>ï¼Œè¿™ä¸ªä¸œè¥¿æ±‚å¯¼æ˜¯ <span class="math inline">\(G'(B(x))\equiv \dfrac{1}{B(x)}\)</span>ã€‚</p>
<p>å¥—ç”¨ä¸€ä¸‹ä¸Šé¢çš„ç‰›è¿­å¼å­ï¼Œå‡è®¾æˆ‘ä»¬å·²ç»æå®šäº†æ¨¡ <span class="math inline">\(x^{\left\lceil\frac n 2\right\rceil}\)</span> æ„ä¹‰ä¸‹çš„è§£ <span class="math inline">\(B_0(x)\)</span>ï¼Œè¦æ±‚æ¨¡ <span class="math inline">\(x^n\)</span> æ„ä¹‰ä¸‹çš„ <span class="math inline">\(B(x)\)</span>ã€‚ç„¶åå°±æœ‰äº† <span class="math display">\[
\begin{aligned}B(x) &amp;\equiv B_0(x) - \frac{G(B_0(x))}{G'(B_0(x))}\\&amp;\equiv B_0(x) - (\ln B_0(x) - A(x))B_0(x)\\&amp;\equiv B_0(x)(1 - \ln B_0(x) + A(x))\pmod{x^n}\end{aligned}
\]</span> è¿™æ ·å­æˆ‘ä»¬å°±æˆåŠŸçš„æŠŠé€’æ¨å¼å†™å‡ºæ¥äº†ã€‚</p>
<h4 id="å®ç°-1-1">å®ç° 1</h4>
<p>è¿™ç§é€’å½’å†™èµ·æ–¹ä¾¿çš„å°±å†™é€’å½’å¥½ä¸€ç‚¹ã€‚</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb27-1"><a aria-hidden="true" href="#cb27-1"></a><span class="dt">void</span> polyExp(<span class="at">const</span> Poly &amp;A, Poly &amp;B, <span class="dt">int</span> n) {</span>
<span id="cb27-2"><a aria-hidden="true" href="#cb27-2"></a>    <span class="cf">if</span> (!n) <span class="cf">return</span>;</span>
<span id="cb27-3"><a aria-hidden="true" href="#cb27-3"></a>    <span class="cf">if</span> (n == <span class="dv">1</span>) B.push_back(<span class="dv">1</span>);</span>
<span id="cb27-4"><a aria-hidden="true" href="#cb27-4"></a>    <span class="cf">else</span> <span class="cf">if</span> (n &amp; <span class="dv">1</span>) {</span>
<span id="cb27-5"><a aria-hidden="true" href="#cb27-5"></a>        polyExp(A, B, n - <span class="dv">1</span>); n -= <span class="dv">2</span>;</span>
<span id="cb27-6"><a aria-hidden="true" href="#cb27-6"></a>        <span class="dt">int</span> sav = <span class="dv">0</span>;</span>
<span id="cb27-7"><a aria-hidden="true" href="#cb27-7"></a>        FOR(i, <span class="dv">0</span>, n) sav = (sav + <span class="dv">1</span><span class="bu">ll</span> * (i + <span class="dv">1</span>) * A[i + <span class="dv">1</span>] % mod * B[n - i]) % mod;</span>
<span id="cb27-8"><a aria-hidden="true" href="#cb27-8"></a>        B.push_back(<span class="dv">1</span><span class="bu">ll</span> * sav * inv[n + <span class="dv">1</span>] % mod);</span>
<span id="cb27-9"><a aria-hidden="true" href="#cb27-9"></a>    } <span class="cf">else</span> {</span>
<span id="cb27-10"><a aria-hidden="true" href="#cb27-10"></a>        polyExp(A, B, n / <span class="dv">2</span>);</span>
<span id="cb27-11"><a aria-hidden="true" href="#cb27-11"></a>        Poly lnB = B;</span>
<span id="cb27-12"><a aria-hidden="true" href="#cb27-12"></a>        lnB.resize(n); lnB = polyLn(lnB);</span>
<span id="cb27-13"><a aria-hidden="true" href="#cb27-13"></a>        VEC(i, lnB) lnB[i] = (mod + A[i] - lnB[i]) % mod;</span>
<span id="cb27-14"><a aria-hidden="true" href="#cb27-14"></a>        ++lnB[<span class="dv">0</span>];</span>
<span id="cb27-15"><a aria-hidden="true" href="#cb27-15"></a>        B = B * lnB;</span>
<span id="cb27-16"><a aria-hidden="true" href="#cb27-16"></a>        B.resize(n);</span>
<span id="cb27-17"><a aria-hidden="true" href="#cb27-17"></a>    }</span>
<span id="cb27-18"><a aria-hidden="true" href="#cb27-18"></a>    <span class="cf">return</span>;</span>
<span id="cb27-19"><a aria-hidden="true" href="#cb27-19"></a>}</span>
<span id="cb27-20"><a aria-hidden="true" href="#cb27-20"></a></span>
<span id="cb27-21"><a aria-hidden="true" href="#cb27-21"></a>Poly polyExp(<span class="at">const</span> Poly &amp;f) {</span>
<span id="cb27-22"><a aria-hidden="true" href="#cb27-22"></a>    Poly ret;</span>
<span id="cb27-23"><a aria-hidden="true" href="#cb27-23"></a>    polyExp(f, ret, f.size());</span>
<span id="cb27-24"><a aria-hidden="true" href="#cb27-24"></a>    <span class="cf">return</span> ret;</span>
<span id="cb27-25"><a aria-hidden="true" href="#cb27-25"></a>}</span></code></pre></div>
<p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªå¤šé¡¹å¼ <span class="math inline">\(\exp\)</span> çš„å¸¸æ•°è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œéœ€è¦å°½é‡å‡å°‘å…¶è°ƒç”¨ã€‚</p>
<h4 id="æ±‚æ³•-2-åˆ†æ²»-fft">æ±‚æ³• 2 åˆ†æ²» FFT</h4>
<p>åˆ†æ²» FFT å¯ä»¥åœ¨ <span class="math inline">\(O(n\log^2n)\)</span> çš„å¤æ‚åº¦ä¸‹ä»¥æä¼˜çš„å¸¸æ•°ï¼ˆæ¯”ä¸€ä¸ª <span class="math inline">\(\log\)</span> å¿«ï¼‰æ±‚å‡ºç»“æœã€‚æš‚æ—¶ä¸æƒ³å†™ï¼Œå’•å’•å’•ã€‚</p>
<h3 id="å¤šé¡¹å¼å¼€æ ¹">å¤šé¡¹å¼å¼€æ ¹</h3>
<h4 id="é—®é¢˜æè¿°-3">é—®é¢˜æè¿°</h4>
<p>ç»™å®šä¸€ä¸ªå¤šé¡¹å¼ <span class="math inline">\(A(x)\)</span>ï¼Œæ±‚ <span class="math inline">\(B(x)\)</span> ä½¿å¾— <span class="math inline">\(B^2(x)\equiv A(x)\pmod{x^n}\)</span></p>
<h4 id="æ±‚è§£">æ±‚è§£</h4>
<p>è€ƒè™‘ä½¿ç”¨ç‰›é¡¿è¿­ä»£ï¼Œä»¤ <span class="math inline">\(f(B(x)) = B^2(x) - A(x)\pmod{x^n}\)</span>ã€‚åˆ™ <span class="math inline">\(f'(B(x)) = 2B(x)\)</span>ï¼Œå¥—ç‰›è¿­å¼å­ï¼š <span class="math display">\[
\begin{aligned}B(x) &amp;\equiv B_0(x) - \frac{f(B_0(x))}{f'(B_0(x))}\\&amp;\equiv B_0(x) - \frac{B_0^2(x) - A(x)}{2B_0(x)}\\&amp;\equiv \frac{B_0^2(x) + A(x)}{2B_0(x)}\end{aligned}
\]</span> æ—¶é—´å¤æ‚åº¦ <span class="math inline">\(O(n\log n)\)</span>ã€‚</p>
<p>æ³¨æ„ä¸€ä¸‹å¦‚æœå¸¸æ•°é¡¹ä¸ä¸º <span class="math inline">\(0\)</span> çš„è¯æ˜¯éœ€è¦äºŒæ¬¡å‰©ä½™æ¥æ±‚å‡ºç­”æ¡ˆçš„å¸¸æ•°é¡¹çš„ã€‚</p>
<h4 id="å®ç°-3">å®ç°</h4>
<div class="sourceCode" id="cb28"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb28-1"><a aria-hidden="true" href="#cb28-1"></a><span class="dt">void</span> polySqrt(<span class="at">const</span> Poly &amp;A, Poly &amp;B, <span class="dt">int</span> m) {</span>
<span id="cb28-2"><a aria-hidden="true" href="#cb28-2"></a>    <span class="cf">if</span> (m == <span class="dv">1</span>) {</span>
<span id="cb28-3"><a aria-hidden="true" href="#cb28-3"></a>        B.push_back(QuadResidue::cipolla(A[<span class="dv">0</span>]));</span>
<span id="cb28-4"><a aria-hidden="true" href="#cb28-4"></a>        <span class="cf">return</span>;</span>
<span id="cb28-5"><a aria-hidden="true" href="#cb28-5"></a>    }</span>
<span id="cb28-6"><a aria-hidden="true" href="#cb28-6"></a>    polySqrt(A, B, (m + <span class="dv">1</span>) &gt;&gt; <span class="dv">1</span>);</span>
<span id="cb28-7"><a aria-hidden="true" href="#cb28-7"></a>    B.resize(m);</span>
<span id="cb28-8"><a aria-hidden="true" href="#cb28-8"></a>    Poly invB = polyInv(<span class="dv">2</span> * B), sA(A.begin(), A.begin() + m);</span>
<span id="cb28-9"><a aria-hidden="true" href="#cb28-9"></a>    B = qPow(<span class="dv">2</span>) * B + invB * sA;</span>
<span id="cb28-10"><a aria-hidden="true" href="#cb28-10"></a>    <span class="cf">return</span>;</span>
<span id="cb28-11"><a aria-hidden="true" href="#cb28-11"></a>}</span>
<span id="cb28-12"><a aria-hidden="true" href="#cb28-12"></a></span>
<span id="cb28-13"><a aria-hidden="true" href="#cb28-13"></a>Poly polySqrt(<span class="at">const</span> Poly &amp;A) {</span>
<span id="cb28-14"><a aria-hidden="true" href="#cb28-14"></a>    Poly C; polySqrt(A, C, A.size());</span>
<span id="cb28-15"><a aria-hidden="true" href="#cb28-15"></a>    <span class="cf">return</span> C;</span>
<span id="cb28-16"><a aria-hidden="true" href="#cb28-16"></a>}</span></code></pre></div>
<h3 id="åº”ç”¨-1-å¤šé¡¹å¼å¿«é€Ÿå¹‚">åº”ç”¨ 1 å¤šé¡¹å¼å¿«é€Ÿå¹‚</h3>
<p>åˆ†ä¸¤ç§æƒ…å†µã€‚ç¬¬ä¸€ç§ <span class="math inline">\([x^0]f(x) = 1\)</span>ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¸éš¾å‘ç° <span class="math display">\[
\begin{aligned}g(x) &amp;\equiv f^k(x)\\\ln g(x) &amp;\equiv k\ln f(x)\\g(x) &amp;\equiv \exp(k\ln f(x))\pmod{x^n}\end{aligned}
\]</span> ç„¶åå°±ä¸€ä¸ª <span class="math inline">\(\ln\)</span>ï¼Œä¹˜ä¸Š <span class="math inline">\(k\)</span>ï¼Œå† <span class="math inline">\(\exp\)</span> ä¸€ä¸‹ï¼Œè¿™é¢˜å°±åšå®Œäº†ã€‚</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb29-1"><a aria-hidden="true" href="#cb29-1"></a>Poly f;</span>
<span id="cb29-2"><a aria-hidden="true" href="#cb29-2"></a><span class="dt">int</span> n, k;</span>
<span id="cb29-3"><a aria-hidden="true" href="#cb29-3"></a><span class="dt">char</span> s[maxn];</span>
<span id="cb29-4"><a aria-hidden="true" href="#cb29-4"></a></span>
<span id="cb29-5"><a aria-hidden="true" href="#cb29-5"></a><span class="dt">int</span> main() {</span>
<span id="cb29-6"><a aria-hidden="true" href="#cb29-6"></a>    read(n), read(s); f.resize(lim = n);</span>
<span id="cb29-7"><a aria-hidden="true" href="#cb29-7"></a>    <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; s[i]; ++i) k = (<span class="dv">10</span><span class="bu">ll</span> * k + s[i] - <span class="ch">'0'</span>) % mod;</span>
<span id="cb29-8"><a aria-hidden="true" href="#cb29-8"></a>    FOR(i, <span class="dv">0</span>, n - <span class="dv">1</span>) read(f[i]);</span>
<span id="cb29-9"><a aria-hidden="true" href="#cb29-9"></a>    initInv();</span>
<span id="cb29-10"><a aria-hidden="true" href="#cb29-10"></a>    f = polyExp(k * polyLn(f));</span>
<span id="cb29-11"><a aria-hidden="true" href="#cb29-11"></a>    print(f);</span>
<span id="cb29-12"><a aria-hidden="true" href="#cb29-12"></a>    <span class="cf">return</span> output(), <span class="dv">0</span>;</span>
<span id="cb29-13"><a aria-hidden="true" href="#cb29-13"></a>}</span></code></pre></div>
<p>ç¬¬äºŒç§æƒ…å†µ <span class="math inline">\([x^0]f(x) \not= 1\)</span>ï¼Œæ­¤æ—¶æˆ‘ä»¬åº”è¯¥åšçš„ï¼Œå°±æ˜¯åˆ›é€ æ¡ä»¶å¼ºä¸Šã€‚</p>
<p>æ€ä¹ˆä¸Šå‘¢ï¼Ÿå½“ <span class="math inline">\([x^0]f(x)\not= 0\)</span> æ—¶ï¼Œæˆ‘ä»¬å°±ç›´æ¥ï¼š <span class="math display">\[
f^k(x)\equiv \left(\frac{f(x)}{[x^0]f(x)} \right)^k\times \left([x^0]f(x)\right)^k
\]</span> å½“ <span class="math inline">\([x^0]f(x) = 0\)</span> æ—¶ï¼Œæˆ‘ä»¬å°±æŠŠå¤šé¡¹å¼å¹³ç§»ä¸€ä¸‹ï¼Œç„¶åå¼ºè¡ŒæŒ‰ä¸Šé¢ä¸Šï¼Œæœ€åå¹³ç§»å›å»å°±å¯ä»¥äº†ã€‚</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb30-1"><a aria-hidden="true" href="#cb30-1"></a>Poly f;</span>
<span id="cb30-2"><a aria-hidden="true" href="#cb30-2"></a><span class="dt">int</span> n, k, k2;</span>
<span id="cb30-3"><a aria-hidden="true" href="#cb30-3"></a><span class="dt">char</span> s[maxn];</span>
<span id="cb30-4"><a aria-hidden="true" href="#cb30-4"></a></span>
<span id="cb30-5"><a aria-hidden="true" href="#cb30-5"></a><span class="dt">int</span> main() {</span>
<span id="cb30-6"><a aria-hidden="true" href="#cb30-6"></a>    read(n), read(s);</span>
<span id="cb30-7"><a aria-hidden="true" href="#cb30-7"></a>    f.resize(n);</span>
<span id="cb30-8"><a aria-hidden="true" href="#cb30-8"></a>    FOR(i, <span class="dv">0</span>, n - <span class="dv">1</span>) read(f[i]);</span>
<span id="cb30-9"><a aria-hidden="true" href="#cb30-9"></a></span>
<span id="cb30-10"><a aria-hidden="true" href="#cb30-10"></a>    <span class="dt">int</span> p = <span class="dv">0</span>;</span>
<span id="cb30-11"><a aria-hidden="true" href="#cb30-11"></a>    <span class="cf">while</span> (f[p] == <span class="dv">0</span> &amp;&amp; p &lt; n) ++p;</span>
<span id="cb30-12"><a aria-hidden="true" href="#cb30-12"></a></span>
<span id="cb30-13"><a aria-hidden="true" href="#cb30-13"></a>    <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; s[i]; ++i) {</span>
<span id="cb30-14"><a aria-hidden="true" href="#cb30-14"></a>        k = (<span class="dv">10</span><span class="bu">ll</span> * k + s[i] - <span class="ch">'0'</span>) % mod;</span>
<span id="cb30-15"><a aria-hidden="true" href="#cb30-15"></a>        k2 = (<span class="dv">10</span><span class="bu">ll</span> * k2 + s[i] - <span class="ch">'0'</span>) % (mod - <span class="dv">1</span>);</span>
<span id="cb30-16"><a aria-hidden="true" href="#cb30-16"></a>        <span class="cf">if</span> (<span class="dv">1</span><span class="bu">ll</span> * k * p &gt; n) {</span>
<span id="cb30-17"><a aria-hidden="true" href="#cb30-17"></a>            FOR(i, <span class="dv">0</span>, n - <span class="dv">1</span>) putchar(<span class="ch">'0'</span>), putchar(<span class="ch">' '</span>);</span>
<span id="cb30-18"><a aria-hidden="true" href="#cb30-18"></a>            <span class="cf">return</span> output(), <span class="dv">0</span>;</span>
<span id="cb30-19"><a aria-hidden="true" href="#cb30-19"></a>        }</span>
<span id="cb30-20"><a aria-hidden="true" href="#cb30-20"></a>    }</span>
<span id="cb30-21"><a aria-hidden="true" href="#cb30-21"></a></span>
<span id="cb30-22"><a aria-hidden="true" href="#cb30-22"></a>    lim = n = n - p * k, initInv();</span>
<span id="cb30-23"><a aria-hidden="true" href="#cb30-23"></a></span>
<span id="cb30-24"><a aria-hidden="true" href="#cb30-24"></a>    <span class="dt">int</span> u = qPow(f[p], MOD - <span class="dv">2</span>), v = qPow(f[p], k2);</span>
<span id="cb30-25"><a aria-hidden="true" href="#cb30-25"></a>    FOR(i, <span class="dv">0</span>, n - <span class="dv">1</span>) f[i] = <span class="dv">1</span><span class="bu">ll</span> * f[i + p] * u % mod;</span>
<span id="cb30-26"><a aria-hidden="true" href="#cb30-26"></a>    clr(&amp;f[<span class="dv">0</span>] + n, p * k);</span>
<span id="cb30-27"><a aria-hidden="true" href="#cb30-27"></a>    f = v * polyExp(k * polyLn(f));</span>
<span id="cb30-28"><a aria-hidden="true" href="#cb30-28"></a>    FOR(i, <span class="dv">0</span>, p * k - <span class="dv">1</span>) putchar(<span class="ch">'0'</span>), putchar(<span class="ch">' '</span>);</span>
<span id="cb30-29"><a aria-hidden="true" href="#cb30-29"></a>    print(f);</span>
<span id="cb30-30"><a aria-hidden="true" href="#cb30-30"></a>    <span class="cf">return</span> output(), <span class="dv">0</span>;</span>
<span id="cb30-31"><a aria-hidden="true" href="#cb30-31"></a>}</span></code></pre></div>
<h3 id="åº”ç”¨-2-ln-çš„ç»„åˆæ„ä¹‰">åº”ç”¨ 2 ln çš„ç»„åˆæ„ä¹‰</h3>
<p>çœ‹ä¾‹é¢˜ï¼š<a href="https://www.luogu.com.cn/problem/P4841">æ´›è°· P4841 [é›†è®­é˜Ÿä½œä¸š2013]åŸå¸‚è§„åˆ’</a></p>
<p>æ±‚ <span class="math inline">\(n\)</span> ä¸ªç‚¹çš„æœ‰æ ‡å·æ— å‘è¿é€šå›¾çš„ä¸ªæ•° <span class="math inline">\(\bmod 1004535809\)</span> çš„å€¼ã€‚</p>
<p>å¯ä»¥å…ˆä¸è€ƒè™‘æ ‡å·ï¼Œæœ€åå¾—åˆ°çš„ç­”æ¡ˆä¹˜ä»¥ <span class="math inline">\(n!\)</span> å°±å¯ä»¥äº†ã€‚</p>
<p>ç„¶åä¸è€ƒè™‘è”é€šçš„è¯ï¼Œ<span class="math inline">\(g_n = 2^{\binom n 2}\)</span>ï¼Œå³è€ƒè™‘æ¯æ¡è¾¹é€‰è¿˜æ˜¯ä¸é€‰ï¼Œè®¾è”é€šçš„æƒ…å†µçš„æ–¹æ¡ˆæ•°ä¸º <span class="math inline">\(f_n\)</span>ã€‚</p>
<p>æ„é€ ä¸€ä¸‹è”é€šçš„ EGFï¼š<span class="math inline">\(F(x) = \displaystyle\sum_{i = 0}^\infty f_i\frac{x^i}{i!}\)</span>ï¼Œä¸è¿é€šçš„ç±»ä¼¼ï¼š<span class="math inline">\(G(x) = \displaystyle\sum_{i = 0}^\infty g_i\frac{x^i}{i!}\)</span>ã€‚æ ¹æ® EGF çš„æ€§è´¨å‘ç° <span class="math inline">\(G(x) = \mathrm e^{F(x)}\)</span>ã€‚</p>
<p>æ‰€ä»¥æ±‚ä¸ª <span class="math inline">\(\ln\)</span> å°±å¯ä»¥äº†ã€‚</p>
<p>é…åˆå°è£…è¿‡çš„ <span class="math inline">\(\ln\)</span> æ˜¯è¿™æ ·çš„ï¼šï¼ˆupdï¼šä¸‹é¢çš„ä»£ç æœªæ›´æ–°æ–°çš„å°è£…ï¼Œè¯·çœ‹å‡†äº†é£Ÿç”¨ï¼‰</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb31-1"><a aria-hidden="true" href="#cb31-1"></a><span class="dt">void</span> polyln(<span class="dt">int</span> *f, <span class="dt">int</span> m)</span>
<span id="cb31-2"><a aria-hidden="true" href="#cb31-2"></a>{</span>
<span id="cb31-3"><a aria-hidden="true" href="#cb31-3"></a>    <span class="at">static</span> <span class="dt">int</span> invf[maxn &lt;&lt; <span class="dv">1</span>];</span>
<span id="cb31-4"><a aria-hidden="true" href="#cb31-4"></a>    <span class="dt">int</span> lim = <span class="dv">1</span>;</span>
<span id="cb31-5"><a aria-hidden="true" href="#cb31-5"></a>    <span class="cf">while</span> (lim &lt; m &lt;&lt; <span class="dv">1</span>) lim &lt;&lt;= <span class="dv">1</span>;</span>
<span id="cb31-6"><a aria-hidden="true" href="#cb31-6"></a>    initinv(lim);</span>
<span id="cb31-7"><a aria-hidden="true" href="#cb31-7"></a>    cpy(invf, f, m);</span>
<span id="cb31-8"><a aria-hidden="true" href="#cb31-8"></a>    invpoly(invf, m);</span>
<span id="cb31-9"><a aria-hidden="true" href="#cb31-9"></a>    derivate(f, m);</span>
<span id="cb31-10"><a aria-hidden="true" href="#cb31-10"></a>    NTT(f, lim, <span class="dv">1</span>), NTT(invf, lim, <span class="dv">1</span>);</span>
<span id="cb31-11"><a aria-hidden="true" href="#cb31-11"></a>    FOR(i, <span class="dv">0</span>, lim - <span class="dv">1</span>)</span>
<span id="cb31-12"><a aria-hidden="true" href="#cb31-12"></a>        f[i] = <span class="dv">1</span><span class="bu">ll</span> * f[i] * invf[i] % mod;</span>
<span id="cb31-13"><a aria-hidden="true" href="#cb31-13"></a>    NTT(f, lim, <span class="dv">0</span>);</span>
<span id="cb31-14"><a aria-hidden="true" href="#cb31-14"></a>    intergrate(f, m);</span>
<span id="cb31-15"><a aria-hidden="true" href="#cb31-15"></a>    clr(invf, lim);</span>
<span id="cb31-16"><a aria-hidden="true" href="#cb31-16"></a>    clr(f + m, lim - m);</span>
<span id="cb31-17"><a aria-hidden="true" href="#cb31-17"></a>}</span>
<span id="cb31-18"><a aria-hidden="true" href="#cb31-18"></a></span>
<span id="cb31-19"><a aria-hidden="true" href="#cb31-19"></a><span class="dt">int</span> f[maxn &lt;&lt; <span class="dv">1</span>], invf[maxn &lt;&lt; <span class="dv">1</span>];</span>
<span id="cb31-20"><a aria-hidden="true" href="#cb31-20"></a><span class="dt">int</span> fact[maxn &lt;&lt; <span class="dv">1</span>];</span>
<span id="cb31-21"><a aria-hidden="true" href="#cb31-21"></a></span>
<span id="cb31-22"><a aria-hidden="true" href="#cb31-22"></a><span class="dt">int</span> n;</span>
<span id="cb31-23"><a aria-hidden="true" href="#cb31-23"></a></span>
<span id="cb31-24"><a aria-hidden="true" href="#cb31-24"></a><span class="dt">int</span> main()</span>
<span id="cb31-25"><a aria-hidden="true" href="#cb31-25"></a>{</span>
<span id="cb31-26"><a aria-hidden="true" href="#cb31-26"></a>    n = readInt();</span>
<span id="cb31-27"><a aria-hidden="true" href="#cb31-27"></a>    fact[<span class="dv">0</span>] = <span class="dv">1</span>, f[<span class="dv">0</span>] = <span class="dv">1</span>;</span>
<span id="cb31-28"><a aria-hidden="true" href="#cb31-28"></a>    FOR(i, <span class="dv">1</span>, n)</span>
<span id="cb31-29"><a aria-hidden="true" href="#cb31-29"></a>        fact[i] = <span class="dv">1</span><span class="bu">ll</span> * fact[i - <span class="dv">1</span>] * i % mod,</span>
<span id="cb31-30"><a aria-hidden="true" href="#cb31-30"></a>        f[i] = <span class="dv">1</span><span class="bu">ll</span> * qpow(<span class="dv">2</span>, <span class="dv">1</span><span class="bu">ll</span> * i * (i - <span class="dv">1</span><span class="bu">ll</span>) &gt;&gt; <span class="dv">1</span>) % mod * qpow(fact[i]) % mod;</span>
<span id="cb31-31"><a aria-hidden="true" href="#cb31-31"></a>    polyln(f, n + <span class="dv">1</span>);</span>
<span id="cb31-32"><a aria-hidden="true" href="#cb31-32"></a>    printf(<span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span>, <span class="dv">1</span><span class="bu">ll</span> * f[n] * fact[n] % mod);</span>
<span id="cb31-33"><a aria-hidden="true" href="#cb31-33"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb31-34"><a aria-hidden="true" href="#cb31-34"></a>}</span></code></pre></div>
<h3 id="åº”ç”¨-3-é…åˆç”Ÿæˆå‡½æ•°æ¨å¼å­">åº”ç”¨ 3 é…åˆç”Ÿæˆå‡½æ•°æ¨å¼å­</h3>
<p>è¯·çœ‹ <a href="https://www.luogu.com.cn/problem/P4389">P4389 ä»˜å…¬ä¸»çš„èƒŒåŒ…</a>ã€‚</p>
<p>è®¾å®¹é‡ä¸º <span class="math inline">\(i\)</span> çš„ç‰©å“çš„ä¸ªæ•°ä¸º <span class="math inline">\(k_i\)</span> ä¸ªï¼Œåˆ™å…¶ç”Ÿæˆå‡½æ•°ä¸º <span class="math display">\[
A_i(x) =  \left(\sum_{j = 0}^{+\infty}x^{ji}\right)^{k_i} =\left(\frac{1}{1 - x^i}\right)^{k_i}
\]</span> æ‰€ä»¥æˆ‘ä»¬è¦æ±‚çš„å°±æ˜¯ <span class="math display">\[
f(x) = \prod_{i = 1}^n A_i(x)
\]</span> çš„æ¯é¡¹ç³»æ•°ã€‚æš´åŠ›ä¹˜èµ·æ¥æ˜¯ <span class="math inline">\(O(nm\log n)\)</span> çš„ï¼Œæ— æ³•é€šè¿‡æœ¬é¢˜ã€‚</p>
<p>æˆ‘ä»¬è¯•ä¸€ä¸‹æ±‚ä¸ª <span class="math inline">\(\ln\)</span>ï¼Œåˆ™æˆ‘ä»¬æœ‰ <span class="math display">\[
\begin{aligned}
f(x) &amp;= \prod_{i = 1}^nA_i(x)\\
\ln f(x) &amp;= \sum_{i = 1}^n\ln A_i(x)\\
\ln f(x) &amp;= \sum_{i = 1}^nk_i(\ln 1 - \ln(1 - x^i))\\
\ln f(x) &amp;= -\sum_{i = 1}^nk_i\ln(1 - x^i)
\end{aligned}
\]</span> ç„¶åæˆ‘ä»¬æ³¨æ„åˆ°è¿™ä¸ª <span class="math inline">\(\ln\)</span> çš„å½¢å¼ï¼Œå›é¡¾ä¸€ä¸‹ä¸Šé¢è®²è¿‡çš„ä¸€ä¸ªå¼å­ï¼š <span class="math display">\[
\ln(1 - x) = -\sum_{m = 1}^{+\infty}\frac{x^{m}}{m}
\]</span> æ‰€ä»¥ <span class="math display">\[
\begin{aligned}
\ln f(x) &amp;= \sum_{i = 1}^nk_i\sum_{j = 1}^{+\infty}\frac{x^{ij}}{j}
\end{aligned}
\]</span> ç„¶åé—®é¢˜å°±è½¬åŒ–ä¸ºäº†æ±‚ <span class="math display">\[
\exp\left(\sum_{i = 1}^nk_i\sum_{j = 1}^{+\infty}\frac{x^{ij}}{j} \right)
\]</span> é‡Œé¢çš„ä¸œè¥¿å¯ä»¥ <span class="math inline">\(O(m\log m)\)</span> ç®—ï¼Œæ€»æ—¶é—´å¤æ‚åº¦ <span class="math inline">\(O(m\log m)\)</span>ã€‚</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb32-1"><a aria-hidden="true" href="#cb32-1"></a><span class="dt">int</span> n, m, cnt[maxn];</span>
<span id="cb32-2"><a aria-hidden="true" href="#cb32-2"></a>Poly f;</span>
<span id="cb32-3"><a aria-hidden="true" href="#cb32-3"></a></span>
<span id="cb32-4"><a aria-hidden="true" href="#cb32-4"></a><span class="dt">int</span> main() {</span>
<span id="cb32-5"><a aria-hidden="true" href="#cb32-5"></a>    read(n), read(m);</span>
<span id="cb32-6"><a aria-hidden="true" href="#cb32-6"></a>    f.resize(lim = m + <span class="dv">1</span>);</span>
<span id="cb32-7"><a aria-hidden="true" href="#cb32-7"></a>    initInv();</span>
<span id="cb32-8"><a aria-hidden="true" href="#cb32-8"></a>    FOR(i, <span class="dv">1</span>, n) {</span>
<span id="cb32-9"><a aria-hidden="true" href="#cb32-9"></a>        <span class="dt">int</span> tmp; read(tmp);</span>
<span id="cb32-10"><a aria-hidden="true" href="#cb32-10"></a>        ++cnt[tmp];</span>
<span id="cb32-11"><a aria-hidden="true" href="#cb32-11"></a>    }</span>
<span id="cb32-12"><a aria-hidden="true" href="#cb32-12"></a>    FOR(i, <span class="dv">1</span>, m) {</span>
<span id="cb32-13"><a aria-hidden="true" href="#cb32-13"></a>        <span class="cf">if</span> (cnt[i]) {</span>
<span id="cb32-14"><a aria-hidden="true" href="#cb32-14"></a>            <span class="cf">for</span> (<span class="dt">int</span> j = i; j &lt;= m; j += i) {</span>
<span id="cb32-15"><a aria-hidden="true" href="#cb32-15"></a>                f[j] += <span class="dv">1</span><span class="bu">ll</span> * cnt[i] * inv[j / i] % mod;</span>
<span id="cb32-16"><a aria-hidden="true" href="#cb32-16"></a>                <span class="cf">if</span> (f[j] &gt; mod) f[j] -= mod;</span>
<span id="cb32-17"><a aria-hidden="true" href="#cb32-17"></a>            }</span>
<span id="cb32-18"><a aria-hidden="true" href="#cb32-18"></a>        }</span>
<span id="cb32-19"><a aria-hidden="true" href="#cb32-19"></a>    }</span>
<span id="cb32-20"><a aria-hidden="true" href="#cb32-20"></a>    f = polyExp(f);</span>
<span id="cb32-21"><a aria-hidden="true" href="#cb32-21"></a>    FOR(i, <span class="dv">1</span>, m) print(f[i]), putchar(<span class="ch">'</span><span class="sc">\n</span><span class="ch">'</span>);</span>
<span id="cb32-22"><a aria-hidden="true" href="#cb32-22"></a>    <span class="cf">return</span> output(), <span class="dv">0</span>;</span>
<span id="cb32-23"><a aria-hidden="true" href="#cb32-23"></a>}</span></code></pre></div>
<h2 id="å¤šé¡¹å¼å¸¦ä½™é™¤æ³•">å¤šé¡¹å¼å¸¦ä½™é™¤æ³•</h2>
<h3 id="é—®é¢˜æè¿°-4">é—®é¢˜æè¿°</h3>
<p>ç»™å®šå¤šé¡¹å¼ <span class="math inline">\(f(x)\)</span> å’Œ <span class="math inline">\(g(x)\)</span>ã€‚æ±‚ <span class="math inline">\(f(x)\)</span> é™¤ä»¥ <span class="math inline">\(g(x)\)</span> çš„å•† <span class="math inline">\(Q(x)\)</span> å’Œä½™æ•° <span class="math inline">\(R(x)\)</span>ã€‚</p>
<p>è‹¥ä»¤ <span class="math inline">\(n = \deg f\)</span>ï¼Œ<span class="math inline">\(m = \deg g\)</span>ï¼Œåˆ™è¦æ±‚æ»¡è¶³ <span class="math inline">\(\deg Q = n - m\)</span>ï¼Œ<span class="math inline">\(\deg R &lt; m\)</span>ã€‚</p>
<h3 id="é—®é¢˜æ±‚è§£">é—®é¢˜æ±‚è§£</h3>
<p>æœ€å…³é”®çš„é—®é¢˜å°±æ˜¯ <span class="math inline">\(R(x)\)</span>ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æŠŠ <span class="math inline">\(R(x)\)</span> çš„å½±å“æ¶ˆå»ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥æ±‚é€†æ¥æ±‚å‡º <span class="math inline">\(Q(x)\)</span>ã€‚</p>
<p>ä»¤ <span class="math inline">\(n = \deg f\)</span>ï¼Œ<span class="math inline">\(m = \deg g\)</span>ã€‚ä¸»è¦æ€æƒ³æ˜¯æ„é€  <span class="math display">\[
f^R(x) = x^nf\left(\frac1x\right)
\]</span> ç„¶åä¸éš¾å‘ç°è¿™ä¸ªä¸œè¥¿çš„å®è´¨å°±æ˜¯åè½¬ <span class="math inline">\(f(x)\)</span> çš„ç³»æ•°ã€‚</p>
<p>å°† <span class="math inline">\(f(x) = Q(x)g(x) + R(x)\)</span> ä¸­çš„ <span class="math inline">\(x\)</span> æ¢æˆ <span class="math inline">\(\dfrac 1x\)</span> è¿›è¡ŒåŒ–ç®€ï¼š <span class="math display">\[
\begin{aligned}f\left(\frac1x\right) &amp;= Q\left(\frac1x\right)g\left(\frac1x\right) + R\left(\frac1x\right)\\x^nf\left(\frac1x\right) &amp;= x^{n - m}Q\left(\frac1x\right)x^mg\left(\frac1x\right) + x^{n - m + 1}x^{m - 1}R\left(\frac1x\right)\\f^R(x)&amp;=Q^R(x)g^R(x) + x^{n - m + 1}R^R(x)\\f^R(x)&amp;\equiv Q^R(x)g^R(x)\pmod{x^{n - m + 1}}\end{aligned}
\]</span> æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨æ±‚é€†æ±‚å‡º <span class="math inline">\(Q(x)\)</span>ï¼Œç„¶åå›ä»£å°±å¯ä»¥æ±‚å‡º <span class="math inline">\(R(x)\)</span> äº†ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦ <span class="math inline">\(O(n\log n)\)</span>ã€‚</p>
<h3 id="å®ç°-4">å®ç°</h3>
<div class="sourceCode" id="cb33"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb33-1"><a aria-hidden="true" href="#cb33-1"></a><span class="dt">void</span> polyDiv(<span class="at">const</span> Poly &amp;A, <span class="at">const</span> Poly &amp;B, Poly &amp;Q, Poly &amp;R) {</span>
<span id="cb33-2"><a aria-hidden="true" href="#cb33-2"></a>    Poly rA = A, rB = B;</span>
<span id="cb33-3"><a aria-hidden="true" href="#cb33-3"></a>    reverse(rA), reverse(rB);</span>
<span id="cb33-4"><a aria-hidden="true" href="#cb33-4"></a>    <span class="dt">int</span> n = A.size(), m = B.size();</span>
<span id="cb33-5"><a aria-hidden="true" href="#cb33-5"></a>    rA.resize(n - m + <span class="dv">1</span>), rB.resize(n - m + <span class="dv">1</span>);</span>
<span id="cb33-6"><a aria-hidden="true" href="#cb33-6"></a>    Q = rA * polyInv(rB), Q.resize(n - m + <span class="dv">1</span>), reverse(Q);</span>
<span id="cb33-7"><a aria-hidden="true" href="#cb33-7"></a>    R = A - B * Q, R.resize(m - <span class="dv">1</span>);</span>
<span id="cb33-8"><a aria-hidden="true" href="#cb33-8"></a>    <span class="cf">return</span>;</span>
<span id="cb33-9"><a aria-hidden="true" href="#cb33-9"></a>}</span></code></pre></div>
<p>ä¸»å‡½æ•°è°ƒç”¨ï¼š</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb34-1"><a aria-hidden="true" href="#cb34-1"></a><span class="dt">int</span> n, m;</span>
<span id="cb34-2"><a aria-hidden="true" href="#cb34-2"></a>Poly f, g, R, Q;</span>
<span id="cb34-3"><a aria-hidden="true" href="#cb34-3"></a></span>
<span id="cb34-4"><a aria-hidden="true" href="#cb34-4"></a><span class="dt">int</span> main() {</span>
<span id="cb34-5"><a aria-hidden="true" href="#cb34-5"></a>    read(n), read(m);</span>
<span id="cb34-6"><a aria-hidden="true" href="#cb34-6"></a>    f.resize(++n), g.resize(++m);</span>
<span id="cb34-7"><a aria-hidden="true" href="#cb34-7"></a>    lim = n;</span>
<span id="cb34-8"><a aria-hidden="true" href="#cb34-8"></a>    FOR(i, <span class="dv">0</span>, n - <span class="dv">1</span>) read(f[i]);</span>
<span id="cb34-9"><a aria-hidden="true" href="#cb34-9"></a>    FOR(i, <span class="dv">0</span>, m - <span class="dv">1</span>) read(g[i]);</span>
<span id="cb34-10"><a aria-hidden="true" href="#cb34-10"></a>    polyDiv(f, g, Q, R);</span>
<span id="cb34-11"><a aria-hidden="true" href="#cb34-11"></a>    print(Q);</span>
<span id="cb34-12"><a aria-hidden="true" href="#cb34-12"></a>    print(R);</span>
<span id="cb34-13"><a aria-hidden="true" href="#cb34-13"></a>    <span class="cf">return</span> output(), <span class="dv">0</span>;</span>
<span id="cb34-14"><a aria-hidden="true" href="#cb34-14"></a>}</span></code></pre></div>
<h2 id="å¤šé¡¹å¼ä¸‰è§’å‡½æ•°åä¸‰è§’å‡½æ•°">å¤šé¡¹å¼ä¸‰è§’å‡½æ•°/åä¸‰è§’å‡½æ•°</h2>
<p>æ„Ÿè§‰è¿™ä¸œè¥¿æ²¡ä»€ä¹ˆç”¨ã€‚ã€‚ã€‚</p>
<h3 id="å¤šé¡¹å¼ä¸‰è§’å‡½æ•°">å¤šé¡¹å¼ä¸‰è§’å‡½æ•°</h3>
<h4 id="é—®é¢˜æè¿°-5">é—®é¢˜æè¿°</h4>
<p>ç»™å®šå¤šé¡¹å¼ <span class="math inline">\(f(x)\)</span>ï¼Œæ±‚æ¨¡ <span class="math inline">\(998244353\)</span> æ„ä¹‰ä¸‹çš„ <span class="math inline">\(\sin f(x)\)</span> å’Œ <span class="math inline">\(\cos f(x)\)</span>ã€‚</p>
<h4 id="å¼å­æ¨å¯¼">å¼å­æ¨å¯¼</h4>
<p>æ¬§æ‹‰å…¬å¼ï¼š <span class="math display">\[
e^{i\theta} = \cos \theta + i\sin\theta
\]</span> ç”¨è¯±å¯¼å…¬å¼æ—¥ä¸€é€šä¹‹åå¯ä»¥å¾—åˆ° <span class="math display">\[
e^{i(-\theta)} = \cos\theta - i\sin\theta
\]</span> ç”±ä¸Šé¢ä¸¤ä¸ªå¼å­å°±å¯ä»¥å¾—åˆ° <span class="math display">\[
\begin{aligned}
\sin\theta &amp;= \frac{e^{i\theta} - e^{-i\theta}}{2i}\\
\cos\theta &amp;= \frac{e^{i\theta} + e^{-i\theta}}{2}
\end{aligned}
\]</span> æŠŠ <span class="math inline">\(f(x)\)</span> å¸¦è¿›å»ï¼š <span class="math display">\[
\begin{aligned}
\sin f(x) &amp;= \frac{\exp(if(x)) - \exp(-if(x))}{2i}\\
\cos f(x) &amp;= \frac{\exp(if(x)) + \exp(-if(x))}{2}
\end{aligned}
\]</span> ç°åœ¨çœ‹æ¥ä¼¼ä¹ç›´æ¥ <span class="math inline">\(\exp\)</span> å°±å¯ä»¥åšå®Œäº†ï¼Œç„¶è€Œ <span class="math inline">\(i\)</span> æ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿ</p>
<p>å›é¡¾ä¸€ä¸‹åœ¨å¤æ•°åŸŸä¸‹ï¼Œæˆ‘ä»¬æœ‰ <span class="math inline">\(i^2 = -1\)</span>ã€‚æ”¾åœ¨ <span class="math inline">\(\mathbb Z_{998244353}\)</span> ä¸‹ä¸å°±æ˜¯ <span class="math inline">\(i^2\equiv 998244352\pmod{998244353}\)</span>ã€‚å– <span class="math inline">\(998244352\)</span> çš„ä¸€ä¸ªäºŒæ¬¡å‰©ä½™ <span class="math inline">\(86583718\)</span> å³å¯ã€‚</p>
<h4 id="å®ç°-5">å®ç°</h4>
<p>æ³¨æ„ä¸€ä¸‹æˆ‘ä»¬èƒ½å°½é‡å°‘æ±‚ <span class="math inline">\(\exp\)</span> å°±å°‘æ±‚ <span class="math inline">\(\exp\)</span>ï¼ˆæœ‰ <span class="math inline">\(\exp(-if(x)) = (\exp(if(x)))^{-1}\)</span>ï¼‰ï¼Œå¯ä»¥å¾ˆå¤§ç¨‹åº¦åœ°ä¼˜åŒ–å¸¸æ•°</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb35-1"><a aria-hidden="true" href="#cb35-1"></a>Poly polySin(<span class="at">const</span> Poly &amp;A) {</span>
<span id="cb35-2"><a aria-hidden="true" href="#cb35-2"></a>    Poly tmp = polyExp(imgunit * A);</span>
<span id="cb35-3"><a aria-hidden="true" href="#cb35-3"></a>    <span class="cf">return</span> qPow(<span class="dv">1</span><span class="bu">ll</span> * <span class="dv">2</span> * imgunit % mod) * (tmp - polyInv(tmp));</span>
<span id="cb35-4"><a aria-hidden="true" href="#cb35-4"></a>}</span>
<span id="cb35-5"><a aria-hidden="true" href="#cb35-5"></a></span>
<span id="cb35-6"><a aria-hidden="true" href="#cb35-6"></a>Poly polyCos(<span class="at">const</span> Poly &amp;A) {</span>
<span id="cb35-7"><a aria-hidden="true" href="#cb35-7"></a>    Poly tmp = polyExp(imgunit * A);</span>
<span id="cb35-8"><a aria-hidden="true" href="#cb35-8"></a>    <span class="cf">return</span> qPow(<span class="dv">2</span>) * (tmp + polyInv(tmp));</span>
<span id="cb35-9"><a aria-hidden="true" href="#cb35-9"></a>}</span></code></pre></div>
<p>è¶…çº§çŸ­ã€‚ã€‚ã€‚</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb36-1"><a aria-hidden="true" href="#cb36-1"></a><span class="dt">int</span> n, type;</span>
<span id="cb36-2"><a aria-hidden="true" href="#cb36-2"></a>Poly f;</span>
<span id="cb36-3"><a aria-hidden="true" href="#cb36-3"></a></span>
<span id="cb36-4"><a aria-hidden="true" href="#cb36-4"></a><span class="dt">int</span> main() {</span>
<span id="cb36-5"><a aria-hidden="true" href="#cb36-5"></a>    read(n), read(type);</span>
<span id="cb36-6"><a aria-hidden="true" href="#cb36-6"></a>    f.resize(lim = n), initInv();</span>
<span id="cb36-7"><a aria-hidden="true" href="#cb36-7"></a>    FOR(i, <span class="dv">0</span>, n - <span class="dv">1</span>) read(f[i]);</span>
<span id="cb36-8"><a aria-hidden="true" href="#cb36-8"></a>    print(type ? polyCos(f) : polySin(f));</span>
<span id="cb36-9"><a aria-hidden="true" href="#cb36-9"></a>    <span class="cf">return</span> output(), <span class="dv">0</span>;</span>
<span id="cb36-10"><a aria-hidden="true" href="#cb36-10"></a>}</span></code></pre></div>
<h3 id="å¤šé¡¹å¼åä¸‰è§’å‡½æ•°">å¤šé¡¹å¼åä¸‰è§’å‡½æ•°</h3>
<h4 id="é—®é¢˜æè¿°-6">é—®é¢˜æè¿°</h4>
<p>ç»™å®š <span class="math inline">\(f(x)\)</span>ï¼Œæ±‚æ¨¡ <span class="math inline">\(998244353\)</span> æ„ä¹‰ä¸‹çš„ <span class="math inline">\(\arcsin f(x)\)</span>ï¼Œ<span class="math inline">\(\arccos f(x)\)</span> å’Œ <span class="math inline">\(\arctan f(x)\)</span>ã€‚</p>
<h4 id="å¼å­æ¨å¯¼-1">å¼å­æ¨å¯¼</h4>
<p>é¦–å…ˆéœ€è¦çŸ¥é“ <span class="math display">\[
\begin{aligned}
\arcsin'x &amp;= \frac{1}{\sqrt{1 - x^2}}\\
\arccos'x &amp;= -\frac{1}{\sqrt{1 - x^2}}\\
\arctan'x &amp;= \frac{1}{1 + x^2}
\end{aligned}
\]</span> ç„¶åç±»ä¼¼ <span class="math inline">\(\ln\)</span>ï¼Œå…ˆæ±‚æ±‚å¯¼åç§¯åˆ†æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ï¼š <span class="math display">\[
\begin{aligned}
\arcsin f(x) &amp;= \int\frac{f'(x)}{\sqrt{1 - f^2(x)}}\\
\arccos f(x) &amp;= -\int\frac{f'(x)}{\sqrt{1 - f^2(x)}}\\
\arctan f(x) &amp;= \int\frac{f'(x)}{1 + f^2(x)}
\end{aligned}
\]</span></p>
<h4 id="å®ç°-6">å®ç°</h4>
<div class="sourceCode" id="cb37"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb37-1"><a aria-hidden="true" href="#cb37-1"></a>Poly polyAsin(<span class="at">const</span> Poly &amp;A) {</span>
<span id="cb37-2"><a aria-hidden="true" href="#cb37-2"></a>    Poly one; one.push_back(<span class="dv">1</span>);</span>
<span id="cb37-3"><a aria-hidden="true" href="#cb37-3"></a>    <span class="cf">return</span> ints(deri(A) * polyInv(polySqrt(one - A * A)));</span>
<span id="cb37-4"><a aria-hidden="true" href="#cb37-4"></a>}</span>
<span id="cb37-5"><a aria-hidden="true" href="#cb37-5"></a></span>
<span id="cb37-6"><a aria-hidden="true" href="#cb37-6"></a>Poly polyAtan(<span class="at">const</span> Poly &amp;A) {</span>
<span id="cb37-7"><a aria-hidden="true" href="#cb37-7"></a>    Poly one; one.push_back(<span class="dv">1</span>);</span>
<span id="cb37-8"><a aria-hidden="true" href="#cb37-8"></a>    <span class="cf">return</span> ints(deri(A) * polyInv(one + A * A));</span>
<span id="cb37-9"><a aria-hidden="true" href="#cb37-9"></a>}</span></code></pre></div>
<p><code>vector</code> å°è£…çš„ä¼˜åŠ¿å¾—åˆ°ä½“ç°ã€‚</p>
<h2 id="æ‹‰æ ¼æœ—æ—¥æ’å€¼">æ‹‰æ ¼æœ—æ—¥æ’å€¼</h2>
<h3 id="é—®é¢˜èƒŒæ™¯">é—®é¢˜èƒŒæ™¯</h3>
<p>ç»™å‡º <span class="math inline">\(n\)</span> ä¸ªç‚¹ <span class="math inline">\((x_i,y_i)\)</span>ï¼Œä»¤è¿™ <span class="math inline">\(n\)</span> ä¸ªç‚¹ç¡®å®šçš„å¤šé¡¹å¼ä¸º <span class="math inline">\(L(x)\)</span>ï¼Œæ±‚ <span class="math inline">\(L(x)\)</span> çš„ç³»æ•°è¡¨ç¤ºã€‚</p>
<h3 id="ç»“è®º">ç»“è®º</h3>
<p><span class="math display">\[
L(x) = \sum_{i=1}^n y_il_i(x)
\]</span></p>
<p>å…¶ä¸­æ¯ä¸ª <span class="math inline">\(l_i(x)\)</span> ä¸ºæ‹‰æ ¼æœ—æ—¥åŸºæœ¬å¤šé¡¹å¼ï¼Œè¡¨è¾¾å¼ä¸º</p>
<p><span class="math display">\[
l_i(x) = \prod_{j=1,j\ne i}^n\frac{x-x_j}{x_i-x_j}
\]</span></p>
<p>å…¶ç‰¹ç‚¹æ˜¯ <span class="math inline">\(l_i(x_i)=1\)</span>ï¼Œ<span class="math inline">\(\forall j\ne i\)</span> æœ‰ <span class="math inline">\(l_i(x_j)=0\)</span>ã€‚</p>
<h3 id="æ¨å¯¼">æ¨å¯¼</h3>
<p>æŠ›å¼€æ‹‰æ’ï¼Œè¿™é“é¢˜æ˜æ˜¾å¯ä»¥åˆ—æ–¹ç¨‹ç»„ç„¶åä½¿ç”¨é«˜æ–¯æ¶ˆå…ƒæ±‚è§£ï¼Œä½†æ˜¯å¤æ‚åº¦ä¸º <span class="math inline">\(O(n^3)\)</span> ä¸”ç²¾åº¦é—®é¢˜æ˜æ˜¾ï¼Œæ‰€ä»¥æ‹‰æ ¼æœ—æ—¥æ˜¯è¿™æ ·è€ƒè™‘çš„ï¼š</p>
<p>å¯¹äºæ¯ä¸ªç‚¹ <span class="math inline">\(P_i(x_i,y_i)\)</span>ï¼Œæ„é€ ä¸€ä¸ª <span class="math inline">\(n-1\)</span> æ¬¡å¤šé¡¹å¼ <span class="math inline">\(l_i(x)\)</span> ä½¿å…¶åœ¨ <span class="math inline">\(x_i\)</span> ä¸Šå–å€¼ä¸º <span class="math inline">\(1\)</span>ï¼Œåœ¨å…¶ä½™ <span class="math inline">\(x_j\)</span> ä¸Šä¸º <span class="math inline">\(0\)</span>ã€‚æ„é€ çš„ç»“æœå°±æ˜¯ä¸Šé¢çš„ç»“è®ºï¼š</p>
<p><span class="math display">\[
l_i(x) = \prod_{j=1,j\ne i}^n\frac{x-x_j}{x_i-x_j}
\]</span></p>
<p>ä¸åŠ è¯æ˜åœ°ï¼Œä¸Šé¢è¿™ä¸ªå¤šé¡¹å¼æ˜¯æ­£ç¡®ä¸”å”¯ä¸€çš„ã€‚</p>
<p>ç„¶åè€ƒè™‘æ„é€ ç­”æ¡ˆï¼šå¾ˆæ˜¾ç„¶å¯¹äºç‚¹ <span class="math inline">\(P_i(x_i,y_i)\)</span>ï¼Œåªæœ‰ <span class="math inline">\(l_i(x_i)\)</span> çš„å–å€¼ä¸º <span class="math inline">\(1\)</span>ï¼Œå…¶ä»–çš„éƒ½ä¸º <span class="math inline">\(0\)</span>ã€‚æ‰€ä»¥ç­”æ¡ˆçš„æ­£ç¡®æ€§ä¹Ÿæ˜¯æ¯”è¾ƒæ˜¾ç„¶çš„ï¼šå¯¹äº <span class="math inline">\(x_i\)</span>ï¼Œåªæœ‰ <span class="math inline">\(y_il_i(x_i)\)</span> äº§ç”Ÿäº†è´¡çŒ®ï¼Œå…¶ä½™çš„éƒ½æ˜¯ <span class="math inline">\(0\)</span>ã€‚æ•…è¿™ä¸ªå¤šé¡¹å¼æ˜¯æ­£ç¡®çš„ã€‚</p>
<p>æ‰€ä»¥å›åˆ°ä¸€å¼€å§‹ï¼Œè‹¥æˆ‘ä»¬éœ€è¦æ±‚ <span class="math inline">\(f(k)\)</span> çš„å€¼ï¼Œåˆ™æˆ‘ä»¬éœ€è¦çš„å°±æ˜¯</p>
<p><span class="math display">\[
f(k) = \sum_{i=1}^n y_i\prod_{j=1,j\ne i}^n\frac{k-x_j}{x_i-x_j}
\]</span></p>
<p>ç”±äºæ¨¡æ•°æ˜¯è´¨æ•°ï¼Œæ‰€ä»¥ä½¿ç”¨è´¹é©¬å°å®šç†æ±‚é€†å…ƒï¼Œè·‘å¾—é£å¿«ã€‚</p>
<p>å¤æ‚åº¦ <span class="math inline">\(O(n^2)\)</span>ï¼Œæ±‚é€†å…ƒå°±æ˜¯ä¸ªå¾ˆå°çš„å¸¸æ•°</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb38-1"><a aria-hidden="true" href="#cb38-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span>
<span id="cb38-2"><a aria-hidden="true" href="#cb38-2"></a><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></span>
<span id="cb38-3"><a aria-hidden="true" href="#cb38-3"></a><span class="pp">#define il </span><span class="kw">inline</span></span>
<span id="cb38-4"><a aria-hidden="true" href="#cb38-4"></a></span>
<span id="cb38-5"><a aria-hidden="true" href="#cb38-5"></a><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</span>
<span id="cb38-6"><a aria-hidden="true" href="#cb38-6"></a></span>
<span id="cb38-7"><a aria-hidden="true" href="#cb38-7"></a><span class="kw">inline</span> ll read()</span>
<span id="cb38-8"><a aria-hidden="true" href="#cb38-8"></a>{</span>
<span id="cb38-9"><a aria-hidden="true" href="#cb38-9"></a>    <span class="dt">char</span> c = getchar();</span>
<span id="cb38-10"><a aria-hidden="true" href="#cb38-10"></a>    ll s = <span class="dv">0</span>;</span>
<span id="cb38-11"><a aria-hidden="true" href="#cb38-11"></a>    <span class="dt">bool</span> x = <span class="dv">0</span>;</span>
<span id="cb38-12"><a aria-hidden="true" href="#cb38-12"></a>    <span class="cf">while</span> (!isdigit(c))</span>
<span id="cb38-13"><a aria-hidden="true" href="#cb38-13"></a>        x = x | (c == <span class="ch">'-'</span>), c = getchar();</span>
<span id="cb38-14"><a aria-hidden="true" href="#cb38-14"></a>    <span class="cf">while</span> (isdigit(c))</span>
<span id="cb38-15"><a aria-hidden="true" href="#cb38-15"></a>        s = <span class="dv">10</span> * s + c - <span class="ch">'0'</span>, c = getchar();</span>
<span id="cb38-16"><a aria-hidden="true" href="#cb38-16"></a>    <span class="cf">return</span> x ? -s : s;</span>
<span id="cb38-17"><a aria-hidden="true" href="#cb38-17"></a>}</span>
<span id="cb38-18"><a aria-hidden="true" href="#cb38-18"></a></span>
<span id="cb38-19"><a aria-hidden="true" href="#cb38-19"></a><span class="at">const</span> ll maxn = <span class="fl">2e3</span> + <span class="dv">5</span>, mod = <span class="dv">998244353</span>;</span>
<span id="cb38-20"><a aria-hidden="true" href="#cb38-20"></a>ll x[maxn], y[maxn];</span>
<span id="cb38-21"><a aria-hidden="true" href="#cb38-21"></a></span>
<span id="cb38-22"><a aria-hidden="true" href="#cb38-22"></a>ll pow(ll base, ll p)</span>
<span id="cb38-23"><a aria-hidden="true" href="#cb38-23"></a>{</span>
<span id="cb38-24"><a aria-hidden="true" href="#cb38-24"></a>    ll ans = <span class="dv">1</span>;</span>
<span id="cb38-25"><a aria-hidden="true" href="#cb38-25"></a>    base = (base + mod) % mod;</span>
<span id="cb38-26"><a aria-hidden="true" href="#cb38-26"></a>    <span class="cf">for</span> (; p; p &gt;&gt;= <span class="dv">1</span>)</span>
<span id="cb38-27"><a aria-hidden="true" href="#cb38-27"></a>    {</span>
<span id="cb38-28"><a aria-hidden="true" href="#cb38-28"></a>        <span class="cf">if</span> (p &amp; <span class="dv">1</span>)</span>
<span id="cb38-29"><a aria-hidden="true" href="#cb38-29"></a>            ans = ans * base % mod;</span>
<span id="cb38-30"><a aria-hidden="true" href="#cb38-30"></a>        base = base * base % mod;</span>
<span id="cb38-31"><a aria-hidden="true" href="#cb38-31"></a>    }</span>
<span id="cb38-32"><a aria-hidden="true" href="#cb38-32"></a>    <span class="cf">return</span> ans;</span>
<span id="cb38-33"><a aria-hidden="true" href="#cb38-33"></a>}</span>
<span id="cb38-34"><a aria-hidden="true" href="#cb38-34"></a></span>
<span id="cb38-35"><a aria-hidden="true" href="#cb38-35"></a>il ll inv(ll n)</span>
<span id="cb38-36"><a aria-hidden="true" href="#cb38-36"></a>{</span>
<span id="cb38-37"><a aria-hidden="true" href="#cb38-37"></a>    <span class="cf">return</span> pow(n, mod - <span class="dv">2</span>);</span>
<span id="cb38-38"><a aria-hidden="true" href="#cb38-38"></a>}</span>
<span id="cb38-39"><a aria-hidden="true" href="#cb38-39"></a></span>
<span id="cb38-40"><a aria-hidden="true" href="#cb38-40"></a><span class="dt">int</span> main()</span>
<span id="cb38-41"><a aria-hidden="true" href="#cb38-41"></a>{</span>
<span id="cb38-42"><a aria-hidden="true" href="#cb38-42"></a>    ll n = read(), k = read();</span>
<span id="cb38-43"><a aria-hidden="true" href="#cb38-43"></a>    <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">1</span> ; i &lt;= n; ++i)</span>
<span id="cb38-44"><a aria-hidden="true" href="#cb38-44"></a>        x[i] = read(), y[i] = read();</span>
<span id="cb38-45"><a aria-hidden="true" href="#cb38-45"></a>    ll ans = <span class="dv">0</span>;</span>
<span id="cb38-46"><a aria-hidden="true" href="#cb38-46"></a>    <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">1</span>; i &lt;= n; ++i)</span>
<span id="cb38-47"><a aria-hidden="true" href="#cb38-47"></a>    {</span>
<span id="cb38-48"><a aria-hidden="true" href="#cb38-48"></a>        ll prod1 = <span class="dv">1</span>, prod2 = <span class="dv">1</span>;</span>
<span id="cb38-49"><a aria-hidden="true" href="#cb38-49"></a>        <span class="cf">for</span> (<span class="dt">int</span> j = <span class="dv">1</span>; j &lt;= n; ++j)</span>
<span id="cb38-50"><a aria-hidden="true" href="#cb38-50"></a>        {</span>
<span id="cb38-51"><a aria-hidden="true" href="#cb38-51"></a>            <span class="cf">if</span> (i == j)</span>
<span id="cb38-52"><a aria-hidden="true" href="#cb38-52"></a>                <span class="cf">continue</span>;</span>
<span id="cb38-53"><a aria-hidden="true" href="#cb38-53"></a>            prod1 = prod1 * (k - x[j]) % mod;</span>
<span id="cb38-54"><a aria-hidden="true" href="#cb38-54"></a>            prod2 = prod2 * (x[i] - x[j]) % mod;</span>
<span id="cb38-55"><a aria-hidden="true" href="#cb38-55"></a>        }</span>
<span id="cb38-56"><a aria-hidden="true" href="#cb38-56"></a>        ans = (ans + prod1 * y[i] % mod * inv(prod2) % mod + mod) % mod;</span>
<span id="cb38-57"><a aria-hidden="true" href="#cb38-57"></a>    }</span>
<span id="cb38-58"><a aria-hidden="true" href="#cb38-58"></a>    printf(<span class="st">"</span><span class="sc">%lld\n</span><span class="st">"</span>, ans);</span>
<span id="cb38-59"><a aria-hidden="true" href="#cb38-59"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb38-60"><a aria-hidden="true" href="#cb38-60"></a>}</span></code></pre></div>
<h3 id="é‡å¿ƒå‹æ‹‰æ ¼æœ—æ—¥æ’å€¼æ³•">é‡å¿ƒå‹æ‹‰æ ¼æœ—æ—¥æ’å€¼æ³•</h3>
<p>ä¸Šé¢çš„åšæ³•åœ¨éœ€è¦åŠ¨æ€åŠ ç‚¹/åˆ ç‚¹çš„æƒ…å†µä¸‹æ˜¯æœ‰å¼Šç«¯çš„ï¼Œå› ä¸ºä¸€æ¬¡åŠ ç‚¹å°±éœ€è¦ <span class="math inline">\(O(n^2)\)</span> é‡æ–°è®¡ç®—ï¼Œè¿™æ ·è‚¯å®šæ˜¯ä¸ä¼˜ç§€çš„ã€‚</p>
<p>ç»§ç»­æ¨å¯¼å¼å­ã€‚ <span class="math display">\[
\begin{aligned}f(k) &amp;= \sum_{i = 1}^nf(x_i)\prod_{j\not=i}\frac{k - x_j}{x_i - x_j}\\&amp;=\sum_{i = 1}^nf(x_i)\frac{\prod_{j = 1}^n(k - x_j)}{(k - x_i)\prod_{j \not= i}(x_i - x_j)}\\&amp;=\prod_{i = 1}^n(k - x_i)\sum_{i = 1}^nf(x_i)\frac{1}{(k - x_i)\prod_{j \not= i}(x_i - x_j)}\end{aligned}
\]</span> è®¾ <span class="math inline">\(w_i = \dfrac{f(x_i)}{\prod_{j\not=i}(x_i - x_j)}\)</span>ï¼Œ<span class="math inline">\(g = \displaystyle\prod_{i = 1}^n(k - x_i)\)</span>ï¼Œåˆ™ <span class="math display">\[
f(k) = g\sum_{i = 1}^n\frac{w_i}{k - x_i}
\]</span> è¿™ä¸ª <span class="math inline">\(w_i\)</span> ç§°ä¸ºé‡å¿ƒæƒã€‚æ¯æ¬¡åŠ ç‚¹æ›´æ–°çš„è¯å…¶å¤æ‚åº¦ä¸º <span class="math inline">\(O(n\log n)\)</span>ï¼ˆæ›´æ–° <span class="math inline">\(O(n)\)</span> ä¸ª <span class="math inline">\(w_i\)</span>ï¼Œæ±‚é€† <span class="math inline">\(O(\log n)\)</span>ï¼‰ã€‚è¿™æ ·åšå°±å¯ä»¥å¿«é€ŸåŠ ç‚¹åˆ ç‚¹ã€‚</p>
<p>æ¨¡æ¿é¢˜ï¼š<a href="https://loj.ac/p/165">LOJ#165. æ‹‰æ ¼æœ—æ—¥æ’å€¼</a></p>
<p>æœ¬é¢˜éœ€è¦ç‰¹åˆ¤ <span class="math inline">\(k = x_i\)</span> çš„æƒ…å†µã€‚</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb39-1"><a aria-hidden="true" href="#cb39-1"></a><span class="at">const</span> <span class="dt">int</span> maxn = <span class="dv">3005</span>;</span>
<span id="cb39-2"><a aria-hidden="true" href="#cb39-2"></a>modint g = <span class="dv">1</span>, w[maxn], x[maxn], y[maxn];</span>
<span id="cb39-3"><a aria-hidden="true" href="#cb39-3"></a><span class="dt">int</span> cnt;</span>
<span id="cb39-4"><a aria-hidden="true" href="#cb39-4"></a></span>
<span id="cb39-5"><a aria-hidden="true" href="#cb39-5"></a><span class="dt">void</span> ins(<span class="dt">int</span> cnt) {</span>
<span id="cb39-6"><a aria-hidden="true" href="#cb39-6"></a>    w[cnt] = y[cnt];</span>
<span id="cb39-7"><a aria-hidden="true" href="#cb39-7"></a>    FOR(i, <span class="dv">1</span>, cnt - <span class="dv">1</span>) w[i] *= qPow(x[i] - x[cnt], mod - <span class="dv">2</span>), w[cnt] *= qPow(x[cnt] - x[i], mod - <span class="dv">2</span>);</span>
<span id="cb39-8"><a aria-hidden="true" href="#cb39-8"></a>    <span class="cf">return</span>;</span>
<span id="cb39-9"><a aria-hidden="true" href="#cb39-9"></a>}</span>
<span id="cb39-10"><a aria-hidden="true" href="#cb39-10"></a></span>
<span id="cb39-11"><a aria-hidden="true" href="#cb39-11"></a>modint calc(modint k) {</span>
<span id="cb39-12"><a aria-hidden="true" href="#cb39-12"></a>    FOR(i, <span class="dv">1</span>, cnt) <span class="cf">if</span> (k == x[i]) <span class="cf">return</span> y[i];</span>
<span id="cb39-13"><a aria-hidden="true" href="#cb39-13"></a>    modint g = <span class="dv">1</span>;</span>
<span id="cb39-14"><a aria-hidden="true" href="#cb39-14"></a>    FOR(i, <span class="dv">1</span>, cnt) g *= (k - x[i]);</span>
<span id="cb39-15"><a aria-hidden="true" href="#cb39-15"></a>    modint ret = <span class="dv">0</span>;</span>
<span id="cb39-16"><a aria-hidden="true" href="#cb39-16"></a>    FOR(i, <span class="dv">1</span>, cnt) ret += w[i] * qPow(k - x[i], mod - <span class="dv">2</span>);</span>
<span id="cb39-17"><a aria-hidden="true" href="#cb39-17"></a>    <span class="cf">return</span> ret * g;</span>
<span id="cb39-18"><a aria-hidden="true" href="#cb39-18"></a>}</span>
<span id="cb39-19"><a aria-hidden="true" href="#cb39-19"></a></span>
<span id="cb39-20"><a aria-hidden="true" href="#cb39-20"></a><span class="dt">int</span> main() {</span>
<span id="cb39-21"><a aria-hidden="true" href="#cb39-21"></a>    <span class="dt">int</span> n; read(n);</span>
<span id="cb39-22"><a aria-hidden="true" href="#cb39-22"></a>    <span class="cf">while</span> (n--) {</span>
<span id="cb39-23"><a aria-hidden="true" href="#cb39-23"></a>        <span class="dt">int</span> op;</span>
<span id="cb39-24"><a aria-hidden="true" href="#cb39-24"></a>        read(op);</span>
<span id="cb39-25"><a aria-hidden="true" href="#cb39-25"></a>        <span class="cf">if</span> (op == <span class="dv">1</span>) {</span>
<span id="cb39-26"><a aria-hidden="true" href="#cb39-26"></a>            read(x[++cnt]), read(y[cnt]);</span>
<span id="cb39-27"><a aria-hidden="true" href="#cb39-27"></a>            ins(cnt);</span>
<span id="cb39-28"><a aria-hidden="true" href="#cb39-28"></a>        } <span class="cf">else</span> {</span>
<span id="cb39-29"><a aria-hidden="true" href="#cb39-29"></a>            <span class="dt">int</span> x; read(x);</span>
<span id="cb39-30"><a aria-hidden="true" href="#cb39-30"></a>            print(calc(x));</span>
<span id="cb39-31"><a aria-hidden="true" href="#cb39-31"></a>            putchar(<span class="ch">'</span><span class="sc">\n</span><span class="ch">'</span>);</span>
<span id="cb39-32"><a aria-hidden="true" href="#cb39-32"></a>        }</span>
<span id="cb39-33"><a aria-hidden="true" href="#cb39-33"></a>    }</span>
<span id="cb39-34"><a aria-hidden="true" href="#cb39-34"></a>    <span class="cf">return</span> output(), <span class="dv">0</span>;</span>
<span id="cb39-35"><a aria-hidden="true" href="#cb39-35"></a>}</span></code></pre></div>
<h3 id="æ­£æ•´æ•°çš„-k-æ¬¡æ–¹ä¹‹å’Œ">æ­£æ•´æ•°çš„ <span class="math inline">\(k\)</span> æ¬¡æ–¹ä¹‹å’Œ</h3>
<h4 id="é—®é¢˜æè¿°-7">é—®é¢˜æè¿°</h4>
<p><a href="https://www.luogu.com.cn/problem/CF622F">CF622F</a></p>
<p>é¢˜æ„ï¼šç»™å®š <span class="math inline">\(n,k\)</span>ï¼ˆ<span class="math inline">\(1\le n\le 10^9,0\le k\le 10^6\)</span>ï¼‰ï¼Œæ±‚ <span class="math display">\[
\sum_{i = 1}^ni^k = 1^k + 2^k + 3^k +\cdots + n^k
\]</span> æ¨¡ <span class="math inline">\(10^9 + 7\)</span> çš„å€¼ã€‚</p>
<h4 id="é¢˜è§£">é¢˜è§£</h4>
<p>ä¸‹é¢çš„è¯æ˜ä¼šè®²åˆ°ï¼Œè¿™ä¸ªä¸œè¥¿å¯ä»¥çœ‹ä½œä»¥ <span class="math inline">\(n\)</span> ä¸ºå˜é‡çš„ <span class="math inline">\(k + 1\)</span> æ¬¡å¤šé¡¹å¼ã€‚</p>
<p>è€Œæˆ‘ä»¬å¾ˆå®¹æ˜“å°±å¯ä»¥åœ¨ <span class="math inline">\(O(k\log k)\)</span> çš„æ—¶é—´å†…æ±‚å‡ºæ±‚å‡º <span class="math inline">\(f(1),f(2),\cdots,f(k+ 1)\)</span>ï¼Œæˆ‘ä»¬éœ€è¦æ±‚çš„æ˜¯ <span class="math inline">\(f(n)\)</span>ï¼Œæ•…è€ƒè™‘æ‹‰æ ¼æœ—æ—¥æ’å€¼ï¼Œå¾—å‡ºå¦‚ä¸‹å…¬å¼ <span class="math display">\[
f(n) = \sum_{i = 1}^{k + 2}f(i)\prod_{j\neq i}\frac{n - j}{i - j}
\]</span> å¦‚æœæœ´ç´ åœ°åšçš„è¯ï¼Œå¤æ‚åº¦æ˜¾ç„¶æ˜¯ <span class="math inline">\(O(k^2)\)</span> çš„ï¼Œä½†æ˜¯æ³¨æ„åˆ°æˆ‘ä»¬ç”¨äºå–ç‚¹å€¼çš„æ•°éƒ½æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥ <span class="math inline">\(\prod\)</span> è¿™ä¸€å †æ˜¯å¯ä»¥ <span class="math inline">\(O(n)\)</span> é¢„å¤„ç†ç„¶å <span class="math inline">\(O(1)\)</span> æ±‚çš„ã€‚æ€ä¹ˆé¢„å¤„ç†å‘¢ï¼Ÿæˆ‘ä»¬è€ƒè™‘æŠŠä»–æ‰“å¼€çœ‹çœ‹è§„å¾‹ <span class="math display">\[
\begin{aligned}
\prod_{j = 1,j\neq i}^{k + 2}\frac{n - j}{i - j} &amp;= \frac{(n - 1)(n - 2)\cdots(n - j + 1)(n - j - 1)\cdots(n - k - 1)(n - k - 2)}{(i - 1)(i - 2)\cdots(i - j + 1)(i - j - 1)\cdots(i - k - 2)}\\
&amp;=\frac{\prod_{j = 1}^{i - 1}(n - j)\times\prod_{j = i + 1}^{k + 2}(n - j)}{(-1)^{k -i}\times i!\times (k + 2 - i)!}
\end{aligned}
\]</span> æ‰€ä»¥ç»´æŠ¤ä¸€ä¸‹ <span class="math inline">\((n - j)\)</span> çš„å‰/åç¼€ç§¯å’Œ <span class="math inline">\([1, k + 1]\)</span> çš„é˜¶ä¹˜é€†å…ƒï¼Œè¿™é“é¢˜å°±å¯ä»¥åœ¨ <span class="math inline">\(O(k\log k)\)</span> çš„æ—¶é—´å†…åšå‡ºæ¥äº†ã€‚</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb40-1"><a aria-hidden="true" href="#cb40-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span>
<span id="cb40-2"><a aria-hidden="true" href="#cb40-2"></a><span class="pp">#define FOR</span>(i,<span class="pp"> </span>a,<span class="pp"> </span>b)<span class="pp"> </span><span class="cf">for</span><span class="pp"> </span>(<span class="dt">int</span><span class="pp"> </span>i<span class="pp"> </span>=<span class="pp"> </span>a;<span class="pp"> </span>i<span class="pp"> </span>&lt;=<span class="pp"> </span>b;<span class="pp"> </span>++i)</span>
<span id="cb40-3"><a aria-hidden="true" href="#cb40-3"></a><span class="pp">#define DEC</span>(i,<span class="pp"> </span>a,<span class="pp"> </span>b)<span class="pp"> </span><span class="cf">for</span><span class="pp"> </span>(<span class="dt">int</span><span class="pp"> </span>i<span class="pp"> </span>=<span class="pp"> </span>a;<span class="pp"> </span>i<span class="pp"> </span>&gt;=<span class="pp"> </span>b;<span class="pp"> </span>--i)</span>
<span id="cb40-4"><a aria-hidden="true" href="#cb40-4"></a></span>
<span id="cb40-5"><a aria-hidden="true" href="#cb40-5"></a><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</span>
<span id="cb40-6"><a aria-hidden="true" href="#cb40-6"></a><span class="at">const</span> ll mod = <span class="fl">1e9</span> + <span class="dv">7</span>;</span>
<span id="cb40-7"><a aria-hidden="true" href="#cb40-7"></a><span class="at">const</span> <span class="dt">int</span> maxn = <span class="fl">1e6</span> + <span class="dv">5</span>;</span>
<span id="cb40-8"><a aria-hidden="true" href="#cb40-8"></a></span>
<span id="cb40-9"><a aria-hidden="true" href="#cb40-9"></a>ll n, k;</span>
<span id="cb40-10"><a aria-hidden="true" href="#cb40-10"></a></span>
<span id="cb40-11"><a aria-hidden="true" href="#cb40-11"></a>ll fac[maxn], pre[maxn], suf[maxn];</span>
<span id="cb40-12"><a aria-hidden="true" href="#cb40-12"></a></span>
<span id="cb40-13"><a aria-hidden="true" href="#cb40-13"></a>ll qpow(ll base, ll p = mod - <span class="dv">2</span>)</span>
<span id="cb40-14"><a aria-hidden="true" href="#cb40-14"></a>{</span>
<span id="cb40-15"><a aria-hidden="true" href="#cb40-15"></a>    ll ret = <span class="dv">1</span>;</span>
<span id="cb40-16"><a aria-hidden="true" href="#cb40-16"></a>    <span class="cf">for</span> (; p; p &gt;&gt;= <span class="dv">1</span>, base = base * base % mod)</span>
<span id="cb40-17"><a aria-hidden="true" href="#cb40-17"></a>        <span class="cf">if</span> (p &amp; <span class="dv">1</span>)</span>
<span id="cb40-18"><a aria-hidden="true" href="#cb40-18"></a>            ret = ret * base % mod;</span>
<span id="cb40-19"><a aria-hidden="true" href="#cb40-19"></a>    <span class="cf">return</span> ret;</span>
<span id="cb40-20"><a aria-hidden="true" href="#cb40-20"></a>}</span>
<span id="cb40-21"><a aria-hidden="true" href="#cb40-21"></a></span>
<span id="cb40-22"><a aria-hidden="true" href="#cb40-22"></a><span class="dt">int</span> main()</span>
<span id="cb40-23"><a aria-hidden="true" href="#cb40-23"></a>{</span>
<span id="cb40-24"><a aria-hidden="true" href="#cb40-24"></a>    scanf(<span class="st">"</span><span class="sc">%lld</span><span class="st"> </span><span class="sc">%lld</span><span class="st">"</span>, &amp;n, &amp;k);</span>
<span id="cb40-25"><a aria-hidden="true" href="#cb40-25"></a>    <span class="cf">if</span> (!k)</span>
<span id="cb40-26"><a aria-hidden="true" href="#cb40-26"></a>    {</span>
<span id="cb40-27"><a aria-hidden="true" href="#cb40-27"></a>        printf(<span class="st">"</span><span class="sc">%lld\n</span><span class="st">"</span>, n);</span>
<span id="cb40-28"><a aria-hidden="true" href="#cb40-28"></a>        <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb40-29"><a aria-hidden="true" href="#cb40-29"></a>    }</span>
<span id="cb40-30"><a aria-hidden="true" href="#cb40-30"></a>    ll ans = <span class="dv">0</span>, y = <span class="dv">0</span>;</span>
<span id="cb40-31"><a aria-hidden="true" href="#cb40-31"></a>    pre[<span class="dv">0</span>] = <span class="dv">1</span>, fac[<span class="dv">0</span>] = <span class="dv">1</span>;</span>
<span id="cb40-32"><a aria-hidden="true" href="#cb40-32"></a>    FOR(i, <span class="dv">1</span>, k + <span class="dv">2</span>)</span>
<span id="cb40-33"><a aria-hidden="true" href="#cb40-33"></a>        pre[i] = pre[i - <span class="dv">1</span>] * (n - i) % mod, fac[i] = fac[i - <span class="dv">1</span>] * i % mod;</span>
<span id="cb40-34"><a aria-hidden="true" href="#cb40-34"></a>    suf[k + <span class="dv">3</span>] = <span class="dv">1</span>;</span>
<span id="cb40-35"><a aria-hidden="true" href="#cb40-35"></a>    DEC(i, k + <span class="dv">2</span>, <span class="dv">0</span>)</span>
<span id="cb40-36"><a aria-hidden="true" href="#cb40-36"></a>        suf[i] = suf[i + <span class="dv">1</span>] * (n - i) % mod;</span>
<span id="cb40-37"><a aria-hidden="true" href="#cb40-37"></a>    FOR(i, <span class="dv">1</span>, k + <span class="dv">2</span>)</span>
<span id="cb40-38"><a aria-hidden="true" href="#cb40-38"></a>    {</span>
<span id="cb40-39"><a aria-hidden="true" href="#cb40-39"></a>        y = (y + qpow(i, k)) % mod;</span>
<span id="cb40-40"><a aria-hidden="true" href="#cb40-40"></a>        ll tmp = y * pre[i - <span class="dv">1</span>] % mod * suf[i + <span class="dv">1</span>] % mod * (((k - i) &amp; <span class="dv">1</span>) ? -<span class="dv">1</span> : <span class="dv">1</span>) * qpow(fac[i - <span class="dv">1</span>] * fac[k + <span class="dv">2</span> - i] % mod) % mod;</span>
<span id="cb40-41"><a aria-hidden="true" href="#cb40-41"></a>        ans = (ans + tmp + mod) % mod;</span>
<span id="cb40-42"><a aria-hidden="true" href="#cb40-42"></a>    }</span>
<span id="cb40-43"><a aria-hidden="true" href="#cb40-43"></a>    printf(<span class="st">"</span><span class="sc">%lld\n</span><span class="st">"</span>, ans);</span>
<span id="cb40-44"><a aria-hidden="true" href="#cb40-44"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb40-45"><a aria-hidden="true" href="#cb40-45"></a>}</span></code></pre></div>
<h4 id="è¯æ˜">è¯æ˜</h4>
<p>è¿™é‡Œçš„è¯æ˜ä½¿ç”¨å·®åˆ†ï¼ˆå‚è€ƒæ•°ç«å°è“æœ¬æ•°åˆ—é‚£ä¸€å†Œï¼‰ã€‚</p>
<p>å®šä¹‰å¤šé¡¹å¼ <span class="math inline">\(f(x)\)</span> çš„ä¸€é˜¶å·®åˆ†ä¸º <span class="math inline">\(\Delta f(x) = f(x + 1) - f(x)\)</span>ï¼ŒæŠŠå¾—åˆ°çš„å¤šé¡¹å¼å†ä½œæ¬¡å·®åˆ†å¾—åˆ° <span class="math inline">\(f(x)\)</span> çš„äºŒé˜¶å·®åˆ† <span class="math display">\[
\begin{aligned}
\Delta^2f(x) &amp;= \Delta (\Delta f(x))\\
&amp;= \Delta (f(x + 1) - f(x))\\
&amp;= (f(x + 2) - f(x + 1)) - (f(x + 1) - f(x))\\
&amp;= f(x + 2) - 2f(x + 1) + f(x)
\end{aligned}
\]</span> ç±»ä¼¼çš„å¯ä»¥å®šä¹‰ <span class="math inline">\(p\)</span> é˜¶å·®åˆ†ï¼Œå³ <span class="math inline">\(\Delta^p f(x) = \Delta(\Delta^{p - 1}f(x))\)</span>ã€‚ç±»ä¼¼çš„æˆ‘ä»¬å¯¹æ•°åˆ—ä¹Ÿæ˜¯å¯ä»¥è¿›è¡Œå·®åˆ†æ“ä½œçš„ã€‚å¦‚æœä¸€ä¸ªæ•°åˆ—çš„ <span class="math inline">\(p\)</span> é˜¶å·®åˆ†ä¸ºä¸€ä¸ªéé›¶å¸¸æ•°åˆ—ï¼Œåˆ™ç§°å…¶ä¸º <span class="math inline">\(p\)</span> é˜¶ç­‰å·®æ•°åˆ—ã€‚</p>
<p><strong>å®šç†ï¼š</strong></p>
<p>æ•°åˆ— <span class="math inline">\(\lbrace a_n\rbrace\)</span> ä¸º <span class="math inline">\(p\)</span> é˜¶ç­‰å·®æ•°åˆ—çš„å……è¦æ¡ä»¶æ˜¯å…¶é€šé¡¹å…¬å¼ä¸º <span class="math inline">\(n\)</span> çš„ä¸€ä¸ª <span class="math inline">\(p\)</span> æ¬¡å¤šé¡¹å¼ã€‚</p>
<p><strong>è¯æ˜ï¼š</strong></p>
<p>å·²çŸ¥æ•°åˆ— <span class="math inline">\(\lbrace a_n\rbrace\)</span> ä¸º <span class="math inline">\(p\)</span> é˜¶ç­‰å·®æ•°åˆ—ï¼Œè®¾æ•°åˆ— <span class="math inline">\(\lbrace a_n\rbrace\)</span> çš„é€šé¡¹ä¸ºä¸€ä¸ªå…³äº <span class="math inline">\(n\)</span> çš„ <span class="math inline">\(v\)</span> æ¬¡å¤šé¡¹å¼ï¼Œå³ <span class="math inline">\(f(n) = \sum_{i = 0}^vu_ix^i\)</span>ã€‚</p>
<p>ä»¤ <span class="math inline">\(\lbrace a_n\rbrace\)</span> çš„å·®åˆ†ä¸º <span class="math inline">\(\lbrace b_n\rbrace\)</span>ï¼Œåˆ™ <span class="math inline">\(\lbrace b_n\rbrace\)</span> çš„é€šé¡¹å…¬å¼ä¸º <span class="math display">\[
\begin{aligned}
\Delta f(x) &amp;= f(x + 1) - f(x)\\
&amp;= \sum_{i = 0}^v u_i(x + 1)^i - \sum_{i = 0}^vu_ix_i
\end{aligned}
\]</span> æ‰“å¼€åæˆ‘ä»¬å‘ç° <span class="math inline">\(x^v\)</span> çš„ç³»æ•°å˜ä¸ºäº† <span class="math inline">\(0\)</span>ï¼Œè¯´æ˜å·®åˆ†ä¹‹åé€šé¡¹å…¬å¼çš„æ¬¡æ•°å‡äº† <span class="math inline">\(1\)</span>ï¼Œä»å…¶ <span class="math inline">\(p\)</span> é˜¶å·®åˆ†ä¸ºä¸€ä¸ªéé›¶å¸¸æ•°åˆ—å¯åæ¨çŸ¥å…¶é€šé¡¹å…¬å¼çš„æ¬¡æ•°ä¸º <span class="math inline">\(p\)</span>ã€‚</p>
<p>å›åˆ°æœ¬é¢˜ï¼Œå®šä¹‰å‡ºæ•°åˆ— <span class="math display">\[
\lbrace a_n\rbrace = \sum_{i = 1}^1i^k, \sum_{i = 1}^2i^k,\cdots,\sum_{i = 1}^ni^k
\]</span> å¯¹è¿™ä¸ªæ•°åˆ—ä½œå·®åˆ†å¯ä»¥å¾—åˆ° <span class="math inline">\(1^k,2^k,3^k,\cdots, n^k\)</span>ï¼Œå‘ç°å…¶é€šé¡¹å…¬å¼ä¸º <span class="math inline">\(f(n) = n^k\)</span>ï¼Œæ‰€ä»¥åŸæ•°åˆ—çš„é€šé¡¹å°±æ˜¯å…³äº <span class="math inline">\(n\)</span> çš„ä¸€ä¸ª <span class="math inline">\(k + 1\)</span> æ¬¡å¤šé¡¹å¼ã€‚</p>
<h2 id="å¤šé¡¹å¼å¤šç‚¹æ±‚å€¼">å¤šé¡¹å¼å¤šç‚¹æ±‚å€¼</h2>
<p>å‰ç½®çŸ¥è¯†ï¼šå¤šé¡¹å¼å¸¦ä½™é™¤æ³•ã€ç®€å•çš„åˆ†æ²»æ€æƒ³ã€‚</p>
<h3 id="é—®é¢˜æè¿°-8">é—®é¢˜æè¿°</h3>
<p>ç»™å®šä¸€ä¸ªå¤šé¡¹å¼å’Œ <span class="math inline">\(m\)</span> ä¸ªç‚¹ <span class="math inline">\(\{a_1,\cdots, a_m\}\)</span>ï¼Œè¦æ±‚åˆ†åˆ«æ±‚å‡º <span class="math inline">\(f(a_1),f(a_2),\cdots, f(a_m)\)</span>ã€‚</p>
<h3 id="é—®é¢˜æ±‚è§£-1">é—®é¢˜æ±‚è§£</h3>
<p>æ ¸å¿ƒæ€æƒ³æ˜¯æ„é€  + åˆ†æ²»ã€‚</p>
<p>è€ƒè™‘ç°åœ¨æ­£åœ¨å¤„ç†å­é—®é¢˜ <span class="math display">\[
\{a_1, a_2, \cdots, a_m\}
\]</span> å°†å…¶åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† <span class="math display">\[
\{a_1, a_2,\cdots, a_{\left\lfloor\frac m2\right\rfloor}\}\quad \{a_{\left\lfloor\frac m2\right\rfloor + 1}, \cdots, a_m\}
\]</span> ç„¶åæ„é€ ä¸¤ä¸ªå¤šé¡¹å¼ <span class="math display">\[
g_0(x) = \prod_{i = 1}^{\lfloor\frac m2\rfloor}(x - a_i)\\g_1(x) = \prod_{i = \lfloor\frac m2\rfloor + 1}^m(x - a_i)
\]</span> ç„¶åæˆ‘ä»¬ä»¤ <span class="math inline">\(f(x) = g_0(x)Q(x) + f_0(x)\)</span>ï¼Œåˆ™æ˜¾ç„¶æœ‰ <span class="math inline">\(\forall i\in[1, \lfloor\frac m2\rfloor]\)</span>ï¼Œä¸€å®šæœ‰ <span class="math inline">\(g_0(a_i) = 0\)</span>ã€‚æ‰€ä»¥æœ‰ <span class="math inline">\(f(x)\equiv f_0(x)\pmod {g_0(x)}\)</span>ã€‚è¿™å°±æ˜¯ä¸€ä¸ªå¤šé¡¹å¼å–æ¨¡çš„äº‹æƒ…ã€‚å¯¹äºå³è¾¹åˆ™åŒç†ã€‚</p>
<p>è¿™æ ·å­æˆ‘ä»¬å°±æˆåŠŸå°†é—®é¢˜çš„è§„æ¨¡å‡åŠã€‚æ—¶é—´å¤æ‚åº¦ <span class="math inline">\(O(n\log^2n)\)</span>ã€‚</p>
<h3 id="å®ç°-7">å®ç°</h3>
<p>ä¸€å¼€å§‹å°±éœ€è¦æ±‚å‡ºæ‰€æœ‰çš„ <span class="math inline">\(g(x)\)</span>ï¼Œè¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼äºçº¿æ®µæ ‘ï¼Œæ˜¯ <span class="math inline">\(O(n\log^2n)\)</span> çš„ã€‚ç„¶åæ¯ä¸€å±‚ä¹Ÿè¦ç»™ä»–ä¸ªå¤šé¡¹å¼å–æ¨¡ã€‚</p>
<p>ç„¶åé‰´äºå¤šé¡¹å¼å–æ¨¡çš„å·¨å¤§å¸¸æ•°ï¼Œå½“åŒºé—´æ¯”è¾ƒå°çš„æ—¶å€™å¯ä»¥è€ƒè™‘ç›´æ¥æš´ç®—ï¼Œä¼˜åŒ–å¸¸æ•°ã€‚</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb41-1"><a aria-hidden="true" href="#cb41-1"></a><span class="pp">#define L </span>(k<span class="pp"> </span>&lt;&lt;<span class="pp"> </span><span class="dv">1</span>)</span>
<span id="cb41-2"><a aria-hidden="true" href="#cb41-2"></a><span class="pp">#define R </span>(L<span class="pp"> </span>|<span class="pp"> </span><span class="dv">1</span>)</span>
<span id="cb41-3"><a aria-hidden="true" href="#cb41-3"></a><span class="pp">#define M </span>((l<span class="pp"> </span>+<span class="pp"> </span>r)<span class="pp"> </span>&gt;&gt;<span class="pp"> </span><span class="dv">1</span>)</span>
<span id="cb41-4"><a aria-hidden="true" href="#cb41-4"></a>Poly g[maxn &lt;&lt; <span class="dv">2</span>], Q;</span>
<span id="cb41-5"><a aria-hidden="true" href="#cb41-5"></a></span>
<span id="cb41-6"><a aria-hidden="true" href="#cb41-6"></a><span class="dt">void</span> initG(<span class="dt">int</span> k, <span class="dt">int</span> l, <span class="dt">int</span> r, <span class="dt">int</span> *a) {</span>
<span id="cb41-7"><a aria-hidden="true" href="#cb41-7"></a>    <span class="cf">if</span> (l == r) {</span>
<span id="cb41-8"><a aria-hidden="true" href="#cb41-8"></a>        g[k].push_back(a[l] ? mod - a[l] : <span class="dv">0</span>);</span>
<span id="cb41-9"><a aria-hidden="true" href="#cb41-9"></a>        g[k].push_back(<span class="dv">1</span>);</span>
<span id="cb41-10"><a aria-hidden="true" href="#cb41-10"></a>        <span class="cf">return</span>;</span>
<span id="cb41-11"><a aria-hidden="true" href="#cb41-11"></a>    }</span>
<span id="cb41-12"><a aria-hidden="true" href="#cb41-12"></a>    initG(L, l, M, a);</span>
<span id="cb41-13"><a aria-hidden="true" href="#cb41-13"></a>    initG(R, M + <span class="dv">1</span>, r, a);</span>
<span id="cb41-14"><a aria-hidden="true" href="#cb41-14"></a>    g[k] = g[L] * g[R];</span>
<span id="cb41-15"><a aria-hidden="true" href="#cb41-15"></a>    <span class="cf">return</span>;</span>
<span id="cb41-16"><a aria-hidden="true" href="#cb41-16"></a>}</span>
<span id="cb41-17"><a aria-hidden="true" href="#cb41-17"></a></span>
<span id="cb41-18"><a aria-hidden="true" href="#cb41-18"></a><span class="dt">void</span> work(<span class="dt">int</span> k, <span class="dt">int</span> l, <span class="dt">int</span> r, Poly A, <span class="dt">int</span> *a, <span class="dt">int</span> *ans) {</span>
<span id="cb41-19"><a aria-hidden="true" href="#cb41-19"></a>    <span class="cf">if</span> (r - l + <span class="dv">1</span> &lt; <span class="dv">100</span>) {</span>
<span id="cb41-20"><a aria-hidden="true" href="#cb41-20"></a>        FOR(i, l, r) {</span>
<span id="cb41-21"><a aria-hidden="true" href="#cb41-21"></a>            <span class="dt">int</span> s = <span class="dv">0</span>;</span>
<span id="cb41-22"><a aria-hidden="true" href="#cb41-22"></a>            DEC(j, A.size() - <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb41-23"><a aria-hidden="true" href="#cb41-23"></a>                s = (<span class="dv">1</span><span class="bu">ll</span> * s * a[i] % mod + A[j]) % mod;</span>
<span id="cb41-24"><a aria-hidden="true" href="#cb41-24"></a>            ans[i] = s;</span>
<span id="cb41-25"><a aria-hidden="true" href="#cb41-25"></a>        }</span>
<span id="cb41-26"><a aria-hidden="true" href="#cb41-26"></a>        <span class="cf">return</span>;</span>
<span id="cb41-27"><a aria-hidden="true" href="#cb41-27"></a>    }</span>
<span id="cb41-28"><a aria-hidden="true" href="#cb41-28"></a>    Poly B;</span>
<span id="cb41-29"><a aria-hidden="true" href="#cb41-29"></a>    polyDiv(A, g[L], Q, B);</span>
<span id="cb41-30"><a aria-hidden="true" href="#cb41-30"></a>    work(L, l, M, B, a, ans);</span>
<span id="cb41-31"><a aria-hidden="true" href="#cb41-31"></a>    polyDiv(A, g[R], Q, B);</span>
<span id="cb41-32"><a aria-hidden="true" href="#cb41-32"></a>    work(R, M + <span class="dv">1</span>, r, B, a, ans);</span>
<span id="cb41-33"><a aria-hidden="true" href="#cb41-33"></a>    <span class="cf">return</span>;</span>
<span id="cb41-34"><a aria-hidden="true" href="#cb41-34"></a>}</span>
<span id="cb41-35"><a aria-hidden="true" href="#cb41-35"></a></span>
<span id="cb41-36"><a aria-hidden="true" href="#cb41-36"></a><span class="dt">void</span> evaluate(Poly f, <span class="dt">int</span> m, <span class="dt">int</span> *a, <span class="dt">int</span> *ans) {</span>
<span id="cb41-37"><a aria-hidden="true" href="#cb41-37"></a>    initG(<span class="dv">1</span>, <span class="dv">1</span>, m, a);</span>
<span id="cb41-38"><a aria-hidden="true" href="#cb41-38"></a>    work(<span class="dv">1</span>, <span class="dv">1</span>, m, f, a, ans);</span>
<span id="cb41-39"><a aria-hidden="true" href="#cb41-39"></a>    <span class="cf">return</span>;</span>
<span id="cb41-40"><a aria-hidden="true" href="#cb41-40"></a>}</span>
<span id="cb41-41"><a aria-hidden="true" href="#cb41-41"></a><span class="pp">#undef L</span></span>
<span id="cb41-42"><a aria-hidden="true" href="#cb41-42"></a><span class="pp">#undef R</span></span>
<span id="cb41-43"><a aria-hidden="true" href="#cb41-43"></a><span class="pp">#undef M</span></span></code></pre></div>
<h2 id="å¤šé¡¹å¼å¿«é€Ÿæ’å€¼">å¤šé¡¹å¼å¿«é€Ÿæ’å€¼</h2>
<p>å‰ç½®çŸ¥è¯†ï¼šå¤šç‚¹æ±‚å€¼ï¼Œæ´›å¿…è¾¾æ³•åˆ™</p>
<h3 id="é—®é¢˜æè¿°-9">é—®é¢˜æè¿°</h3>
<p>ç»™å®š <span class="math inline">\(n\)</span> ä¸ªç‚¹ <span class="math inline">\((x_i, y_i)\)</span>ï¼Œæ±‚å‡ºç»è¿‡è¿™ <span class="math inline">\(n\)</span> ä¸ªç‚¹çš„ <span class="math inline">\(n - 1\)</span> æ¬¡å¤šé¡¹å¼ã€‚</p>
<h3 id="é—®é¢˜æ±‚è§£-2">é—®é¢˜æ±‚è§£</h3>
<p>å›é¡¾ä¸€ä¸‹æ‹‰æ ¼æœ—æ—¥æ’å€¼å…¬å¼ï¼š <span class="math display">\[
F(x) = \sum_{i = 1}^n y_i\prod_{j \not=i}\frac{x - x_j}{x_i - x_j}
\]</span> å…ˆæŠŠåé¢çš„åˆ†æ¯æåˆ°å‰é¢æ¥ï¼š <span class="math display">\[
F(x) = \sum_{i = 1}^n\frac{y_i}{\prod_{j\not=i}(x_i - x_j)}\prod_{j \not= i}(x - x_j)
\]</span> é¦–å…ˆå‘ç° <span class="math inline">\(\dfrac{y_i}{\prod_{j\not=i}(x_i - x_j)}\)</span>ï¼Œè€ƒè™‘å…ˆè®¡ç®—è¿™ä¸ªå¸¸æ•°ã€‚ä»¤ <span class="math inline">\(\delta(x) = \displaystyle\prod_{j = 1}^n(x - x_j)\)</span>ï¼Œè¿™ä¸ªä¸œè¥¿å¯ä»¥åˆ†æ²» <span class="math inline">\(O(n\log^2 n)\)</span> æ±‚ã€‚ç„¶åçœ‹ <span class="math inline">\(y_i\)</span> çš„åˆ†æ¯ï¼š <span class="math display">\[
\prod_{j\not= i}(x_i - x_j) = \lim_{x\to x_i}\frac{\delta(x)}{x - x_i}
\]</span> è¿™ä¸ªä¸œè¥¿å°±æ˜¯å¯¼æ•°çš„å®šä¹‰å¼ï¼Œä¸éš¾å‘ç° <span class="math display">\[
\lim_{x\to x_i}\frac{\delta(x)}{x - x_i} = \delta'(x_i)
\]</span> æ±‚å‡º <span class="math inline">\(\delta(x)\)</span> ä¹‹åæ±‚ä¸ªå¯¼å†å†™ä¸ªå¤šç‚¹æ±‚å€¼å°±å¯ä»¥æå®šäº†ã€‚</p>
<p>ç„¶åé—®é¢˜å°±åŒ–ç®€åˆ°äº† <span class="math display">\[
F(x) = \sum_{i = 1}^n\frac{y_i}{\delta'(x_i)}\prod_{j\not=i}(x - x_j)
\]</span> è¿˜æ˜¯ç”¨åˆ†æ²»å¤§æ³•ã€‚è®¾ <span class="math inline">\(\displaystyle F_{l, r}(x) = \sum_{i = l}^r\frac{y_i}{\delta'(x_i)}\prod_{j\not=i}(x - x_j)\)</span>ï¼Œ<span class="math inline">\(\delta_{l,r}(x) = \displaystyle\prod_{j = l}^r(x - x_j)\)</span>ï¼Œ<span class="math inline">\(m = \left\lfloor\dfrac {i+ j}2\right\rfloor\)</span>ï¼Œå¼€å§‹åŒ–ç®€ï¼š <span class="math display">\[
\begin{aligned}F_{l, r}(x) &amp;= \sum_{i = l}^r\frac{y_i}{\delta'(x_i)}\prod_{j\not=i}(x - x_j)\\&amp;=\sum_{i = l}^m\frac{y_i}{\delta'(x_i)}\prod_{j = l, j\not=i}^m(x - x_j)\prod_{j = m + 1, j\not= i}^r(x - x_j) + \sum_{i = m + 1}^r\frac{y_i}{\delta'(x_i)}\prod_{j = l, j\not=i}^m(x - x_j)\prod_{j = m + 1, j\not= i}^r(x - x_j)\\&amp;=F_{l,m}(x)\delta_{m + 1, r}(x) + F_{m + 1, r}(x)\delta_{l, m}(x)\end{aligned}
\]</span> è¾¹ç•Œè‚¯å®šå°±æ˜¯ <span class="math inline">\(l = r\)</span> çš„æ—¶å€™ <span class="math inline">\(F_{l,l}(x) = \dfrac{y_l}{\delta'(x_l)}\)</span>ã€‚æ€»å¤æ‚åº¦ <span class="math inline">\(O(n\log^2n)\)</span>ã€‚</p>
<h3 id="å®ç°-8">å®ç°</h3>
<p>é…åˆä¸Šé¢çš„å°è£…ï¼Œå…¶å®ä¸éš¾å†™ã€‚</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb42-1"><a aria-hidden="true" href="#cb42-1"></a>Poly delta[maxn &lt;&lt; <span class="dv">2</span>], ddelta;</span>
<span id="cb42-2"><a aria-hidden="true" href="#cb42-2"></a><span class="dt">int</span> dval[maxn];</span>
<span id="cb42-3"><a aria-hidden="true" href="#cb42-3"></a></span>
<span id="cb42-4"><a aria-hidden="true" href="#cb42-4"></a><span class="dt">void</span> initDelta(<span class="dt">int</span> k, <span class="dt">int</span> l, <span class="dt">int</span> r, <span class="dt">int</span> *x) {</span>
<span id="cb42-5"><a aria-hidden="true" href="#cb42-5"></a>    <span class="cf">if</span> (l == r) {</span>
<span id="cb42-6"><a aria-hidden="true" href="#cb42-6"></a>        delta[k].push_back(x[l] ? mod - x[l] : <span class="dv">0</span>);</span>
<span id="cb42-7"><a aria-hidden="true" href="#cb42-7"></a>        delta[k].push_back(<span class="dv">1</span>);</span>
<span id="cb42-8"><a aria-hidden="true" href="#cb42-8"></a>        <span class="cf">return</span>;</span>
<span id="cb42-9"><a aria-hidden="true" href="#cb42-9"></a>    }</span>
<span id="cb42-10"><a aria-hidden="true" href="#cb42-10"></a>    initDelta(L, l, M, x);</span>
<span id="cb42-11"><a aria-hidden="true" href="#cb42-11"></a>    initDelta(R, M + <span class="dv">1</span>, r, x);</span>
<span id="cb42-12"><a aria-hidden="true" href="#cb42-12"></a>    delta[k] = delta[L] * delta[R];</span>
<span id="cb42-13"><a aria-hidden="true" href="#cb42-13"></a>    <span class="cf">return</span>;</span>
<span id="cb42-14"><a aria-hidden="true" href="#cb42-14"></a>}</span>
<span id="cb42-15"><a aria-hidden="true" href="#cb42-15"></a></span>
<span id="cb42-16"><a aria-hidden="true" href="#cb42-16"></a>Poly interpolation(<span class="dt">int</span> k, <span class="dt">int</span> l, <span class="dt">int</span> r, <span class="dt">int</span> *x, <span class="dt">int</span> *y) {</span>
<span id="cb42-17"><a aria-hidden="true" href="#cb42-17"></a>    <span class="cf">if</span> (l == r)</span>
<span id="cb42-18"><a aria-hidden="true" href="#cb42-18"></a>        <span class="cf">return</span> Poly(<span class="dv">1</span>, <span class="dv">1</span><span class="bu">ll</span> * y[l] * qPow(dval[l]) % mod);</span>
<span id="cb42-19"><a aria-hidden="true" href="#cb42-19"></a>    <span class="cf">return</span> interpolation(L, l, M, x, y) * delta[R] + interpolation(R, M + <span class="dv">1</span>, r, x, y) * delta[L];</span>
<span id="cb42-20"><a aria-hidden="true" href="#cb42-20"></a>}</span>
<span id="cb42-21"><a aria-hidden="true" href="#cb42-21"></a></span>
<span id="cb42-22"><a aria-hidden="true" href="#cb42-22"></a>Poly interpolation(<span class="dt">int</span> n, <span class="dt">int</span> *x, <span class="dt">int</span> *y) {</span>
<span id="cb42-23"><a aria-hidden="true" href="#cb42-23"></a>    initDelta(<span class="dv">1</span>, <span class="dv">1</span>, n, x);</span>
<span id="cb42-24"><a aria-hidden="true" href="#cb42-24"></a>    ddelta = deri(delta[<span class="dv">1</span>]);</span>
<span id="cb42-25"><a aria-hidden="true" href="#cb42-25"></a>    evaluate(ddelta, n, x, dval);</span>
<span id="cb42-26"><a aria-hidden="true" href="#cb42-26"></a>    <span class="cf">return</span> interpolation(<span class="dv">1</span>, <span class="dv">1</span>, n, x, y);</span>
<span id="cb42-27"><a aria-hidden="true" href="#cb42-27"></a>}</span></code></pre></div>
</section>
<footer class="article-footer">
<section class="article-tags">
<a href="/tags/OI/">OI</a>
<a href="/tags/note/">ç¬”è®°</a>
<a href="/tags/FFT/">FFT</a>
<a href="/tags/NTT/">NTT</a>
<a href="/tags/gf/">ç”Ÿæˆå‡½æ•°</a>
<a href="/tags/inclusion-exclusion-principle/">å®¹æ–¥åŸç†</a>
<a href="/tags/lagrange-interpolation/">æ‹‰æ ¼æœ—æ—¥æ’å€¼</a>
</section>
<section class="article-copyright">
<svg class="icon icon-tabler icon-tabler-copyright" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<circle cx="12" cy="12" r="9"></circle>
<path d="M14.5 9a3.5 4 0 1 0 0 6"></path>
</svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" rel="stylesheet"/><script crossorigin="anonymous" defer="" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js">
</script><script crossorigin="anonymous" defer="" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js">
</script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
</article>
<aside class="related-contents--wrapper">
<h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
<div class="related-contents">
<div class="flex article-list--tile">
<article class="has-image">
<a href="/sol-bzoj3771/">
<div class="article-image">
<img data-hash="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg50.webp" data-key="" loading="lazy" src="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg50.webp"/>
</div>
<div class="article-details">
<h2 class="article-title">BZOJ3771. Triple</h2>
</div>
</a>
</article>
<article class="has-image">
<a href="/summary-atcoder/">
<div class="article-image">
<img data-hash="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg70.webp" data-key="" loading="lazy" src="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg70.webp"/>
</div>
<div class="article-details">
<h2 class="article-title">AtCoder æ¯”èµ›æ—¥è®°</h2>
</div>
</a>
</article>
<article class="has-image">
<a href="/note-gf/">
<div class="article-image">
<img data-hash="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg28.webp" data-key="" loading="lazy" src="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg28.webp"/>
</div>
<div class="article-details">
<h2 class="article-title">ç”Ÿæˆå‡½æ•°èƒ¡æ‰¯</h2>
</div>
</a>
</article>
<article class="has-image">
<a href="/sol-luogu-p4451/">
<div class="article-image">
<img data-hash="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg5.webp" data-key="" loading="lazy" src="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg5.webp"/>
</div>
<div class="article-details">
<h2 class="article-title">P4451 [å›½å®¶é›†è®­é˜Ÿ]æ•´æ•°çš„lqpæ‹†åˆ†</h2>
</div>
</a>
</article>
<article class="has-image">
<a href="/sol-cf438e/">
<div class="article-image">
<img data-hash="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg67.webp" data-key="" loading="lazy" src="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg67.webp"/>
</div>
<div class="article-details">
<h2 class="article-title">CF438E The Child and Binary Tree</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<footer class="site-footer">
<section class="copyright">
        Â© 
        
            2019 - 
        
        2024 æ¸…çƒ›çš„åšå®¢
    </section>
<section class="powerby">
        Built with <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo</a> <br/>
        ä¸»é¢˜ <b><a data-version="3.11.0" href="https://github.com/CaiJimmy/hugo-theme-stack" rel="noopener" target="_blank">Stack</a></b> ç”± <a href="https://jimmycai.com" rel="noopener" target="_blank">Jimmy</a> è®¾è®¡
    </section>
</footer>
<div aria-hidden="true" class="pswp" role="dialog" tabindex="-1">
<div class="pswp__bg"></div>
<div class="pswp__scroll-wrap">
<div class="pswp__container">
<div class="pswp__item"></div>
<div class="pswp__item"></div>
<div class="pswp__item"></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class="pswp__top-bar">
<div class="pswp__counter"></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title="Share"></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class="pswp__preloader">
<div class="pswp__preloader__icn">
<div class="pswp__preloader__cut">
<div class="pswp__preloader__donut"></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class="pswp__share-tooltip"></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class="pswp__caption">
<div class="pswp__caption__center"></div>
</div>
</div>
</div>
</div><script crossorigin="anonymous" defer="" integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js">
</script><script crossorigin="anonymous" defer="" integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js">
</script><link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css" integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" rel="stylesheet"/><link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css" integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" rel="stylesheet"/>
</main>
</div>
<script crossorigin="anonymous" integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js">
</script><script defer="" src="/ts/main.js" type="text/javascript"></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>
</body>
</html>
