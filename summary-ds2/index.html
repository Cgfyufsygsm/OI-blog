<!DOCTYPE html>
<html dir="ltr" lang="zh-CN">
<head><meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/><meta content="å‰è¨€ çœé€‰/NOIï¼ˆå¦‚æœèƒ½è¿›çœé˜Ÿï¼‰çš„ä¸ªäººå¤ä¹ èµ„æ–™ã€‚
å…¨å‡­ä¸ªäººå–œå¥½æ¥æã€‚
ä¸ä¼šå†™çš„å¾ˆä¸¥è°¨ï¼Œå®æˆ˜å¯¼å‘å‹ã€‚
æœ¬æ–‡å†…å®¹æ¦‚è§ˆï¼š
æ ‘å¥—æ ‘ CDQ åˆ†æ²» æ•´ä½“äºŒåˆ† çº¿æ®µæ ‘åˆ†æ²» å®é™…è§£å†³é—®é¢˜çš„æ—¶å€™ï¼Œè¿™å‡ ç§æ–¹æ³•æ˜¯å¯ä»¥ç›¸äº’æ›¿ä»£çš„ï¼Œä¸€ä¸ªé¢˜ç›®å¯èƒ½æœ‰å¾ˆå¤šç§æ–¹æ³•è§£å†³ã€‚
æ ‘å¥—æ ‘ cdq åˆ†æ²» ç®€ä»‹ ä¸€ç±»åˆ†æ²»æ–¹æ³•ï¼Œä¸æ˜¯ç‰¹å®šçš„æŸç§ç®—æ³•ã€‚ç”± IOI2008 é‡‘ç‰Œå¾—ä¸»é™ˆä¸¹ç¦æå‡ºã€‚å¯ä»¥é¡¶æ›¿æ ‘å¥—æ ‘ç­‰å¤æ‚çš„æ•°æ®ç»“æ„ã€‚å…¶å¯ä»¥ç»™é—®é¢˜â€œé™ç»´â€ã€‚æ ‘å¥—æ ‘ä¸ cdq åˆ†æ²»å®Œå…¨ç­‰ä»·ã€‚
ä¸€èˆ¬æµç¨‹ é€’å½’çš„è¿›è¡Œï¼Œä¸€å¼€å§‹å…ˆå°†æ“ä½œï¼ˆä¿®æ”¹ï¼Œè¯¢é—®ï¼‰åºåˆ—/ç‚¹å¯¹å»ºç«‹å‡ºæ¥ï¼ŒæŒ‰ç…§ç¬¬ä¸€ç»´æ’åºï¼Œéšåå¼€å§‹é€’å½’ï¼š
é€’å½’ \([l, mid]\)ï¼› å¤„ç† \([l, mid]\) ä¸­çš„å…ƒç´ ä¸ \([mid + 1, r]\) ä¸­å…ƒç´ çš„è´¡çŒ®ï¼Œå³è®¡ç®—è·¨ä¸­ç‚¹çš„è´¡çŒ®ï¼› é€’å½’ \([mid + 1, r]\)ã€‚ å…¶ä¸­æœ€é‡è¦çš„ï¼Œå°±æ˜¯å¤„ç†è·¨ä¸­ç‚¹è´¡çŒ®è¿™ä¸€éƒ¨åˆ†ã€‚ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥æœ‰äº›æ—¶å€™æ˜¯å¯ä»¥é¢ å€’çš„ã€‚éœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚
éœ€è¦ç‰¹åˆ«æ³¨æ„ååºå‹çš„é—®é¢˜ï¼Œæ’åºæ˜¯å¦èƒ½ä¿è¯ \(a &amp;lt; b\) å’Œ \(b &amp;lt; a\) ä¸åŒæ—¶ä¸º \(0/1\)ï¼Œå¾ˆå®¹æ˜“ REã€‚
ååºé—®é¢˜ï¼ˆæ•°ç‚¹é—®é¢˜ï¼‰ äºŒç»´ååº ã€‚äºŒç»´ååºé—®é¢˜è¯´çš„æ˜¯ï¼šç»™å®š \(n\) ä¸ªæœ‰åºå¯¹ \((a, b)\)ï¼Œé—®å¯¹äºæ¯ä¸ªæœ‰åºå¯¹ \((a, b)\)ï¼Œæœ‰å¤šå°‘ä¸ªæœ‰åºå¯¹ \((a_0, b_0)\) æ»¡è¶³ \(a &amp;gt; a_0\land b &amp;gt; b_0\)ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥æ€ä¹ˆåšå‘¢ï¼Ÿ
æˆ‘ä»¬ä¸å¦¨å…ˆå°†ç¬¬ä¸€ç»´æ’å¥½åºï¼Œå³æŒ‰ç…§ \(a_i\) å‡åºæ’åºï¼Œç„¶åå¼€å§‹é€’å½’å¤„ç†ã€‚ç„¶åé—®é¢˜ä¾¿è½¬åŒ–ä¸ºå¯¹äº \([mid + 1, r]\) ä¸­çš„æ¯ä¸ª \((a, b)\) é‡Œæ±‚ \([l, mid]\) ä¸­æœ‰å¤šå°‘ä¸ª \((a_0, b_0)\) æ»¡è¶³ \(b &amp;gt; b_0\)ã€‚å› ä¸º \(a\) æ’å¥½åºäº†æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ç®¡ã€‚è¿™ä¸ªä¸œè¥¿ç±»ä¼¼å½’å¹¶æ’åºæ±‚é€†åºå¯¹ï¼Œåªè¦ä¸¤ä¸ªå­åŒºé—´é‡Œé¢çš„ \(b_i\) æœ‰åºé‚£ä¹ˆæ˜¯å¯ä»¥å¾ˆå¿«è§£å†³çš„ã€‚æ‰€ä»¥ç›¸å½“äºé­”æ”¹ä¸€ä¸‹å½’å¹¶æ’åºå°±å¯ä»¥è¿‡äº†ã€‚å¤æ‚åº¦ \(T(n) = 2T(n / 2) + O(n) = O(n\log n)\)ã€‚äº‹å®ä¸Šï¼Œæ±‚é€†åºå¯¹ä¹Ÿæ˜¯ä¸€ä¸ªäºŒç»´ååºé—®é¢˜ï¼Œåªä¸è¿‡æ˜¯æŠŠä¸‹æ ‡çœ‹ä½œç¬¬ä¸€ç»´ã€‚" name="description"/><title>æ•°æ®ç»“æ„å¤ä¹  2 ï¼ˆé«˜ç»´é—®é¢˜ï¼‰</title>
<link href="https://oi.imyangty.com/summary-ds2/" rel="canonical"/>
<link href="/scss/style.min.a5821f3d3ab84ce5a0ac21477e347a2e0ca00292e398d16c5e8e36ded6e35a23.css" rel="stylesheet"/><meta content="æ•°æ®ç»“æ„å¤ä¹  2 ï¼ˆé«˜ç»´é—®é¢˜ï¼‰" property="og:title"/>
<meta content="å‰è¨€ çœé€‰/NOIï¼ˆå¦‚æœèƒ½è¿›çœé˜Ÿï¼‰çš„ä¸ªäººå¤ä¹ èµ„æ–™ã€‚
å…¨å‡­ä¸ªäººå–œå¥½æ¥æã€‚
ä¸ä¼šå†™çš„å¾ˆä¸¥è°¨ï¼Œå®æˆ˜å¯¼å‘å‹ã€‚
æœ¬æ–‡å†…å®¹æ¦‚è§ˆï¼š
æ ‘å¥—æ ‘ CDQ åˆ†æ²» æ•´ä½“äºŒåˆ† çº¿æ®µæ ‘åˆ†æ²» å®é™…è§£å†³é—®é¢˜çš„æ—¶å€™ï¼Œè¿™å‡ ç§æ–¹æ³•æ˜¯å¯ä»¥ç›¸äº’æ›¿ä»£çš„ï¼Œä¸€ä¸ªé¢˜ç›®å¯èƒ½æœ‰å¾ˆå¤šç§æ–¹æ³•è§£å†³ã€‚
æ ‘å¥—æ ‘ cdq åˆ†æ²» ç®€ä»‹ ä¸€ç±»åˆ†æ²»æ–¹æ³•ï¼Œä¸æ˜¯ç‰¹å®šçš„æŸç§ç®—æ³•ã€‚ç”± IOI2008 é‡‘ç‰Œå¾—ä¸»é™ˆä¸¹ç¦æå‡ºã€‚å¯ä»¥é¡¶æ›¿æ ‘å¥—æ ‘ç­‰å¤æ‚çš„æ•°æ®ç»“æ„ã€‚å…¶å¯ä»¥ç»™é—®é¢˜â€œé™ç»´â€ã€‚æ ‘å¥—æ ‘ä¸ cdq åˆ†æ²»å®Œå…¨ç­‰ä»·ã€‚
ä¸€èˆ¬æµç¨‹ é€’å½’çš„è¿›è¡Œï¼Œä¸€å¼€å§‹å…ˆå°†æ“ä½œï¼ˆä¿®æ”¹ï¼Œè¯¢é—®ï¼‰åºåˆ—/ç‚¹å¯¹å»ºç«‹å‡ºæ¥ï¼ŒæŒ‰ç…§ç¬¬ä¸€ç»´æ’åºï¼Œéšåå¼€å§‹é€’å½’ï¼š
é€’å½’ \([l, mid]\)ï¼› å¤„ç† \([l, mid]\) ä¸­çš„å…ƒç´ ä¸ \([mid + 1, r]\) ä¸­å…ƒç´ çš„è´¡çŒ®ï¼Œå³è®¡ç®—è·¨ä¸­ç‚¹çš„è´¡çŒ®ï¼› é€’å½’ \([mid + 1, r]\)ã€‚ å…¶ä¸­æœ€é‡è¦çš„ï¼Œå°±æ˜¯å¤„ç†è·¨ä¸­ç‚¹è´¡çŒ®è¿™ä¸€éƒ¨åˆ†ã€‚ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥æœ‰äº›æ—¶å€™æ˜¯å¯ä»¥é¢ å€’çš„ã€‚éœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚
éœ€è¦ç‰¹åˆ«æ³¨æ„ååºå‹çš„é—®é¢˜ï¼Œæ’åºæ˜¯å¦èƒ½ä¿è¯ \(a &amp;lt; b\) å’Œ \(b &amp;lt; a\) ä¸åŒæ—¶ä¸º \(0/1\)ï¼Œå¾ˆå®¹æ˜“ REã€‚
ååºé—®é¢˜ï¼ˆæ•°ç‚¹é—®é¢˜ï¼‰ äºŒç»´ååº ã€‚äºŒç»´ååºé—®é¢˜è¯´çš„æ˜¯ï¼šç»™å®š \(n\) ä¸ªæœ‰åºå¯¹ \((a, b)\)ï¼Œé—®å¯¹äºæ¯ä¸ªæœ‰åºå¯¹ \((a, b)\)ï¼Œæœ‰å¤šå°‘ä¸ªæœ‰åºå¯¹ \((a_0, b_0)\) æ»¡è¶³ \(a &amp;gt; a_0\land b &amp;gt; b_0\)ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥æ€ä¹ˆåšå‘¢ï¼Ÿ
æˆ‘ä»¬ä¸å¦¨å…ˆå°†ç¬¬ä¸€ç»´æ’å¥½åºï¼Œå³æŒ‰ç…§ \(a_i\) å‡åºæ’åºï¼Œç„¶åå¼€å§‹é€’å½’å¤„ç†ã€‚ç„¶åé—®é¢˜ä¾¿è½¬åŒ–ä¸ºå¯¹äº \([mid + 1, r]\) ä¸­çš„æ¯ä¸ª \((a, b)\) é‡Œæ±‚ \([l, mid]\) ä¸­æœ‰å¤šå°‘ä¸ª \((a_0, b_0)\) æ»¡è¶³ \(b &amp;gt; b_0\)ã€‚å› ä¸º \(a\) æ’å¥½åºäº†æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ç®¡ã€‚è¿™ä¸ªä¸œè¥¿ç±»ä¼¼å½’å¹¶æ’åºæ±‚é€†åºå¯¹ï¼Œåªè¦ä¸¤ä¸ªå­åŒºé—´é‡Œé¢çš„ \(b_i\) æœ‰åºé‚£ä¹ˆæ˜¯å¯ä»¥å¾ˆå¿«è§£å†³çš„ã€‚æ‰€ä»¥ç›¸å½“äºé­”æ”¹ä¸€ä¸‹å½’å¹¶æ’åºå°±å¯ä»¥è¿‡äº†ã€‚å¤æ‚åº¦ \(T(n) = 2T(n / 2) + O(n) = O(n\log n)\)ã€‚äº‹å®ä¸Šï¼Œæ±‚é€†åºå¯¹ä¹Ÿæ˜¯ä¸€ä¸ªäºŒç»´ååºé—®é¢˜ï¼Œåªä¸è¿‡æ˜¯æŠŠä¸‹æ ‡çœ‹ä½œç¬¬ä¸€ç»´ã€‚" property="og:description"/>
<meta content="https://oi.imyangty.com/summary-ds2/" property="og:url"/>
<meta content="æ¸…çƒ›çš„åšå®¢" property="og:site_name"/>
<meta content="article" property="og:type"/><meta content="Post" property="article:section"/><meta content="OI" property="article:tag"/><meta content="ç¬”è®°" property="article:tag"/><meta content="cdqåˆ†æ²»" property="article:tag"/><meta content="æ•´ä½“äºŒåˆ†" property="article:tag"/><meta content="çº¿æ®µæ ‘åˆ†æ²»" property="article:tag"/><meta content="æ ‘å¥—æ ‘" property="article:tag"/><meta content="2022-02-08T23:31:11+08:00" property="article:published_time"/><meta content="2022-02-08T23:31:11+08:00" property="article:modified_time"/><meta content="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg6.webp" property="og:image"/>
<meta content="æ•°æ®ç»“æ„å¤ä¹  2 ï¼ˆé«˜ç»´é—®é¢˜ï¼‰" name="twitter:title"/>
<meta content="å‰è¨€ çœé€‰/NOIï¼ˆå¦‚æœèƒ½è¿›çœé˜Ÿï¼‰çš„ä¸ªäººå¤ä¹ èµ„æ–™ã€‚
å…¨å‡­ä¸ªäººå–œå¥½æ¥æã€‚
ä¸ä¼šå†™çš„å¾ˆä¸¥è°¨ï¼Œå®æˆ˜å¯¼å‘å‹ã€‚
æœ¬æ–‡å†…å®¹æ¦‚è§ˆï¼š
æ ‘å¥—æ ‘ CDQ åˆ†æ²» æ•´ä½“äºŒåˆ† çº¿æ®µæ ‘åˆ†æ²» å®é™…è§£å†³é—®é¢˜çš„æ—¶å€™ï¼Œè¿™å‡ ç§æ–¹æ³•æ˜¯å¯ä»¥ç›¸äº’æ›¿ä»£çš„ï¼Œä¸€ä¸ªé¢˜ç›®å¯èƒ½æœ‰å¾ˆå¤šç§æ–¹æ³•è§£å†³ã€‚
æ ‘å¥—æ ‘ cdq åˆ†æ²» ç®€ä»‹ ä¸€ç±»åˆ†æ²»æ–¹æ³•ï¼Œä¸æ˜¯ç‰¹å®šçš„æŸç§ç®—æ³•ã€‚ç”± IOI2008 é‡‘ç‰Œå¾—ä¸»é™ˆä¸¹ç¦æå‡ºã€‚å¯ä»¥é¡¶æ›¿æ ‘å¥—æ ‘ç­‰å¤æ‚çš„æ•°æ®ç»“æ„ã€‚å…¶å¯ä»¥ç»™é—®é¢˜â€œé™ç»´â€ã€‚æ ‘å¥—æ ‘ä¸ cdq åˆ†æ²»å®Œå…¨ç­‰ä»·ã€‚
ä¸€èˆ¬æµç¨‹ é€’å½’çš„è¿›è¡Œï¼Œä¸€å¼€å§‹å…ˆå°†æ“ä½œï¼ˆä¿®æ”¹ï¼Œè¯¢é—®ï¼‰åºåˆ—/ç‚¹å¯¹å»ºç«‹å‡ºæ¥ï¼ŒæŒ‰ç…§ç¬¬ä¸€ç»´æ’åºï¼Œéšåå¼€å§‹é€’å½’ï¼š
é€’å½’ \([l, mid]\)ï¼› å¤„ç† \([l, mid]\) ä¸­çš„å…ƒç´ ä¸ \([mid + 1, r]\) ä¸­å…ƒç´ çš„è´¡çŒ®ï¼Œå³è®¡ç®—è·¨ä¸­ç‚¹çš„è´¡çŒ®ï¼› é€’å½’ \([mid + 1, r]\)ã€‚ å…¶ä¸­æœ€é‡è¦çš„ï¼Œå°±æ˜¯å¤„ç†è·¨ä¸­ç‚¹è´¡çŒ®è¿™ä¸€éƒ¨åˆ†ã€‚ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥æœ‰äº›æ—¶å€™æ˜¯å¯ä»¥é¢ å€’çš„ã€‚éœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚
éœ€è¦ç‰¹åˆ«æ³¨æ„ååºå‹çš„é—®é¢˜ï¼Œæ’åºæ˜¯å¦èƒ½ä¿è¯ \(a &amp;lt; b\) å’Œ \(b &amp;lt; a\) ä¸åŒæ—¶ä¸º \(0/1\)ï¼Œå¾ˆå®¹æ˜“ REã€‚
ååºé—®é¢˜ï¼ˆæ•°ç‚¹é—®é¢˜ï¼‰ äºŒç»´ååº ã€‚äºŒç»´ååºé—®é¢˜è¯´çš„æ˜¯ï¼šç»™å®š \(n\) ä¸ªæœ‰åºå¯¹ \((a, b)\)ï¼Œé—®å¯¹äºæ¯ä¸ªæœ‰åºå¯¹ \((a, b)\)ï¼Œæœ‰å¤šå°‘ä¸ªæœ‰åºå¯¹ \((a_0, b_0)\) æ»¡è¶³ \(a &amp;gt; a_0\land b &amp;gt; b_0\)ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥æ€ä¹ˆåšå‘¢ï¼Ÿ
æˆ‘ä»¬ä¸å¦¨å…ˆå°†ç¬¬ä¸€ç»´æ’å¥½åºï¼Œå³æŒ‰ç…§ \(a_i\) å‡åºæ’åºï¼Œç„¶åå¼€å§‹é€’å½’å¤„ç†ã€‚ç„¶åé—®é¢˜ä¾¿è½¬åŒ–ä¸ºå¯¹äº \([mid + 1, r]\) ä¸­çš„æ¯ä¸ª \((a, b)\) é‡Œæ±‚ \([l, mid]\) ä¸­æœ‰å¤šå°‘ä¸ª \((a_0, b_0)\) æ»¡è¶³ \(b &amp;gt; b_0\)ã€‚å› ä¸º \(a\) æ’å¥½åºäº†æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ç®¡ã€‚è¿™ä¸ªä¸œè¥¿ç±»ä¼¼å½’å¹¶æ’åºæ±‚é€†åºå¯¹ï¼Œåªè¦ä¸¤ä¸ªå­åŒºé—´é‡Œé¢çš„ \(b_i\) æœ‰åºé‚£ä¹ˆæ˜¯å¯ä»¥å¾ˆå¿«è§£å†³çš„ã€‚æ‰€ä»¥ç›¸å½“äºé­”æ”¹ä¸€ä¸‹å½’å¹¶æ’åºå°±å¯ä»¥è¿‡äº†ã€‚å¤æ‚åº¦ \(T(n) = 2T(n / 2) + O(n) = O(n\log n)\)ã€‚äº‹å®ä¸Šï¼Œæ±‚é€†åºå¯¹ä¹Ÿæ˜¯ä¸€ä¸ªäºŒç»´ååºé—®é¢˜ï¼Œåªä¸è¿‡æ˜¯æŠŠä¸‹æ ‡çœ‹ä½œç¬¬ä¸€ç»´ã€‚" name="twitter:description"/><meta content="summary_large_image" name="twitter:card"/>
<meta content="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg6.webp" name="twitter:image"/>
<link href="https://q1.qlogo.cn/g?b=qq&amp;nk=375836877&amp;s=5" rel="shortcut icon"/>
<link href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/styles/github-dark-dimmed.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</head>
<body class="article-page">
<script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky">
<button aria-label="åˆ‡æ¢èœå•" class="hamburger hamburger--spin" id="toggle-menu" type="button">
<span class="hamburger-box">
<span class="hamburger-inner"></span>
</span>
</button>
<header>
<figure class="site-avatar">
<a href="/">
<img alt="Avatar" class="site-logo" height="300" loading="lazy" src="/img/avatar_huea3ce2119467b51fdd2a81393644a76d_51594_300x0_resize_q75_box.jpg" width="300"/>
</a>
<span class="emoji">ğŸ˜…</span>
</figure>
<div class="site-meta">
<h1 class="site-name"><a href="/">æ¸…çƒ›çš„åšå®¢</a></h1>
<h2 class="site-description">çƒŸç«å·²è°¢ï¼Œç¬™æ­Œæœªåœ</h2>
</div>
</header><ol class="social-menu">
<li>
<a href="mailto:i@imyangty.com" target="_blank" title="email">
<svg class="icon icon-tabler icon-tabler-mail" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
<rect height="14" rx="2" width="18" x="3" y="5"></rect>
<polyline points="3 7 12 13 21 7"></polyline>
</svg>
</a>
</li>
<li>
<a href="https://github.com/Cgfyufsygsm" target="_blank" title="GitHub">
<svg class="icon icon-tabler icon-tabler-brand-github" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
<path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path>
</svg>
</a>
</li>
<li>
<a href="https://t.me/Cgfyufsygsm" target="_blank" title="Telegram">
<svg class="icon icon-tabler icon-tabler-brand-telegram" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
<path d="M15 10l-4 4l6 6l4 -16l-18 7l4 2l2 6l3 -4"></path>
</svg>
</a>
</li>
<li>
<a href="https://twitter.com/Cgfyufsygsm" target="_blank" title="Twitter">
<svg class="icon icon-tabler icon-tabler-brand-twitter" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
<path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z"></path>
</svg>
</a>
</li>
</ol><ol class="menu" id="main-menu">
<li>
<a href="/">
<svg class="icon icon-tabler icon-tabler-home" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<polyline points="5 12 3 12 12 3 21 12 19 12"></polyline>
<path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7"></path>
<path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6"></path>
</svg>
<span>ä¸»é¡µ</span>
</a>
</li>
<li>
<a href="/about/">
<svg class="icon icon-tabler icon-tabler-user" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<circle cx="12" cy="7" r="4"></circle>
<path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2"></path>
</svg>
<span>å…³äº</span>
</a>
</li>
<li>
<a href="/idx/">
<svg class="icon icon-tabler icon-tabler-hash" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<line x1="5" x2="19" y1="9" y2="9"></line>
<line x1="5" x2="19" y1="15" y2="15"></line>
<line x1="11" x2="7" y1="4" y2="20"></line>
<line x1="17" x2="13" y1="4" y2="20"></line>
</svg>
<span>å¯¼èˆª</span>
</a>
</li>
<li>
<a href="/archives/">
<svg class="icon icon-tabler icon-tabler-archive" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<rect height="4" rx="2" width="18" x="3" y="4"></rect>
<path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10"></path>
<line x1="10" x2="14" y1="12" y2="12"></line>
</svg>
<span>å½’æ¡£</span>
</a>
</li>
<li>
<a href="/search/">
<svg class="icon icon-tabler icon-tabler-search" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<circle cx="10" cy="10" r="7"></circle>
<line x1="21" x2="15" y1="21" y2="15"></line>
</svg>
<span>æœç´¢</span>
</a>
</li>
<li>
<a href="/friends/">
<svg class="icon icon-tabler icon-tabler-link" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5"></path>
<path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"></path>
</svg>
<span>å‹é“¾</span>
</a>
</li>
<li>
<a href="https://blog.imyangty.com" target="_blank">
<svg class="icon icon-tabler icon-tabler-home" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<polyline points="5 12 3 12 12 3 21 12 19 12"></polyline>
<path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7"></path>
<path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6"></path>
</svg>
<span>ä¸»åšå®¢</span>
</a>
</li>
<div class="menu-bottom-section">
<li id="dark-mode-toggle">
<svg class="icon icon-tabler icon-tabler-toggle-left" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<circle cx="8" cy="12" r="2"></circle>
<rect height="12" rx="6" width="20" x="2" y="6"></rect>
</svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<circle cx="16" cy="12" r="2"></circle>
<rect height="12" rx="6" width="20" x="2" y="6"></rect>
</svg>
<span>æš—è‰²æ¨¡å¼</span>
</li>
</div>
</ol>
</aside>
<main class="main full-width">
<article class="has-image main-article">
<header class="article-header">
<div class="article-image">
<a href="/summary-ds2/">
<img alt="Featured image of post æ•°æ®ç»“æ„å¤ä¹  2 ï¼ˆé«˜ç»´é—®é¢˜ï¼‰" loading="lazy" src="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg6.webp"/>
</a>
</div>
<div class="article-details">
<header class="article-category">
<a href="/categories/oi/">
                OI
            </a>
<a href="/categories/summary/">
                æ€»ç»“
            </a>
</header>
<div class="article-title-wrapper">
<h2 class="article-title">
<a href="/summary-ds2/">æ•°æ®ç»“æ„å¤ä¹  2 ï¼ˆé«˜ç»´é—®é¢˜ï¼‰</a>
</h2>
</div>
<footer class="article-time">
<div>
<svg class="icon icon-tabler icon-tabler-calendar-time" fill="none" height="56" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="56" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4"></path>
<circle cx="18" cy="18" r="4"></circle>
<path d="M15 3v4"></path>
<path d="M7 3v4"></path>
<path d="M3 11h16"></path>
<path d="M18 16.496v1.504l1 1"></path>
</svg>
<time class="article-time--published">Feb 08, 2022</time>
</div>
<div>
<svg class="icon icon-tabler icon-tabler-clock" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<circle cx="12" cy="12" r="9"></circle>
<polyline points="12 7 12 12 15 15"></polyline>
</svg>
<time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 10 åˆ†é’Ÿ
                </time>
</div>
</footer>
</div>
</header>
<section class="article-content">
<h2 id="å‰è¨€">å‰è¨€</h2>
<p>çœé€‰/NOIï¼ˆå¦‚æœèƒ½è¿›çœé˜Ÿï¼‰çš„ä¸ªäººå¤ä¹ èµ„æ–™ã€‚</p>
<p>å…¨å‡­ä¸ªäººå–œå¥½æ¥æã€‚</p>
<p>ä¸ä¼šå†™çš„å¾ˆä¸¥è°¨ï¼Œå®æˆ˜å¯¼å‘å‹ã€‚</p>
<p>æœ¬æ–‡å†…å®¹æ¦‚è§ˆï¼š</p>
<ul>
<li>æ ‘å¥—æ ‘</li>
<li>CDQ åˆ†æ²»</li>
<li>æ•´ä½“äºŒåˆ†</li>
<li>çº¿æ®µæ ‘åˆ†æ²»</li>
</ul>
<p>å®é™…è§£å†³é—®é¢˜çš„æ—¶å€™ï¼Œè¿™å‡ ç§æ–¹æ³•æ˜¯å¯ä»¥ç›¸äº’æ›¿ä»£çš„ï¼Œä¸€ä¸ªé¢˜ç›®å¯èƒ½æœ‰å¾ˆå¤šç§æ–¹æ³•è§£å†³ã€‚</p>
<h2 id="æ ‘å¥—æ ‘">æ ‘å¥—æ ‘</h2>
<h2 id="cdq-åˆ†æ²»">cdq åˆ†æ²»</h2>
<h3 id="ç®€ä»‹">ç®€ä»‹</h3>
<p>ä¸€ç±»åˆ†æ²»æ–¹æ³•ï¼Œä¸æ˜¯ç‰¹å®šçš„æŸç§ç®—æ³•ã€‚ç”± IOI2008 é‡‘ç‰Œå¾—ä¸»é™ˆä¸¹ç¦æå‡ºã€‚å¯ä»¥é¡¶æ›¿æ ‘å¥—æ ‘ç­‰å¤æ‚çš„æ•°æ®ç»“æ„ã€‚å…¶å¯ä»¥ç»™é—®é¢˜â€œé™ç»´â€ã€‚<strong>æ ‘å¥—æ ‘ä¸ cdq åˆ†æ²»å®Œå…¨ç­‰ä»·</strong>ã€‚</p>
<h3 id="ä¸€èˆ¬æµç¨‹">ä¸€èˆ¬æµç¨‹</h3>
<p>é€’å½’çš„è¿›è¡Œï¼Œä¸€å¼€å§‹å…ˆå°†æ“ä½œï¼ˆä¿®æ”¹ï¼Œè¯¢é—®ï¼‰åºåˆ—/ç‚¹å¯¹å»ºç«‹å‡ºæ¥ï¼ŒæŒ‰ç…§ç¬¬ä¸€ç»´æ’åºï¼Œéšåå¼€å§‹é€’å½’ï¼š</p>
<ul>
<li>é€’å½’ <span class="math inline">\([l, mid]\)</span>ï¼›</li>
<li>å¤„ç† <span class="math inline">\([l, mid]\)</span> ä¸­çš„å…ƒç´ ä¸ <span class="math inline">\([mid + 1, r]\)</span> ä¸­å…ƒç´ çš„è´¡çŒ®ï¼Œå³è®¡ç®—è·¨ä¸­ç‚¹çš„è´¡çŒ®ï¼›</li>
<li>é€’å½’ <span class="math inline">\([mid + 1, r]\)</span>ã€‚</li>
</ul>
<p>å…¶ä¸­æœ€é‡è¦çš„ï¼Œå°±æ˜¯å¤„ç†è·¨ä¸­ç‚¹è´¡çŒ®è¿™ä¸€éƒ¨åˆ†ã€‚ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥æœ‰äº›æ—¶å€™æ˜¯å¯ä»¥é¢ å€’çš„ã€‚éœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚</p>
<p><strong>éœ€è¦ç‰¹åˆ«æ³¨æ„ååºå‹çš„é—®é¢˜ï¼Œæ’åºæ˜¯å¦èƒ½ä¿è¯ <span class="math inline">\(a &lt; b\)</span> å’Œ <span class="math inline">\(b &lt; a\)</span> ä¸åŒæ—¶ä¸º <span class="math inline">\(0/1\)</span>ï¼Œå¾ˆå®¹æ˜“ RE</strong>ã€‚</p>
<h3 id="ååºé—®é¢˜æ•°ç‚¹é—®é¢˜">ååºé—®é¢˜ï¼ˆæ•°ç‚¹é—®é¢˜ï¼‰</h3>
<h4 id="äºŒç»´ååº">äºŒç»´ååº</h4>
<p>ã€‚äºŒç»´ååºé—®é¢˜è¯´çš„æ˜¯ï¼šç»™å®š <span class="math inline">\(n\)</span> ä¸ªæœ‰åºå¯¹ <span class="math inline">\((a, b)\)</span>ï¼Œé—®å¯¹äºæ¯ä¸ªæœ‰åºå¯¹ <span class="math inline">\((a, b)\)</span>ï¼Œæœ‰å¤šå°‘ä¸ªæœ‰åºå¯¹ <span class="math inline">\((a_0, b_0)\)</span> æ»¡è¶³ <span class="math inline">\(a &gt; a_0\land b &gt; b_0\)</span>ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬ä¸å¦¨å…ˆå°†ç¬¬ä¸€ç»´æ’å¥½åºï¼Œå³æŒ‰ç…§ <span class="math inline">\(a_i\)</span> å‡åºæ’åºï¼Œç„¶åå¼€å§‹é€’å½’å¤„ç†ã€‚ç„¶åé—®é¢˜ä¾¿è½¬åŒ–ä¸ºå¯¹äº <span class="math inline">\([mid + 1, r]\)</span> ä¸­çš„æ¯ä¸ª <span class="math inline">\((a, b)\)</span> é‡Œæ±‚ <span class="math inline">\([l, mid]\)</span> ä¸­æœ‰å¤šå°‘ä¸ª <span class="math inline">\((a_0, b_0)\)</span> æ»¡è¶³ <span class="math inline">\(b &gt; b_0\)</span>ã€‚å› ä¸º <span class="math inline">\(a\)</span> æ’å¥½åºäº†æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ç®¡ã€‚è¿™ä¸ªä¸œè¥¿ç±»ä¼¼å½’å¹¶æ’åºæ±‚é€†åºå¯¹ï¼Œåªè¦ä¸¤ä¸ªå­åŒºé—´é‡Œé¢çš„ <span class="math inline">\(b_i\)</span> æœ‰åºé‚£ä¹ˆæ˜¯å¯ä»¥å¾ˆå¿«è§£å†³çš„ã€‚æ‰€ä»¥ç›¸å½“äºé­”æ”¹ä¸€ä¸‹å½’å¹¶æ’åºå°±å¯ä»¥è¿‡äº†ã€‚å¤æ‚åº¦ <span class="math inline">\(T(n) = 2T(n / 2) + O(n) = O(n\log n)\)</span>ã€‚äº‹å®ä¸Šï¼Œæ±‚é€†åºå¯¹ä¹Ÿæ˜¯ä¸€ä¸ªäºŒç»´ååºé—®é¢˜ï¼Œåªä¸è¿‡æ˜¯æŠŠä¸‹æ ‡çœ‹ä½œç¬¬ä¸€ç»´ã€‚</p>
<p>å†æ¥çœ‹ä¸€ä¸ªå¥‡æ€ªçš„é—®é¢˜ï¼š<a href="https://www.luogu.com.cn/problem/P3374">P3374 ã€æ¨¡æ¿ã€‘æ ‘çŠ¶æ•°ç»„ 1</a>ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥æ‹†è§£æˆ <span class="math inline">\(3\)</span> ç§æ“ä½œï¼š</p>
<ul>
<li>ä¿®æ”¹æ“ä½œ <code>1 x k</code>ï¼›</li>
<li>æŸ¥è¯¢å‰ç¼€å’Œæ“ä½œ <code>2 y 1</code> å’Œ <code>3 x-1 -1</code>ã€‚</li>
</ul>
<p>å…¶å®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªäºŒç»´ååºé—®é¢˜ï¼Œæ€ä¹ˆè¯´ï¼Ÿæ—¶é—´çœ‹æˆç¬¬ä¸€ç»´ï¼Œæ“ä½œçš„ä½ç½®çœ‹æˆç¬¬äºŒç»´ã€‚ç¬¬ä¸€ç»´é»˜è®¤æ˜¯æœ‰åºçš„ï¼Œ æ‰€ä»¥æˆ‘ä»¬å…³äºç¬¬äºŒç»´åšä¸€ä¸ªâ€œå½’å¹¶æ’åºâ€å°±å¯ä»¥äº†ã€‚å…·ä½“åœ°ï¼Œcdq çš„æ—¶å€™ï¼Œæˆ‘ä»¬è€ƒè™‘å·¦åŠè¾¹çš„<strong>ä¿®æ”¹</strong>å¯¹å³åŠè¾¹çš„<strong>æŸ¥è¯¢</strong>çš„è´¡çŒ®ã€‚å› ä¸ºå·¦åŠè¾¹æ—¶é—´å°äºå³åŠè¾¹ï¼ŒåŒæ—¶ä»–ä»¬å„è‡ªçš„ä½ç½®éƒ½æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç»Ÿè®¡è´¡çŒ®ã€‚</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a aria-hidden="true" href="#cb1-1"></a><span class="at">const</span> <span class="dt">int</span> maxn = <span class="fl">5e6</span> + <span class="dv">5</span>;</span>
<span id="cb1-2"><a aria-hidden="true" href="#cb1-2"></a></span>
<span id="cb1-3"><a aria-hidden="true" href="#cb1-3"></a><span class="kw">struct</span> node {</span>
<span id="cb1-4"><a aria-hidden="true" href="#cb1-4"></a>    <span class="dt">int</span> type, id;</span>
<span id="cb1-5"><a aria-hidden="true" href="#cb1-5"></a>    ll val;</span>
<span id="cb1-6"><a aria-hidden="true" href="#cb1-6"></a>    il <span class="dt">bool</span> <span class="kw">operator</span>&lt;(<span class="at">const</span> node &amp;b) {<span class="cf">return</span> id == b.id ? type &lt; b.type : id &lt; b.id;}</span>
<span id="cb1-7"><a aria-hidden="true" href="#cb1-7"></a>} A[maxn], B[maxn];</span>
<span id="cb1-8"><a aria-hidden="true" href="#cb1-8"></a>ll ans[maxn];</span>
<span id="cb1-9"><a aria-hidden="true" href="#cb1-9"></a></span>
<span id="cb1-10"><a aria-hidden="true" href="#cb1-10"></a><span class="dt">int</span> n, m, tot, totx;</span>
<span id="cb1-11"><a aria-hidden="true" href="#cb1-11"></a></span>
<span id="cb1-12"><a aria-hidden="true" href="#cb1-12"></a><span class="dt">void</span> cdq(<span class="dt">int</span> l, <span class="dt">int</span> r) {</span>
<span id="cb1-13"><a aria-hidden="true" href="#cb1-13"></a>    <span class="cf">if</span> (l == r) <span class="cf">return</span>;</span>
<span id="cb1-14"><a aria-hidden="true" href="#cb1-14"></a>    <span class="dt">int</span> m = (l + r) &gt;&gt; <span class="dv">1</span>;</span>
<span id="cb1-15"><a aria-hidden="true" href="#cb1-15"></a>    cdq(l, m), cdq(m + <span class="dv">1</span>, r);</span>
<span id="cb1-16"><a aria-hidden="true" href="#cb1-16"></a>    <span class="dt">int</span> t1 = l, t2 = m + <span class="dv">1</span>;</span>
<span id="cb1-17"><a aria-hidden="true" href="#cb1-17"></a>    ll sum = <span class="dv">0</span>;</span>
<span id="cb1-18"><a aria-hidden="true" href="#cb1-18"></a>    FOR(i, l, r) {</span>
<span id="cb1-19"><a aria-hidden="true" href="#cb1-19"></a>        <span class="cf">if</span> ((t1 &lt;= m &amp;&amp; A[t1] &lt; A[t2]) || t2 &gt; r) {</span>
<span id="cb1-20"><a aria-hidden="true" href="#cb1-20"></a>            <span class="cf">if</span> (A[t1].type == <span class="dv">1</span>) sum += A[t1].val;</span>
<span id="cb1-21"><a aria-hidden="true" href="#cb1-21"></a>            B[i] = A[t1++];</span>
<span id="cb1-22"><a aria-hidden="true" href="#cb1-22"></a>        } <span class="cf">else</span> {</span>
<span id="cb1-23"><a aria-hidden="true" href="#cb1-23"></a>            <span class="cf">if</span> (A[t2].type == <span class="dv">3</span>) ans[A[t2].val] += sum;</span>
<span id="cb1-24"><a aria-hidden="true" href="#cb1-24"></a>            <span class="cf">else</span> <span class="cf">if</span> (A[t2].type == <span class="dv">2</span>) ans[A[t2].val] -= sum;</span>
<span id="cb1-25"><a aria-hidden="true" href="#cb1-25"></a>            B[i] = A[t2++];</span>
<span id="cb1-26"><a aria-hidden="true" href="#cb1-26"></a>        }</span>
<span id="cb1-27"><a aria-hidden="true" href="#cb1-27"></a>    }</span>
<span id="cb1-28"><a aria-hidden="true" href="#cb1-28"></a>    FOR(i, l, r) A[i] = B[i];</span>
<span id="cb1-29"><a aria-hidden="true" href="#cb1-29"></a>    <span class="cf">return</span>;</span>
<span id="cb1-30"><a aria-hidden="true" href="#cb1-30"></a>}</span>
<span id="cb1-31"><a aria-hidden="true" href="#cb1-31"></a></span>
<span id="cb1-32"><a aria-hidden="true" href="#cb1-32"></a><span class="dt">int</span> main() {</span>
<span id="cb1-33"><a aria-hidden="true" href="#cb1-33"></a>    n = read(), m = read();</span>
<span id="cb1-34"><a aria-hidden="true" href="#cb1-34"></a>    FOR(i, <span class="dv">1</span>, n) {</span>
<span id="cb1-35"><a aria-hidden="true" href="#cb1-35"></a>        ++tot;</span>
<span id="cb1-36"><a aria-hidden="true" href="#cb1-36"></a>        A[tot].type = <span class="dv">1</span>, A[tot].id = i, A[tot].val = read();</span>
<span id="cb1-37"><a aria-hidden="true" href="#cb1-37"></a>    }</span>
<span id="cb1-38"><a aria-hidden="true" href="#cb1-38"></a>    FOR(i, <span class="dv">1</span>, m) {</span>
<span id="cb1-39"><a aria-hidden="true" href="#cb1-39"></a>        <span class="dt">int</span> t = read();</span>
<span id="cb1-40"><a aria-hidden="true" href="#cb1-40"></a>        A[++tot].type = t;</span>
<span id="cb1-41"><a aria-hidden="true" href="#cb1-41"></a>        <span class="cf">if</span> (t == <span class="dv">1</span>) A[tot].id = read(), A[tot].val = read();</span>
<span id="cb1-42"><a aria-hidden="true" href="#cb1-42"></a>        <span class="cf">else</span> {</span>
<span id="cb1-43"><a aria-hidden="true" href="#cb1-43"></a>            <span class="dt">int</span> l = read(), r = read();</span>
<span id="cb1-44"><a aria-hidden="true" href="#cb1-44"></a>            ++totx;</span>
<span id="cb1-45"><a aria-hidden="true" href="#cb1-45"></a>            A[tot].val = totx, A[tot].id = l - <span class="dv">1</span>;</span>
<span id="cb1-46"><a aria-hidden="true" href="#cb1-46"></a>            ++tot;</span>
<span id="cb1-47"><a aria-hidden="true" href="#cb1-47"></a>            A[tot].type = <span class="dv">3</span>, A[tot].val = totx, A[tot].id = r;</span>
<span id="cb1-48"><a aria-hidden="true" href="#cb1-48"></a>        }</span>
<span id="cb1-49"><a aria-hidden="true" href="#cb1-49"></a>    }</span>
<span id="cb1-50"><a aria-hidden="true" href="#cb1-50"></a>    cdq(<span class="dv">1</span>, tot);</span>
<span id="cb1-51"><a aria-hidden="true" href="#cb1-51"></a>    FOR(i, <span class="dv">1</span>, totx) printf(<span class="st">"</span><span class="sc">%lld\n</span><span class="st">"</span>, ans[i]);</span>
<span id="cb1-52"><a aria-hidden="true" href="#cb1-52"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb1-53"><a aria-hidden="true" href="#cb1-53"></a>}</span></code></pre></div>
<ul>
<li><strong><a href="https://www.luogu.com.cn/problem/P2717">P2717 å¯’å‡ä½œä¸š</a></strong>ï¼šè½¬åŒ–ä¸€ä¸‹å°±å˜æˆäº†å‚»é€¼é¢˜ï¼Œ<a href="/sol-luogu-p2717/">é¢˜è§£</a>ã€‚</li>
</ul>
<h4 id="ä¸‰ç»´ååº">ä¸‰ç»´ååº</h4>
<p><a href="https://www.luogu.com.cn/problem/P3810">P3810 ã€æ¨¡æ¿ã€‘ä¸‰ç»´ååºï¼ˆé™Œä¸ŠèŠ±å¼€ï¼‰</a>ã€‚é¢˜æ„å¤§æ¦‚æ˜¯ï¼šæœ‰ <span class="math inline">\(n\)</span> ä¸ªå…ƒç´ ï¼Œæ¯ç§å…ƒç´ æœ‰ <span class="math inline">\(a_i\)</span>ï¼Œ<span class="math inline">\(b_i\)</span>ï¼Œ<span class="math inline">\(c_i\)</span> ä¸‰ä¸ªå±æ€§ï¼Œè®¾ <span class="math inline">\(f_i\)</span> è¡¨ç¤ºæ»¡è¶³ <span class="math inline">\(a_j \le a_i\land b_j \le b_i\land c_j \le c_i\)</span> çš„ <span class="math inline">\(j\)</span> çš„æ•°é‡ã€‚å¯¹äº <span class="math inline">\(d\in [0, n)\)</span>ï¼Œæ±‚ <span class="math inline">\(f_i = d\)</span> çš„ <span class="math inline">\(i\)</span> çš„æ•°é‡ã€‚</p>
<p>è¿™ä¸ªé¢˜ KDT å’Œæ ‘å¥—æ ‘éƒ½æ˜¯å¯ä»¥åšçš„ï¼Œä½†æ˜¯ cdq <em>å¯ä»¥é¡¶æ›¿å¤æ‚çš„æ•°æ®ç»“æ„</em>ï¼Œæ‰€ä»¥æ¥çœ‹çœ‹æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>å¯ä»¥å…ˆæŒ‰ç…§ç¬¬ä¸€ç»´æ’åºï¼Œç„¶åå¯¹ç¬¬äºŒç»´ cdqï¼Œç”¨æ ‘çŠ¶æ•°ç»„è§£å†³ç¬¬ä¸‰ç»´ã€‚å…·ä½“åœ°ï¼Œæˆ‘ä»¬å…ˆåˆå¹¶ç›¸åŒå…ƒç´ ï¼Œç„¶åæŒ‰ <span class="math inline">\(a_i\)</span> ä¸ºç¬¬ä¸€å…³é”®å­—æ’åºã€‚åˆ†æ²»å®Œ <span class="math inline">\([l, mid]\)</span> å’Œ <span class="math inline">\([mid + 1, r]\)</span>ï¼ŒåŒæŒ‡é’ˆå»æ‰«ï¼Œè®¡ç®—è´¡çŒ®å°±ç”¨æ ‘çŠ¶æ•°ç»„ç»Ÿè®¡ä¸€ä¸‹ <span class="math inline">\(c_i\)</span> çš„ä¸ªæ•°ï¼ŒæŒ‰ <span class="math inline">\(b_i\)</span> å½’å¹¶æ’åºã€‚æœ€åè®°å¾—æ¸…ç©ºå³å¯ã€‚</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a aria-hidden="true" href="#cb2-1"></a><span class="at">const</span> <span class="dt">int</span> maxn = <span class="fl">1e5</span> + <span class="dv">5</span>, maxk = <span class="fl">2e5</span> + <span class="dv">5</span>;</span>
<span id="cb2-2"><a aria-hidden="true" href="#cb2-2"></a></span>
<span id="cb2-3"><a aria-hidden="true" href="#cb2-3"></a><span class="kw">struct</span> node {</span>
<span id="cb2-4"><a aria-hidden="true" href="#cb2-4"></a>    <span class="dt">int</span> a, b, c;</span>
<span id="cb2-5"><a aria-hidden="true" href="#cb2-5"></a>    <span class="dt">int</span> cnt, ans;</span>
<span id="cb2-6"><a aria-hidden="true" href="#cb2-6"></a>    il <span class="kw">friend</span> <span class="dt">bool</span> <span class="kw">operator</span>!=(<span class="at">const</span> node &amp;a, <span class="at">const</span> node &amp;b) {</span>
<span id="cb2-7"><a aria-hidden="true" href="#cb2-7"></a>        <span class="cf">return</span> a.a != b.a || a.b != b.b || a.c != b.c;</span>
<span id="cb2-8"><a aria-hidden="true" href="#cb2-8"></a>    }</span>
<span id="cb2-9"><a aria-hidden="true" href="#cb2-9"></a>} a0[maxn], a[maxn], tmp[maxn];</span>
<span id="cb2-10"><a aria-hidden="true" href="#cb2-10"></a></span>
<span id="cb2-11"><a aria-hidden="true" href="#cb2-11"></a>il <span class="dt">bool</span> cmp1(<span class="at">const</span> node &amp;a, <span class="at">const</span> node &amp;b) {</span>
<span id="cb2-12"><a aria-hidden="true" href="#cb2-12"></a>    <span class="cf">return</span> a.a == b.a ? (a.b == b.b ? a.c &lt; b.c : a.b &lt; b.b) : a.a &lt; b.a;</span>
<span id="cb2-13"><a aria-hidden="true" href="#cb2-13"></a>}</span>
<span id="cb2-14"><a aria-hidden="true" href="#cb2-14"></a></span>
<span id="cb2-15"><a aria-hidden="true" href="#cb2-15"></a>il <span class="dt">bool</span> cmp2(<span class="at">const</span> node &amp;a, <span class="at">const</span> node &amp;b) {</span>
<span id="cb2-16"><a aria-hidden="true" href="#cb2-16"></a>    <span class="cf">return</span> a.b == b.b ? a.c &lt; b.c : a.b &lt; b.b;</span>
<span id="cb2-17"><a aria-hidden="true" href="#cb2-17"></a>}</span>
<span id="cb2-18"><a aria-hidden="true" href="#cb2-18"></a></span>
<span id="cb2-19"><a aria-hidden="true" href="#cb2-19"></a><span class="dt">int</span> n, m, k, t[maxk], ans[maxn];</span>
<span id="cb2-20"><a aria-hidden="true" href="#cb2-20"></a></span>
<span id="cb2-21"><a aria-hidden="true" href="#cb2-21"></a><span class="dt">void</span> add(<span class="dt">int</span> x, <span class="dt">int</span> v) {</span>
<span id="cb2-22"><a aria-hidden="true" href="#cb2-22"></a>    <span class="cf">for</span> (; x &lt;= k; x += lowbit(x)) t[x] += v;</span>
<span id="cb2-23"><a aria-hidden="true" href="#cb2-23"></a>    <span class="cf">return</span>;</span>
<span id="cb2-24"><a aria-hidden="true" href="#cb2-24"></a>}</span>
<span id="cb2-25"><a aria-hidden="true" href="#cb2-25"></a></span>
<span id="cb2-26"><a aria-hidden="true" href="#cb2-26"></a><span class="dt">int</span> query(<span class="dt">int</span> x) {</span>
<span id="cb2-27"><a aria-hidden="true" href="#cb2-27"></a>    <span class="dt">int</span> ret = <span class="dv">0</span>;</span>
<span id="cb2-28"><a aria-hidden="true" href="#cb2-28"></a>    <span class="cf">for</span> (; x; x -= lowbit(x)) ret += t[x];</span>
<span id="cb2-29"><a aria-hidden="true" href="#cb2-29"></a>    <span class="cf">return</span> ret;</span>
<span id="cb2-30"><a aria-hidden="true" href="#cb2-30"></a>}</span>
<span id="cb2-31"><a aria-hidden="true" href="#cb2-31"></a></span>
<span id="cb2-32"><a aria-hidden="true" href="#cb2-32"></a><span class="dt">void</span> solve(<span class="dt">int</span> l, <span class="dt">int</span> r) {</span>
<span id="cb2-33"><a aria-hidden="true" href="#cb2-33"></a>    <span class="cf">if</span> (l == r) <span class="cf">return</span>;</span>
<span id="cb2-34"><a aria-hidden="true" href="#cb2-34"></a>    <span class="dt">int</span> mid = (l + r) &gt;&gt; <span class="dv">1</span>;</span>
<span id="cb2-35"><a aria-hidden="true" href="#cb2-35"></a>    solve(l, mid), solve(mid + <span class="dv">1</span>, r);</span>
<span id="cb2-36"><a aria-hidden="true" href="#cb2-36"></a>    <span class="dt">int</span> i, j, k = l;</span>
<span id="cb2-37"><a aria-hidden="true" href="#cb2-37"></a>    <span class="cf">for</span> (i = l, j = mid + <span class="dv">1</span>; j &lt;= r;) {</span>
<span id="cb2-38"><a aria-hidden="true" href="#cb2-38"></a>        <span class="cf">while</span> (a[j].b &gt;= a[i].b &amp;&amp; i &lt;= mid) {</span>
<span id="cb2-39"><a aria-hidden="true" href="#cb2-39"></a>            add(a[i].c, a[i].cnt);</span>
<span id="cb2-40"><a aria-hidden="true" href="#cb2-40"></a>            tmp[k++] = a[i++];</span>
<span id="cb2-41"><a aria-hidden="true" href="#cb2-41"></a>        }</span>
<span id="cb2-42"><a aria-hidden="true" href="#cb2-42"></a>        a[j].ans += query(a[j].c), tmp[k++] = a[j++];</span>
<span id="cb2-43"><a aria-hidden="true" href="#cb2-43"></a>    }</span>
<span id="cb2-44"><a aria-hidden="true" href="#cb2-44"></a>    <span class="cf">for</span> (j = l; j &lt; i; ++j) add(a[j].c, -a[j].cnt);</span>
<span id="cb2-45"><a aria-hidden="true" href="#cb2-45"></a>    <span class="cf">while</span> (i &lt;= mid) tmp[k++] = a[i++];</span>
<span id="cb2-46"><a aria-hidden="true" href="#cb2-46"></a>    FOR(i, l, r) a[i] = tmp[i];</span>
<span id="cb2-47"><a aria-hidden="true" href="#cb2-47"></a>    <span class="cf">return</span>;</span>
<span id="cb2-48"><a aria-hidden="true" href="#cb2-48"></a>}</span>
<span id="cb2-49"><a aria-hidden="true" href="#cb2-49"></a></span>
<span id="cb2-50"><a aria-hidden="true" href="#cb2-50"></a><span class="dt">int</span> main() {</span>
<span id="cb2-51"><a aria-hidden="true" href="#cb2-51"></a>    read(n), read(k);</span>
<span id="cb2-52"><a aria-hidden="true" href="#cb2-52"></a>    FOR(i, <span class="dv">1</span>, n) read(a0[i].a), read(a0[i].b), read(a0[i].c);</span>
<span id="cb2-53"><a aria-hidden="true" href="#cb2-53"></a>    <span class="bu">std::</span>sort(a0 + <span class="dv">1</span>, a0 + n + <span class="dv">1</span>, cmp1);</span>
<span id="cb2-54"><a aria-hidden="true" href="#cb2-54"></a>    <span class="dt">int</span> same = <span class="dv">0</span>;</span>
<span id="cb2-55"><a aria-hidden="true" href="#cb2-55"></a>    FOR(i, <span class="dv">1</span>, n) {</span>
<span id="cb2-56"><a aria-hidden="true" href="#cb2-56"></a>        ++same;</span>
<span id="cb2-57"><a aria-hidden="true" href="#cb2-57"></a>        <span class="cf">if</span> (a0[i] != a0[i + <span class="dv">1</span>]) {</span>
<span id="cb2-58"><a aria-hidden="true" href="#cb2-58"></a>            a[++m] = a0[i];</span>
<span id="cb2-59"><a aria-hidden="true" href="#cb2-59"></a>            a[m].cnt = same;</span>
<span id="cb2-60"><a aria-hidden="true" href="#cb2-60"></a>            a[m].ans = <span class="dv">0</span>;</span>
<span id="cb2-61"><a aria-hidden="true" href="#cb2-61"></a>            same = <span class="dv">0</span>;</span>
<span id="cb2-62"><a aria-hidden="true" href="#cb2-62"></a>        }</span>
<span id="cb2-63"><a aria-hidden="true" href="#cb2-63"></a>    }</span>
<span id="cb2-64"><a aria-hidden="true" href="#cb2-64"></a>    solve(<span class="dv">1</span>, m);</span>
<span id="cb2-65"><a aria-hidden="true" href="#cb2-65"></a>    FOR(i, <span class="dv">1</span>, m) ans[a[i].ans + a[i].cnt - <span class="dv">1</span>] += a[i].cnt;</span>
<span id="cb2-66"><a aria-hidden="true" href="#cb2-66"></a>    FOR(i, <span class="dv">0</span>, n - <span class="dv">1</span>) print(ans[i], <span class="ch">'</span><span class="sc">\n</span><span class="ch">'</span>);</span>
<span id="cb2-67"><a aria-hidden="true" href="#cb2-67"></a>    <span class="cf">return</span> output(), <span class="dv">0</span>;</span>
<span id="cb2-68"><a aria-hidden="true" href="#cb2-68"></a>}</span></code></pre></div>
<p>ä¸å¦¨æ¥çœ‹å‡ é“ä¸‰ç»´ååºçš„ä¾‹é¢˜ï¼š</p>
<ul>
<li><a href="https://www.luogu.com.cn/problem/P4169"><strong>P4169 [Violet]å¤©ä½¿ç©å¶/SJYæ‘†æ£‹å­</strong></a>ï¼šå¾ˆç®€å•çš„å¡å¸¸é¢˜ã€‚<a href="/sol-luogu-p4169/">é¢˜è§£</a>ã€‚</li>
<li><a href="https://www.luogu.com.cn/problem/P4390"><strong>P4390 [BOI2007]Mokia æ‘©åŸºäºš</strong></a>ï¼šå®¹æ–¥è½¬åŒ–ä¸€ä¸‹ï¼Œå˜ä¸ºäºŒç»´æ•°ç‚¹ï¼Œä¸Šä¸‰ç»´ååºã€‚</li>
</ul>
<h4 id="å››ç»´ååº">å››ç»´ååº</h4>
<p>KDT å’Œ cdq å¥— cdq éƒ½å¯ä»¥ã€‚</p>
<p>æˆ‘ä»¬å›å¿†ä¸€ä¸‹ä¹‹å‰å­¦çš„ï¼š</p>
<ul>
<li>äºŒç»´ååºï¼šé¦–å…ˆæ’åºå»æ‰ä¸€ç»´ï¼Œç„¶ååœ¨<strong>æŒ‰ç…§ç¬¬äºŒç»´å½’å¹¶</strong>ï¼Œå°±å¯ä»¥è¿›è¡Œ <span class="math inline">\((L, a)\)</span> å¯¹ <span class="math inline">\((R, b)\)</span> çš„è´¡çŒ®ç»Ÿè®¡ã€‚</li>
<li>ä¸‰ç»´ååºï¼šé¦–å…ˆæ’åºå»æ‰ç¬¬ä¸€ç»´ï¼ŒæŒ‰ç…§<strong>ç¬¬äºŒç»´å½’å¹¶</strong>ï¼Œä½¿ç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤å°±å¯ä»¥è¿›è¡Œ <span class="math inline">\((L, b, c)\)</span> å¯¹ <span class="math inline">\((R, b_2, c_2)\)</span> çš„è´¡çŒ®ç»Ÿè®¡ã€‚</li>
<li>å››ç»´ååºï¼šé¦–å…ˆæ’åºå»æ‰ç¬¬ä¸€ç»´ï¼Œåˆ†æ²»ä¸‹å»ä¹‹åæˆ‘ä»¬å°±éœ€è¦å¤„ç† <span class="math inline">\((L, b, c, d)\)</span> å¯¹ <span class="math inline">\((R, b_2, c_2, d_2)\)</span> çš„è´¡çŒ®ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æŠŠç¬¬ä¸€ç»´æ‰“ä¸Š <span class="math inline">\(L/R\)</span> çš„æ ‡è®°ï¼Œç„¶åæŒ‰ç…§ <span class="math inline">\(b\)</span> å½’å¹¶ã€‚æ­¤æ—¶ <span class="math inline">\(b\)</span> æ˜¯æœ‰åºçš„ï¼Œä¹‹åå¤åˆ¶ä¸€éåºåˆ—å†ä½¿ç”¨ä¸€æ¬¡ cdqï¼Œå¤„ç† <span class="math inline">\((L, L, c, d)\)</span> å¯¹ <span class="math inline">\((R, R, c, d)\)</span> çš„å½±å“ã€‚</li>
</ul>
<p>ä¸‹é¢ä¼šæåˆ°çš„ <a href="https://www.luogu.com.cn/problem/P3769"><strong>P3769 [CHå¼±çœèƒ¡ç­–R2]TATT</strong></a> çš„ä»£ç ï¼š</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a aria-hidden="true" href="#cb3-1"></a><span class="at">const</span> <span class="dt">int</span> maxn = <span class="fl">2e5</span> + <span class="dv">5</span>;</span>
<span id="cb3-2"><a aria-hidden="true" href="#cb3-2"></a><span class="dt">int</span> n;</span>
<span id="cb3-3"><a aria-hidden="true" href="#cb3-3"></a><span class="kw">struct</span> node {</span>
<span id="cb3-4"><a aria-hidden="true" href="#cb3-4"></a>    <span class="dt">int</span> x, y, z, w, cnt, id, ans, ok;</span>
<span id="cb3-5"><a aria-hidden="true" href="#cb3-5"></a>    il <span class="dt">bool</span> <span class="kw">operator</span>==(<span class="at">const</span> node &amp;b) {<span class="cf">return</span> x == b.x &amp;&amp; y == b.y &amp;&amp; z == b.z &amp;&amp; w == b.w;}</span>
<span id="cb3-6"><a aria-hidden="true" href="#cb3-6"></a>} a[maxn], tmp[maxn];</span>
<span id="cb3-7"><a aria-hidden="true" href="#cb3-7"></a><span class="dt">int</span> w0[maxn], pos2[maxn], pos1[maxn];</span>
<span id="cb3-8"><a aria-hidden="true" href="#cb3-8"></a></span>
<span id="cb3-9"><a aria-hidden="true" href="#cb3-9"></a><span class="kw">auto</span> cmpx = [](<span class="at">const</span> node &amp;a, <span class="at">const</span> node &amp;b) {<span class="cf">return</span> a.x == b.x ? (a.y == b.y ? (a.z == b.z ? a.w &lt; b.w : a.z &lt; b.z) : a.y &lt; b.y) : a.x &lt; b.x;};</span>
<span id="cb3-10"><a aria-hidden="true" href="#cb3-10"></a><span class="kw">auto</span> cmpy = [](<span class="at">const</span> node &amp;a, <span class="at">const</span> node &amp;b) {<span class="cf">return</span> a.y == b.y ? (a.x == b.x ? (a.z == b.z ? a.w &lt; b.w : a.z &lt; b.z) : a.x &lt; b.x) : a.y &lt; b.y;};</span>
<span id="cb3-11"><a aria-hidden="true" href="#cb3-11"></a><span class="kw">auto</span> cmpz = [](<span class="at">const</span> node &amp;a, <span class="at">const</span> node &amp;b) {<span class="cf">return</span> a.z &lt; b.z;};</span>
<span id="cb3-12"><a aria-hidden="true" href="#cb3-12"></a></span>
<span id="cb3-13"><a aria-hidden="true" href="#cb3-13"></a><span class="dt">int</span> t[maxn];</span>
<span id="cb3-14"><a aria-hidden="true" href="#cb3-14"></a></span>
<span id="cb3-15"><a aria-hidden="true" href="#cb3-15"></a><span class="dt">void</span> add(<span class="dt">int</span> x, <span class="dt">int</span> v) {</span>
<span id="cb3-16"><a aria-hidden="true" href="#cb3-16"></a>    <span class="cf">for</span> (; x &lt;= n; x += lowbit(x))</span>
<span id="cb3-17"><a aria-hidden="true" href="#cb3-17"></a>        chkmax(t[x], v);</span>
<span id="cb3-18"><a aria-hidden="true" href="#cb3-18"></a>    <span class="cf">return</span>;</span>
<span id="cb3-19"><a aria-hidden="true" href="#cb3-19"></a>}</span>
<span id="cb3-20"><a aria-hidden="true" href="#cb3-20"></a></span>
<span id="cb3-21"><a aria-hidden="true" href="#cb3-21"></a><span class="dt">int</span> query(<span class="dt">int</span> x) {</span>
<span id="cb3-22"><a aria-hidden="true" href="#cb3-22"></a>    <span class="dt">int</span> ans = <span class="dv">0</span>;</span>
<span id="cb3-23"><a aria-hidden="true" href="#cb3-23"></a>    <span class="cf">for</span> (; x; x -= lowbit(x))</span>
<span id="cb3-24"><a aria-hidden="true" href="#cb3-24"></a>        chkmax(ans, t[x]);</span>
<span id="cb3-25"><a aria-hidden="true" href="#cb3-25"></a>    <span class="cf">return</span> ans;</span>
<span id="cb3-26"><a aria-hidden="true" href="#cb3-26"></a>}</span>
<span id="cb3-27"><a aria-hidden="true" href="#cb3-27"></a></span>
<span id="cb3-28"><a aria-hidden="true" href="#cb3-28"></a><span class="dt">void</span> del(<span class="dt">int</span> x) {</span>
<span id="cb3-29"><a aria-hidden="true" href="#cb3-29"></a>    <span class="cf">for</span> (; x &lt;= n; x += lowbit(x))</span>
<span id="cb3-30"><a aria-hidden="true" href="#cb3-30"></a>        t[x] = <span class="dv">0</span>;</span>
<span id="cb3-31"><a aria-hidden="true" href="#cb3-31"></a>    <span class="cf">return</span>;</span>
<span id="cb3-32"><a aria-hidden="true" href="#cb3-32"></a>}</span>
<span id="cb3-33"><a aria-hidden="true" href="#cb3-33"></a></span>
<span id="cb3-34"><a aria-hidden="true" href="#cb3-34"></a><span class="dt">void</span> solve2(<span class="dt">int</span> l, <span class="dt">int</span> r) {</span>
<span id="cb3-35"><a aria-hidden="true" href="#cb3-35"></a>    <span class="cf">if</span> (l == r) <span class="cf">return</span>;</span>
<span id="cb3-36"><a aria-hidden="true" href="#cb3-36"></a>    <span class="dt">int</span> mid = (l + r) &gt;&gt; <span class="dv">1</span>;</span>
<span id="cb3-37"><a aria-hidden="true" href="#cb3-37"></a>    solve2(l, mid);</span>
<span id="cb3-38"><a aria-hidden="true" href="#cb3-38"></a>    sort(a + l, a + mid + <span class="dv">1</span>, cmpz);</span>
<span id="cb3-39"><a aria-hidden="true" href="#cb3-39"></a>    sort(a + mid + <span class="dv">1</span>, a + r + <span class="dv">1</span>, cmpz);</span>
<span id="cb3-40"><a aria-hidden="true" href="#cb3-40"></a>    <span class="dt">int</span> i, j;</span>
<span id="cb3-41"><a aria-hidden="true" href="#cb3-41"></a>    <span class="cf">for</span> (i = l, j = mid + <span class="dv">1</span>; j &lt;= r; ++j) {</span>
<span id="cb3-42"><a aria-hidden="true" href="#cb3-42"></a>        <span class="cf">while</span> (a[i].z &lt;= a[j].z &amp;&amp; i &lt;= mid) {</span>
<span id="cb3-43"><a aria-hidden="true" href="#cb3-43"></a>            <span class="cf">if</span> (a[i].ok) add(a[i].w, a[i].ans);</span>
<span id="cb3-44"><a aria-hidden="true" href="#cb3-44"></a>            ++i;</span>
<span id="cb3-45"><a aria-hidden="true" href="#cb3-45"></a>        }</span>
<span id="cb3-46"><a aria-hidden="true" href="#cb3-46"></a>        <span class="cf">if</span> (!a[j].ok) chkmax(a[j].ans, query(a[j].w) + a[j].cnt);</span>
<span id="cb3-47"><a aria-hidden="true" href="#cb3-47"></a>    }</span>
<span id="cb3-48"><a aria-hidden="true" href="#cb3-48"></a>    <span class="cf">for</span> (; i &gt;= l; --i) <span class="cf">if</span> (a[i].ok) del(a[i].w);</span>
<span id="cb3-49"><a aria-hidden="true" href="#cb3-49"></a>    FOR(i, l, r) tmp[pos2[a[i].id]] = a[i];</span>
<span id="cb3-50"><a aria-hidden="true" href="#cb3-50"></a>    FOR(i, l, r) a[i] = tmp[i];</span>
<span id="cb3-51"><a aria-hidden="true" href="#cb3-51"></a>    solve2(mid + <span class="dv">1</span>, r);</span>
<span id="cb3-52"><a aria-hidden="true" href="#cb3-52"></a>    <span class="cf">return</span>;</span>
<span id="cb3-53"><a aria-hidden="true" href="#cb3-53"></a>}</span>
<span id="cb3-54"><a aria-hidden="true" href="#cb3-54"></a></span>
<span id="cb3-55"><a aria-hidden="true" href="#cb3-55"></a><span class="dt">void</span> solve1(<span class="dt">int</span> l, <span class="dt">int</span> r) {<span class="co">//ç¬¬ä¸€å±‚ cdq åˆ†æ²»</span></span>
<span id="cb3-56"><a aria-hidden="true" href="#cb3-56"></a>    <span class="cf">if</span> (l == r) <span class="cf">return</span>;</span>
<span id="cb3-57"><a aria-hidden="true" href="#cb3-57"></a>    <span class="dt">int</span> mid = (l + r) &gt;&gt; <span class="dv">1</span>;</span>
<span id="cb3-58"><a aria-hidden="true" href="#cb3-58"></a>    solve1(l, mid);</span>
<span id="cb3-59"><a aria-hidden="true" href="#cb3-59"></a>    FOR(i, l, mid) a[i].ok = <span class="dv">1</span>;<span class="co">//å¾ˆé‡è¦çš„æ‰“æ ‡è®°è¿‡ç¨‹ã€‚</span></span>
<span id="cb3-60"><a aria-hidden="true" href="#cb3-60"></a>    FOR(i, mid + <span class="dv">1</span>, r) a[i].ok = <span class="dv">0</span>;</span>
<span id="cb3-61"><a aria-hidden="true" href="#cb3-61"></a>    sort(a + l, a + r + <span class="dv">1</span>, cmpy);</span>
<span id="cb3-62"><a aria-hidden="true" href="#cb3-62"></a>    FOR(i, l, r) pos2[a[i].id] = i;<span class="co">//è®°å½•ä¸€ä¸‹ç¬¬äºŒå±‚åºåˆ—</span></span>
<span id="cb3-63"><a aria-hidden="true" href="#cb3-63"></a>    solve2(l, r);</span>
<span id="cb3-64"><a aria-hidden="true" href="#cb3-64"></a>    FOR(i, l, r) tmp[pos1[a[i].id]] = a[i];</span>
<span id="cb3-65"><a aria-hidden="true" href="#cb3-65"></a>    FOR(i, l, r) a[i] = tmp[i];</span>
<span id="cb3-66"><a aria-hidden="true" href="#cb3-66"></a>    solve1(mid + <span class="dv">1</span>, r);</span>
<span id="cb3-67"><a aria-hidden="true" href="#cb3-67"></a>    <span class="cf">return</span>;</span>
<span id="cb3-68"><a aria-hidden="true" href="#cb3-68"></a>}</span>
<span id="cb3-69"><a aria-hidden="true" href="#cb3-69"></a></span>
<span id="cb3-70"><a aria-hidden="true" href="#cb3-70"></a><span class="dt">int</span> main() {</span>
<span id="cb3-71"><a aria-hidden="true" href="#cb3-71"></a>    read(n);</span>
<span id="cb3-72"><a aria-hidden="true" href="#cb3-72"></a>    FOR(i, <span class="dv">1</span>, n) read(a[i].x, a[i].y, a[i].z, a[i].w), w0[i] = a[i].w, a[i].cnt = <span class="dv">1</span>;</span>
<span id="cb3-73"><a aria-hidden="true" href="#cb3-73"></a>    sort(w0 + <span class="dv">1</span>, w0 + n + <span class="dv">1</span>);</span>
<span id="cb3-74"><a aria-hidden="true" href="#cb3-74"></a>    <span class="dt">int</span> tot = unique(w0 + <span class="dv">1</span>, w0 + n + <span class="dv">1</span>) - w0 - <span class="dv">1</span>;</span>
<span id="cb3-75"><a aria-hidden="true" href="#cb3-75"></a>    FOR(i, <span class="dv">1</span>, n) a[i].w = lower_bound(w0 + <span class="dv">1</span>, w0 + tot + <span class="dv">1</span>, a[i].w) - w0;</span>
<span id="cb3-76"><a aria-hidden="true" href="#cb3-76"></a>    <span class="dt">int</span> n0 = n; n = <span class="dv">1</span>;</span>
<span id="cb3-77"><a aria-hidden="true" href="#cb3-77"></a>    sort(a + <span class="dv">1</span>, a + n0 + <span class="dv">1</span>, cmpx);</span>
<span id="cb3-78"><a aria-hidden="true" href="#cb3-78"></a>    FOR(i, <span class="dv">2</span>, n0) {</span>
<span id="cb3-79"><a aria-hidden="true" href="#cb3-79"></a>        <span class="cf">if</span> (a[i].x != a[n].x || a[i].y != a[n].y || a[i].z != a[n].z || a[i].w != a[n].w)</span>
<span id="cb3-80"><a aria-hidden="true" href="#cb3-80"></a>            a[++n] = a[i];</span>
<span id="cb3-81"><a aria-hidden="true" href="#cb3-81"></a>        <span class="cf">else</span> a[n].cnt += a[i].cnt;</span>
<span id="cb3-82"><a aria-hidden="true" href="#cb3-82"></a>    }</span>
<span id="cb3-83"><a aria-hidden="true" href="#cb3-83"></a>    FOR(i, <span class="dv">1</span>, n) a[i].id = i, a[i].ans = a[i].cnt, pos1[a[i].id] = i;</span>
<span id="cb3-84"><a aria-hidden="true" href="#cb3-84"></a>    solve1(<span class="dv">1</span>, n);</span>
<span id="cb3-85"><a aria-hidden="true" href="#cb3-85"></a>    <span class="dt">int</span> ans = <span class="dv">0</span>;</span>
<span id="cb3-86"><a aria-hidden="true" href="#cb3-86"></a>    FOR(i, <span class="dv">1</span>, n) chkmax(ans, a[i].ans);</span>
<span id="cb3-87"><a aria-hidden="true" href="#cb3-87"></a>    print(ans);</span>
<span id="cb3-88"><a aria-hidden="true" href="#cb3-88"></a>    <span class="cf">return</span> output(), <span class="dv">0</span>;</span>
<span id="cb3-89"><a aria-hidden="true" href="#cb3-89"></a>}</span></code></pre></div>
<h3 id="ä¼˜åŒ–-dp">ä¼˜åŒ– dp</h3>
<p>æœ‰äº›æ—¶å€™ï¼Œä¸€äº› 1D1D æœ´ç´ çš„è½¬ç§»çš„å¤æ‚åº¦å¯èƒ½æ¯”è¾ƒé«˜ï¼ˆ<span class="math inline">\(O(n^2)\)</span> æˆ–è€…æ›´é«˜ï¼‰ï¼Œè€Œè‹¥å…¶æ»¡è¶³ç‰¹æ®Šæ€§è´¨ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ cdq åˆ†æ²»ï¼Œç”¨ç±»ä¼¼å¤„ç†ç‚¹å¯¹å…³ç³»çš„æ–¹æ³•å¤„ç† dp æ•°ç»„é—´çš„è½¬ç§»ï¼Œä¸€èˆ¬æ¥è¯´å¯ä»¥ä¼˜åŒ–è‡³ <span class="math inline">\(O(n\log^2n)\)</span>ã€‚</p>
<p><strong><a href="https://www.luogu.com.cn/problem/P2487">P2487 [SDOI2011]æ‹¦æˆªå¯¼å¼¹</a></strong>ã€‚é¢˜æ„ï¼šæ±‚äºŒå…ƒä¸é™å­åºåˆ—çš„é•¿åº¦ã€‚ä»¥åŠä¸€ä¸ªå…ƒç´ è¢«é€‰å…¥æœ€é•¿å­åºåˆ—çš„æ¦‚ç‡ã€‚</p>
<p>é¦–å…ˆè€ƒè™‘è§£å†³ç¬¬ä¸€é—®ï¼šå¯ä»¥è®¾ <span class="math inline">\(f_{i}\)</span> ä¸ºä»¥ <span class="math inline">\(i\)</span> ç»“å°¾çš„æœ€é•¿ä¸é™å­åºåˆ—çš„é•¿åº¦ï¼Œåˆ™æˆ‘ä»¬æœ‰ dpï¼š <span class="math display">\[
f_i = f_j + 1\quad(j &lt; i\land v_j\ge v_i\land h_j\ge h_i)
\]</span> ç„¶åå¾ˆè‡ªç„¶çš„å°±æœ‰äº†ä¸€ä¸ªä¸‰ç»´ååºçš„å½¢å¼ã€‚ï¼ˆ<span class="math inline">\(t_j &lt; t_i, v_j\ge v_i, h_j\ge h_i\)</span>ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘è¿›è¡Œ cdq åˆ†æ²»ã€‚</p>
<p>å…·ä½“åœ°ï¼Œæˆ‘ä»¬å°† <span class="math inline">\(v_i\)</span> ç¦»æ•£åŒ–ã€‚ç„¶åé€’å½’åœ¨æ¯ä¸€å±‚ä¸Šè€ƒè™‘å·¦åŠè¾¹å¯¹äºå³åŠè¾¹çš„è´¡çŒ®ã€‚è¿™æ—¶æˆ‘ä»¬å‘ç°ä¸€å®šè¦ç®—å¥½å·¦åŠè¾¹æ‰èƒ½ç®—å³åŠè¾¹ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åˆ†æ²»æ ‘ä¸Šæ˜¯<strong>ä¸­åºéå†</strong>çš„ã€‚</p>
<p>å…·ä½“åœ°ï¼Œæ¯æ¬¡å…ˆå°†åˆ†æ²»åŒºé—´æŒ‰ç…§ <span class="math inline">\(t\)</span> æ’åºï¼Œç„¶åè§£å†³å·¦åŠè¾¹çš„ dp å€¼ï¼Œç„¶åå°†ä¸¤è¾¹åˆ†åˆ«æŒ‰ç…§ <span class="math inline">\(h_i\)</span> æ’åºï¼Œè¿™æ ·å°±ç›¸å½“äºæ˜¯ä¸€ä¸ªå½’å¹¶çš„è¿‡ç¨‹ã€‚æ‰«åˆ°ä¸€ä¸ªå·¦è¾¹çš„ <span class="math inline">\(i\)</span> å°±å°†å…¶ dp å€¼æ’å…¥çº¿æ®µæ ‘çš„ <span class="math inline">\(v_i\)</span> ä¸‹æ ‡ï¼ŒæŸ¥è¯¢ä¸€ä¸ªå³è¾¹çš„ <span class="math inline">\(j\)</span> å°±æŸ¥è¯¢çº¿æ®µæ ‘ä¸Š <span class="math inline">\([v_j, n]\)</span> ä¸­æœ€ä¼˜çš„ dp å€¼ã€‚</p>
<p>ç„¶åæˆ‘ä»¬éœ€è¦å¤„ç†ç¬¬äºŒé—®çš„è¯ï¼Œä¸å¦¨ä»¤ <span class="math inline">\(g_i\)</span> ä¸ºä»¥ <span class="math inline">\(i\)</span> ç»“å°¾çš„æœ€é•¿ä¸é™å­åºåˆ—çš„æ¡æ•°ï¼Œåˆ™è½¬ç§»å¦‚ä¸‹ï¼š <span class="math display">\[
g_i = \sum_{j &lt; i\land v_j \ge v_i\land h_j\ge h_i\land f_j + 1 = f_i}g_j 
\]</span> æˆ‘ä»¬ä»å¤´åˆ°å°¾ dp ä¸€ä¸‹ï¼Œå†å€’ç€ dp ä¸€ä¸‹ï¼Œ å°±å¯ä»¥è½»æ¾è§£å†³ç¬¬äºŒé—®äº†ï¼Œå…¶ä¸æ˜¯é‡ç‚¹ã€‚</p>
<p>cdq åˆ†æ²»ä¹Ÿå¯ä»¥ç”¨äºæ–œç‡/æ¨ªåæ ‡ä¸å•è°ƒçš„æ–œç‡ä¼˜åŒ–çš„è½¬ç§»ï¼Œä½†æ˜¯ç¬”è€…ä¸€èˆ¬é€‰æ‹©ä½¿ç”¨æ›´å¥½ç†è§£çš„æè¶…æ ‘ï¼Œè¿™é‡Œä¸å±•å¼€ã€‚</p>
<p>æ¥çœ‹ä¾‹é¢˜ï¼š</p>
<ul>
<li><p><a href="https://www.luogu.com.cn/problem/P3769"><strong>P3769 [CHå¼±çœèƒ¡ç­–R2]TATT</strong></a></p>
<p>å˜æˆå››ç»´çš„ä¸é™å­åºåˆ—äº†ã€‚cdq å¥— cdqï¼Œå››ç»´ååºã€‚</p></li>
</ul>
<h3 id="ä»¥é™åŒ–åŠ¨">ä»¥é™åŒ–åŠ¨</h3>
<p>æœ‰ä¸€ç±»<strong>å¯ä»¥ç¦»çº¿</strong>çš„æ•°æ®ç»“æ„é—®é¢˜è¦æ±‚ä½ è¿›è¡Œçš„æ“ä½œæ˜¯å½¢å¦‚ã€åš xxx çš„ä¿®æ”¹ç„¶åå›ç­” xxx çš„è¯¢é—®ã€‘ä¹‹ç±»çš„é—®é¢˜ï¼Œå¹¶ä¸”æœ‰äº›æ—¶å€™éš¾ä»¥ä½¿ç”¨æŸç§æ•°æ®ç»“æ„è¿›è¡Œç»´æŠ¤ã€‚</p>
<p>æˆ‘ä»¬å°†å…¶ç¦»çº¿ä¸‹æ¥ï¼Œä¼šå˜æˆå¦‚ä¸‹çš„æƒ…å†µï¼š</p>
<ul>
<li>æ‰€æœ‰çš„æ“ä½œï¼ˆä¿®æ”¹ï¼Œè¯¢é—®ï¼‰ä¼šæŒ‰ç…§æ—¶é—´é¡ºåºæ’æˆä¸€ä¸ªåºåˆ—ã€‚</li>
<li>å‰é¢çš„æ“ä½œä¼šå¯¹åé¢çš„è¯¢é—®äº§ç”Ÿè´¡çŒ®ã€‚è¿™æ ·çš„è´¡çŒ®å¯¹æ•°æ˜¯ <span class="math inline">\(O(n^2)\)</span> çš„ã€‚<em>å¯ä»¥å‘ç°è¿™ç§å…³ç³»è·Ÿä¹‹å‰çš„ååºé—®é¢˜å¾ˆåƒ</em>ã€‚</li>
</ul>
<p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨ cdq åˆ†æ²»æ¥ä¼˜åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚å…ˆé€’å½’å¤„ç† <span class="math inline">\([l, m]\)</span> å’Œ <span class="math inline">\([m + 1, r]\)</span> å†…éƒ¨çš„ä¿®æ”¹-è¯¢é—®å…³ç³»ï¼Œç„¶åå¤„ç†æ‰€æœ‰çš„ <span class="math inline">\(i\in[l, m], j\in[m + 1, j]\)</span> çš„ä¿®æ”¹-è¯¢é—®å…³ç³»ï¼Œå…¶ä¸­ <span class="math inline">\(i\)</span> ä¸ºä¿®æ”¹ï¼Œ<span class="math inline">\(j\)</span> ä¸ºè¯¢é—®ã€‚</p>
<p><strong>æœ‰æ—¶å¦‚æœå„ä¸ªä¿®æ”¹ä¸ç‹¬ç«‹ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸­åºéå†åˆ†æ²»æ ‘ï¼Œç†ç”±åŒä¼˜åŒ– 1D/1D çš„ dp</strong>ã€‚</p>
<ul>
<li><strong>P3157 [CQOI2011]åŠ¨æ€é€†åºå¯¹</strong>ï¼šè¿™é¢˜æ˜¯è¾ƒä¸ºç®€å•çš„ä¸‰ç»´ååºã€‚</li>
</ul>
<h3 id="åˆ†æ²»-fft">åˆ†æ²» FFT</h3>
<p>åŠåœ¨çº¿å·ç§¯ï¼Œ<strong><a href="https://www.luogu.com.cn/problem/P4721">P4721 ã€æ¨¡æ¿ã€‘åˆ†æ²» FFT</a></strong>ã€‚</p>
<p>é¢˜æ„ï¼šç»™å®š <span class="math inline">\(g_{1,\cdots,n - 1}\)</span>ï¼Œæ±‚ <span class="math inline">\(f_{0,\cdots,n - 1}\)</span>ï¼Œå…¶ä¸­ <span class="math display">\[
\begin{cases}
f_0 = 1\\
f_i = \displaystyle\sum_{j = 1}^if_{i - j}g_j
\end{cases}
\]</span> åˆ†æè¿™ä¸ªå¼å­ï¼Œå‘ç°æ˜¯ä¸ªå·ç§¯ï¼Œè€ƒè™‘ä¸Š NTTï¼Œä½†æ˜¯ä¼šå‘ç°è¿™ä¸ªä¸œè¥¿ä¾èµ–å‰é¢ç®—å¥½çš„ï¼Œæ²¡æ³•ç›´æ¥ NTTï¼Œåªèƒ½ <span class="math inline">\(O(n^2)\)</span>ï¼Ÿ</p>
<p>è€ƒè™‘åˆ†æ²»ä¸€æ‰‹ï¼šå‡è®¾æ±‚å‡ºäº† <span class="math inline">\([l, mid]\)</span> çš„ç­”æ¡ˆï¼Œç°åœ¨è¦ç®— <span class="math inline">\([l, mid]\to[mid + 1, r]\)</span> çš„å½±å“ï¼Œä¸éš¾å‘ç°è¿™é‡Œæ˜¯å¯ä»¥ç›´æ¥å·çš„ã€‚æ­¤å¤„çš„æ€æƒ³å°±æ˜¯å…¸å‹çš„ cdq åˆ†æ²»ï¼šè€ƒè™‘è·¨è¶Šä¸­ç‚¹çš„è´¡çŒ®ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦ <span class="math inline">\(O(n\log^2n)\)</span>ï¼Œå¯ä»¥ç”¨äºä¼˜åŒ–å¤šé¡¹å¼ expï¼ˆç‰›è¿­è·‘çš„æ¯”è¿™ä¸ªæ…¢ï¼‰ã€‚ <span class="math display">\[
G(x) = \exp(F(x))
\]</span> æ±‚å¯¼æœ‰ <span class="math display">\[
G'(x) = G(x)F'(x)
\]</span> æå–ç¬¬ <span class="math inline">\(n\)</span> é¡¹ç³»æ•°ï¼Œ <span class="math display">\[
(n + 1)g_{n + 1} = \sum_{i = 0}^n(i + 1)f_{i + 1}g_{n - i}
\]</span> æ•… <span class="math display">\[
g_n = \frac{1}{n}\sum_{i = 1}^nif_ig_{n - i}
\]</span> æ•…å¯ä»¥åŠåœ¨çº¿å·ç§¯ã€‚</p>
<h2 id="æ•´ä½“äºŒåˆ†">æ•´ä½“äºŒåˆ†</h2>
<h3 id="ç®€ä»‹-1">ç®€ä»‹</h3>
<p>æ¥å¡«å‘ on 22/05/27ã€‚</p>
<p>èƒ½è§£å†³ä¸€éƒ¨åˆ†ç¦»çº¿ä¸”æ»¡è¶³å¯äºŒåˆ†æ€§çš„é—®é¢˜ã€‚ä¸»è¦æ€æƒ³æ˜¯å°†æ‰€æœ‰çš„è¯¢é—®ä¸€èµ·è¿›è¡ŒäºŒåˆ†ã€‚</p>
<blockquote>
<p>å¯ä»¥ä½¿ç”¨æ•´ä½“äºŒåˆ†è§£å†³çš„é¢˜ç›®éœ€è¦æ»¡è¶³ä»¥ä¸‹æ€§è´¨ï¼š</p>
<ol type="1">
<li><p>è¯¢é—®çš„ç­”æ¡ˆå…·æœ‰å¯äºŒåˆ†æ€§ï¼›</p></li>
<li><p><strong>ä¿®æ”¹å¯¹åˆ¤å®šç­”æ¡ˆçš„è´¡çŒ®äº’ç›¸ç‹¬ç«‹</strong>ï¼Œä¿®æ”¹ä¹‹é—´äº’ä¸å½±å“æ•ˆæœï¼›</p></li>
<li><p>ä¿®æ”¹å¦‚æœå¯¹åˆ¤å®šç­”æ¡ˆæœ‰è´¡çŒ®ï¼Œåˆ™è´¡çŒ®ä¸ºä¸€ç¡®å®šçš„ä¸åˆ¤å®šæ ‡å‡†æ— å…³çš„å€¼ï¼›</p></li>
<li><p>è´¡çŒ®æ»¡è¶³äº¤æ¢å¾‹ï¼Œç»“åˆå¾‹ï¼Œå…·æœ‰å¯åŠ æ€§ï¼›</p></li>
<li><p>é¢˜ç›®å…è®¸ä½¿ç”¨ç¦»çº¿ç®—æ³•</p>
<p>â€”â€”è®¸æ˜Šç„¶ã€Šæµ…è°ˆæ•°æ®ç»“æ„é¢˜å‡ ä¸ªéç»å…¸è§£æ³•ã€‹</p></li>
</ol>
</blockquote>
<h3 id="æµç¨‹">æµç¨‹</h3>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬ä»¤ <span class="math inline">\([l,r]\)</span> ä¸ºç­”æ¡ˆå€¼åŸŸï¼Œ<span class="math inline">\([L,R]\)</span> ä¸ºç­”æ¡ˆå®šä¹‰åŸŸï¼Œ</p>
<ul>
<li>å…ˆå°†æ‰€æœ‰æ“ä½œï¼ˆåŒ…å«ä¿®æ”¹å’Œè¯¢é—®ï¼‰<strong>æŒ‰æ—¶é—´é¡ºåº</strong>å­˜å‚¨ï¼Œç„¶ååˆ†æ²»ã€‚</li>
<li>åœ¨æ¯å±‚åˆ†æ²»ä¸­ï¼Œåˆ©ç”¨æ•°æ®ç»“æ„ï¼ˆä¸€èˆ¬ä¸º BITï¼‰ç»Ÿè®¡å½“å‰æŸ¥è¯¢çš„ç­”æ¡ˆå’Œ <span class="math inline">\(mid\)</span> ä¹‹é—´çš„å…³ç³»ã€‚</li>
<li>æ ¹æ®æŸ¥è¯¢å‡ºçš„ç­”æ¡ˆä¸ <span class="math inline">\(mid\)</span> ä¹‹é—´çš„å…³ç³»å°†æ“ä½œåºåˆ—åˆ†ä¸º <span class="math inline">\(q_1\)</span> å’Œ <span class="math inline">\(q_2\)</span> ä¸¤éƒ¨åˆ†å¹¶é€’å½’å¤„ç†ã€‚</li>
<li>å½“ <span class="math inline">\(l=r\)</span> çš„æ—¶å€™æ‰¾åˆ°ç­”æ¡ˆï¼Œè¿”å›ã€‚</li>
</ul>
<p>æ­¤å¤„ç”¨ä¸€ä¸ªä¾‹é¢˜æ¥è¯´æ˜ã€‚</p>
<blockquote>
<p>ä¾‹é¢˜ <span class="math inline">\(1\)</span>ï¼š<a href="https://www.luogu.com.cn/problem/P3834">P3834 ã€æ¨¡æ¿ã€‘å¯æŒä¹…åŒ–çº¿æ®µæ ‘ 2</a></p>
<p>é™æ€åŒºé—´ç¬¬ <span class="math inline">\(k\)</span> å°ï¼Œå…è®¸ç¦»çº¿ã€‚</p>
</blockquote>
<p>é¦–å…ˆå¯¹äºå•æ¬¡è¯¢é—®ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘äºŒåˆ†è§£å†³ã€‚ä½†æ˜¯å¯¹äºäºŒåˆ†çš„åˆ¤å®šï¼Œæˆ‘ä»¬å°±ä¸èƒ½æ¯æ¬¡éƒ½ <span class="math inline">\(O(n\log n)\)</span> æ¥åˆ¤äº†ã€‚</p>
<p>ä¸å¦¨å°†æ•°å­—çœ‹ä½œâ€œæ“ä½œâ€ï¼ˆä¿è¯è¿™äº›â€œæ“ä½œâ€åœ¨è¯¢é—®ä¹‹å‰ï¼‰ï¼Œæ¯å±‚åˆ†æ²»åªè€ƒè™‘ä¼šå¯¹ç­”æ¡ˆ <span class="math inline">\(\le mid\)</span> çš„è¯¢é—®äº§ç”Ÿå½±å“çš„æ•°ï¼Œå°†ä»–ä»¬æ’å…¥ä»¥æ•°ç»„ä½ç½®ä¸ºä¸‹æ ‡çš„æ ‘çŠ¶æ•°ç»„è¿›è¡Œç»´æŠ¤ï¼Œç„¶åä¾¿å¯å¾ˆæ–¹ä¾¿çš„åˆ¤æ–­å½“å‰åŒºé—´å†…çš„æ¯ä¸ªåŒºé—´çš„ç­”æ¡ˆæ˜¯å¦ <span class="math inline">\(\le mid\)</span>ï¼Œä¾æ­¤åˆ†æ²»ã€‚è¯¦è§ä»£ç ï¼š</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a aria-hidden="true" href="#cb4-1"></a><span class="at">const</span> <span class="dt">int</span> maxn = <span class="fl">2e5</span> + <span class="dv">5</span>;</span>
<span id="cb4-2"><a aria-hidden="true" href="#cb4-2"></a><span class="at">const</span> <span class="dt">int</span> INF = <span class="fl">1e9</span>;</span>
<span id="cb4-3"><a aria-hidden="true" href="#cb4-3"></a><span class="dt">int</span> n, m, totv, totq, a0[maxn], a[maxn], ans[maxn];</span>
<span id="cb4-4"><a aria-hidden="true" href="#cb4-4"></a><span class="kw">using</span> fastIO::is;</span>
<span id="cb4-5"><a aria-hidden="true" href="#cb4-5"></a><span class="kw">using</span> fastIO::os;</span>
<span id="cb4-6"><a aria-hidden="true" href="#cb4-6"></a></span>
<span id="cb4-7"><a aria-hidden="true" href="#cb4-7"></a><span class="kw">struct</span> Query {</span>
<span id="cb4-8"><a aria-hidden="true" href="#cb4-8"></a>    <span class="dt">int</span> l, r, k, id, type;</span>
<span id="cb4-9"><a aria-hidden="true" href="#cb4-9"></a>} q[maxn &lt;&lt; <span class="dv">1</span>], q1[maxn &lt;&lt; <span class="dv">1</span>], q2[maxn &lt;&lt; <span class="dv">1</span>];</span>
<span id="cb4-10"><a aria-hidden="true" href="#cb4-10"></a></span>
<span id="cb4-11"><a aria-hidden="true" href="#cb4-11"></a><span class="dt">int</span> t[maxn];</span>
<span id="cb4-12"><a aria-hidden="true" href="#cb4-12"></a></span>
<span id="cb4-13"><a aria-hidden="true" href="#cb4-13"></a><span class="dt">void</span> add(<span class="dt">int</span> x, <span class="dt">int</span> v) {</span>
<span id="cb4-14"><a aria-hidden="true" href="#cb4-14"></a>    <span class="cf">for</span> (; x &lt;= n; x += lowbit(x)) t[x] += v;</span>
<span id="cb4-15"><a aria-hidden="true" href="#cb4-15"></a>    <span class="cf">return</span>;</span>
<span id="cb4-16"><a aria-hidden="true" href="#cb4-16"></a>}</span>
<span id="cb4-17"><a aria-hidden="true" href="#cb4-17"></a></span>
<span id="cb4-18"><a aria-hidden="true" href="#cb4-18"></a><span class="dt">int</span> sum(<span class="dt">int</span> x) {</span>
<span id="cb4-19"><a aria-hidden="true" href="#cb4-19"></a>    <span class="dt">int</span> res = <span class="dv">0</span>;</span>
<span id="cb4-20"><a aria-hidden="true" href="#cb4-20"></a>    <span class="cf">for</span> (; x; x  -= lowbit(x)) res += t[x];</span>
<span id="cb4-21"><a aria-hidden="true" href="#cb4-21"></a>    <span class="cf">return</span> res;</span>
<span id="cb4-22"><a aria-hidden="true" href="#cb4-22"></a>}</span>
<span id="cb4-23"><a aria-hidden="true" href="#cb4-23"></a></span>
<span id="cb4-24"><a aria-hidden="true" href="#cb4-24"></a><span class="dt">void</span> solve(<span class="dt">int</span> l, <span class="dt">int</span> r, <span class="dt">int</span> ql, <span class="dt">int</span> qr) {</span>
<span id="cb4-25"><a aria-hidden="true" href="#cb4-25"></a>    <span class="cf">if</span> (ql &gt; qr) <span class="cf">return</span>;</span>
<span id="cb4-26"><a aria-hidden="true" href="#cb4-26"></a>    <span class="cf">if</span> (l == r) {</span>
<span id="cb4-27"><a aria-hidden="true" href="#cb4-27"></a>        FOR(i, ql, qr) <span class="cf">if</span> (q[i].type == <span class="dv">2</span>) ans[q[i].id] = l; <span class="co">// æ›´æ–°ç­”æ¡ˆ</span></span>
<span id="cb4-28"><a aria-hidden="true" href="#cb4-28"></a>        <span class="cf">return</span>;</span>
<span id="cb4-29"><a aria-hidden="true" href="#cb4-29"></a>    }</span>
<span id="cb4-30"><a aria-hidden="true" href="#cb4-30"></a>    <span class="dt">int</span> mid = (l + r) &gt;&gt; <span class="dv">1</span>;</span>
<span id="cb4-31"><a aria-hidden="true" href="#cb4-31"></a>    <span class="dt">int</span> p1 = <span class="dv">0</span>, p2 = <span class="dv">0</span>;</span>
<span id="cb4-32"><a aria-hidden="true" href="#cb4-32"></a>    FOR(i, ql, qr) {</span>
<span id="cb4-33"><a aria-hidden="true" href="#cb4-33"></a>        <span class="cf">if</span> (q[i].type == <span class="dv">1</span>) {</span>
<span id="cb4-34"><a aria-hidden="true" href="#cb4-34"></a>            <span class="cf">if</span> (q[i].l &lt;= mid) { <span class="co">// åªæœ‰ &lt;= mid çš„æ•°å­—æ‰ä¼šäº§ç”Ÿå½±å“</span></span>
<span id="cb4-35"><a aria-hidden="true" href="#cb4-35"></a>                add(q[i].id, <span class="dv">1</span>); <span class="co">// åŠ å…¥æ ‘çŠ¶æ•°ç»„</span></span>
<span id="cb4-36"><a aria-hidden="true" href="#cb4-36"></a>                q1[++p1] = q[i];</span>
<span id="cb4-37"><a aria-hidden="true" href="#cb4-37"></a>            } <span class="cf">else</span> q2[++p2] = q[i];</span>
<span id="cb4-38"><a aria-hidden="true" href="#cb4-38"></a>        } <span class="cf">else</span> {</span>
<span id="cb4-39"><a aria-hidden="true" href="#cb4-39"></a>            <span class="dt">int</span> res = sum(q[i].r) - sum(q[i].l - <span class="dv">1</span>);</span>
<span id="cb4-40"><a aria-hidden="true" href="#cb4-40"></a>            <span class="cf">if</span> (res &gt;= q[i].k) q1[++p1] = q[i]; <span class="co">// åˆ¤æ–­</span></span>
<span id="cb4-41"><a aria-hidden="true" href="#cb4-41"></a>            <span class="cf">else</span> {</span>
<span id="cb4-42"><a aria-hidden="true" href="#cb4-42"></a>                q[i].k -= res; <span class="co">// å°†å·¦åŠè¾¹çš„å½±å“å»é™¤</span></span>
<span id="cb4-43"><a aria-hidden="true" href="#cb4-43"></a>                q2[++p2] = q[i];</span>
<span id="cb4-44"><a aria-hidden="true" href="#cb4-44"></a>            }</span>
<span id="cb4-45"><a aria-hidden="true" href="#cb4-45"></a>        }</span>
<span id="cb4-46"><a aria-hidden="true" href="#cb4-46"></a>    }</span>
<span id="cb4-47"><a aria-hidden="true" href="#cb4-47"></a>    FOR(i, <span class="dv">1</span>, p1) <span class="cf">if</span> (q1[i].type == <span class="dv">1</span>) add(q1[i].id, -<span class="dv">1</span>); <span class="co">// æ¸…ç©ºæ ‘çŠ¶æ•°ç»„</span></span>
<span id="cb4-48"><a aria-hidden="true" href="#cb4-48"></a>    FOR(i, <span class="dv">1</span>, p1) q[ql + i - <span class="dv">1</span>] = q1[i]; <span class="co">// å°†æ“ä½œé‡æ–°åˆ’åˆ†</span></span>
<span id="cb4-49"><a aria-hidden="true" href="#cb4-49"></a>    FOR(i, <span class="dv">1</span>, p2) q[ql + p1 + i - <span class="dv">1</span>] = q2[i]; <span class="co">// å°†æ“ä½œé‡æ–°åˆ’åˆ†</span></span>
<span id="cb4-50"><a aria-hidden="true" href="#cb4-50"></a>    solve(l, mid, ql, ql + p1 - <span class="dv">1</span>); <span class="co">// ç»§ç»­åˆ†æ²»</span></span>
<span id="cb4-51"><a aria-hidden="true" href="#cb4-51"></a>    solve(mid + <span class="dv">1</span>, r, ql + p1, qr); <span class="co">// ç»§ç»­åˆ†æ²»</span></span>
<span id="cb4-52"><a aria-hidden="true" href="#cb4-52"></a>    <span class="cf">return</span>;</span>
<span id="cb4-53"><a aria-hidden="true" href="#cb4-53"></a>}</span>
<span id="cb4-54"><a aria-hidden="true" href="#cb4-54"></a></span>
<span id="cb4-55"><a aria-hidden="true" href="#cb4-55"></a><span class="dt">int</span> main() {</span>
<span id="cb4-56"><a aria-hidden="true" href="#cb4-56"></a>    is &gt;&gt; n &gt;&gt; m;</span>
<span id="cb4-57"><a aria-hidden="true" href="#cb4-57"></a>    FOR(i, <span class="dv">1</span>, n) is &gt;&gt; a0[i], a[i] = a0[i];</span>
<span id="cb4-58"><a aria-hidden="true" href="#cb4-58"></a>    sort(a0 + <span class="dv">1</span>, a0 + n + <span class="dv">1</span>);</span>
<span id="cb4-59"><a aria-hidden="true" href="#cb4-59"></a>    totv = unique(a0 + <span class="dv">1</span>, a0 + n + <span class="dv">1</span>) - a0 - <span class="dv">1</span>;</span>
<span id="cb4-60"><a aria-hidden="true" href="#cb4-60"></a>    FOR(i, <span class="dv">1</span>, n) a[i] = lower_bound(a0 + <span class="dv">1</span>, a0 + totv + <span class="dv">1</span>, a[i]) - a0, q[++totq] = {a[i], -<span class="dv">1</span>, -<span class="dv">1</span>, i, <span class="dv">1</span>};</span>
<span id="cb4-61"><a aria-hidden="true" href="#cb4-61"></a>    FOR(i, <span class="dv">1</span>, m) {</span>
<span id="cb4-62"><a aria-hidden="true" href="#cb4-62"></a>        <span class="dt">int</span> x, y, k; is &gt;&gt; x &gt;&gt; y &gt;&gt; k;</span>
<span id="cb4-63"><a aria-hidden="true" href="#cb4-63"></a>        q[++totq] = {x, y, k, i, <span class="dv">2</span>};</span>
<span id="cb4-64"><a aria-hidden="true" href="#cb4-64"></a>    }</span>
<span id="cb4-65"><a aria-hidden="true" href="#cb4-65"></a>    solve(<span class="dv">1</span>, totv, <span class="dv">1</span>, totq);</span>
<span id="cb4-66"><a aria-hidden="true" href="#cb4-66"></a>    FOR(i, <span class="dv">1</span>, m) os &lt;&lt; a0[ans[i]] &lt;&lt; <span class="ch">'</span><span class="sc">\n</span><span class="ch">'</span>;</span>
<span id="cb4-67"><a aria-hidden="true" href="#cb4-67"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb4-68"><a aria-hidden="true" href="#cb4-68"></a>}</span></code></pre></div>
<p>ç¨åŠ åˆ†æå³çŸ¥å…¶å¤æ‚åº¦ä¸º <span class="math inline">\(O(n\log^2n)\)</span>ã€‚</p>
<h3 id="åº”ç”¨">åº”ç”¨</h3>
<blockquote>
<p>ä¾‹é¢˜ <span class="math inline">\(2\)</span>ï¼š<a href="https://www.luogu.com.cn/problem/P2617">P2617 Dynamic Rankings</a></p>
<p>ç»™å®šä¸€ä¸ªå«æœ‰ <span class="math inline">\(n\)</span> ä¸ªæ•°çš„åºåˆ— <span class="math inline">\(a_1,a_2 \dots a_n\)</span>ï¼Œéœ€è¦æ”¯æŒä¸¤ç§æ“ä½œï¼š</p>
<ul>
<li><code>Q l r k</code> è¡¨ç¤ºæŸ¥è¯¢ä¸‹æ ‡åœ¨åŒºé—´ <span class="math inline">\([l,r]\)</span> ä¸­çš„ç¬¬ <span class="math inline">\(k\)</span> å°çš„æ•°ï¼›</li>
<li><code>C x y</code> è¡¨ç¤ºå°† <span class="math inline">\(a_x\)</span> æ”¹ä¸º <span class="math inline">\(y\)</span>ã€‚</li>
</ul>
<p><span class="math inline">\(n,m\le 10^5\)</span>ã€‚</p>
</blockquote>
<p>å’Œä¸Šé¢˜åŸºæœ¬æ˜¯ä¸€ä¸ªé“ç†ã€‚<em>ä¿®æ”¹æ“ä½œå¯ä»¥çœ‹æˆå…ˆåˆ é™¤ï¼Œåæ·»åŠ </em>ã€‚å°†èµ‹å€¼æ“ä½œè¿›è¡Œæ‹†åˆ†æ˜¯å¾ˆå¸¸è§çš„æ–¹æ³•ã€‚</p>
<blockquote>
<p>ä¾‹é¢˜ <span class="math inline">\(3\)</span>ï¼š<a href="https://www.luogu.com.cn/problem/P3332">P3332 [ZJOI2013]Kå¤§æ•°æŸ¥è¯¢</a></p>
<p>ç»´æŠ¤ <span class="math inline">\(n\)</span> ä¸ªå¯é‡æ•´æ•°é›†ï¼Œåˆå§‹ä¸ºç©ºï¼Œé›†åˆçš„ç¼–å·ä» <span class="math inline">\(1\)</span> åˆ° <span class="math inline">\(n\)</span>ï¼Œæœ‰ <span class="math inline">\(m\)</span> ä¸ªæ“ä½œï¼š</p>
<ul>
<li><code>1 l r c</code>ï¼šè¡¨ç¤ºå°† <span class="math inline">\(c\)</span> åŠ å…¥åˆ°ç¼–å·åœ¨ <span class="math inline">\([l,r]\)</span> å†…çš„é›†åˆä¸­<br/>
</li>
<li><code>2 l r c</code>ï¼šè¡¨ç¤ºæŸ¥è¯¢ç¼–å·åœ¨ <span class="math inline">\([l,r]\)</span> å†…çš„é›†åˆçš„å¹¶é›†ä¸­ï¼Œç¬¬ <span class="math inline">\(c\)</span> å¤§çš„æ•°æ˜¯å¤šå°‘ã€‚</li>
</ul>
<p>æ³¨æ„å¯é‡é›†çš„å¹¶æ˜¯ä¸å»é™¤é‡å¤å…ƒç´ çš„ï¼Œå¦‚ <span class="math inline">\(\{1,1,4\}\cup\{5,1,4\}=\{1,1,4,5,1,4\}\)</span>ã€‚<span class="math inline">\(1 \le n,m \le 5\times 10^4\)</span>ï¼Œ<span class="math inline">\(1\le l,r \le n\)</span>ï¼Œ<span class="math inline">\(1\)</span> æ“ä½œä¸­ <span class="math inline">\(|c|\le n\)</span>ï¼Œ<span class="math inline">\(2\)</span> æ“ä½œä¸­ <span class="math inline">\(1\le c &lt; 2^{63}\)</span>ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬è¿›è¡ŒäºŒåˆ†ä¼šå‘ç°é—®é¢˜å˜æˆäº†åŒºé—´åŠ åŒºé—´æ±‚å’Œï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨çº¿æ®µæ ‘æ¥è¿›è¡Œç»´æŠ¤ï¼Œæ•´ä½“äºŒåˆ†ä¹‹åæœ¬é¢˜å³å¾—è§£ã€‚</p>
<h2 id="çº¿æ®µæ ‘åˆ†æ²»">çº¿æ®µæ ‘åˆ†æ²»</h2>
<p>çº¿æ®µæ ‘åˆ†æ²»ï¼Œå¯ä»¥å¤„ç†ä¸€ç±»éœ€è¦æ”¯æŒæ’¤é”€æ“ä½œçš„é—®é¢˜ï¼Œç”±äºæ˜¯åœ¨æ—¶é—´è½´ä¸Šå»ºç«‹çº¿æ®µæ ‘ï¼Œæ‰€ä»¥åˆç§°æ­¤æŠ€å·§ä¸ºâ€œæ—¶é—´çº¿æ®µæ ‘â€ã€‚</p>
<p>å…·ä½“åœ°ï¼Œè€ƒè™‘ä¸€ä¸ªæ“ä½œå½±å“çš„æ—¶é—´åŒºé—´ã€‚ä¸€ä¸ªç®€å•çš„æš´åŠ›å°±æ˜¯å¯¹äºæ¯ä¸ªæ—¶é—´ç‚¹å¼€ä¸€ä¸ªæ¡¶ï¼ŒæŠŠå¯¹åº”æ“ä½œæ‰”è¿›å»ï¼Œç„¶åå¯¹æ¯ä¸ªæ¡¶å›ç­”ä¸€ä¸‹è¯¢é—®å³å¯ã€‚è¿™ä¸ªæš´åŠ›ä»¥æ¯ä¸ªä¿®æ”¹æ“ä½œå¤šåš <span class="math inline">\(O(n)\)</span> æ¬¡çš„ä»£ä»·è§„é¿äº†åˆ é™¤æ“ä½œã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å°†çº¿æ®µæ ‘å»ºç«‹åœ¨æ—¶é—´è½´ä¸Šåï¼Œä¸€ä¸ªæ“ä½œå½±å“çš„åŒºé—´å°±å¯ä»¥è¢«åˆ†ä¸º <span class="math inline">\(O(\log n)\)</span> æ®µåŒºé—´ï¼Œå°†ä¿®æ”¹æ“ä½œæ”¾ä¸Šå»åå°±èƒ½å½±å“åˆ°å…¶ä¸­çš„æ¯ä¸ªå¶å­èŠ‚ç‚¹ã€‚ç„¶ååœ¨çº¿æ®µæ ‘ä¸Š dfsï¼Œå›æº¯çš„æ—¶å€™æ’¤é”€ä¸€ä¸‹æ“ä½œå³å¯ã€‚</p>
<p>è¯´ç€å¾ˆæŠ½è±¡ï¼Œä»¥ä¾‹é¢˜å¼•å…¥ä¸€ä¸‹ã€‚</p>
<blockquote>
<p>ä¾‹é¢˜ 1ï¼š<a href="https://loj.ac/problem/121">LOJ#121. ã€Œç¦»çº¿å¯è¿‡ã€åŠ¨æ€å›¾è¿é€šæ€§</a>ã€</p>
<p>è¦æ±‚ç»´æŠ¤åŠ è¾¹åˆ è¾¹ï¼Œè¯¢é—®ä¸¤ç‚¹è¿é€šæ€§ã€‚</p>
</blockquote>
<p>è‹¥<strong>æ²¡æœ‰åˆ é™¤æ“ä½œ</strong>ï¼Œæœ¬é¢˜å°±æ˜¯å¾ˆç®€å•çš„å¹¶æŸ¥é›†ã€‚</p>
<p>ç„¶åå¥—ä¸Šçº¿æ®µæ ‘åˆ†æ²»å°±çœŸçš„å˜æˆäº†å¾ˆç®€å•çš„å¹¶æŸ¥é›†ï¼ˆï¼Ÿï¼‰</p>
<p>ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œæœ¬é¢˜çš„å¹¶æŸ¥é›†ä¸èƒ½è¿›è¡Œè·¯å¾„å‹ç¼©ï¼Œéœ€è¦ä½¿ç”¨ä¸åŸºäºå‡æ‘Šåˆ†æçš„æŒ‰ç§©åˆå¹¶å¹¶æŸ¥é›†ï¼Œæ‰èƒ½æ”¯æŒæ’¤é”€æ“ä½œã€‚</p>
<p>è‡³äºå¯æ’¤é”€å¹¶æŸ¥é›†ï¼Œæ‹¿ä¸ªæ ˆæ¥ç»´æŠ¤ä¸€ä¸‹å°±å¥½ï¼Œæ³¨æ„ç»†èŠ‚ã€‚<a href="https://loj.ac/s/1376251">ä»£ç é“¾æ¥</a>ã€‚</p>
<blockquote>
<p>ä¾‹é¢˜ 2ï¼š<a href="https://www.luogu.com.cn/problem/P5787">P5787 äºŒåˆ†å›¾ /ã€æ¨¡æ¿ã€‘çº¿æ®µæ ‘åˆ†æ²»</a></p>
<p>æ¯æ¡è¾¹æœ‰å­˜åœ¨çš„æ—¶é—´åŒºé—´ï¼Œè¾“å‡ºæ¯ä¸ªæ—¶é—´æ®µå†…å›¾æ˜¯å¦ä¸ºäºŒåˆ†å›¾ã€‚<span class="math inline">\(2\times 10^5\)</span></p>
</blockquote>
<p>å’Œä¸Šé¢˜ç±»ä¼¼ï¼Œæ‹¿ä¸ª<a href="/summary-ds0/">å¸¦æƒå¹¶æŸ¥é›†</a>ç»´æŠ¤ä¸€ä¸‹å°±å¥½äº†ã€‚</p>
<blockquote>
<p>ä¾‹é¢˜ 3ï¼š<a href="https://www.luogu.com.cn/problem/P4585">P4585 [FJOI2015]ç«æ˜Ÿå•†åº—é—®é¢˜</a></p>
<p>æœ‰ä¸€æ’ <span class="math inline">\(n\)</span> ä¸ªå•†åº—ï¼ŒæŸä¸ªå•†åº—ä¼šåœ¨æŸä¸ªæ—¶åˆ»è¿›è´§æƒå€¼ä¸º <span class="math inline">\(v\)</span> çš„å•†å“ã€‚</p>
<p>æ¯ä¸ªäººæœ‰ä¸€ä¸ªå‚æ•° <span class="math inline">\(x\)</span>ï¼Œè¯¢é—®åœ¨ <span class="math inline">\([l, r]\)</span> å•†åº—å†…è¿›è´§æ—¶é—´åœ¨ <span class="math inline">\([t_l, t_r]\)</span> çš„å•†å“ä¸­ï¼Œ<span class="math inline">\(x\oplus v\)</span> çš„æœ€å¤§å€¼ã€‚</p>
<p><span class="math inline">\(10^5\)</span>ï¼Œ2s</p>
</blockquote>
<p><del>çœ‹ç€å°±å¾ˆæ ‘å¥—æ ‘ + 0-1 Trie æ˜¯å§</del>ï¼Œæ„Ÿè§‰å¤æ‚åº¦å¾ˆé«˜ï¼Œæ”¾å¼ƒã€‚</p>
<p>å‘ç°ï¼Œå•†å“æ˜¯æ—¶é—´è½´ä¸Šçš„è‹¥å¹²ä¸ªç‚¹ï¼Œè€Œè¯¢é—®æ˜¯è‹¥å¹²ä¸ªåŒºé—´ã€‚æ‰€ä»¥è€ƒè™‘ç”¨çº¿æ®µæ ‘åˆ†æ²»æ¥ç»´æŠ¤ï¼Œå°†å•†å“æŒ‚åœ¨ä»å¶å­åˆ°æ ¹çš„èŠ‚ç‚¹ä¸Šï¼Œä½¿ç”¨ä¸€ä¸ªå¯æŒä¹…åŒ– 0-1 Trie ç»´æŠ¤ï¼Œç„¶åå°†è¯¢é—®æ‹†æˆåŒºé—´æ¥å›ç­”ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦ <span class="math inline">\(O(n\log^2n)\)</span>ï¼Œä»£ç å†™èµ·æ¥æœ‰ç‚¹æ¯’ç˜¤ï¼ˆä½†æ˜¯ä¸€å‘ A äº†æˆ‘å¾ˆæ„ŸåŠ¨ï¼‰ã€‚æœ¬é¢˜ä¹Ÿå¯ä»¥ä½¿ç”¨æ•´ä½“äºŒåˆ†ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<h2 id="references">References</h2>
<p>æ„Ÿè°¢ä»¥ä¸‹å‚è€ƒèµ„æ–™çš„ä½œè€…ä»¬ï¼š</p>
<ul>
<li>__stdcallï¼š<a href="https://www.cnblogs.com/mlystdcall/p/6219421.html">ã€æ•™ç¨‹ã€‘ç®€æ˜“CDQåˆ†æ²»æ•™ç¨‹&amp;å­¦ä¹ ç¬”è®°</a></li>
<li>foreverlastingï¼š<a href="https://foreverlasting1202.github.io/2019/07/19/%E7%BA%BF%E6%AE%B5%E6%A0%91%E5%88%86%E6%B2%BB%E6%80%BB%E7%BB%93/">çº¿æ®µæ ‘åˆ†æ²»æ€»ç»“</a></li>
<li>command_blockï¼š<a href="https://www.luogu.com.cn/blog/command-block/yi-suo-chang-yong-di-shuo-ju-jie-gou-wei-hu-shou-fa">ä¸€äº›å¸¸ç”¨çš„æ•°æ®ç»“æ„ç»´æŠ¤æ‰‹æ³•</a></li>
</ul>
</section>
<footer class="article-footer">
<section class="article-tags">
<a href="/tags/OI/">OI</a>
<a href="/tags/note/">ç¬”è®°</a>
<a href="/tags/cdq/">cdqåˆ†æ²»</a>
<a href="/tags/parallel-binary-search/">æ•´ä½“äºŒåˆ†</a>
<a href="/tags/segtree-division/">çº¿æ®µæ ‘åˆ†æ²»</a>
<a href="/tags/ds-in-tree-nodes/">æ ‘å¥—æ ‘</a>
</section>
<section class="article-copyright">
<svg class="icon icon-tabler icon-tabler-copyright" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<circle cx="12" cy="12" r="9"></circle>
<path d="M14.5 9a3.5 4 0 1 0 0 6"></path>
</svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" rel="stylesheet"/><script crossorigin="anonymous" defer="" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js">
</script><script crossorigin="anonymous" defer="" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js">
</script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
</article>
<aside class="related-contents--wrapper">
<h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
<div class="related-contents">
<div class="flex article-list--tile">
<article class="has-image">
<a href="/sol-luogu-p3242/">
<div class="article-image">
<img data-hash="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg5.webp" data-key="" loading="lazy" src="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg5.webp"/>
</div>
<div class="article-details">
<h2 class="article-title">P3242 [HNOI2015] æ¥æ°´æœ</h2>
</div>
</a>
</article>
<article class="has-image">
<a href="/note-gf/">
<div class="article-image">
<img data-hash="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg28.webp" data-key="" loading="lazy" src="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg28.webp"/>
</div>
<div class="article-details">
<h2 class="article-title">ç”Ÿæˆå‡½æ•°èƒ¡æ‰¯</h2>
</div>
</a>
</article>
<article class="has-image">
<a href="/note-set-power-series/">
<div class="article-image">
<img data-hash="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg39.webp" data-key="" loading="lazy" src="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg39.webp"/>
</div>
<div class="article-details">
<h2 class="article-title">é›†åˆå¹‚çº§æ•°èƒ¡æ‰¯</h2>
</div>
</a>
</article>
<article class="has-image">
<a href="/sol-agc002d/">
<div class="article-image">
<img data-hash="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg3.webp" data-key="" loading="lazy" src="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg3.webp"/>
</div>
<div class="article-details">
<h2 class="article-title">AGC002D - Stamp Rally</h2>
</div>
</a>
</article>
<article class="has-image">
<a href="/note-linear-basis/">
<div class="article-image">
<img data-hash="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg19.webp" data-key="" loading="lazy" src="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg19.webp"/>
</div>
<div class="article-details">
<h2 class="article-title">çº¿æ€§åŸºå­¦ä¹ ç¬”è®°</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<footer class="site-footer">
<section class="copyright">
        Â© 
        
            2019 - 
        
        2024 æ¸…çƒ›çš„åšå®¢
    </section>
<section class="powerby">
        Built with <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo</a> <br/>
        ä¸»é¢˜ <b><a data-version="3.11.0" href="https://github.com/CaiJimmy/hugo-theme-stack" rel="noopener" target="_blank">Stack</a></b> ç”± <a href="https://jimmycai.com" rel="noopener" target="_blank">Jimmy</a> è®¾è®¡
    </section>
</footer>
<div aria-hidden="true" class="pswp" role="dialog" tabindex="-1">
<div class="pswp__bg"></div>
<div class="pswp__scroll-wrap">
<div class="pswp__container">
<div class="pswp__item"></div>
<div class="pswp__item"></div>
<div class="pswp__item"></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class="pswp__top-bar">
<div class="pswp__counter"></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title="Share"></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class="pswp__preloader">
<div class="pswp__preloader__icn">
<div class="pswp__preloader__cut">
<div class="pswp__preloader__donut"></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class="pswp__share-tooltip"></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class="pswp__caption">
<div class="pswp__caption__center"></div>
</div>
</div>
</div>
</div><script crossorigin="anonymous" defer="" integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js">
</script><script crossorigin="anonymous" defer="" integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js">
</script><link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css" integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" rel="stylesheet"/><link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css" integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" rel="stylesheet"/>
</main>
</div>
<script crossorigin="anonymous" integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js">
</script><script defer="" src="/ts/main.js" type="text/javascript"></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>
</body>
</html>
