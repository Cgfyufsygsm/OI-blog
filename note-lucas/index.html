<!DOCTYPE html>
<html dir="ltr" lang="zh-CN">
<head><meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/><meta content="æœ¬æ–‡åœæ­¢ç»´æŠ¤ï¼Œæ›´å¤šå†…å®¹è¯¦è§æ•°è®ºæ€»ç»“ã€‚
å‰è¨€ æœ¬æ–‡ä¸»è¦ä»‹ç»äº† Lucas å®šç†åŠå…¶æ‰©å±•ï¼Œå¹¶é™„ä»¥è‹¥å¹²é“ç›¸å…³ä¹ é¢˜ã€‚
é‰´äºä½œè€…æ²¡æœ‰ MO èƒŒæ™¯ï¼Œå†™å‡ºæ¥çš„ä¸œè¥¿å¯èƒ½æ›´åå‘ OI çš„åšé¢˜åº”ç”¨ï¼Œæœ›å„ä½å¤§ä½¬æµ·æ¶µ qwqã€‚
å…¬å¼å¯èƒ½åå¤šï¼Œä½†æ˜¯åªè¦é™ä¸‹å¿ƒæ¥æ…¢æ…¢è¯»è¿˜å‰©å¯ä»¥è¯»å¾—æ‡‚çš„ qwqã€‚
æœ¬æ–‡ç”¨åˆ°äº†çš„å‰ç½®çŸ¥è¯†ï¼š
ç®€å•çš„æ’åˆ—ç»„åˆ æ™®åŠ~æé«˜çš„æ•°è®ºçŸ¥è¯† äºŒé¡¹å¼å®šç† ç®€å•çš„ç”Ÿæˆå‡½æ•°çŸ¥è¯† ä¹˜æ³•é€†å…ƒ ä¸­å›½å‰©ä½™å®šç†ï¼ˆCRTï¼‰ æ¬§æ‹‰å®šç†ï¼ˆå¯é€‰ï¼Œä¹ é¢˜æ¶‰åŠï¼‰ æ•´é™¤åˆ†å—ï¼ˆä¹ é¢˜æ¶‰åŠå…¶æ€æƒ³ï¼‰ æ™®é€š Lucasï¼ˆæ¨¡æ•°ä¸ºè´¨æ•°ï¼‰ é—®é¢˜æè¿° æ±‚ \[ \binom n m\bmod p \] çš„å€¼ï¼Œå…¶ä¸­ \(n\) å’Œ \(m\) å¯ä»¥å¾ˆå¤§ï¼Œ\(p\) ä¸ºä¸€ä¸ªä¸å¤§çš„è´¨æ•°ã€‚
ç»“è®ºï¼ˆLucas å®šç†ï¼‰ \[ \binom n m \equiv \binom{\lfloor\frac n p\rfloor}{\lfloor\frac m p\rfloor}\cdot \binom{n\bmod p}{m\bmod p}\pmod p \]
ä½“ç°åœ¨ç¨‹åºä¸­å°±æ˜¯ï¼š\(\binom{\lfloor\frac n p\rfloor}{\lfloor\frac m p\rfloor}\) å¯ä»¥é€’å½’æ±‚è§£ï¼Œ\(\binom{n\bmod p}{m\bmod p}\) å¯ä»¥ç›´æ¥ç®—ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º \(O(f(p) + g(n)\log n)\)ï¼Œå…¶ä¸­ \(f(p)\) ä¸ºé¢„å¤„ç†ç»„åˆæ•°çš„æ—¶é—´å¤æ‚åº¦ï¼Œ\(g(n)\) ä¸ºå•æ¬¡è¯¢é—®ç»„åˆæ•°çš„æ—¶é—´å¤æ‚åº¦ã€‚" name="description"/><title>Lucas å®šç†</title>
<link href="https://oi.imyangty.com/note-lucas/" rel="canonical"/>
<link href="/scss/style.min.a5821f3d3ab84ce5a0ac21477e347a2e0ca00292e398d16c5e8e36ded6e35a23.css" rel="stylesheet"/><meta content="Lucas å®šç†" property="og:title"/>
<meta content="æœ¬æ–‡åœæ­¢ç»´æŠ¤ï¼Œæ›´å¤šå†…å®¹è¯¦è§æ•°è®ºæ€»ç»“ã€‚
å‰è¨€ æœ¬æ–‡ä¸»è¦ä»‹ç»äº† Lucas å®šç†åŠå…¶æ‰©å±•ï¼Œå¹¶é™„ä»¥è‹¥å¹²é“ç›¸å…³ä¹ é¢˜ã€‚
é‰´äºä½œè€…æ²¡æœ‰ MO èƒŒæ™¯ï¼Œå†™å‡ºæ¥çš„ä¸œè¥¿å¯èƒ½æ›´åå‘ OI çš„åšé¢˜åº”ç”¨ï¼Œæœ›å„ä½å¤§ä½¬æµ·æ¶µ qwqã€‚
å…¬å¼å¯èƒ½åå¤šï¼Œä½†æ˜¯åªè¦é™ä¸‹å¿ƒæ¥æ…¢æ…¢è¯»è¿˜å‰©å¯ä»¥è¯»å¾—æ‡‚çš„ qwqã€‚
æœ¬æ–‡ç”¨åˆ°äº†çš„å‰ç½®çŸ¥è¯†ï¼š
ç®€å•çš„æ’åˆ—ç»„åˆ æ™®åŠ~æé«˜çš„æ•°è®ºçŸ¥è¯† äºŒé¡¹å¼å®šç† ç®€å•çš„ç”Ÿæˆå‡½æ•°çŸ¥è¯† ä¹˜æ³•é€†å…ƒ ä¸­å›½å‰©ä½™å®šç†ï¼ˆCRTï¼‰ æ¬§æ‹‰å®šç†ï¼ˆå¯é€‰ï¼Œä¹ é¢˜æ¶‰åŠï¼‰ æ•´é™¤åˆ†å—ï¼ˆä¹ é¢˜æ¶‰åŠå…¶æ€æƒ³ï¼‰ æ™®é€š Lucasï¼ˆæ¨¡æ•°ä¸ºè´¨æ•°ï¼‰ é—®é¢˜æè¿° æ±‚ \[ \binom n m\bmod p \] çš„å€¼ï¼Œå…¶ä¸­ \(n\) å’Œ \(m\) å¯ä»¥å¾ˆå¤§ï¼Œ\(p\) ä¸ºä¸€ä¸ªä¸å¤§çš„è´¨æ•°ã€‚
ç»“è®ºï¼ˆLucas å®šç†ï¼‰ \[ \binom n m \equiv \binom{\lfloor\frac n p\rfloor}{\lfloor\frac m p\rfloor}\cdot \binom{n\bmod p}{m\bmod p}\pmod p \]
ä½“ç°åœ¨ç¨‹åºä¸­å°±æ˜¯ï¼š\(\binom{\lfloor\frac n p\rfloor}{\lfloor\frac m p\rfloor}\) å¯ä»¥é€’å½’æ±‚è§£ï¼Œ\(\binom{n\bmod p}{m\bmod p}\) å¯ä»¥ç›´æ¥ç®—ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º \(O(f(p) + g(n)\log n)\)ï¼Œå…¶ä¸­ \(f(p)\) ä¸ºé¢„å¤„ç†ç»„åˆæ•°çš„æ—¶é—´å¤æ‚åº¦ï¼Œ\(g(n)\) ä¸ºå•æ¬¡è¯¢é—®ç»„åˆæ•°çš„æ—¶é—´å¤æ‚åº¦ã€‚" property="og:description"/>
<meta content="https://oi.imyangty.com/note-lucas/" property="og:url"/>
<meta content="æ¸…çƒ›çš„åšå®¢" property="og:site_name"/>
<meta content="article" property="og:type"/><meta content="Post" property="article:section"/><meta content="OI" property="article:tag"/><meta content="ç¬”è®°" property="article:tag"/><meta content="Lucaså®šç†" property="article:tag"/><meta content="2021-05-10T21:25:50+08:00" property="article:published_time"/><meta content="2021-05-10T21:25:50+08:00" property="article:modified_time"/><meta content="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg20.webp" property="og:image"/>
<meta content="Lucas å®šç†" name="twitter:title"/>
<meta content="æœ¬æ–‡åœæ­¢ç»´æŠ¤ï¼Œæ›´å¤šå†…å®¹è¯¦è§æ•°è®ºæ€»ç»“ã€‚
å‰è¨€ æœ¬æ–‡ä¸»è¦ä»‹ç»äº† Lucas å®šç†åŠå…¶æ‰©å±•ï¼Œå¹¶é™„ä»¥è‹¥å¹²é“ç›¸å…³ä¹ é¢˜ã€‚
é‰´äºä½œè€…æ²¡æœ‰ MO èƒŒæ™¯ï¼Œå†™å‡ºæ¥çš„ä¸œè¥¿å¯èƒ½æ›´åå‘ OI çš„åšé¢˜åº”ç”¨ï¼Œæœ›å„ä½å¤§ä½¬æµ·æ¶µ qwqã€‚
å…¬å¼å¯èƒ½åå¤šï¼Œä½†æ˜¯åªè¦é™ä¸‹å¿ƒæ¥æ…¢æ…¢è¯»è¿˜å‰©å¯ä»¥è¯»å¾—æ‡‚çš„ qwqã€‚
æœ¬æ–‡ç”¨åˆ°äº†çš„å‰ç½®çŸ¥è¯†ï¼š
ç®€å•çš„æ’åˆ—ç»„åˆ æ™®åŠ~æé«˜çš„æ•°è®ºçŸ¥è¯† äºŒé¡¹å¼å®šç† ç®€å•çš„ç”Ÿæˆå‡½æ•°çŸ¥è¯† ä¹˜æ³•é€†å…ƒ ä¸­å›½å‰©ä½™å®šç†ï¼ˆCRTï¼‰ æ¬§æ‹‰å®šç†ï¼ˆå¯é€‰ï¼Œä¹ é¢˜æ¶‰åŠï¼‰ æ•´é™¤åˆ†å—ï¼ˆä¹ é¢˜æ¶‰åŠå…¶æ€æƒ³ï¼‰ æ™®é€š Lucasï¼ˆæ¨¡æ•°ä¸ºè´¨æ•°ï¼‰ é—®é¢˜æè¿° æ±‚ \[ \binom n m\bmod p \] çš„å€¼ï¼Œå…¶ä¸­ \(n\) å’Œ \(m\) å¯ä»¥å¾ˆå¤§ï¼Œ\(p\) ä¸ºä¸€ä¸ªä¸å¤§çš„è´¨æ•°ã€‚
ç»“è®ºï¼ˆLucas å®šç†ï¼‰ \[ \binom n m \equiv \binom{\lfloor\frac n p\rfloor}{\lfloor\frac m p\rfloor}\cdot \binom{n\bmod p}{m\bmod p}\pmod p \]
ä½“ç°åœ¨ç¨‹åºä¸­å°±æ˜¯ï¼š\(\binom{\lfloor\frac n p\rfloor}{\lfloor\frac m p\rfloor}\) å¯ä»¥é€’å½’æ±‚è§£ï¼Œ\(\binom{n\bmod p}{m\bmod p}\) å¯ä»¥ç›´æ¥ç®—ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º \(O(f(p) + g(n)\log n)\)ï¼Œå…¶ä¸­ \(f(p)\) ä¸ºé¢„å¤„ç†ç»„åˆæ•°çš„æ—¶é—´å¤æ‚åº¦ï¼Œ\(g(n)\) ä¸ºå•æ¬¡è¯¢é—®ç»„åˆæ•°çš„æ—¶é—´å¤æ‚åº¦ã€‚" name="twitter:description"/><meta content="summary_large_image" name="twitter:card"/>
<meta content="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg20.webp" name="twitter:image"/>
<link href="https://q1.qlogo.cn/g?b=qq&amp;nk=375836877&amp;s=5" rel="shortcut icon"/>
<link href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/styles/github-dark-dimmed.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</head>
<body class="article-page">
<script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky">
<button aria-label="åˆ‡æ¢èœå•" class="hamburger hamburger--spin" id="toggle-menu" type="button">
<span class="hamburger-box">
<span class="hamburger-inner"></span>
</span>
</button>
<header>
<figure class="site-avatar">
<a href="/">
<img alt="Avatar" class="site-logo" height="300" loading="lazy" src="/img/avatar_huea3ce2119467b51fdd2a81393644a76d_51594_300x0_resize_q75_box.jpg" width="300"/>
</a>
<span class="emoji">ğŸ˜…</span>
</figure>
<div class="site-meta">
<h1 class="site-name"><a href="/">æ¸…çƒ›çš„åšå®¢</a></h1>
<h2 class="site-description">çƒŸç«å·²è°¢ï¼Œç¬™æ­Œæœªåœ</h2>
</div>
</header><ol class="social-menu">
<li>
<a href="mailto:i@imyangty.com" target="_blank" title="email">
<svg class="icon icon-tabler icon-tabler-mail" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
<rect height="14" rx="2" width="18" x="3" y="5"></rect>
<polyline points="3 7 12 13 21 7"></polyline>
</svg>
</a>
</li>
<li>
<a href="https://github.com/Cgfyufsygsm" target="_blank" title="GitHub">
<svg class="icon icon-tabler icon-tabler-brand-github" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
<path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path>
</svg>
</a>
</li>
<li>
<a href="https://t.me/Cgfyufsygsm" target="_blank" title="Telegram">
<svg class="icon icon-tabler icon-tabler-brand-telegram" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
<path d="M15 10l-4 4l6 6l4 -16l-18 7l4 2l2 6l3 -4"></path>
</svg>
</a>
</li>
<li>
<a href="https://twitter.com/Cgfyufsygsm" target="_blank" title="Twitter">
<svg class="icon icon-tabler icon-tabler-brand-twitter" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
<path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z"></path>
</svg>
</a>
</li>
</ol><ol class="menu" id="main-menu">
<li>
<a href="/">
<svg class="icon icon-tabler icon-tabler-home" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<polyline points="5 12 3 12 12 3 21 12 19 12"></polyline>
<path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7"></path>
<path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6"></path>
</svg>
<span>ä¸»é¡µ</span>
</a>
</li>
<li>
<a href="/about/">
<svg class="icon icon-tabler icon-tabler-user" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<circle cx="12" cy="7" r="4"></circle>
<path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2"></path>
</svg>
<span>å…³äº</span>
</a>
</li>
<li>
<a href="/idx/">
<svg class="icon icon-tabler icon-tabler-hash" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<line x1="5" x2="19" y1="9" y2="9"></line>
<line x1="5" x2="19" y1="15" y2="15"></line>
<line x1="11" x2="7" y1="4" y2="20"></line>
<line x1="17" x2="13" y1="4" y2="20"></line>
</svg>
<span>å¯¼èˆª</span>
</a>
</li>
<li>
<a href="/archives/">
<svg class="icon icon-tabler icon-tabler-archive" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<rect height="4" rx="2" width="18" x="3" y="4"></rect>
<path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10"></path>
<line x1="10" x2="14" y1="12" y2="12"></line>
</svg>
<span>å½’æ¡£</span>
</a>
</li>
<li>
<a href="/search/">
<svg class="icon icon-tabler icon-tabler-search" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<circle cx="10" cy="10" r="7"></circle>
<line x1="21" x2="15" y1="21" y2="15"></line>
</svg>
<span>æœç´¢</span>
</a>
</li>
<li>
<a href="/friends/">
<svg class="icon icon-tabler icon-tabler-link" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5"></path>
<path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"></path>
</svg>
<span>å‹é“¾</span>
</a>
</li>
<li>
<a href="https://blog.imyangty.com" target="_blank">
<svg class="icon icon-tabler icon-tabler-home" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<polyline points="5 12 3 12 12 3 21 12 19 12"></polyline>
<path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7"></path>
<path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6"></path>
</svg>
<span>ä¸»åšå®¢</span>
</a>
</li>
<div class="menu-bottom-section">
<li id="dark-mode-toggle">
<svg class="icon icon-tabler icon-tabler-toggle-left" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<circle cx="8" cy="12" r="2"></circle>
<rect height="12" rx="6" width="20" x="2" y="6"></rect>
</svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<circle cx="16" cy="12" r="2"></circle>
<rect height="12" rx="6" width="20" x="2" y="6"></rect>
</svg>
<span>æš—è‰²æ¨¡å¼</span>
</li>
</div>
</ol>
</aside>
<main class="main full-width">
<article class="has-image main-article">
<header class="article-header">
<div class="article-image">
<a href="/note-lucas/">
<img alt="Featured image of post Lucas å®šç†" loading="lazy" src="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg20.webp"/>
</a>
</div>
<div class="article-details">
<header class="article-category">
<a href="/categories/oi/">
                OI
            </a>
<a href="/categories/note/">
                ç¬”è®°
            </a>
</header>
<div class="article-title-wrapper">
<h2 class="article-title">
<a href="/note-lucas/">Lucas å®šç†</a>
</h2>
</div>
<footer class="article-time">
<div>
<svg class="icon icon-tabler icon-tabler-calendar-time" fill="none" height="56" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="56" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4"></path>
<circle cx="18" cy="18" r="4"></circle>
<path d="M15 3v4"></path>
<path d="M7 3v4"></path>
<path d="M3 11h16"></path>
<path d="M18 16.496v1.504l1 1"></path>
</svg>
<time class="article-time--published">May 10, 2021</time>
</div>
<div>
<svg class="icon icon-tabler icon-tabler-clock" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<circle cx="12" cy="12" r="9"></circle>
<polyline points="12 7 12 12 15 15"></polyline>
</svg>
<time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 14 åˆ†é’Ÿ
                </time>
</div>
</footer>
</div>
</header>
<section class="article-content">
<p>æœ¬æ–‡åœæ­¢ç»´æŠ¤ï¼Œæ›´å¤šå†…å®¹è¯¦è§<a href="/summary-number-theory/">æ•°è®ºæ€»ç»“</a>ã€‚</p>
<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº† Lucas å®šç†åŠå…¶æ‰©å±•ï¼Œå¹¶é™„ä»¥è‹¥å¹²é“ç›¸å…³ä¹ é¢˜ã€‚</p>
<p>é‰´äºä½œè€…æ²¡æœ‰ MO èƒŒæ™¯ï¼Œå†™å‡ºæ¥çš„ä¸œè¥¿å¯èƒ½æ›´åå‘ OI çš„åšé¢˜åº”ç”¨ï¼Œæœ›å„ä½å¤§ä½¬æµ·æ¶µ qwqã€‚</p>
<p>å…¬å¼å¯èƒ½åå¤šï¼Œä½†æ˜¯åªè¦é™ä¸‹å¿ƒæ¥æ…¢æ…¢è¯»è¿˜å‰©å¯ä»¥è¯»å¾—æ‡‚çš„ qwqã€‚</p>
<p>æœ¬æ–‡ç”¨åˆ°äº†çš„å‰ç½®çŸ¥è¯†ï¼š</p>
<ul>
<li><strong>ç®€å•çš„æ’åˆ—ç»„åˆ</strong></li>
<li><strong>æ™®åŠ~æé«˜çš„æ•°è®ºçŸ¥è¯†</strong></li>
<li><strong>äºŒé¡¹å¼å®šç†</strong></li>
<li>ç®€å•çš„ç”Ÿæˆå‡½æ•°çŸ¥è¯†</li>
<li>ä¹˜æ³•é€†å…ƒ</li>
<li>ä¸­å›½å‰©ä½™å®šç†ï¼ˆCRTï¼‰</li>
<li>æ¬§æ‹‰å®šç†ï¼ˆå¯é€‰ï¼Œä¹ é¢˜æ¶‰åŠï¼‰</li>
<li>æ•´é™¤åˆ†å—ï¼ˆä¹ é¢˜æ¶‰åŠå…¶æ€æƒ³ï¼‰</li>
</ul>
<h2 id="æ™®é€š-lucasæ¨¡æ•°ä¸ºè´¨æ•°">æ™®é€š Lucasï¼ˆæ¨¡æ•°ä¸ºè´¨æ•°ï¼‰</h2>
<h3 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h3>
<p>æ±‚ <span class="math display">\[
\binom n m\bmod p
\]</span> çš„å€¼ï¼Œå…¶ä¸­ <span class="math inline">\(n\)</span> å’Œ <span class="math inline">\(m\)</span> å¯ä»¥å¾ˆå¤§ï¼Œ<span class="math inline">\(p\)</span> ä¸ºä¸€ä¸ªä¸å¤§çš„è´¨æ•°ã€‚</p>
<h3 id="ç»“è®ºlucas-å®šç†">ç»“è®ºï¼ˆLucas å®šç†ï¼‰</h3>
<p><span class="math display">\[
\binom n m \equiv \binom{\lfloor\frac n p\rfloor}{\lfloor\frac m p\rfloor}\cdot \binom{n\bmod p}{m\bmod p}\pmod p
\]</span></p>
<p>ä½“ç°åœ¨ç¨‹åºä¸­å°±æ˜¯ï¼š<span class="math inline">\(\binom{\lfloor\frac n p\rfloor}{\lfloor\frac m p\rfloor}\)</span> å¯ä»¥é€’å½’æ±‚è§£ï¼Œ<span class="math inline">\(\binom{n\bmod p}{m\bmod p}\)</span> å¯ä»¥ç›´æ¥ç®—ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º <span class="math inline">\(O(f(p) + g(n)\log n)\)</span>ï¼Œå…¶ä¸­ <span class="math inline">\(f(p)\)</span> ä¸ºé¢„å¤„ç†ç»„åˆæ•°çš„æ—¶é—´å¤æ‚åº¦ï¼Œ<span class="math inline">\(g(n)\)</span> ä¸ºå•æ¬¡è¯¢é—®ç»„åˆæ•°çš„æ—¶é—´å¤æ‚åº¦ã€‚</p>
<h3 id="è¯æ˜">è¯æ˜</h3>
<p>å‚è€ƒäº† <a href="https://oi-wiki.org/math/lucas/">OI-Wiki</a> çš„è¯æ˜å¹¶åŠ ä»¥äº†è‡ªå·±çš„è¯´æ˜å’Œè¡¥å……ã€‚</p>
<h4 id="å¼•ç†">å¼•ç†</h4>
<p>é¦–å…ˆè€ƒè™‘ <span class="math display">\[
\binom p n \bmod p
\]</span> çš„å–å€¼ï¼Œæ³¨æ„åˆ°å±•å¼€ç»„åˆæ•°ä¹‹åå…¶ä¸ºå¦‚ä¸‹å½¢å¼ï¼š <span class="math display">\[
\frac{p!}{n!(p-n)!}\bmod p
\]</span> è€Œæ˜¾ç„¶ï¼Œç”±äºåˆ†å­ä¸­ <span class="math inline">\(p!\)</span> æ˜¯ä¸€å®šæœ‰è´¨å› å­ <span class="math inline">\(p\)</span> çš„ï¼Œæ‰€ä»¥åªæœ‰å½“ <span class="math inline">\(n = 0\lor n = p\)</span> çš„æ—¶å€™ï¼ˆå³ <span class="math inline">\(p!\)</span> èƒ½è¢«æ¶ˆå¹²å‡€ï¼‰æ•´ä½“çš„ç»“æœä¸º <span class="math inline">\(1\)</span>ï¼Œå¦åˆ™ä¸º <span class="math inline">\(0\)</span>ã€‚å³ <span class="math display">\[
\binom p n\bmod p = [n = 0\lor n = p]
\]</span> è¿›è€Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° <span class="math display">\[
\begin{aligned}
(a + b)^p&amp;=\sum_{n = 0}^p\binom p na^nb^{p - n}\\
&amp;\equiv \sum_{n= 0}^p[n = 0\lor n = p]a^nb^{p - n}\\
&amp;\equiv a^p + b^p\pmod p
\end{aligned}
\]</span> ç„¶åå°†å…¶æ¨å¹¿åˆ°äºŒé¡¹å¼çš„æƒ…å†µï¼Œ <span class="math display">\[
\begin{aligned}
(ax^n + bx^m)^p&amp;\equiv a^px^{np} + b^px^{mp}\\
&amp;\equiv ax^{np} + bx^{mp}
\end{aligned}
\]</span> å³æˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠæŒ‡æ•° <span class="math inline">\(p\)</span> ç»™æè¿›æ¥ã€‚</p>
<h4 id="è¯æ˜-1">è¯æ˜</h4>
<h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a aria-hidden="true" href="#cb1-1"></a><span class="dt">int</span> lucas(<span class="dt">int</span> n, <span class="dt">int</span> m)</span>
<span id="cb1-2"><a aria-hidden="true" href="#cb1-2"></a>{</span>
<span id="cb1-3"><a aria-hidden="true" href="#cb1-3"></a>    <span class="cf">if</span> (!m) <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb1-4"><a aria-hidden="true" href="#cb1-4"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="bu">ll</span> * lucas(n / p, m / p) * C(n % p, m % p) % p;</span>
<span id="cb1-5"><a aria-hidden="true" href="#cb1-5"></a>}</span></code></pre></div>
<p>å†™çš„æ—¶å€™æ³¨æ„è¾¹ç•Œ <span class="math inline">\(m = 0\)</span> å³å¯ï¼Œç„¶åå¯¹äº <span class="math inline">\(\displaystyle\binom{\lfloor\frac n p\rfloor}{\lfloor\frac m p\rfloor}\)</span> ç”¨ Lucas å®šç†ç»§ç»­é€’å½’è®¡ç®—ï¼Œè€Œå³è¾¹çš„ <span class="math inline">\(\displaystyle\binom{n\bmod p}{m\bmod p}\)</span> å› ä¸º <span class="math inline">\(p\)</span> è¾ƒå°ï¼Œç›´æ¥æ±‚å³å¯ã€‚</p>
<p>æ€»çš„å®ç°ï¼š<a href="https://www.luogu.com.cn/problem/P3807">æ´›è°· P3807 ã€æ¨¡æ¿ã€‘å¢å¡æ–¯å®šç†</a></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a aria-hidden="true" href="#cb2-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span>
<span id="cb2-2"><a aria-hidden="true" href="#cb2-2"></a><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></span>
<span id="cb2-3"><a aria-hidden="true" href="#cb2-3"></a><span class="pp">#define FOR</span>(i,<span class="pp"> </span>a,<span class="pp"> </span>b)<span class="pp"> </span><span class="cf">for</span><span class="pp"> </span>(<span class="dt">int</span><span class="pp"> </span>i<span class="pp"> </span>=<span class="pp"> </span>a;<span class="pp"> </span>i<span class="pp"> </span>&lt;=<span class="pp"> </span>b;<span class="pp"> </span>++i)</span>
<span id="cb2-4"><a aria-hidden="true" href="#cb2-4"></a><span class="pp">#define DEC</span>(i,<span class="pp"> </span>a,<span class="pp"> </span>b)<span class="pp"> </span><span class="cf">for</span><span class="pp"> </span>(<span class="dt">int</span><span class="pp"> </span>i<span class="pp"> </span>=<span class="pp"> </span>a;<span class="pp"> </span>i<span class="pp"> </span>&gt;=<span class="pp"> </span>b;<span class="pp"> </span>--i)</span>
<span id="cb2-5"><a aria-hidden="true" href="#cb2-5"></a></span>
<span id="cb2-6"><a aria-hidden="true" href="#cb2-6"></a><span class="dt">int</span> read()</span>
<span id="cb2-7"><a aria-hidden="true" href="#cb2-7"></a>{</span>
<span id="cb2-8"><a aria-hidden="true" href="#cb2-8"></a>    <span class="dt">int</span> s = <span class="dv">0</span>, x = <span class="dv">0</span>;</span>
<span id="cb2-9"><a aria-hidden="true" href="#cb2-9"></a>    <span class="dt">char</span> c = getchar();</span>
<span id="cb2-10"><a aria-hidden="true" href="#cb2-10"></a>    <span class="cf">while</span> (!isdigit(c))</span>
<span id="cb2-11"><a aria-hidden="true" href="#cb2-11"></a>        x |= (c == <span class="ch">'-'</span>), c = getchar();</span>
<span id="cb2-12"><a aria-hidden="true" href="#cb2-12"></a>    <span class="cf">while</span> (isdigit(c))</span>
<span id="cb2-13"><a aria-hidden="true" href="#cb2-13"></a>        s = <span class="dv">10</span> * s + c - <span class="ch">'0'</span>, c = getchar();</span>
<span id="cb2-14"><a aria-hidden="true" href="#cb2-14"></a>    <span class="cf">return</span> x ? -s : s;</span>
<span id="cb2-15"><a aria-hidden="true" href="#cb2-15"></a>}</span>
<span id="cb2-16"><a aria-hidden="true" href="#cb2-16"></a></span>
<span id="cb2-17"><a aria-hidden="true" href="#cb2-17"></a><span class="at">const</span> <span class="dt">int</span> maxn = <span class="fl">3e5</span> + <span class="dv">5</span>;</span>
<span id="cb2-18"><a aria-hidden="true" href="#cb2-18"></a><span class="dt">int</span> n, m, p, fact[maxn];</span>
<span id="cb2-19"><a aria-hidden="true" href="#cb2-19"></a></span>
<span id="cb2-20"><a aria-hidden="true" href="#cb2-20"></a><span class="dt">int</span> qpow(<span class="dt">int</span> base, <span class="dt">int</span> p, <span class="dt">int</span> mod)</span>
<span id="cb2-21"><a aria-hidden="true" href="#cb2-21"></a>{</span>
<span id="cb2-22"><a aria-hidden="true" href="#cb2-22"></a>    <span class="dt">int</span> ret = <span class="dv">1</span>;</span>
<span id="cb2-23"><a aria-hidden="true" href="#cb2-23"></a>    <span class="cf">for</span> (; p; p &gt;&gt;= <span class="dv">1</span>, base = <span class="dv">1</span><span class="bu">ll</span> * base * base % mod)</span>
<span id="cb2-24"><a aria-hidden="true" href="#cb2-24"></a>        <span class="cf">if</span> (p &amp; <span class="dv">1</span>) ret = <span class="dv">1</span><span class="bu">ll</span> * ret * base % mod;</span>
<span id="cb2-25"><a aria-hidden="true" href="#cb2-25"></a>    <span class="cf">return</span> ret;</span>
<span id="cb2-26"><a aria-hidden="true" href="#cb2-26"></a>}</span>
<span id="cb2-27"><a aria-hidden="true" href="#cb2-27"></a></span>
<span id="cb2-28"><a aria-hidden="true" href="#cb2-28"></a><span class="dt">int</span> C(<span class="dt">int</span> n, <span class="dt">int</span> m)</span>
<span id="cb2-29"><a aria-hidden="true" href="#cb2-29"></a>{</span>
<span id="cb2-30"><a aria-hidden="true" href="#cb2-30"></a>    <span class="cf">if</span> (m &gt; n) <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb2-31"><a aria-hidden="true" href="#cb2-31"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="bu">ll</span> * fact[n] * qpow(<span class="dv">1</span><span class="bu">ll</span> * fact[m] * fact[n - m] % p, p - <span class="dv">2</span>, p) % p;</span>
<span id="cb2-32"><a aria-hidden="true" href="#cb2-32"></a>}</span>
<span id="cb2-33"><a aria-hidden="true" href="#cb2-33"></a></span>
<span id="cb2-34"><a aria-hidden="true" href="#cb2-34"></a><span class="dt">int</span> lucas(<span class="dt">int</span> n, <span class="dt">int</span> m)</span>
<span id="cb2-35"><a aria-hidden="true" href="#cb2-35"></a>{</span>
<span id="cb2-36"><a aria-hidden="true" href="#cb2-36"></a>    <span class="cf">if</span> (!m) <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb2-37"><a aria-hidden="true" href="#cb2-37"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="bu">ll</span> * lucas(n / p, m / p) * C(n % p, m % p) % p;</span>
<span id="cb2-38"><a aria-hidden="true" href="#cb2-38"></a>}</span>
<span id="cb2-39"><a aria-hidden="true" href="#cb2-39"></a></span>
<span id="cb2-40"><a aria-hidden="true" href="#cb2-40"></a><span class="dt">int</span> main()</span>
<span id="cb2-41"><a aria-hidden="true" href="#cb2-41"></a>{</span>
<span id="cb2-42"><a aria-hidden="true" href="#cb2-42"></a>    <span class="dt">int</span> T = read();</span>
<span id="cb2-43"><a aria-hidden="true" href="#cb2-43"></a>    <span class="cf">while</span> (T--)</span>
<span id="cb2-44"><a aria-hidden="true" href="#cb2-44"></a>    {</span>
<span id="cb2-45"><a aria-hidden="true" href="#cb2-45"></a>        m = read(), n = read() + m, p = read();</span>
<span id="cb2-46"><a aria-hidden="true" href="#cb2-46"></a>        fact[<span class="dv">0</span>] = <span class="dv">1</span>;</span>
<span id="cb2-47"><a aria-hidden="true" href="#cb2-47"></a>        FOR(i, <span class="dv">1</span>, <span class="fl">3e5</span>) fact[i] = <span class="dv">1</span><span class="bu">ll</span> * i * fact[i - <span class="dv">1</span>] % p;</span>
<span id="cb2-48"><a aria-hidden="true" href="#cb2-48"></a>        printf(<span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span>, lucas(n, m));</span>
<span id="cb2-49"><a aria-hidden="true" href="#cb2-49"></a>    }</span>
<span id="cb2-50"><a aria-hidden="true" href="#cb2-50"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb2-51"><a aria-hidden="true" href="#cb2-51"></a>}</span></code></pre></div>
<h2 id="lucas-å®šç†çš„å¦ä¸€ç§è¯æ˜">Lucas å®šç†çš„å¦ä¸€ç§è¯æ˜</h2>
<p>å‚è€ƒäº†<strong>å†¯å¿—åˆšç‰ˆã€Šåˆç­‰æ•°è®ºã€‹</strong>ç¬¬37é¡µã€‚è¿™ä¸ªåº”è¯¥æ˜¯å¤§å¤šæ•° MOer å…ˆæ¥è§¦åˆ°çš„ Lucas å®šç†çš„ç‰ˆæœ¬ã€‚</p>
<h3 id="lucas-å®šç†çš„å¦ä¸€å½¢å¼">Lucas å®šç†çš„å¦ä¸€å½¢å¼</h3>
<p>å¯¹äºæ•´æ•° <span class="math inline">\(a\)</span>ï¼Œ<span class="math inline">\(b\)</span> å’Œç´ æ•° <span class="math inline">\(p\)</span>ï¼Œè‹¥ <span class="math display">\[
\begin{aligned}
a &amp;= \sum_{i = 0}^k a_ip^i\\
b &amp;= \sum_{i = 0}^k b_ip^i
\end{aligned}
\]</span> ï¼ˆç›¸å½“äºæŠŠ <span class="math inline">\(a\)</span> å’Œ <span class="math inline">\(b\)</span> åœ¨ <span class="math inline">\(p\)</span> è¿›åˆ¶ä¸‹è¡¨ç¤ºï¼‰åˆ™ <span class="math display">\[
\binom ab\equiv\prod_{i = 0}^k\binom{a_i}{b_i}\pmod p
\]</span> é‚£ä¹ˆå®ƒå’Œä¹‹å‰æåˆ°çš„ <span class="math display">\[
\binom a b\equiv\binom{\lfloor\frac ap\rfloor}{\lfloor\frac bp\rfloor}\binom{a\bmod p}{b\bmod p}\pmod p
\]</span> ä¸ºä»€ä¹ˆæ˜¯ç­‰ä»·çš„å‘¢ï¼Ÿ</p>
<p>è¿™æ ·å­è€ƒè™‘ï¼Œå¯¹ <span class="math inline">\(p\)</span> å–æ¨¡ç›¸å½“äºå–äº† <span class="math inline">\(p\)</span> è¿›åˆ¶ä¸‹çš„æœ€ä½ä½ï¼Œè€Œé™¤ä»¥ <span class="math inline">\(p\)</span> å‘ä¸‹å–æ•´å°±ç›¸å½“äº <span class="math inline">\(p\)</span> è¿›åˆ¶ä¸‹å»æ‰æœ€åä¸€ä½ï¼Œåå¤å¥—ç”¨å°±å‘ç°ä¸¤ä¸ªå½¢å¼æ˜¯ç­‰ä»·çš„äº†ã€‚</p>
<h3 id="è¯æ˜-2">è¯æ˜</h3>
<p>è®°å·çº¦å®šï¼šè®¾ <span class="math inline">\(\displaystyle f(x) = \sum_{i = 0}^na_ix^i\)</span>ï¼Œ<span class="math inline">\(\displaystyle g(x) = \sum_{i = 0}^nb_ix^i\)</span> å‡ä¸ºæ•´ç³»æ•°å¤šé¡¹å¼ï¼Œè‹¥å¯¹äº <span class="math inline">\(\forall 0\le i\le n\)</span>ï¼Œéƒ½æœ‰ <span class="math inline">\(a_i\equiv b_i\pmod m\)</span>ï¼Œåˆ™ç§° <span class="math inline">\(f(x)\)</span> ä¸ <span class="math inline">\(g(x)\)</span> å¯¹æ¨¡ <span class="math inline">\(m\)</span> åŒä½™ï¼Œè®°ä½œ <span class="math inline">\(f(x)\equiv g(x)\pmod m\)</span>ã€‚æ³¨æ„åˆ°è‹¥ <span class="math inline">\(f(x)\equiv g(x)\pmod m\)</span>ï¼Œåˆ™å¯¹äº <span class="math inline">\(\forall a\in \mathbb Z\)</span>ï¼Œéƒ½æœ‰ <span class="math inline">\(f(a)\equiv g(a)\pmod m\)</span>ã€‚</p>
<p><strong>ç”±äº <span class="math inline">\(p\)</span> ä¸ºç´ æ•°</strong>ï¼Œå¯çŸ¥å¯¹äº <span class="math inline">\(1\le j\le p - 1\)</span>ï¼Œéƒ½æœ‰ <span class="math display">\[
\binom p j = \frac pj\binom{p - 1}{j - 1}\equiv0\pmod p
\]</span> æ‰€ä»¥ <span class="math display">\[
\begin{aligned}
(1 + x)^p &amp;= 1 + \binom p1x + \cdots + \binom{p}{p - 1}x^{p - 1} + x^p\\
&amp;\equiv 1 + x^p\pmod p
\end{aligned}
\]</span> åˆ©ç”¨è¿™ä¸ªç»“è®ºï¼Œæœ‰ <span class="math display">\[
\begin{aligned}
(1 + x)^a &amp;= (1 + x)^{a_0}((1 + x)^p)^{a_1}\cdots((1 + x)^{p^k})^{a_k}\\
&amp;\equiv (1 + x)^{a_0}(1 + x^p)^{a_1}\cdots(1 + x^{p^k})^{a_k}\pmod p
\end{aligned}
\]</span> è§‚å¯Ÿå³è¾¹å±•å¼€åå¾—åˆ°çš„ç»“æœã€‚å‘ç°æ¯ä¸ªæ‹¬å·ä¸­æœ‰ä¸”ä»…æœ‰ä¸€é¡¹å¯¹ <span class="math inline">\(x^b\)</span> çš„ç³»æ•°äº§ç”Ÿäº†è´¡çŒ®ï¼ˆæ ¹æ® <span class="math inline">\(p\)</span> è¿›åˆ¶æ•°çš„æ€§è´¨ï¼‰ï¼Œå†ç»“åˆäºŒé¡¹å¼å®šç†ï¼Œæ•… <span class="math display">\[
\binom ab\equiv\prod_{i = 0}^k\binom{a_i}{b_i}\pmod p
\]</span></p>
<h2 id="exlucasæ¨¡æ•°ä¸ä¸€å®šä¸ºè´¨æ•°">exLucasï¼ˆæ¨¡æ•°ä¸ä¸€å®šä¸ºè´¨æ•°ï¼‰</h2>
<p>ç»§ç»­ä¹‹å‰ï¼Œå‡å®šè¯»è€…å·²ç†Ÿç»ƒæŒæ¡ä¹˜æ³•é€†å…ƒå’Œ CRTã€‚</p>
<p><del>è¿™ä¸ªä¸œè¥¿é™¤äº†å’Œ Lucas å®šç†é•¿å¾—åƒä¹‹å¤–å’Œ Lucas å°±æ²¡æœ‰åŠæ¯›é’±å…³ç³»äº†ï¼Œè€Œä¸”æ¯” Lucas é˜´é—´ n å¤šå€</del></p>
<h3 id="é—®é¢˜æè¿°-1">é—®é¢˜æè¿°</h3>
<p>æ±‚ <span class="math display">\[
\binom nm\bmod p
\]</span> çš„å€¼ã€‚å…¶ä¸­ <span class="math inline">\(p\)</span> ä¸ä¸€å®šä¸ºè´¨æ•°ä¸” <span class="math inline">\(p\)</span> è¾ƒå°ã€‚</p>
<h3 id="é—®é¢˜æ±‚è§£">é—®é¢˜æ±‚è§£</h3>
<p>å‚è€ƒäº† <a href="https://oi-wiki.org/math/lucas/">OI-Wiki</a> å¹¶åŠ ä»¥è‡ªå·±çš„è¯´æ˜å’Œè¡¥å……ã€‚</p>
<h4 id="part-1">Part 1</h4>
<p>ä½¿ç”¨å”¯ä¸€åˆ†è§£å®šç†åˆ†è§£æ¨¡æ•° <span class="math inline">\(p\)</span> å¾—åˆ°ï¼š <span class="math display">\[
p = \prod_{i = 1}^rq_i^{k_i}
\]</span> ç„¶åç”±äº <span class="math inline">\(q_i^{k_i}\)</span> å’Œ <span class="math inline">\(q_j^{k_j}\)</span> ä¸¤ä¸¤äº’è´¨ï¼Œæ‰€ä»¥å¯ä»¥æ„é€ å¦‚ä¸‹çš„åŒä½™æ–¹ç¨‹ç»„ <span class="math display">\[
\begin{cases}x\equiv\dbinom n m\pmod{q_1^{k_1}}\\x\equiv\dbinom n m\pmod{q_2^{k_2}}\\\quad\cdots\\x\equiv\dbinom n m\pmod{q_r^{k_r}}\end{cases}
\]</span> ç„¶åç”¨ CRT åˆå¹¶è§£å³å¯ã€‚</p>
<h4 id="part-2">Part 2</h4>
<p>ç°åœ¨çš„é—®é¢˜å˜æˆäº†æ±‚ <span class="math inline">\(\displaystyle\binom n m \bmod{q^k}\)</span>ï¼ˆ<span class="math inline">\(q\)</span> ä¸ºè´¨æ•°ï¼‰çš„å€¼ã€‚æ‹†å¼€ç»„åˆæ•°çš„å¼å­ï¼Œæˆ‘ä»¬å‘ç°ï¼š <span class="math display">\[
\binom n m \equiv \frac{n!}{m!(n - m)!}\pmod{q^k}
\]</span> ç„¶è€Œä¸‹é¢é‚£ä¸ªä¸œè¥¿ä¸ä¸€å®šèƒ½ç®—æ¨¡ <span class="math inline">\(q^k\)</span> æ„ä¹‰ä¸‹çš„ä¹˜æ³•é€†å…ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æŠŠæ‰€æœ‰çš„ <span class="math inline">\(q\)</span> æå‡ºæ¥ï¼š <span class="math display">\[
\frac{\frac{n!}{q^x}}{\frac{m!}{q^y}\frac{(n - m)!}{q^z}}q^{x - y - z}\bmod q^k
\]</span> å…¶ä¸­ <span class="math inline">\(x\)</span> è¡¨ç¤º <span class="math inline">\(n!\)</span> ä¸­è´¨å› å­ <span class="math inline">\(q\)</span> çš„æ¬¡æ•°ï¼Œ<span class="math inline">\(y\)</span> å’Œ <span class="math inline">\(z\)</span> åŒç†ã€‚è¿™æ ·å­åˆ†æ•°çº¿ä¸‹é¢çš„å¼å­ç”±äºä¸ <span class="math inline">\(q^k\)</span> äº’è´¨ï¼Œå°±å¯ä»¥æ±‚é€†å…ƒäº†ã€‚</p>
<h4 id="part-3">Part 3</h4>
<p>ç°åœ¨éœ€è¦è§£å†³çš„å°±æ˜¯æ±‚ <span class="math display">\[
f(n) \equiv \frac{n!}{q^x}\pmod{q^k}
\]</span> çš„å€¼ã€‚</p>
<p>å…ˆè€ƒè™‘ <span class="math inline">\(n!\bmod q^k\)</span> çš„å€¼ã€‚ä»¥ä¸€ä¸ªæœ€å¸¸è§çš„ä¾‹å­ï¼š<span class="math inline">\(n = 22\)</span>ï¼Œ<span class="math inline">\(q = 3\)</span>ï¼Œ<span class="math inline">\(k = 2\)</span> ä¸ºä¾‹ï¼š <span class="math display">\[
\begin{aligned}
22! = 1\times2\times3\times4\times5\times6\times7\times8\times9\times10\times11\times12\\\times13\times14\times15\times16\times17\times18\times19\times20\times21\times22
\end{aligned}
\]</span> æŠŠæ‰€æœ‰ <span class="math inline">\(q\)</span> çš„å€æ•°æå–å‡ºæ¥ï¼Œå³ä¸º <span class="math display">\[
\begin{aligned}
22! =&amp; (3\times6\times9\times12\times15\times18\times21)\times1\times2\times4\times5\times7\\&amp;\times8\times10\times11\times13\times14\times16\times17\times19\times20\times22\\
=&amp;3^7\times(1\times2\times3\times4\times5\times6\times7)\times1\times2\times4\times5\times7\\&amp;\times8\times10\times11\times13\times14\times16\times17\times19\times20\times22\\
\end{aligned}
\]</span> æ³¨æ„ä¸€ä¸‹è¿™ä¸ªåˆ†ç»„</p>
<ul>
<li><p><span class="math inline">\(3^7\)</span> å³ä¸º <span class="math inline">\(q^{\lfloor n/q\rfloor}\)</span></p></li>
<li><p>è¿˜å‰©ä¸‹ä¸€ä¸ª <span class="math inline">\(7!\)</span> å³ä¸º <span class="math inline">\(\lfloor n/q\rfloor!\)</span>ï¼Œè¿™ä¸€éƒ¨åˆ†å¯ä»¥é€’å½’è¿›è¡Œæ±‚è§£ã€‚</p></li>
<li><p>æœ€åå‰©ä¸‹æ¥çš„å°±æ˜¯ <span class="math inline">\(n!\)</span> ä¸­ä¸ <span class="math inline">\(q\)</span> äº’è´¨çš„éƒ¨åˆ†çš„ä¹˜ç§¯ã€‚å¯ä»¥å‘ç° <span class="math display">\[
1\times2\times4\times5\times7\times8\equiv10\times11\times13\times14\times16\times17\pmod{3^2}
\]</span> æ‰€ä»¥å…¶ç›¸å½“äºå°±æ˜¯ä¸€ä¸ªå¾ªç¯èŠ‚ï¼Œæˆ‘ä»¬å†é‡æ–°å†™ä¸€ä¸‹ <span class="math inline">\(22!\)</span> çš„å±•å¼€ï¼š <span class="math display">\[
22! \equiv 3^7\times7!\times(1\times2\times4\times5\times7\times8)^2\times(19\times20\times22)\pmod{3^2}
\]</span> å…³äºå¾ªç¯èŠ‚ï¼Œå¯ä»¥è¿™æ ·ç†è§£ï¼š <span class="math display">\[
\prod_{i,i\perp q}^{q^k}i\equiv\prod_{i,i\perp q}^{q^k}(i + tq^k)\pmod{q^k}
\]</span> å…¶ä¸­ <span class="math inline">\(t\in\mathbb N^*\)</span>ã€‚è¿™ä¸ªå¾ªç¯èŠ‚å¾ªç¯äº† <span class="math inline">\(\displaystyle\left\lfloor\frac{n}{q^k}\right\rfloor\)</span> æ¬¡ï¼Œæ‰€ä»¥è€ƒè™‘æš´åŠ›æŠŠ <span class="math inline">\(\displaystyle\prod_{i,i\perp q}^{q^k}i\)</span> æ±‚å‡ºæ¥ç„¶åå¿«é€Ÿå¹‚æ±‚ä¸€æ³¢ <span class="math inline">\(\displaystyle\left\lfloor\frac{n}{q^k}\right\rfloor\)</span> æ¬¡å¹‚ã€‚å½“ç„¶æœ€åæ˜¯éœ€è¦ä¹˜ä¸Šä½™é¡¹ <span class="math inline">\(\displaystyle\prod_{i,i\perp q}^{n\bmod q^k}i\)</span>ï¼ˆå¯¹åº”ä¸Šé¢çš„ <span class="math inline">\(19\times20\times22\)</span>ï¼‰ï¼Œæš´åŠ›å°±å¯ä»¥äº†ã€‚</p></li>
</ul>
<p>æ€»ç»“ä¸‹æ¥å°±æ˜¯ <span class="math display">\[
n!\equiv q^{\lfloor n/q\rfloor}\cdot\left(\left\lfloor\frac n q\right\rfloor\right)!\cdot\left(\prod_{i, i\perp q}^{q^k}i\right)^{\lfloor n / q^k\rfloor}\cdot \left(\prod_{i, i\perp q}^{n\bmod q^k}i\right)\pmod{q^k}
\]</span> è€Œæˆ‘ä»¬éœ€è¦æ±‚çš„æ˜¯ <span class="math inline">\(\displaystyle\frac{n!}{q^x}\bmod q^k\)</span>ã€‚</p>
<p>å˜å½¢ä¸€ä¸‹ä¸Šé¢çš„å¼å­å¾—åˆ° <span class="math display">\[
f(n)\equiv f\left(\left\lfloor\frac n q\right\rfloor\right)\cdot\left(\prod_{i, i\perp q}^{q^k}i\right)^{\lfloor n / q^k\rfloor}\cdot \left(\prod_{i, i\perp q}^{n\bmod q^k}i\right)\pmod{q^k}
\]</span> ï¼ˆæ³¨æ„æ­¤æ—¶ <span class="math inline">\(n!\)</span> ä¸­çš„è´¨å› å­ <span class="math inline">\(q\)</span> ä¼šåœ¨é€’å½’çš„è¿‡ç¨‹ä¸­å…¨éƒ¨è¢«æ¶ˆæ‰ï¼‰ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±æ±‚å¾— <span class="math inline">\(f(n)\)</span> çš„å€¼äº†ã€‚</p>
<p>è¿™ä¸€éƒ¨åˆ†çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a aria-hidden="true" href="#cb3-1"></a>ll calc(ll n, ll q, ll qk)<span class="co">//ä¼ å…¥çš„å‚æ•°ä¸å†èµ˜è¿°</span></span>
<span id="cb3-2"><a aria-hidden="true" href="#cb3-2"></a>{</span>
<span id="cb3-3"><a aria-hidden="true" href="#cb3-3"></a>    <span class="cf">if</span> (!n) <span class="cf">return</span> <span class="dv">1</span>;<span class="co">//è¾¹ç•Œæ¡ä»¶</span></span>
<span id="cb3-4"><a aria-hidden="true" href="#cb3-4"></a>    ll ret = <span class="dv">1</span>;</span>
<span id="cb3-5"><a aria-hidden="true" href="#cb3-5"></a>    FOR(i, <span class="dv">1</span>, qk)</span>
<span id="cb3-6"><a aria-hidden="true" href="#cb3-6"></a>        <span class="cf">if</span> (i % q) ret = ret * i % qk;<span class="co">//å¤„ç†å¾ªç¯èŠ‚çš„éƒ¨åˆ†</span></span>
<span id="cb3-7"><a aria-hidden="true" href="#cb3-7"></a>    ret = qpow(ret, n / qk, qk);<span class="co">//ç»™å¾ªç¯èŠ‚è¿›è¡Œå¿«é€Ÿå¹‚</span></span>
<span id="cb3-8"><a aria-hidden="true" href="#cb3-8"></a>    FOR(i, n / qk * qk + <span class="dv">1</span>, n)</span>
<span id="cb3-9"><a aria-hidden="true" href="#cb3-9"></a>        <span class="cf">if</span> (i % q) ret = ret * (i % qk) % qk;<span class="co">//æš´åŠ›åˆå¹¶ä½™é¡¹ï¼Œæ³¨æ„è¿™é‡Œä¸€å®šè¦å…ˆå–æ¨¡å†ä¹˜ä¸ç„¶ä¼šå»ä¸–</span></span>
<span id="cb3-10"><a aria-hidden="true" href="#cb3-10"></a>    <span class="cf">return</span> ret * calc(n / q, q, qk) % qk;<span class="co">//é€’å½’ç»§ç»­æ±‚è§£</span></span>
<span id="cb3-11"><a aria-hidden="true" href="#cb3-11"></a>}</span></code></pre></div>
<h4 id="part-4">Part 4</h4>
<p>é‚£ä¹ˆå›åˆ°åˆšæ‰çš„é—®é¢˜ï¼šæ±‚ <span class="math display">\[
\frac{\frac{n!}{q^x}}{\frac{m!}{q^y}\frac{(n - m)!}{q^z}}q^{x - y - z}\bmod q^k
\]</span> å·¦è¾¹åˆ†æ•°çš„åˆ†å­å¯ä»¥æ±‚ï¼Œåˆ†æ¯ç”±äºå¿…ç„¶ä¸ <span class="math inline">\(q^k\)</span> äº’è´¨æ˜¯å¯ä»¥æ±‚é€†å…ƒçš„ï¼Œç°åœ¨é—®é¢˜å°±æ˜¯å¦‚ä½•å»æ±‚è¿™ä¸ª <span class="math inline">\(q^{x - y - z}\)</span>ã€‚</p>
<p>ä¸å¦¨è®¾ <span class="math inline">\(g(n) = x\)</span>ï¼Œåˆ™ç”±åˆšæ‰çš„æ¨å¯¼è¿‡ç¨‹å¯ä»¥çŸ¥é“ <span class="math display">\[
g(n) = \left\lfloor\frac n q\right\rfloor + g\left(\left\lfloor\frac n q\right\rfloor\right)
\]</span> ï¼ˆå…¶å®å°±æ˜¯è€ƒè™‘å½“å‰æ±‚ <span class="math inline">\(n!\)</span> ä¸­ <span class="math inline">\(q\)</span> çš„å€æ•°äº§ç”Ÿçš„è´¡çŒ®å’Œä¸‹é¢æ±‚ <span class="math inline">\(\lfloor n / q\rfloor!\)</span> ä¸­ <span class="math inline">\(q\)</span> çš„å€æ•°äº§ç”Ÿçš„è´¡çŒ®ï¼‰</p>
<p>å½“ç„¶æˆ‘ä»¬å…¶å®æœ‰ä¸€ç§æ›´åŠ ç®€æ´çš„å»æ±‚ <span class="math inline">\(x - y - z\)</span> çš„æ–¹æ³•ï¼š</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a aria-hidden="true" href="#cb4-1"></a>ll cnt = <span class="dv">0</span>;</span>
<span id="cb4-2"><a aria-hidden="true" href="#cb4-2"></a><span class="cf">for</span> (ll i = n; i; i /= q) cnt += i / q;</span>
<span id="cb4-3"><a aria-hidden="true" href="#cb4-3"></a><span class="cf">for</span> (ll i = m; i; i /= q) cnt -= i / q;</span>
<span id="cb4-4"><a aria-hidden="true" href="#cb4-4"></a><span class="cf">for</span> (ll i = n - m; i; i /= q) cnt -= i / q;</span></code></pre></div>
<p>è¿™æ ·åšçš„é“ç†å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå®Œå…¨å°±æ˜¯æŠŠé€’å½’å¼çš„ <span class="math inline">\(g(n)\)</span> æ¢æˆäº†éé€’å½’å¼è€Œå·²ã€‚</p>
<p>é‚£ä¹ˆæ‰€æœ‰çš„é—®é¢˜å°±å·²ç»æå®šäº†ã€‚</p>
<p>è¿™ä¸€éƒ¨åˆ†çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a aria-hidden="true" href="#cb5-1"></a>ll multiLucas(ll n, ll m, ll q, ll qk)<span class="co">//æ±‚ \binom n m \pmod{q ^ k} çš„å€¼</span></span>
<span id="cb5-2"><a aria-hidden="true" href="#cb5-2"></a>{</span>
<span id="cb5-3"><a aria-hidden="true" href="#cb5-3"></a>    <span class="dt">int</span> cnt = <span class="dv">0</span>;</span>
<span id="cb5-4"><a aria-hidden="true" href="#cb5-4"></a>    <span class="cf">for</span> (ll i = n; i; i /= q) cnt += i / q;</span>
<span id="cb5-5"><a aria-hidden="true" href="#cb5-5"></a>    <span class="cf">for</span> (ll i = m; i; i /= q) cnt -= i / q;</span>
<span id="cb5-6"><a aria-hidden="true" href="#cb5-6"></a>    <span class="cf">for</span> (ll i = n - m; i; i /= q) cnt -= i / q;</span>
<span id="cb5-7"><a aria-hidden="true" href="#cb5-7"></a>    <span class="cf">return</span> qpow(q, cnt, qk) * calc(n, q, qk) % qk * inv(calc(m, q, qk), qk) % qk * inv(calc(n - m, q, qk), qk) % qk;</span>
<span id="cb5-8"><a aria-hidden="true" href="#cb5-8"></a>}</span></code></pre></div>
<h4 id="æµç¨‹å›é¡¾">æµç¨‹å›é¡¾</h4>
<ol type="1">
<li><p>å¯¹äº <span class="math inline">\(p\)</span> åˆ†è§£è´¨å› æ•°å¾—åˆ°æ¯ä¸ªè´¨å› å­ <span class="math inline">\(q^k\)</span>ã€‚</p></li>
<li><p>å¯¹äºæ¯ä¸ªè´¨å› å­ï¼Œæ±‚å‡º <span class="math display">\[
\binom n m\equiv \frac{f(n)}{f(m)f(n - m)}\cdot q^{g(n) - g(m) - g(n - m)}\pmod{q^k}
\]</span></p></li>
<li><p>ç”¨ CRT åˆå¹¶æ‰€æœ‰ç­”æ¡ˆã€‚</p></li>
</ol>
<h3 id="ä»£ç å®ç°-1">ä»£ç å®ç°</h3>
<p>ç»†èŠ‚éå¸¸çš„ç¹å†—ï¼Œä¸€å®šè¦æ³¨æ„å…³äºå–æ¨¡/<code>long long</code>/æ˜¯å¦çˆ†èŒƒå›´ä¹‹ç±»çš„é—®é¢˜ã€‚</p>
<p><a href="https://www.luogu.com.cn/problem/P4720">æ´›è°· P4720 ã€æ¨¡æ¿ã€‘æ‰©å±•å¢å¡æ–¯</a></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a aria-hidden="true" href="#cb6-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span>
<span id="cb6-2"><a aria-hidden="true" href="#cb6-2"></a><span class="pp">#define FOR</span>(i,<span class="pp"> </span>a,<span class="pp"> </span>b)<span class="pp"> </span><span class="cf">for</span><span class="pp"> </span>(ll<span class="pp"> </span>i<span class="pp"> </span>=<span class="pp"> </span>a;<span class="pp"> </span>i<span class="pp"> </span>&lt;=<span class="pp"> </span>b;<span class="pp"> </span>++i)</span>
<span id="cb6-3"><a aria-hidden="true" href="#cb6-3"></a><span class="pp">#define DEC</span>(i,<span class="pp"> </span>a,<span class="pp"> </span>b)<span class="pp"> </span><span class="cf">for</span><span class="pp"> </span>(ll<span class="pp"> </span>i<span class="pp"> </span>=<span class="pp"> </span>a;<span class="pp"> </span>i<span class="pp"> </span>&gt;=<span class="pp"> </span>b;<span class="pp"> </span>--i)</span>
<span id="cb6-4"><a aria-hidden="true" href="#cb6-4"></a></span>
<span id="cb6-5"><a aria-hidden="true" href="#cb6-5"></a><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</span>
<span id="cb6-6"><a aria-hidden="true" href="#cb6-6"></a></span>
<span id="cb6-7"><a aria-hidden="true" href="#cb6-7"></a>ll mod;</span>
<span id="cb6-8"><a aria-hidden="true" href="#cb6-8"></a></span>
<span id="cb6-9"><a aria-hidden="true" href="#cb6-9"></a><span class="dt">void</span> exgcd(ll a, ll b, ll &amp;x, ll &amp;y)</span>
<span id="cb6-10"><a aria-hidden="true" href="#cb6-10"></a>{</span>
<span id="cb6-11"><a aria-hidden="true" href="#cb6-11"></a>    <span class="cf">if</span> (!b)</span>
<span id="cb6-12"><a aria-hidden="true" href="#cb6-12"></a>    {</span>
<span id="cb6-13"><a aria-hidden="true" href="#cb6-13"></a>        x = <span class="dv">1</span>, y = <span class="dv">0</span>;</span>
<span id="cb6-14"><a aria-hidden="true" href="#cb6-14"></a>        <span class="cf">return</span>;</span>
<span id="cb6-15"><a aria-hidden="true" href="#cb6-15"></a>    }</span>
<span id="cb6-16"><a aria-hidden="true" href="#cb6-16"></a>    exgcd(b, a % b, y, x);</span>
<span id="cb6-17"><a aria-hidden="true" href="#cb6-17"></a>    y -= a / b * x;</span>
<span id="cb6-18"><a aria-hidden="true" href="#cb6-18"></a>    <span class="cf">return</span>;</span>
<span id="cb6-19"><a aria-hidden="true" href="#cb6-19"></a>}</span>
<span id="cb6-20"><a aria-hidden="true" href="#cb6-20"></a></span>
<span id="cb6-21"><a aria-hidden="true" href="#cb6-21"></a><span class="kw">inline</span> ll inv(ll n, ll p)</span>
<span id="cb6-22"><a aria-hidden="true" href="#cb6-22"></a>{</span>
<span id="cb6-23"><a aria-hidden="true" href="#cb6-23"></a>    ll x, y;</span>
<span id="cb6-24"><a aria-hidden="true" href="#cb6-24"></a>    exgcd(n, p, x, y);</span>
<span id="cb6-25"><a aria-hidden="true" href="#cb6-25"></a>    <span class="cf">return</span> (x + p) % p;</span>
<span id="cb6-26"><a aria-hidden="true" href="#cb6-26"></a>}</span>
<span id="cb6-27"><a aria-hidden="true" href="#cb6-27"></a></span>
<span id="cb6-28"><a aria-hidden="true" href="#cb6-28"></a>ll qpow(ll base, ll p, ll mod)</span>
<span id="cb6-29"><a aria-hidden="true" href="#cb6-29"></a>{</span>
<span id="cb6-30"><a aria-hidden="true" href="#cb6-30"></a>    ll ret = <span class="dv">1</span>;</span>
<span id="cb6-31"><a aria-hidden="true" href="#cb6-31"></a>    <span class="cf">for</span> (; p; p &gt;&gt;= <span class="dv">1</span>, base = base * base % mod)</span>
<span id="cb6-32"><a aria-hidden="true" href="#cb6-32"></a>        <span class="cf">if</span> (p &amp; <span class="dv">1</span>)</span>
<span id="cb6-33"><a aria-hidden="true" href="#cb6-33"></a>            ret = ret * base % mod;</span>
<span id="cb6-34"><a aria-hidden="true" href="#cb6-34"></a>    <span class="cf">return</span> ret;</span>
<span id="cb6-35"><a aria-hidden="true" href="#cb6-35"></a>}</span>
<span id="cb6-36"><a aria-hidden="true" href="#cb6-36"></a></span>
<span id="cb6-37"><a aria-hidden="true" href="#cb6-37"></a>ll CRT(<span class="dt">int</span> n, ll *a, ll *m)</span>
<span id="cb6-38"><a aria-hidden="true" href="#cb6-38"></a>{</span>
<span id="cb6-39"><a aria-hidden="true" href="#cb6-39"></a>    ll M = <span class="dv">1</span>, ret = <span class="dv">0</span>;</span>
<span id="cb6-40"><a aria-hidden="true" href="#cb6-40"></a>    FOR(i, <span class="dv">1</span>, n) M *= m[i];</span>
<span id="cb6-41"><a aria-hidden="true" href="#cb6-41"></a>    FOR(i, <span class="dv">1</span>, n)</span>
<span id="cb6-42"><a aria-hidden="true" href="#cb6-42"></a>    {</span>
<span id="cb6-43"><a aria-hidden="true" href="#cb6-43"></a>        ll w = M / m[i];</span>
<span id="cb6-44"><a aria-hidden="true" href="#cb6-44"></a>        ret = (ret + a[i] * w % mod * inv(w, m[i]) % mod) % mod;</span>
<span id="cb6-45"><a aria-hidden="true" href="#cb6-45"></a>    }</span>
<span id="cb6-46"><a aria-hidden="true" href="#cb6-46"></a>    <span class="cf">return</span> (ret + mod) % mod;</span>
<span id="cb6-47"><a aria-hidden="true" href="#cb6-47"></a>}</span>
<span id="cb6-48"><a aria-hidden="true" href="#cb6-48"></a></span>
<span id="cb6-49"><a aria-hidden="true" href="#cb6-49"></a>ll calc(ll n, ll q, ll qk)</span>
<span id="cb6-50"><a aria-hidden="true" href="#cb6-50"></a>{</span>
<span id="cb6-51"><a aria-hidden="true" href="#cb6-51"></a>    <span class="cf">if</span> (!n) <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb6-52"><a aria-hidden="true" href="#cb6-52"></a>    ll ret = <span class="dv">1</span>;</span>
<span id="cb6-53"><a aria-hidden="true" href="#cb6-53"></a>    FOR(i, <span class="dv">1</span>, qk)</span>
<span id="cb6-54"><a aria-hidden="true" href="#cb6-54"></a>        <span class="cf">if</span> (i % q) ret = ret * i % qk;</span>
<span id="cb6-55"><a aria-hidden="true" href="#cb6-55"></a>    ret = qpow(ret, n / qk, qk);</span>
<span id="cb6-56"><a aria-hidden="true" href="#cb6-56"></a>    FOR(i, n / qk * qk + <span class="dv">1</span>, n)</span>
<span id="cb6-57"><a aria-hidden="true" href="#cb6-57"></a>        <span class="cf">if</span> (i % q) ret = ret * (i % qk) % qk;</span>
<span id="cb6-58"><a aria-hidden="true" href="#cb6-58"></a>    <span class="cf">return</span> ret * calc(n / q, q, qk) % qk;</span>
<span id="cb6-59"><a aria-hidden="true" href="#cb6-59"></a>}</span>
<span id="cb6-60"><a aria-hidden="true" href="#cb6-60"></a></span>
<span id="cb6-61"><a aria-hidden="true" href="#cb6-61"></a>ll multiLucas(ll n, ll m, ll q, ll qk)</span>
<span id="cb6-62"><a aria-hidden="true" href="#cb6-62"></a>{</span>
<span id="cb6-63"><a aria-hidden="true" href="#cb6-63"></a>    <span class="dt">int</span> cnt = <span class="dv">0</span>;</span>
<span id="cb6-64"><a aria-hidden="true" href="#cb6-64"></a>    <span class="cf">for</span> (ll i = n; i; i /= q) cnt += i / q;</span>
<span id="cb6-65"><a aria-hidden="true" href="#cb6-65"></a>    <span class="cf">for</span> (ll i = m; i; i /= q) cnt -= i / q;</span>
<span id="cb6-66"><a aria-hidden="true" href="#cb6-66"></a>    <span class="cf">for</span> (ll i = n - m; i; i /= q) cnt -= i / q;</span>
<span id="cb6-67"><a aria-hidden="true" href="#cb6-67"></a>    <span class="cf">return</span> qpow(q, cnt, qk) * calc(n, q, qk) % qk * inv(calc(m, q, qk), qk) % qk * inv(calc(n - m, q, qk), qk) % qk;</span>
<span id="cb6-68"><a aria-hidden="true" href="#cb6-68"></a>}</span>
<span id="cb6-69"><a aria-hidden="true" href="#cb6-69"></a></span>
<span id="cb6-70"><a aria-hidden="true" href="#cb6-70"></a>ll exLucas(ll n, ll m, ll p)</span>
<span id="cb6-71"><a aria-hidden="true" href="#cb6-71"></a>{</span>
<span id="cb6-72"><a aria-hidden="true" href="#cb6-72"></a>    <span class="dt">int</span> cnt = <span class="dv">0</span>;</span>
<span id="cb6-73"><a aria-hidden="true" href="#cb6-73"></a>    ll qk[<span class="dv">20</span>], a[<span class="dv">20</span>];<span class="co">//å­˜æ”¾æ‰€æœ‰çš„ q^k å’Œå¾…åˆå¹¶ç­”æ¡ˆçš„ç»“æœ</span></span>
<span id="cb6-74"><a aria-hidden="true" href="#cb6-74"></a>    <span class="cf">for</span> (ll i = <span class="dv">2</span>; i * i &lt;= p; ++i)<span class="co">//è´¨å› æ•°åˆ†è§£</span></span>
<span id="cb6-75"><a aria-hidden="true" href="#cb6-75"></a>    {</span>
<span id="cb6-76"><a aria-hidden="true" href="#cb6-76"></a>        <span class="cf">if</span> (p % i == <span class="dv">0</span>)</span>
<span id="cb6-77"><a aria-hidden="true" href="#cb6-77"></a>        {</span>
<span id="cb6-78"><a aria-hidden="true" href="#cb6-78"></a>            qk[++cnt] = <span class="dv">1</span>;</span>
<span id="cb6-79"><a aria-hidden="true" href="#cb6-79"></a>            <span class="cf">while</span> (p % i == <span class="dv">0</span>)</span>
<span id="cb6-80"><a aria-hidden="true" href="#cb6-80"></a>                qk[cnt] *= i, p /= i;</span>
<span id="cb6-81"><a aria-hidden="true" href="#cb6-81"></a>            a[cnt] = multiLucas(n, m, i, qk[cnt]);</span>
<span id="cb6-82"><a aria-hidden="true" href="#cb6-82"></a>        }</span>
<span id="cb6-83"><a aria-hidden="true" href="#cb6-83"></a>    }</span>
<span id="cb6-84"><a aria-hidden="true" href="#cb6-84"></a>    <span class="cf">if</span> (p &gt; <span class="dv">1</span>) qk[++cnt] = p, a[cnt] = multiLucas(n, m, p, p);</span>
<span id="cb6-85"><a aria-hidden="true" href="#cb6-85"></a>    <span class="cf">return</span> CRT(cnt, a, qk);<span class="co">//CRT åˆå¹¶ç­”æ¡ˆ</span></span>
<span id="cb6-86"><a aria-hidden="true" href="#cb6-86"></a>}</span>
<span id="cb6-87"><a aria-hidden="true" href="#cb6-87"></a></span>
<span id="cb6-88"><a aria-hidden="true" href="#cb6-88"></a><span class="dt">int</span> main()</span>
<span id="cb6-89"><a aria-hidden="true" href="#cb6-89"></a>{</span>
<span id="cb6-90"><a aria-hidden="true" href="#cb6-90"></a>    ll n, m, p;</span>
<span id="cb6-91"><a aria-hidden="true" href="#cb6-91"></a>    scanf(<span class="st">"</span><span class="sc">%lld</span><span class="st"> </span><span class="sc">%lld</span><span class="st"> </span><span class="sc">%lld</span><span class="st">"</span>, &amp;n, &amp;m, &amp;p);</span>
<span id="cb6-92"><a aria-hidden="true" href="#cb6-92"></a>    mod = p;</span>
<span id="cb6-93"><a aria-hidden="true" href="#cb6-93"></a>    printf(<span class="st">"</span><span class="sc">%lld\n</span><span class="st">"</span>, exLucas(n, m, p));</span>
<span id="cb6-94"><a aria-hidden="true" href="#cb6-94"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb6-95"><a aria-hidden="true" href="#cb6-95"></a>}</span></code></pre></div>
<h2 id="ä¹ é¢˜">ä¹ é¢˜</h2>
<p>ä¸¤ä¸ªæ¨¡æ¿</p>
<ul>
<li><a href="https://www.luogu.com.cn/problem/P3807">P3807 ã€æ¨¡æ¿ã€‘å¢å¡æ–¯å®šç†</a></li>
<li><a href="https://www.luogu.com.cn/problem/P4720">P4720 ã€æ¨¡æ¿ã€‘æ‰©å±•å¢å¡æ–¯</a></li>
</ul>
<p>æ¥ä¸‹æ¥å°±æ˜¯åº”ç”¨åˆ° Lucas å®šç†çš„ä¹ é¢˜äº†ï¼Œéš¾åº¦åº”è¯¥æ˜¯é€’å¢çš„ï¼Œè¯·æ”¾å¿ƒé£Ÿç”¨ã€‚</p>
<h3 id="å›½å®¶é›†è®­é˜Ÿç¤¼ç‰©">[å›½å®¶é›†è®­é˜Ÿ]ç¤¼ç‰©</h3>
<p><a href="https://www.luogu.com.cn/problem/P2183">æ´›è°· P2183</a></p>
<h4 id="description">Description</h4>
<p><span class="math inline">\(n\)</span> ä»¶ç¤¼ç‰©ï¼Œé€ç»™ <span class="math inline">\(m\)</span> ä¸ªäººï¼Œé€ç»™ç¬¬ <span class="math inline">\(i\)</span> ä¸ªäººç¤¼ç‰©çš„æ•°é‡ä¸º <span class="math inline">\(w_i\)</span>ã€‚è¯·è®¡ç®—å‡ºé€ç¤¼ç‰©çš„æ–¹æ¡ˆæ•°ï¼ˆä¸¤ä¸ªæ–¹æ¡ˆè¢«è®¤ä¸ºæ˜¯ä¸åŒçš„ï¼Œå½“ä¸”ä»…å½“å­˜åœ¨æŸä¸ªäººåœ¨è¿™ä¸¤ç§æ–¹æ¡ˆä¸­æ”¶åˆ°çš„ç¤¼ç‰©ä¸åŒï¼‰æ¨¡ <span class="math inline">\(P\)</span> åçš„ç»“æœã€‚</p>
<p>æ•°æ®èŒƒå›´ï¼šä»¤ <span class="math inline">\(P = \prod_{i = 1}^tp_i^{c_i}\)</span>ï¼Œå…¶ä¸­ <span class="math inline">\(p_i\)</span> ä¸ºè´¨æ•°ï¼Œæœ‰ <span class="math inline">\(1\le n\le10^9\)</span>ï¼Œ<span class="math inline">\(1\leq m\leq 5\)</span>ï¼Œ<span class="math inline">\(1\leq p_i^{c_i}\leq 10^5\)</span>ï¼Œ<span class="math inline">\(1\leq w_i \leq P\leq 10^9\)</span>ã€‚</p>
<h4 id="hint">Hint</h4>
<p>ç›´æ¥è€ƒè™‘ç»„åˆæ„ä¹‰ã€‚</p>
<h4 id="solution">Solution</h4>
<p>åˆ†æé¢˜æ„ï¼šç›´æ¥ä¸€æ³¢ä¹˜æ³•åŸç†å¯å¾—ç­”æ¡ˆä¸º <span class="math display">\[
\binom{n}{w_1}\times\binom{n - w_1}{w_2}\times\binom{n - w_1 - w_2}{w_3}\times\cdots\bmod P
\]</span> ï¼ˆç»„åˆæ„ä¹‰å°±æ˜¯å¯¹äºæ¯ä¸ªäººçœ‹èƒ½å–å¤šå°‘ï¼Œç¬¬ä¸€ä¸ªäººå–äº† <span class="math inline">\(w_1\)</span> ä¸ªäº†æ‰€ä»¥ç¬¬äºŒä¸ªäººèƒ½å–çš„å°±åªæœ‰ <span class="math inline">\(n - w_1\)</span> ä¸ªï¼Œä»¥æ­¤ç±»æ¨ï¼‰</p>
<p>å‰©ä¸‹å°±æ˜¯å¥—ä¸€ä¸ª exLucas æ¿å­çš„äº‹æƒ…äº†ï¼ˆå› ä¸º <span class="math inline">\(P\)</span> ä¸ä¸€å®šä¸ºè´¨æ•°ï¼‰ã€‚</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a aria-hidden="true" href="#cb7-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span>
<span id="cb7-2"><a aria-hidden="true" href="#cb7-2"></a><span class="pp">#define FOR</span>(i,<span class="pp"> </span>a,<span class="pp"> </span>b)<span class="pp"> </span><span class="cf">for</span><span class="pp"> </span>(ll<span class="pp"> </span>i<span class="pp"> </span>=<span class="pp"> </span>a;<span class="pp"> </span>i<span class="pp"> </span>&lt;=<span class="pp"> </span>b;<span class="pp"> </span>++i)</span>
<span id="cb7-3"><a aria-hidden="true" href="#cb7-3"></a></span>
<span id="cb7-4"><a aria-hidden="true" href="#cb7-4"></a><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</span>
<span id="cb7-5"><a aria-hidden="true" href="#cb7-5"></a></span>
<span id="cb7-6"><a aria-hidden="true" href="#cb7-6"></a>ll P, n, m, w[<span class="dv">6</span>];</span>
<span id="cb7-7"><a aria-hidden="true" href="#cb7-7"></a></span>
<span id="cb7-8"><a aria-hidden="true" href="#cb7-8"></a><span class="co">//.......//</span></span>
<span id="cb7-9"><a aria-hidden="true" href="#cb7-9"></a></span>
<span id="cb7-10"><a aria-hidden="true" href="#cb7-10"></a><span class="dt">int</span> main()</span>
<span id="cb7-11"><a aria-hidden="true" href="#cb7-11"></a>{</span>
<span id="cb7-12"><a aria-hidden="true" href="#cb7-12"></a>    scanf(<span class="st">"</span><span class="sc">%lld</span><span class="st">"</span>, &amp;P);</span>
<span id="cb7-13"><a aria-hidden="true" href="#cb7-13"></a>    scanf(<span class="st">"</span><span class="sc">%lld</span><span class="st"> </span><span class="sc">%lld</span><span class="st">"</span>, &amp;n, &amp;m);</span>
<span id="cb7-14"><a aria-hidden="true" href="#cb7-14"></a>    ll W = <span class="dv">0</span>;</span>
<span id="cb7-15"><a aria-hidden="true" href="#cb7-15"></a>    FOR(i, <span class="dv">1</span>, m) scanf(<span class="st">"</span><span class="sc">%lld</span><span class="st">"</span>, w + i), W += w[i];</span>
<span id="cb7-16"><a aria-hidden="true" href="#cb7-16"></a>    <span class="cf">if</span> (W &gt; n)</span>
<span id="cb7-17"><a aria-hidden="true" href="#cb7-17"></a>    {</span>
<span id="cb7-18"><a aria-hidden="true" href="#cb7-18"></a>        puts(<span class="st">"Impossible"</span>);</span>
<span id="cb7-19"><a aria-hidden="true" href="#cb7-19"></a>        <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb7-20"><a aria-hidden="true" href="#cb7-20"></a>    }</span>
<span id="cb7-21"><a aria-hidden="true" href="#cb7-21"></a>    ll ans = <span class="dv">1</span>;</span>
<span id="cb7-22"><a aria-hidden="true" href="#cb7-22"></a>    FOR(i, <span class="dv">1</span>, m)</span>
<span id="cb7-23"><a aria-hidden="true" href="#cb7-23"></a>    {</span>
<span id="cb7-24"><a aria-hidden="true" href="#cb7-24"></a>        ans = ans * exLucas(n, w[i], P) % P;</span>
<span id="cb7-25"><a aria-hidden="true" href="#cb7-25"></a>        n -= w[i];</span>
<span id="cb7-26"><a aria-hidden="true" href="#cb7-26"></a>    }</span>
<span id="cb7-27"><a aria-hidden="true" href="#cb7-27"></a>    printf(<span class="st">"</span><span class="sc">%lld\n</span><span class="st">"</span>, ans);</span>
<span id="cb7-28"><a aria-hidden="true" href="#cb7-28"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb7-29"><a aria-hidden="true" href="#cb7-29"></a>}</span></code></pre></div>
<h3 id="sdoi2010å¤ä»£çŒªæ–‡">[SDOI2010]å¤ä»£çŒªæ–‡</h3>
<p><a href="https://www.luogu.com.cn/problem/P2480">æ´›è°· P2480</a></p>
<h4 id="description-1">Description</h4>
<p>è¿œå¤æ—¶æœŸçŒªæ–‡æ–‡å­—æ€»ä¸ªæ•°ä¸º <span class="math inline">\(n\)</span>ã€‚</p>
<p>iPig æ‰“ç®—ç ”ç©¶å¤æ—¶æŸä¸ªæœä»£çš„çŒªæ–‡æ–‡å­—ã€‚è¯¥æœä»£æµä¼ çš„çŒªæ–‡æ–‡å­—æ°å¥½ä¸ºè¿œå¤æ—¶æœŸçš„ <span class="math inline">\(1/k\)</span>ï¼Œå…¶ä¸­ <span class="math inline">\(k\)</span> æ˜¯ <span class="math inline">\(n\)</span> çš„ä¸€ä¸ªæ­£çº¦æ•°ï¼ˆå¯ä»¥æ˜¯ <span class="math inline">\(1\)</span> æˆ– <span class="math inline">\(n\)</span>ï¼‰ã€‚</p>
<p>iPig è§‰å¾—åªè¦ç¬¦åˆæ–‡çŒ®ï¼Œæ¯ä¸€ç§ <span class="math inline">\(k|n\)</span> éƒ½æ˜¯æœ‰å¯èƒ½çš„ã€‚ä»–æ‰“ç®—è€ƒè™‘åˆ°æ‰€æœ‰å¯èƒ½çš„ <span class="math inline">\(k\)</span>ã€‚æ˜¾ç„¶å½“ <span class="math inline">\(k\)</span> ç­‰äºæŸä¸ªå®šå€¼æ—¶ï¼Œè¯¥æœçš„çŒªæ–‡æ–‡å­—ä¸ªæ•°ä¸º <span class="math inline">\(n/k\)</span>ã€‚ç„¶è€Œä» <span class="math inline">\(n\)</span> ä¸ªæ–‡å­—ä¸­ä¿ç•™ä¸‹ <span class="math inline">\(n/k\)</span> ä¸ªçš„æƒ…å†µä¹Ÿæ˜¯ç›¸å½“å¤šçš„ã€‚iPig é¢„è®¡ï¼Œå¦‚æœæ‰€æœ‰å¯èƒ½çš„ <span class="math inline">\(k\)</span> çš„æ‰€æœ‰æƒ…å†µæ•°åŠ èµ·æ¥ä¸º <span class="math inline">\(p\)</span> çš„è¯ï¼Œé‚£ä¹ˆä»–ç ”ç©¶å¤ä»£æ–‡å­—çš„ä»£ä»·å°†ä¼šæ˜¯ <span class="math inline">\(g^p\)</span>ã€‚</p>
<p>ç°åœ¨ä»–æƒ³çŸ¥é“çŒªç‹å›½ç ”ç©¶å¤ä»£æ–‡å­—çš„ä»£ä»·æ˜¯å¤šå°‘ã€‚ç”±äº iPig è§‰å¾—è¿™ä¸ªæ•°å­—å¯èƒ½æ˜¯å¤©æ–‡æ•°å­—ï¼Œæ‰€ä»¥ä½ åªéœ€è¦å‘Šè¯‰ä»–ç­”æ¡ˆé™¤ä»¥ <span class="math inline">\(999911659\)</span> çš„ä½™æ•°å°±å¯ä»¥äº†ã€‚</p>
<p>æ•°æ®èŒƒå›´ <span class="math inline">\(1\le n,g \le 10^9\)</span>ã€‚</p>
<h4 id="hint-1">Hint</h4>
<p>è€ƒè™‘æ¬§æ‹‰å®šç†ï¼Œå°†æ¨¡æ•°æ‹†å¼€ï¼Œè®¡ç®—åç”¨ CRT åˆå¹¶ç­”æ¡ˆã€‚</p>
<h4 id="solution-1">Solution</h4>
<p>ç­”æ¡ˆå®é™…å°±ä¸º <span class="math display">\[
g^{\sum_{k\mid n}\binom n k}\bmod 999911659
\]</span> ç„¶åä¸ºäº†æ±‚è¿™ä¸ªä¸œè¥¿ï¼Œéœ€è¦å¥—ä¸€ä¸ªæ¬§æ‹‰å®šç†ï¼š <span class="math display">\[
g^{\sum_{k\mid n}\binom n k\bmod 999911658}\bmod 999911659
\]</span> ç°åœ¨é—®é¢˜çš„å…³é”®å°±æ˜¯æ±‚å‡º <span class="math display">\[
\sum_{k\mid n}\binom n k\bmod 999911658
\]</span> <del>è¿™æ³¢ï¼Œè¿™æ³¢å•Šç›´æ¥ exLucas</del>ï¼Œå°è¯•ä¸€ä¸‹åˆ†è§£ <span class="math inline">\(999911658=4679\times3\times2\times35617\)</span>ï¼Œæ¯ä¸€ä¸ªè´¨å› å­çš„æ¬¡æ•°éƒ½æ˜¯ <span class="math inline">\(1\)</span>ï¼Œæ‰€ä»¥åªéœ€è¦ç”¨ CRT æ±‚è§£å¦‚ä¸‹æ–¹ç¨‹ç»„ <span class="math display">\[
\begin{cases}p \equiv \sum_{k\mid n}\dbinom n k\pmod{2}\\p \equiv \sum_{k\mid n}\dbinom n k\pmod{3}\\p \equiv \sum_{k\mid n}\dbinom n k\pmod{4679}\\p \equiv \sum_{k\mid n}\dbinom n k\pmod{35617}\end{cases}
\]</span> æœ€åæ±‚ä¸€æ³¢å¿«é€Ÿå¹‚ï¼Œäºæ˜¯è¿™é¢˜å°±åšå®Œäº†ï¼Œæ³¨æ„ä»£ç ç»†èŠ‚å³å¯ã€‚</p>
<p>å‚è€ƒä»£ç ï¼š</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a aria-hidden="true" href="#cb8-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span>
<span id="cb8-2"><a aria-hidden="true" href="#cb8-2"></a><span class="pp">#define FOR</span>(i,<span class="pp"> </span>a,<span class="pp"> </span>b)<span class="pp"> </span><span class="cf">for</span><span class="pp"> </span>(ll<span class="pp"> </span>i<span class="pp"> </span>=<span class="pp"> </span>a;<span class="pp"> </span>i<span class="pp"> </span>&lt;=<span class="pp"> </span>b;<span class="pp"> </span>++i)</span>
<span id="cb8-3"><a aria-hidden="true" href="#cb8-3"></a></span>
<span id="cb8-4"><a aria-hidden="true" href="#cb8-4"></a><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</span>
<span id="cb8-5"><a aria-hidden="true" href="#cb8-5"></a></span>
<span id="cb8-6"><a aria-hidden="true" href="#cb8-6"></a><span class="at">const</span> ll mod[<span class="dv">5</span>] = {<span class="dv">999911659</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4679</span>, <span class="dv">35617</span>};</span>
<span id="cb8-7"><a aria-hidden="true" href="#cb8-7"></a></span>
<span id="cb8-8"><a aria-hidden="true" href="#cb8-8"></a><span class="at">const</span> <span class="dt">int</span> maxp = <span class="dv">40005</span>;</span>
<span id="cb8-9"><a aria-hidden="true" href="#cb8-9"></a>ll fact[maxp];</span>
<span id="cb8-10"><a aria-hidden="true" href="#cb8-10"></a></span>
<span id="cb8-11"><a aria-hidden="true" href="#cb8-11"></a>ll qpow(ll base, ll p, ll mod)</span>
<span id="cb8-12"><a aria-hidden="true" href="#cb8-12"></a>{</span>
<span id="cb8-13"><a aria-hidden="true" href="#cb8-13"></a>    ll ret = <span class="dv">1</span>;</span>
<span id="cb8-14"><a aria-hidden="true" href="#cb8-14"></a>    <span class="cf">for</span> (; p; p &gt;&gt;= <span class="dv">1</span>, base = base * base % mod)</span>
<span id="cb8-15"><a aria-hidden="true" href="#cb8-15"></a>        <span class="cf">if</span> (p &amp; <span class="dv">1</span>) ret = ret * base % mod;</span>
<span id="cb8-16"><a aria-hidden="true" href="#cb8-16"></a>    <span class="cf">return</span> ret;</span>
<span id="cb8-17"><a aria-hidden="true" href="#cb8-17"></a>}</span>
<span id="cb8-18"><a aria-hidden="true" href="#cb8-18"></a></span>
<span id="cb8-19"><a aria-hidden="true" href="#cb8-19"></a><span class="dt">void</span> init(ll p)</span>
<span id="cb8-20"><a aria-hidden="true" href="#cb8-20"></a>{</span>
<span id="cb8-21"><a aria-hidden="true" href="#cb8-21"></a>    fact[<span class="dv">0</span>] = <span class="dv">1</span>;</span>
<span id="cb8-22"><a aria-hidden="true" href="#cb8-22"></a>    FOR(i, <span class="dv">1</span>, p)</span>
<span id="cb8-23"><a aria-hidden="true" href="#cb8-23"></a>        fact[i] = fact[i - <span class="dv">1</span>] * i % p;</span>
<span id="cb8-24"><a aria-hidden="true" href="#cb8-24"></a>    <span class="cf">return</span>;</span>
<span id="cb8-25"><a aria-hidden="true" href="#cb8-25"></a>}</span>
<span id="cb8-26"><a aria-hidden="true" href="#cb8-26"></a></span>
<span id="cb8-27"><a aria-hidden="true" href="#cb8-27"></a>ll C(<span class="dt">int</span> n, <span class="dt">int</span> m, ll p)</span>
<span id="cb8-28"><a aria-hidden="true" href="#cb8-28"></a>{</span>
<span id="cb8-29"><a aria-hidden="true" href="#cb8-29"></a>    <span class="cf">if</span> (n &lt; m) <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb8-30"><a aria-hidden="true" href="#cb8-30"></a>    <span class="cf">return</span> fact[n] * qpow(fact[m], p - <span class="dv">2</span>, p) % p * qpow(fact[n - m], p - <span class="dv">2</span>, p) % p;</span>
<span id="cb8-31"><a aria-hidden="true" href="#cb8-31"></a>}</span>
<span id="cb8-32"><a aria-hidden="true" href="#cb8-32"></a></span>
<span id="cb8-33"><a aria-hidden="true" href="#cb8-33"></a>ll Lucas(ll n, ll m, ll p)</span>
<span id="cb8-34"><a aria-hidden="true" href="#cb8-34"></a>{</span>
<span id="cb8-35"><a aria-hidden="true" href="#cb8-35"></a>    <span class="cf">if</span> (n &lt; m) <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb8-36"><a aria-hidden="true" href="#cb8-36"></a>    <span class="cf">if</span> (!n || !m) <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb8-37"><a aria-hidden="true" href="#cb8-37"></a>    <span class="cf">return</span> Lucas(n / p, m / p, p) * C(n % p, m % p, p) % p;</span>
<span id="cb8-38"><a aria-hidden="true" href="#cb8-38"></a>}</span>
<span id="cb8-39"><a aria-hidden="true" href="#cb8-39"></a></span>
<span id="cb8-40"><a aria-hidden="true" href="#cb8-40"></a>ll a[<span class="dv">5</span>];</span>
<span id="cb8-41"><a aria-hidden="true" href="#cb8-41"></a></span>
<span id="cb8-42"><a aria-hidden="true" href="#cb8-42"></a><span class="dt">int</span> main()</span>
<span id="cb8-43"><a aria-hidden="true" href="#cb8-43"></a>{</span>
<span id="cb8-44"><a aria-hidden="true" href="#cb8-44"></a>    ll n, g;</span>
<span id="cb8-45"><a aria-hidden="true" href="#cb8-45"></a>    scanf(<span class="st">"</span><span class="sc">%lld</span><span class="st"> </span><span class="sc">%lld</span><span class="st">"</span>, &amp;n, &amp;g);</span>
<span id="cb8-46"><a aria-hidden="true" href="#cb8-46"></a>    <span class="cf">if</span> (g % mod[<span class="dv">0</span>] == <span class="dv">0</span>)<span class="co">//ç‰¹åˆ¤</span></span>
<span id="cb8-47"><a aria-hidden="true" href="#cb8-47"></a>    {</span>
<span id="cb8-48"><a aria-hidden="true" href="#cb8-48"></a>        printf(<span class="st">"0</span><span class="sc">\n</span><span class="st">"</span>);</span>
<span id="cb8-49"><a aria-hidden="true" href="#cb8-49"></a>        <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb8-50"><a aria-hidden="true" href="#cb8-50"></a>    }</span>
<span id="cb8-51"><a aria-hidden="true" href="#cb8-51"></a>    FOR(k, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb8-52"><a aria-hidden="true" href="#cb8-52"></a>    {</span>
<span id="cb8-53"><a aria-hidden="true" href="#cb8-53"></a>        init(mod[k]);</span>
<span id="cb8-54"><a aria-hidden="true" href="#cb8-54"></a>        <span class="cf">for</span> (ll i = <span class="dv">1</span>; i * i &lt;= n; ++i)</span>
<span id="cb8-55"><a aria-hidden="true" href="#cb8-55"></a>        {</span>
<span id="cb8-56"><a aria-hidden="true" href="#cb8-56"></a>            <span class="cf">if</span> (n % i) <span class="cf">continue</span>;</span>
<span id="cb8-57"><a aria-hidden="true" href="#cb8-57"></a>            a[k] = (a[k] + Lucas(n, i, mod[k])) % mod[k];</span>
<span id="cb8-58"><a aria-hidden="true" href="#cb8-58"></a>            <span class="cf">if</span> (i * i != n)</span>
<span id="cb8-59"><a aria-hidden="true" href="#cb8-59"></a>                a[k] = (a[k] + Lucas(n, n / i, mod[k])) % mod[k];</span>
<span id="cb8-60"><a aria-hidden="true" href="#cb8-60"></a>        }</span>
<span id="cb8-61"><a aria-hidden="true" href="#cb8-61"></a>    }</span>
<span id="cb8-62"><a aria-hidden="true" href="#cb8-62"></a>    ll M = mod[<span class="dv">0</span>] - <span class="dv">1</span>, ans = <span class="dv">0</span>;</span>
<span id="cb8-63"><a aria-hidden="true" href="#cb8-63"></a>    FOR(i, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb8-64"><a aria-hidden="true" href="#cb8-64"></a>    {</span>
<span id="cb8-65"><a aria-hidden="true" href="#cb8-65"></a>        <span class="dt">int</span> w = M / mod[i];</span>
<span id="cb8-66"><a aria-hidden="true" href="#cb8-66"></a>        ans = (ans + a[i] * w % M * qpow(w, mod[i] - <span class="dv">2</span>, mod[i]) % M) % M;</span>
<span id="cb8-67"><a aria-hidden="true" href="#cb8-67"></a>    }</span>
<span id="cb8-68"><a aria-hidden="true" href="#cb8-68"></a>    printf(<span class="st">"</span><span class="sc">%lld\n</span><span class="st">"</span>, qpow(g, ans, mod[<span class="dv">0</span>]));</span>
<span id="cb8-69"><a aria-hidden="true" href="#cb8-69"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb8-70"><a aria-hidden="true" href="#cb8-70"></a>}</span></code></pre></div>
<h3 id="shoi2015è¶…èƒ½ç²’å­ç‚®æ”¹">[SHOI2015]è¶…èƒ½ç²’å­ç‚®Â·æ”¹</h3>
<p><a href="https://www.luogu.com.cn/problem/P4345">æ´›è°· P4345</a></p>
<h4 id="description-2">Description</h4>
<p><span class="math inline">\(t\)</span> ç»„æ•°æ®ï¼ˆ<span class="math inline">\(1\le t\le 10^5\)</span>ï¼‰ï¼Œç»™å®š <span class="math inline">\(n\)</span>ï¼Œ<span class="math inline">\(k\)</span>ï¼ˆ<span class="math inline">\(1\le n,k\le 10^{18}\)</span>ï¼‰ï¼Œæ±‚ <span class="math display">\[
\sum_{i = 0}^k\binom n k\bmod{2333}
\]</span> çš„å€¼ã€‚</p>
<h4 id="hint-2">Hint</h4>
<p>è€ƒè™‘æ‹†å¼€å¼å­ï¼Œç„¶ååˆ©ç”¨ç±»ä¼¼æ•´é™¤åˆ†å—çš„æ€æƒ³å¤„ç†ï¼Œé€’å½’æ¥åšã€‚</p>
<h4 id="solution-2">Solution</h4>
<p>ç”±äºæ•°æ®ç»„æ•°å¾ˆå¤§å¹¶ä¸” <span class="math inline">\(n\)</span> å’Œ <span class="math inline">\(k\)</span> éƒ½å¾ˆå¤§ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥å¢å¡æ–¯ç„¶åç®€å•ç›¸åŠ ï¼Œæ—¶é—´ä¼šçˆ†ç‚¸ã€‚è€ƒè™‘ä»¤ <span class="math display">\[
f(n, k) = \sum_{i = 0}^k\binom n k\bmod p
\]</span> å…¶ä¸­ <span class="math inline">\(p\)</span> å³ä¸º <span class="math inline">\(2333\)</span>ã€‚ç„¶åä½¿ç”¨å¢å¡æ–¯å®šç†æ‹†å¼€ <span class="math display">\[
\begin{aligned}f(n,k) &amp;\equiv \sum_{i = 0}^k\binom n k\\&amp;\equiv \sum_{i = 0}^k\binom{n\bmod p}{i\bmod p}\binom{\lfloor\frac np\rfloor}{\lfloor\frac ip\rfloor}\pmod p\end{aligned}
\]</span> ç°åœ¨åŒ–ç®€æˆäº†è¿™æ ·ä¹‹åï¼Œæ³¨æ„åˆ° <span class="math inline">\(p\)</span> å…¶å®å¾ˆå°ï¼Œå¯ä»¥ç±»ä¼¼æ•´é™¤åˆ†å—çš„åšæ³•ï¼ŒæŒ‰ç…§ <span class="math inline">\(\displaystyle\left\lfloor\frac ip\right\rfloor\)</span> çš„å€¼åˆ†å¼€æ¥å¤„ç†ï¼š <span class="math display">\[
f(n,k) \equiv \binom{\lfloor\frac np\rfloor}{0}\sum_{i = 0}^{p - 1}\binom{n\bmod p}{i} + \binom{\lfloor\frac np\rfloor}{1}\sum_{i = 0}^{p - 1}\binom{n\bmod p}{i} + \cdots+\binom{\lfloor\frac np\rfloor}{\lfloor\frac kp\rfloor}\sum_{i = 0}^{k\bmod p}\binom{n\bmod p}{i}\pmod p
\]</span> å‰é¢æœ‰ä» <span class="math inline">\(0\)</span> åˆ° <span class="math inline">\(\displaystyle\left\lfloor\frac kp\right\rfloor - 1\)</span> çš„æ•´å—ï¼ŒæŠŠå‰é¢æ•´å—çš„éƒ¨åˆ†æ‹å‡ºæ¥åŒ–ç®€ï¼š<br/>
<span class="math display">\[
\begin{aligned}&amp;\binom{\lfloor\frac np\rfloor}{0}\sum_{i = 0}^{p - 1}\binom{n\bmod p}{i} + \binom{\lfloor\frac np\rfloor}{1}\sum_{i = 0}^{p - 1}\binom{n\bmod p}{i} + \cdots + \binom{\lfloor\frac np\rfloor}{\left\lfloor\frac kp\right\rfloor - 1}\sum_{i = 0}^{p - 1}\binom{n\bmod p}{i}\\=&amp;\left(\sum_{i = 0}^{p - 1}\binom{n\bmod p}{i}\right)\cdot\left(\sum_{i = 0}^{\left\lfloor\frac kp\right\rfloor - 1}\binom{\lfloor\frac np\rfloor}{i}\right)\\=&amp;f(n\bmod p, p - 1)\times f(\lfloor n/p\rfloor, \lfloor k/p\rfloor - 1)\end{aligned}
\]</span> åé¢çš„ä½™é¡¹å³ä¸º <span class="math display">\[
\begin{aligned}&amp;\binom{\lfloor\frac np\rfloor}{\lfloor\frac kp\rfloor}\sum_{i = 0}^{k\bmod p}\binom{n\bmod p}{i}\\=&amp;\binom{\lfloor\frac np\rfloor}{\lfloor\frac kp\rfloor}f(n\bmod p, k\bmod p)\end{aligned}
\]</span> æœ€åæˆ‘ä»¬å¾—åˆ° <span class="math display">\[
f(n, k) =f(n\bmod p, p - 1)\times f(\lfloor n/p\rfloor, \lfloor k/p\rfloor - 1) +\binom{\lfloor\frac np\rfloor}{\lfloor\frac kp\rfloor}f(n\bmod p, k\bmod p)\bmod p
\]</span> <span class="math inline">\(\displaystyle\binom{\lfloor\frac np\rfloor}{\lfloor\frac kp\rfloor}\)</span> å¯ä»¥ç›´æ¥ Lucas å®šç†ï¼Œå‰©ä¸‹çš„é€’å½’åšå°±è¡Œï¼Œé¢„å¤„ç† <span class="math inline">\(p\)</span> ä»¥å†…çš„ <span class="math inline">\(f\)</span> å°±å¯ä»¥å¾ˆå¿«çš„åšäº†ã€‚</p>
<p>ä¸»è¦ä»£ç ï¼š</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a aria-hidden="true" href="#cb9-1"></a><span class="pp">#define int </span><span class="dt">long</span><span class="pp"> </span><span class="dt">long</span></span>
<span id="cb9-2"><a aria-hidden="true" href="#cb9-2"></a><span class="pp">#define FOR</span>(i,<span class="pp"> </span>a,<span class="pp"> </span>b)<span class="pp"> </span><span class="cf">for</span><span class="pp"> </span>(<span class="dt">int</span><span class="pp"> </span>i<span class="pp"> </span>=<span class="pp"> </span>a;<span class="pp"> </span>i<span class="pp"> </span>&lt;=<span class="pp"> </span>b;<span class="pp"> </span>++i)<span class="at">const</span><span class="pp"> </span><span class="dt">int</span><span class="pp"> </span>p<span class="pp"> </span>=<span class="pp"> </span><span class="dv">2333</span>;</span>
<span id="cb9-3"><a aria-hidden="true" href="#cb9-3"></a><span class="dt">int</span> C[p + <span class="dv">5</span>][p + <span class="dv">5</span>], f[p + <span class="dv">5</span>][p + <span class="dv">5</span>];</span>
<span id="cb9-4"><a aria-hidden="true" href="#cb9-4"></a></span>
<span id="cb9-5"><a aria-hidden="true" href="#cb9-5"></a><span class="dt">int</span> lucas(<span class="dt">int</span> n, <span class="dt">int</span> m)</span>
<span id="cb9-6"><a aria-hidden="true" href="#cb9-6"></a>{</span>
<span id="cb9-7"><a aria-hidden="true" href="#cb9-7"></a>    <span class="cf">if</span> (!m) <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb9-8"><a aria-hidden="true" href="#cb9-8"></a>    <span class="cf">return</span> C[n % p][m % p] * lucas(n / p, m / p) % p;</span>
<span id="cb9-9"><a aria-hidden="true" href="#cb9-9"></a>}</span>
<span id="cb9-10"><a aria-hidden="true" href="#cb9-10"></a></span>
<span id="cb9-11"><a aria-hidden="true" href="#cb9-11"></a><span class="dt">int</span> F(<span class="dt">int</span> n, <span class="dt">int</span> k)</span>
<span id="cb9-12"><a aria-hidden="true" href="#cb9-12"></a>{</span>
<span id="cb9-13"><a aria-hidden="true" href="#cb9-13"></a>    <span class="cf">if</span> (k &lt; <span class="dv">0</span>) <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb9-14"><a aria-hidden="true" href="#cb9-14"></a>    <span class="cf">if</span> (!k || !n) <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb9-15"><a aria-hidden="true" href="#cb9-15"></a>    <span class="cf">if</span> (n &lt; p &amp;&amp; k &lt; p) <span class="cf">return</span> f[n][k];</span>
<span id="cb9-16"><a aria-hidden="true" href="#cb9-16"></a>    <span class="cf">return</span> (lucas(n / p, k / p) * f[n % p][k % p] % p + f[n % p][p - <span class="dv">1</span>] * F(n / p, k / p - <span class="dv">1</span>) % p) % p;</span>
<span id="cb9-17"><a aria-hidden="true" href="#cb9-17"></a>}</span>
<span id="cb9-18"><a aria-hidden="true" href="#cb9-18"></a></span>
<span id="cb9-19"><a aria-hidden="true" href="#cb9-19"></a><span class="dt">signed</span> main()</span>
<span id="cb9-20"><a aria-hidden="true" href="#cb9-20"></a>{</span>
<span id="cb9-21"><a aria-hidden="true" href="#cb9-21"></a>    <span class="dt">int</span> t = read();</span>
<span id="cb9-22"><a aria-hidden="true" href="#cb9-22"></a>    C[<span class="dv">0</span>][<span class="dv">0</span>] = <span class="dv">1</span>;</span>
<span id="cb9-23"><a aria-hidden="true" href="#cb9-23"></a>    FOR(i, <span class="dv">1</span>, p)</span>
<span id="cb9-24"><a aria-hidden="true" href="#cb9-24"></a>    {</span>
<span id="cb9-25"><a aria-hidden="true" href="#cb9-25"></a>        C[i][<span class="dv">0</span>] = C[i][i] = <span class="dv">1</span>;</span>
<span id="cb9-26"><a aria-hidden="true" href="#cb9-26"></a>        FOR(j, <span class="dv">1</span>, i - <span class="dv">1</span>)</span>
<span id="cb9-27"><a aria-hidden="true" href="#cb9-27"></a>            C[i][j] = (C[i - <span class="dv">1</span>][j] + C[i - <span class="dv">1</span>][j - <span class="dv">1</span>]) % p;</span>
<span id="cb9-28"><a aria-hidden="true" href="#cb9-28"></a>    }</span>
<span id="cb9-29"><a aria-hidden="true" href="#cb9-29"></a>    f[<span class="dv">0</span>][<span class="dv">0</span>] = <span class="dv">1</span>;</span>
<span id="cb9-30"><a aria-hidden="true" href="#cb9-30"></a>    FOR(i, <span class="dv">1</span>, p)</span>
<span id="cb9-31"><a aria-hidden="true" href="#cb9-31"></a>        f[i][<span class="dv">0</span>] = <span class="dv">1</span>;</span>
<span id="cb9-32"><a aria-hidden="true" href="#cb9-32"></a>    FOR(i, <span class="dv">0</span>, p)</span>
<span id="cb9-33"><a aria-hidden="true" href="#cb9-33"></a>        FOR(j, <span class="dv">1</span>, p)</span>
<span id="cb9-34"><a aria-hidden="true" href="#cb9-34"></a>            f[i][j] = (C[i][j] + f[i][j - <span class="dv">1</span>]) % p;</span>
<span id="cb9-35"><a aria-hidden="true" href="#cb9-35"></a>    <span class="cf">while</span> (t--)</span>
<span id="cb9-36"><a aria-hidden="true" href="#cb9-36"></a>    {</span>
<span id="cb9-37"><a aria-hidden="true" href="#cb9-37"></a>        <span class="dt">int</span> n = read(), k = read();</span>
<span id="cb9-38"><a aria-hidden="true" href="#cb9-38"></a>        printf(<span class="st">"</span><span class="sc">%lld\n</span><span class="st">"</span>, F(n, k));</span>
<span id="cb9-39"><a aria-hidden="true" href="#cb9-39"></a>    }</span>
<span id="cb9-40"><a aria-hidden="true" href="#cb9-40"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb9-41"><a aria-hidden="true" href="#cb9-41"></a>}</span></code></pre></div>
<p>éœ€è¦æ³¨æ„é¢„å¤„ç† <span class="math inline">\(f\)</span> çš„æ—¶å€™ <span class="math inline">\(f(0, i) = 1\)</span>ï¼Œå¦‚æœè¿™é‡Œæ²¡å¤„ç†çš„è¯ä¼šåªæœ‰ 55ptsã€‚</p>
<h3 id="æ¸…åé›†è®­2016-ç»„åˆæ•°é—®é¢˜">[æ¸…åé›†è®­2016] ç»„åˆæ•°é—®é¢˜</h3>
<p><a href="https://www.luogu.com.cn/problem/P6669">æ´›è°· P6669</a></p>
<h4 id="description-3">Description</h4>
<p>ç»™å®š <span class="math inline">\(n\)</span>ã€<span class="math inline">\(m\)</span> å’Œ <span class="math inline">\(k\)</span>ï¼Œé—® <span class="math inline">\(\forall 0\le i\le n, 0\le j\le \min(i, m)\)</span> æœ‰å¤šå°‘å¯¹ <span class="math inline">\((i, j)\)</span> æ»¡è¶³ <span class="math inline">\(k\mid \dbinom i j\)</span></p>
<p>ç­”æ¡ˆå¯¹ <span class="math inline">\(10^9 + 7\)</span> å–æ¨¡ï¼Œ<span class="math inline">\(t\)</span> ç»„æ•°æ®ï¼Œ<span class="math inline">\(k\)</span> ä¸ºä¸€ä¸ªç´ æ•°ï¼Œ<span class="math inline">\(1\le n,m\le 10^{18}\)</span>ï¼Œ<span class="math inline">\(1\le t,k \le 100\)</span>ã€‚</p>
<h4 id="hint-3">Hint</h4>
<p>è€ƒè™‘ Lucas å®šç†åœ¨ <span class="math inline">\(p\)</span> è¿›åˆ¶ä¸‹çš„é‚£ç§å½¢å¼ã€‚</p>
<h4 id="solution-3">Solution</h4>
<p>æ€»è€Œè¨€ä¹‹å°±æ˜¯ <span class="math inline">\(p\)</span> è¿›åˆ¶ä¸‹ <span class="math inline">\(i\)</span> çš„æ¯ä¸€ä½éƒ½ä¸èƒ½å°äº <span class="math inline">\(j\)</span>ï¼Œè¿™ä¸ªä¸œè¥¿å¯ä»¥æ•°ä½ dpï¼</p>
<p>ä»£ç å¾ˆçŸ­ï¼</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a aria-hidden="true" href="#cb10-1"></a><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</span>
<span id="cb10-2"><a aria-hidden="true" href="#cb10-2"></a><span class="at">const</span> ll mod = <span class="fl">1e9</span> + <span class="dv">7</span>;</span>
<span id="cb10-3"><a aria-hidden="true" href="#cb10-3"></a>ll t, k, n, m, bn[<span class="dv">66</span>], bm[<span class="dv">66</span>];</span>
<span id="cb10-4"><a aria-hidden="true" href="#cb10-4"></a>ll f[<span class="dv">66</span>][<span class="dv">2</span>][<span class="dv">2</span>][<span class="dv">2</span>][<span class="dv">2</span>];</span>
<span id="cb10-5"><a aria-hidden="true" href="#cb10-5"></a></span>
<span id="cb10-6"><a aria-hidden="true" href="#cb10-6"></a>ll solve(<span class="dt">int</span> cur, <span class="dt">bool</span> ok, <span class="dt">bool</span> dif, <span class="dt">bool</span> fn, <span class="dt">bool</span> fm) {</span>
<span id="cb10-7"><a aria-hidden="true" href="#cb10-7"></a>    <span class="cf">if</span> (!cur) <span class="cf">return</span> ok;</span>
<span id="cb10-8"><a aria-hidden="true" href="#cb10-8"></a>    ll &amp;res = f[cur][ok][dif][fn][fm];</span>
<span id="cb10-9"><a aria-hidden="true" href="#cb10-9"></a>    <span class="cf">if</span> (~res) <span class="cf">return</span> res;</span>
<span id="cb10-10"><a aria-hidden="true" href="#cb10-10"></a>    res = <span class="dv">0</span>;</span>
<span id="cb10-11"><a aria-hidden="true" href="#cb10-11"></a>    <span class="dt">int</span> upn = fn ? k - <span class="dv">1</span> : bn[cur], upm = fm ? k - <span class="dv">1</span> : bm[cur];</span>
<span id="cb10-12"><a aria-hidden="true" href="#cb10-12"></a>    FOR(i, <span class="dv">0</span>, upn)</span>
<span id="cb10-13"><a aria-hidden="true" href="#cb10-13"></a>        <span class="cf">for</span> (<span class="dt">int</span> j = <span class="dv">0</span>; (j &lt;= i || dif) &amp;&amp; j &lt;= upm; ++j)</span>
<span id="cb10-14"><a aria-hidden="true" href="#cb10-14"></a>            res = (res + solve(cur - <span class="dv">1</span>, ok | (i &lt; j), dif | (i != j), fn | (i &lt; upn), fm | (j &lt; upm))) % mod;</span>
<span id="cb10-15"><a aria-hidden="true" href="#cb10-15"></a>    <span class="cf">return</span> res;</span>
<span id="cb10-16"><a aria-hidden="true" href="#cb10-16"></a>}</span>
<span id="cb10-17"><a aria-hidden="true" href="#cb10-17"></a></span>
<span id="cb10-18"><a aria-hidden="true" href="#cb10-18"></a><span class="dt">int</span> main() {</span>
<span id="cb10-19"><a aria-hidden="true" href="#cb10-19"></a>    read(t), read(k);</span>
<span id="cb10-20"><a aria-hidden="true" href="#cb10-20"></a>    <span class="cf">while</span> (t--) {</span>
<span id="cb10-21"><a aria-hidden="true" href="#cb10-21"></a>        read(n), read(m);</span>
<span id="cb10-22"><a aria-hidden="true" href="#cb10-22"></a>        ll mx = n &gt; m ? n : m, len = <span class="dv">0</span>;</span>
<span id="cb10-23"><a aria-hidden="true" href="#cb10-23"></a>        memset(f, -<span class="dv">1</span>, <span class="kw">sizeof</span> f);</span>
<span id="cb10-24"><a aria-hidden="true" href="#cb10-24"></a>        <span class="cf">while</span> (mx) mx /= k, ++len;</span>
<span id="cb10-25"><a aria-hidden="true" href="#cb10-25"></a>        FOR(i, <span class="dv">1</span>, len) bn[i] = n % k, n /= k;</span>
<span id="cb10-26"><a aria-hidden="true" href="#cb10-26"></a>        FOR(i, <span class="dv">1</span>, len) bm[i] = m % k, m /= k;</span>
<span id="cb10-27"><a aria-hidden="true" href="#cb10-27"></a>        print(solve(len, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)), putchar(<span class="ch">'</span><span class="sc">\n</span><span class="ch">'</span>);</span>
<span id="cb10-28"><a aria-hidden="true" href="#cb10-28"></a>    }</span>
<span id="cb10-29"><a aria-hidden="true" href="#cb10-29"></a>    <span class="cf">return</span> output(), <span class="dv">0</span>;</span>
<span id="cb10-30"><a aria-hidden="true" href="#cb10-30"></a>}</span></code></pre></div>
<h3 id="å…¶ä»–çš„å¥½é¢˜">å…¶ä»–çš„å¥½é¢˜</h3>
<p>ç¯‡å¹…é™åˆ¶ï¼Œä¸æ”¾åœ¨è¿™é‡Œäº†ã€‚ä¸‹é¢ç»™å‡ºé¢˜è§£é“¾æ¥ï¼š</p>
<ul>
<li><a href="http://www.51nod.com/Challenge/Problem.html#problemId=1778">51nod1778 å°Qçš„é›†åˆ</a> <a href="/sol-51nod1778/">æ¨å¼å­å¥½é¢˜</a></li>
<li><a href="https://www.luogu.com.cn/problem/P3301">æ´›è°·<strong>P3301</strong> [SDOI2013]æ–¹ç¨‹</a> <a href="/sol-luogu-p3301/">å®¹æ–¥ + æ‰©å±• Lucas</a></li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>é‚£ä¹ˆå¯¹äº Lucas å®šç†åŠå…¶æ‰©å±•çš„å­¦ä¹ å°±å‘Šä¸€æ®µè½äº†ï¼Œé™¤äº†è¿™äº›åˆ—å‡ºæ¥çš„ä¹ é¢˜å¤–ï¼ŒLucas å®šç†è¿˜å¯èƒ½å‡ºç°åœ¨æŸäº›æ¯’ç˜¤ç»„åˆé¢˜è¦ä½ æ±‚ç»„åˆæ•°å–æ¨¡çš„å€¼çš„æ—¶å€™ï¼Œæ€»çš„æ¥è¯´ Lucas å®šç†æœ¬èº«è¿˜æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ¸…æ–°ä¼˜ç¾çš„å®šç†çš„ã€‚</p>
<p>çœé€‰çˆ†ç‚¸æ²¡è¿›çœé˜Ÿçš„è’Ÿè’»ç¥å„ä½ NOI åŠ æ²¹ã€‚</p>
</section>
<footer class="article-footer">
<section class="article-tags">
<a href="/tags/OI/">OI</a>
<a href="/tags/note/">ç¬”è®°</a>
<a href="/tags/lucas/">Lucaså®šç†</a>
</section>
<section class="article-copyright">
<svg class="icon icon-tabler icon-tabler-copyright" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" stroke="none"></path>
<circle cx="12" cy="12" r="9"></circle>
<path d="M14.5 9a3.5 4 0 1 0 0 6"></path>
</svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" rel="stylesheet"/><script crossorigin="anonymous" defer="" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js">
</script><script crossorigin="anonymous" defer="" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js">
</script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
</article>
<aside class="related-contents--wrapper">
<h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
<div class="related-contents">
<div class="flex article-list--tile">
<article class="has-image">
<a href="/note-gf/">
<div class="article-image">
<img data-hash="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg28.webp" data-key="" loading="lazy" src="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg28.webp"/>
</div>
<div class="article-details">
<h2 class="article-title">ç”Ÿæˆå‡½æ•°èƒ¡æ‰¯</h2>
</div>
</a>
</article>
<article class="has-image">
<a href="/note-set-power-series/">
<div class="article-image">
<img data-hash="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg39.webp" data-key="" loading="lazy" src="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg39.webp"/>
</div>
<div class="article-details">
<h2 class="article-title">é›†åˆå¹‚çº§æ•°èƒ¡æ‰¯</h2>
</div>
</a>
</article>
<article class="has-image">
<a href="/note-linear-basis/">
<div class="article-image">
<img data-hash="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg19.webp" data-key="" loading="lazy" src="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg19.webp"/>
</div>
<div class="article-details">
<h2 class="article-title">çº¿æ€§åŸºå­¦ä¹ ç¬”è®°</h2>
</div>
</a>
</article>
<article class="has-image">
<a href="/note-wqs/">
<div class="article-image">
<img data-hash="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg28.webp" data-key="" loading="lazy" src="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg28.webp"/>
</div>
<div class="article-details">
<h2 class="article-title">wqs äºŒåˆ†å­¦ä¹ ç¬”è®°</h2>
</div>
</a>
</article>
<article class="has-image">
<a href="/note-builtin/">
<div class="article-image">
<img data-hash="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg9.webp" data-key="" loading="lazy" src="https://yangty-pic.oss-cn-beijing.aliyuncs.com/bg9.webp"/>
</div>
<div class="article-details">
<h2 class="article-title">__builtin ç³»åˆ—å‡½æ•°æ€»ç»“</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<footer class="site-footer">
<section class="copyright">
        Â© 
        
            2019 - 
        
        2024 æ¸…çƒ›çš„åšå®¢
    </section>
<section class="powerby">
        Built with <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo</a> <br/>
        ä¸»é¢˜ <b><a data-version="3.11.0" href="https://github.com/CaiJimmy/hugo-theme-stack" rel="noopener" target="_blank">Stack</a></b> ç”± <a href="https://jimmycai.com" rel="noopener" target="_blank">Jimmy</a> è®¾è®¡
    </section>
</footer>
<div aria-hidden="true" class="pswp" role="dialog" tabindex="-1">
<div class="pswp__bg"></div>
<div class="pswp__scroll-wrap">
<div class="pswp__container">
<div class="pswp__item"></div>
<div class="pswp__item"></div>
<div class="pswp__item"></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class="pswp__top-bar">
<div class="pswp__counter"></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title="Share"></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class="pswp__preloader">
<div class="pswp__preloader__icn">
<div class="pswp__preloader__cut">
<div class="pswp__preloader__donut"></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class="pswp__share-tooltip"></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class="pswp__caption">
<div class="pswp__caption__center"></div>
</div>
</div>
</div>
</div><script crossorigin="anonymous" defer="" integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js">
</script><script crossorigin="anonymous" defer="" integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js">
</script><link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css" integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" rel="stylesheet"/><link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css" integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" rel="stylesheet"/>
</main>
</div>
<script crossorigin="anonymous" integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js">
</script><script defer="" src="/ts/main.js" type="text/javascript"></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>
</body>
</html>
